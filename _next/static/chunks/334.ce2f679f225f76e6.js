"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[334],{5334:(e,t,r)=>{r.r(t),r.d(t,{default:()=>u});var n=r(5155),s=r(9137),i=r.n(s),a=r(2115);class c{initialize(){this.isReady=!0,this._triggerEvent("WORKER_READY",{})}sendMessage(e,t,r){queueMicrotask(()=>{try{let n=this._processMessage(e,t);r&&r(n)}catch(t){console.error("[WorkerManager] メッセージ処理エラー(".concat(e,"):"),t),r&&r({error:t.message})}})}addEventListener(e,t){return this.eventListeners[e]||(this.eventListeners[e]=[]),this.eventListeners[e].push(t),()=>{this.removeEventListener(e,t)}}removeEventListener(e,t){this.eventListeners[e]&&(this.eventListeners[e]=this.eventListeners[e].filter(e=>e!==t))}_triggerEvent(e,t){if(!this.eventListeners[e])return;let r=Date.now(),n={...t,timestamp:r};this.eventListeners[e].forEach(t=>{try{t(n)}catch(t){console.error("[WorkerManager] イベントハンドラエラー(".concat(e,"):"),t)}})}_processMessage(e,t){switch(e){case"PING":return{type:"PONG",timestamp:Date.now()};case"START_ANIMATION":return this._triggerEvent("ANIMATION_FRAME",{keyStates:{},effects:[],animationProgress:[]}),{success:!0};case"PROCESS_EFFECTS":return this._triggerEvent("EFFECTS_UPDATE",{effects:[]}),{success:!0};default:return{error:"未知のメッセージタイプ: ".concat(e)}}}setProcessingModes(e){return console.log("[WorkerManager] 処理モード設定:",e),{success:!0,currentModes:{typing:"main-thread",effects:"main-thread",statistics:"main-thread"}}}terminate(){this.eventListeners={},console.log("[WorkerManager] 終了: ".concat(this.workerPath))}constructor(e,t={}){this.workerPath=e,this.options=t,this.callbacks={},this.isReady=!0,this.eventListeners={},console.log("[WorkerManager] メインスレッドモードで初期化: ".concat(e))}}function o(){let e=(0,a.useRef)(null),[t,r]=(0,a.useState)({isRunning:!1,nextKey:"",effects:[],keyStates:{},animationProgress:[],lastUpdate:0}),n=(0,a.useRef)(null),s=(0,a.useRef)([]);(0,a.useEffect)(()=>{let t=new c("../workers/animation-worker.js");return e.current=t,t.initialize(),()=>{n.current&&(cancelAnimationFrame(n.current),n.current=null),s.current.forEach(e=>e()),s.current=[]}},[]);let i=(0,a.useCallback)(()=>{e.current&&!t.isRunning&&e.current.sendMessage("START_ANIMATION",{},e=>{if(e.success){r(e=>({...e,isRunning:!0}));let e=()=>{let s={keyStates:{...t.keyStates},effects:[...t.effects],animationProgress:[...t.animationProgress],timestamp:Date.now()};r(e=>({...e,...s})),n.current=requestAnimationFrame(e)};n.current=requestAnimationFrame(e)}})},[t.isRunning]),o=(0,a.useCallback)(()=>{e.current&&t.isRunning&&(n.current&&(cancelAnimationFrame(n.current),n.current=null),e.current.sendMessage("STOP_ANIMATION",{},()=>{r(e=>({...e,isRunning:!1}))}))},[t.isRunning]);return{animationState:t,startAnimation:i,stopAnimation:o,processKeyEvent:(0,a.useCallback)(t=>{e.current&&(e.current.sendMessage("PROCESS_KEY_EVENT",t),r(e=>{let r={...e.keyStates},{key:n,isDown:s}=t;return s?r[n]={pressed:!0,timestamp:Date.now()}:r[n]&&(r[n].pressed=!1),{...e,keyStates:r}}))},[]),addEffect:(0,a.useCallback)(t=>{e.current&&(e.current.sendMessage("ADD_EFFECT",t),r(e=>{let r=[...e.effects,{...t,id:"effect_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),createdAt:Date.now()}];return{...e,effects:r}}))},[]),isRunning:t.isRunning}}let l=e=>{let{nextKey:t="",lastPressedKey:r="",isError:s=!1,className:i=""}=e,c=(0,a.useRef)(null),{animationState:l,startAnimation:u,stopAnimation:d,handleKeyPress:g,setNextKey:f,isReady:m}=o(),h=(0,a.useMemo)(()=>[[["1","!"],["2",'"'],["3","#"],["4","$"],["5","%"],["6","&"],["7","'"],["8","("],["9",")"],["0",""],["-","="],["^","~"],["\\","|"]],[["q","Q"],["w","W"],["e","E"],["r","R"],["t","T"],["y","Y"],["u","U"],["i","I"],["o","O"],["p","P"],["@","`"],["[","{"]],[["a","A"],["s","S"],["d","D"],["f","F"],["g","G"],["h","H"],["j","J"],["k","K"],["l","L"],[";","+"],[":","*"],["]","}"]],[["z","Z"],["x","X"],["c","C"],["v","V"],["b","B"],["n","N"],["m","M"],[",","<"],[".",">"],["/","?"],["\\","_"]],[["space","space"]]],[]),p=(0,a.useMemo)(()=>({primary:"#FF8C00",primaryLight:"#FFB41E",primaryDark:"#C86400",primaryGlow:"rgba(255, 140, 0, 0.5)",bgDark:"#0A0D14",bgMid:"#0F141E",bgLight:"#191E2D",error:"#FF3C3C",errorGlow:"rgba(255, 60, 60, 0.6)",textLight:"#F0F0F0",textMid:"#C8C8C8",textDim:"#B4B4B4"}),[]);return(0,a.useEffect)(()=>{m&&(t!==l.nextKey&&f(t),r&&g(r,s))},[t,r,s,m,l.nextKey,f,g]),(0,a.useEffect)(()=>{if(!c.current||!m)return;let e=c.current,r=e.getContext("2d"),n=()=>{let t=window.devicePixelRatio||1;return e.width=800*t,e.height=280*t,e.style.width="".concat(800,"px"),e.style.height="".concat(280,"px"),{width:800,height:280,scale:t}},{width:s,height:i,scale:a}=n(),o=()=>n();window.addEventListener("resize",o);let g=(e,t,r)=>{e.strokeStyle="rgba(255, 140, 0, 0.07)",e.lineWidth=1,e.beginPath();for(let n=0;n<r;n+=60)e.moveTo(0,n),e.lineTo(t,n);for(let n=0;n<t;n+=60)e.moveTo(n,0),e.lineTo(n,r);e.stroke()},f=(e,t)=>{e.fillStyle="rgba(10, 13, 20, 0.8)",e.fillRect(t/2-380,40,760,220),e.strokeStyle=p.primary,e.lineWidth=2,e.beginPath(),e.rect(t/2-384,36,768,228),e.stroke(),e.fillStyle=p.primary,e.fillRect(t/2-384-3,33,6,6),e.fillRect(t/2+384-3,33,6,6),e.fillRect(t/2-384-3,261,6,6),e.fillRect(t/2+384-3,261,6,6);let r=t/2-384+Date.now()/3e3%1*768;e.strokeStyle="rgba(255, 140, 0, 0.25)",e.lineWidth=1,e.beginPath(),e.moveTo(r,36),e.lineTo(r,264),e.stroke()},x=(e,r,n)=>{let s=h.reduce((e,t)=>Math.max(e,t.reduce((e,t)=>e+("space"===t[0]?240:48)+5,0)),0),i=(r-s)/2;h.forEach((r,a)=>{let c=i+(s-r.reduce((e,t)=>e+("space"===t[0]?240:48)+5,0))/2,o=50+39*a;r.forEach(r=>{let s,i,[a,l]=r,u="space"===a,d=u?240:48,g=a.toLowerCase(),f=g===(null==t?void 0:t.toLowerCase())&&""!==t,m=n[g],h=(null==m?void 0:m.pressed)||!1,x=(null==m?void 0:m.error)||!1;if(f){s=p.primaryDark,i=p.primary;let t=.5*Math.sin(Date.now()/400)+.5;t>.4&&(e.fillStyle="rgba(255, 140, 0, ".concat(Math.min(.15,.2*t),")"),e.fillRect(c-2,o-2,d+4,38))}else h?x?(s=p.error,i=p.error):(s=p.primaryLight,i=p.primary):(s=p.bgMid,i="rgba(50, 55, 70, 0.8)");if(e.fillStyle=s,e.fillRect(c,o,d,34),e.strokeStyle=i,e.lineWidth=f?2:1,e.strokeRect(c,o,d,34),f&&(e.fillStyle="rgba(255, 200, 100, 0.5)",e.fillRect(c+d-6,o+4,2,2)),e.fillStyle=f||h?p.textLight:p.textMid,e.font="bold ".concat(u?14:13,"px monospace"),e.textAlign="center",e.textBaseline="middle",u?(e.fillText("SPACE",c+d/2,o+17),f&&(e.strokeStyle="rgba(255, 140, 0, 0.5)",e.beginPath(),e.moveTo(c+15,o+17),e.lineTo(c+d-15,o+17),e.stroke())):(e.fillText(a.toUpperCase(),c+d/2,o+17),f&&l&&l!==a.toUpperCase()&&(e.fillStyle=p.textDim,e.font="bold 8px monospace",e.fillText(l,c+d-8,o+8))),f){let t=Date.now()/600,r=1.5*Math.sin(t),n=.4+.15*Math.sin(t);e.strokeStyle="rgba(255, 154, 40, ".concat(n.toFixed(2),")"),e.lineWidth=1.5,e.setLineDash([3,3]),e.beginPath(),e.rect(c-2-r/2,o-2-r/2,d+4+r,38+r),e.stroke(),e.setLineDash([])}c+=d+5})})};u();let y=setInterval(()=>{r.clearRect(0,0,e.width,e.height),r.globalAlpha=1,r.globalCompositeOperation="source-over",r.setTransform(1,0,0,1,0,0),r.scale(a,a),g(r,s,i),f(r,s),x(r,s,l.keyStates)},1e3/30);return()=>{d(),window.removeEventListener("resize",o),clearInterval(y)}},[p,h,t,l.keyStates,m,u,d]),(0,n.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center",margin:"10px auto 30px",padding:0,position:"relative",overflow:"visible"},className:i,children:(0,n.jsx)("canvas",{ref:c,style:{display:"block",width:"800px",height:"280px",imageRendering:"pixelated"},"aria-label":"レトロスタイルのタイピングキーボード（Worker対応）"})})},u=()=>{let[e,t]=(0,a.useState)({nextKey:"a",lastPressedKey:"",isError:!1,score:0}),{animationState:r,startAnimation:s}=o(),{effectsState:u,startEffects:d,addKeyEffect:g,playSound:f}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,a.useRef)(null),[r,n]=(0,a.useState)({isRunning:!1,effects:[],lastUpdate:0,config:{soundEnabled:!0,visualEffectsEnabled:!0,...e}}),s=(0,a.useRef)(null);(0,a.useRef)({});let i=(0,a.useRef)([]);(0,a.useEffect)(()=>{let e=new c("../workers/effects-worker.js");if(t.current=e,e.initialize(),r.config.soundEnabled&&"undefined"!=typeof AudioContext)try{s.current=new AudioContext}catch(e){console.warn("[useEffectsWorker] AudioContext初期化エラー:",e)}return()=>{s.current&&s.current.close().catch(console.error),i.current.forEach(e=>e()),i.current=[]}},[r.config.soundEnabled]);let o=(0,a.useCallback)(()=>{t.current&&!r.isRunning&&t.current.sendMessage("START_EFFECTS",{config:r.config},e=>{e.success&&n(e=>({...e,isRunning:!0}))})},[r.config,r.isRunning]),l=(0,a.useCallback)(()=>{t.current&&r.isRunning&&t.current.sendMessage("STOP_EFFECTS",{},()=>{n(e=>({...e,isRunning:!1}))})},[r.isRunning]),u=(0,a.useCallback)(e=>{t.current&&r.isRunning&&(t.current.sendMessage("PROCESS_KEY_EVENT",e),r.config.soundEnabled&&e.isDown&&f(e.key))},[r.config.soundEnabled,r.isRunning]),d=(0,a.useCallback)(e=>{t.current&&r.isRunning&&(t.current.sendMessage("ADD_EFFECT",e),n(t=>{let r=[...t.effects,{...e,id:"effect_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),createdAt:Date.now()}];return{...t,effects:r,lastUpdate:Date.now()}}),e.sound&&r.config.soundEnabled&&m(e.sound))},[r.config.soundEnabled,r.isRunning]),g=(0,a.useCallback)(e=>{n(t=>({...t,config:{...t.config,...e}})),t.current&&t.current.sendMessage("UPDATE_CONFIG",{config:{...r.config,...e}})},[r.config]),f=e=>{if(s.current)try{let e=s.current.createOscillator(),t=s.current.createGain();e.type="sine",e.frequency.setValueAtTime(440+100*Math.random(),s.current.currentTime),t.gain.setValueAtTime(.1,s.current.currentTime),t.gain.exponentialRampToValueAtTime(.001,s.current.currentTime+.1),e.connect(t),t.connect(s.current.destination),e.start(),e.stop(s.current.currentTime+.1)}catch(e){console.warn("[useEffectsWorker] サウンド再生エラー:",e)}},m=e=>{if(s.current)try{let t=s.current.createOscillator(),r=s.current.createGain();switch(e){case"success":t.type="sine",t.frequency.setValueAtTime(880,s.current.currentTime),t.frequency.exponentialRampToValueAtTime(440,s.current.currentTime+.2),r.gain.setValueAtTime(.2,s.current.currentTime),r.gain.exponentialRampToValueAtTime(.001,s.current.currentTime+.2);break;case"error":t.type="sawtooth",t.frequency.setValueAtTime(220,s.current.currentTime),r.gain.setValueAtTime(.15,s.current.currentTime),r.gain.exponentialRampToValueAtTime(.001,s.current.currentTime+.3);break;default:t.type="triangle",t.frequency.setValueAtTime(600,s.current.currentTime),r.gain.setValueAtTime(.1,s.current.currentTime),r.gain.exponentialRampToValueAtTime(.001,s.current.currentTime+.1)}t.connect(r),r.connect(s.current.destination),t.start(),t.stop(s.current.currentTime+.3)}catch(e){console.warn("[useEffectsWorker] エフェクトサウンド再生エラー:",e)}};return{effects:r.effects,isRunning:r.isRunning,config:r.config,startEffects:o,stopEffects:l,processKeyEvent:u,addEffect:d,updateConfig:g}}();(0,a.useEffect)(()=>{s(),d();let r=r=>{let n=r.key.toLowerCase(),s=n===e.nextKey.toLowerCase();t(e=>({...e,lastPressedKey:n,isError:!s,score:s?e.score+1:e.score,nextKey:s?m():e.nextKey})),g(n,!s)};return window.addEventListener("keydown",r),()=>{window.removeEventListener("keydown",r)}},[s,d,g,e.nextKey]);let m=()=>{let e="abcdefghijklmnopqrstuvwxyz";return e.charAt(Math.floor(Math.random()*e.length))};return(0,n.jsxs)("div",{className:"jsx-92c9c050417d907 typing-game-container",children:[(0,n.jsx)("h1",{className:"jsx-92c9c050417d907",children:"Worker対応タイピングゲーム"}),(0,n.jsxs)("div",{className:"jsx-92c9c050417d907 typing-stats",children:[(0,n.jsxs)("p",{className:"jsx-92c9c050417d907",children:["スコア: ",e.score]}),(0,n.jsxs)("p",{className:"jsx-92c9c050417d907",children:["次のキー: ",e.nextKey.toUpperCase()]}),e.lastPressedKey&&(0,n.jsxs)("p",{className:"jsx-92c9c050417d907",children:["最後に押されたキー: ",e.lastPressedKey.toUpperCase(),e.isError?" (不正解)":" (正解)"]})]}),(0,n.jsx)(l,{nextKey:e.nextKey,lastPressedKey:e.lastPressedKey,isError:e.isError}),(0,n.jsx)("div",{className:"jsx-92c9c050417d907 debug-info",children:(0,n.jsxs)("details",{className:"jsx-92c9c050417d907",children:[(0,n.jsx)("summary",{className:"jsx-92c9c050417d907",children:"デバッグ情報"}),(0,n.jsxs)("p",{className:"jsx-92c9c050417d907",children:["アニメーションWorker: ",r.isRunning?"実行中":"停止"]}),(0,n.jsxs)("p",{className:"jsx-92c9c050417d907",children:["エフェクトWorker: ",u.isRunning?"実行中":"停止"]}),(0,n.jsxs)("p",{className:"jsx-92c9c050417d907",children:["アクティブエフェクト数: ",u.effects.length]})]})}),(0,n.jsx)(i(),{id:"92c9c050417d907",children:".typing-game-container.jsx-92c9c050417d907{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;max-width:800px;margin:0 auto;padding:20px}.typing-stats.jsx-92c9c050417d907{margin-bottom:20px;padding:15px;background:rgba(10,13,20,.8);-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;width:100%}.typing-stats.jsx-92c9c050417d907 p.jsx-92c9c050417d907{margin:5px 0}.debug-info.jsx-92c9c050417d907{margin-top:20px;width:100%;font-size:.9rem;color:#888}"})]})}}}]);