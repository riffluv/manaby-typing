"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[344],{9344:(e,t,i)=>{i.d(t,{Ay:()=>u,Pz:()=>h,Rz:()=>d});var r=i(5155),s=i(2115);i(9509).env.NEXT_PUBLIC_GITHUB_REPO;let n={debug:function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r]},info:function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r]},error:function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];console.error(e,...i)}};class c{initialize(){return new Promise((e,t)=>{try{return n.info("[MCPUtils] 環境変数でMCPが無効化されています（本番環境モード）"),e({status:"disabled",reason:"production_mode"})}catch(e){n.error("[MCPUtils] MCP初期化の例外:",e),t(e)}})}_extendMCP(){}_initializeTypingMCP(){return new Promise((e,t)=>{try{return n.info("[MCPUtils] 環境変数によりMCPタイピングモデルの初期化をスキップします（本番環境モード）"),e({status:"disabled",reason:"production_mode"})}catch(e){n.error("[MCPUtils] タイピングゲームのMCP初期化の例外:",e),t(e)}})}_initializeAudioMCP(){return new Promise(e=>(n.info("[MCPUtils] 環境変数によりMCPオーディオモジュールの初期化をスキップします（本番環境モード）"),e({status:"disabled",reason:"production_mode"})))}get isAvailable(){return!1}isMCPAvailable(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!!e&&{available:!1,status:"disabled",reason:"production_mode",time:Date.now()}}async checkConnection(){let e=this.isMCPAvailable(!0);if(!e.available)return e;try{let t=await new Promise(e=>{let t=setTimeout(()=>{e({success:!1,reason:"timeout"})},1e3);if(window._mcp.send){var i,r;let s=i=>{var r,n;clearTimeout(t),null==(r=(n=window._mcp).off)||r.call(n,"pong",s),e({success:!0,response:i})};null==(i=(r=window._mcp).on)||i.call(r,"pong",s),window._mcp.send("ping",{timestamp:Date.now()})}else clearTimeout(t),e({success:!1,reason:"no_send_method"})});return e.pingCheck=t,e.alive=t.success,e}catch(t){return e.pingCheck={success:!1,error:t.message},e.alive=!1,e}}}class o{initialize(){return Promise.resolve()}setContext(e){if(this.mcpEnabled&&e)try{if(this.context={...this.context,...e,updatedAt:new Date().toISOString()},window._mcp){var t,i;null==(t=(i=window._mcp).setContext)||t.call(i,this.context),n.debug("[MCP] コンテキストを設定しました:",this.context)}}catch(e){n.error("[MCP] コンテキスト設定エラー:",e)}}get isActive(){return this.mcpEnabled&&!!this.context.id}recordTypingInput(e){if(this.mcpEnabled)try{let t={timestamp:Date.now(),...e,contextType:"typing-event",source:e.fromWorker?"worker":"main-thread",isAnalyticsOnly:e.isAnalyticsOnly||!1};this.metricsBuffer.push(t),this.analyticsData.totalEvents++;let i=e.isBackspace?"backspace":"char";this.analyticsData.eventTypes[i]=(this.analyticsData.eventTypes[i]||0)+1;let r=e.isHighFrequency?50:100;this.metricsBuffer.length>=r&&!this.isBackgroundProcessing&&this._scheduleBackgroundFlush()}catch(e){n.error("[MCP] タイピング記録エラー:",e)}}recordGameEvent(e){if(this.mcpEnabled)try{let t={timestamp:Date.now(),...e,contextType:"game-event",isAnalyticsOnly:!0};this.metricsBuffer.push(t),this.analyticsData.totalEvents++,this.metricsBuffer.length>=50&&!this.isBackgroundProcessing&&this._scheduleBackgroundFlush()}catch(e){n.error("[MCP] ゲームイベント記録エラー:",e)}}recordPerformanceMetric(e){if(this.mcpEnabled)try{let t={timestamp:Date.now(),...e,contextType:"performance-metric",isAnalyticsOnly:!0};this.metricsBuffer.push(t),this.analyticsData.totalEvents++,this.metricsBuffer.length>=100&&!this.isBackgroundProcessing&&this._scheduleBackgroundFlush()}catch(e){n.error("[MCP] パフォーマンス記録エラー:",e)}}recordUXElement(e){if(this.mcpEnabled)try{let t={timestamp:Date.now(),...e,contextType:"ux-element",isAnalyticsOnly:!0};this.metricsBuffer.push(t),this.analyticsData.totalEvents++,this.metricsBuffer.length>=50&&!this.isBackgroundProcessing&&this._scheduleBackgroundFlush()}catch(e){n.error("[MCP] UX要素記録エラー:",e)}}registerComponentRender(e){if(this.mcpEnabled)try{this.recordUXElement({type:"component-render",componentName:e,timestamp:Date.now()})}catch(e){}}flushMetricsBuffer(){return this.metricsBuffer.length>0&&!this.isBackgroundProcessing&&this._scheduleBackgroundFlush(),Promise.resolve()}_scheduleBackgroundFlush(){this.isBackgroundProcessing||(this.isBackgroundProcessing=!0,setTimeout(()=>{this._flushMetricsBufferAsync()},0))}async _flushMetricsBufferAsync(){try{this.metricsBuffer.length>1e3&&(console.warn("[MCP] メトリクスバッファが肥大化しています (".concat(this.metricsBuffer.length,"件)。古いエントリを破棄します。")),this.metricsBuffer=this.metricsBuffer.slice(-1e3));let e=[...this.metricsBuffer];if(this.metricsBuffer=[],this.analyticsData.lastBatchTime=Date.now(),this.analyticsData.batchCount++,this.workerSupported&&!this.worker)try{await this._sendMetricsDirectly(e)}catch(t){n.error("[MCP] Worker初期化エラー:",t),await this._sendMetricsDirectly(e)}else await this._sendMetricsDirectly(e)}catch(e){n.error("[MCP] メトリクス送信エラー:",e),this.metricsBuffer=[]}finally{this.isBackgroundProcessing=!1;let e=Date.now(),t=this.analyticsData.lastBatchTime||0;this.metricsBuffer.length>=50&&e-t>=500&&this._scheduleBackgroundFlush()}}async _sendMetricsDirectly(e){if(this.mcpEnabled&&window._mcp&&e&&0!==e.length)try{if(window._mcp.sendMetrics)await window._mcp.sendMetrics(e);else for(let r of e){var t,i;null==(t=(i=window._mcp).send)||t.call(i,"metrics",r)}}catch(e){n.error("[MCP] メトリクス送信エラー:",e)}}constructor(){this.mcpEnabled=!!window._mcp,this.context={id:null,type:null,modelName:null,modelVersion:null,metadata:{}},this.metricsBuffer=[],this.analyticsData={startTime:Date.now(),totalEvents:0,lastBatchTime:null,batchCount:0,eventTypes:{}},this.isBackgroundProcessing=!1,this.workerSupported="undefined"!=typeof Worker,this.worker=null,n.debug("[MCP] 初期化完了 (有効: ".concat(this.mcpEnabled,", Worker: ").concat(this.workerSupported?"サポート":"未サポート",")"))}}let a=new o,l=new c,d=()=>{let[e,t]=(0,s.useState)(!1),[i,r]=(0,s.useState)("initializing");return(0,s.useEffect)(()=>(l.initialize().then(e=>{t(a.mcpEnabled),r(e.status)}).catch(()=>{r("error")}),()=>{a.flushMetricsBuffer()}),[]),(0,s.useEffect)(()=>{try{let e=Error().stack,t=e&&e.match(/at ([A-Z][A-Za-z0-9$_]+) /),i=t?t[1]:"UnknownComponent";a.registerComponentRender(i)}catch(e){}},[]),{isActive:e,status:i,recordTypingInput:a.recordTypingInput.bind(a),recordGameEvent:a.recordGameEvent.bind(a),recordPerformanceMetric:a.recordPerformanceMetric.bind(a),recordUXElement:a.recordUXElement.bind(a)}},h=e=>{let{position:t="bottom-right"}=e,[i,n]=(0,s.useState)(!1),[c,o]=(0,s.useState)({connected:a.mcpEnabled,metricsCount:0,lastUpdate:Date.now()});(0,s.useEffect)(()=>{a.initialize();let e=setInterval(()=>{o({connected:a.mcpEnabled,metricsCount:a.metricsBuffer.length,lastUpdate:Date.now()})},2e3);return()=>clearInterval(e)},[]);let l={"bottom-right":{position:"fixed",bottom:"10px",right:"10px",zIndex:9999},"bottom-left":{position:"fixed",bottom:"10px",left:"10px",zIndex:9999},"top-right":{position:"fixed",top:"10px",right:"10px",zIndex:9999},"top-left":{position:"fixed",top:"10px",left:"10px",zIndex:9999}},d={width:"12px",height:"12px",borderRadius:"50%",backgroundColor:c.connected?"#4CAF50":"#F44336",display:"inline-block",marginRight:"8px"},h={...l[t],backgroundColor:"rgba(0, 0, 0, 0.7)",color:"white",padding:"5px 10px",borderRadius:"4px",cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center"},u={...l[t],backgroundColor:"rgba(0, 0, 0, 0.85)",color:"white",padding:"10px",borderRadius:"4px",width:"250px",fontSize:"12px"};return i?(0,r.jsxs)("div",{style:u,children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px"},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,r.jsx)("div",{style:d}),(0,r.jsx)("span",{style:{fontWeight:"bold"},children:"MCP Status"})]}),(0,r.jsx)("div",{style:{cursor:"pointer"},onClick:()=>n(!1),children:"\xd7"})]}),(0,r.jsxs)("div",{style:{marginBottom:"5px"},children:[(0,r.jsxs)("div",{children:["接続状態: ",c.connected?"接続済み":"未接続"]}),(0,r.jsxs)("div",{children:["メトリクスバッファ: ",c.metricsCount," 件"]}),(0,r.jsxs)("div",{children:["最終更新: ",new Date(c.lastUpdate).toLocaleTimeString()]})]}),(0,r.jsx)("div",{style:{textAlign:"center",marginTop:"10px",padding:"5px",backgroundColor:"#2196F3",borderRadius:"4px",cursor:"pointer"},onClick:()=>a.flushMetricsBuffer(),children:"メトリクス送信"})]}):(0,r.jsxs)("div",{style:h,onClick:()=>n(!0),children:[(0,r.jsx)("div",{style:d}),(0,r.jsxs)("span",{children:["MCP ",c.connected?"接続中":"未接続"]})]})},u={initialize:l.initialize.bind(l),recordTypingInput:a.recordTypingInput.bind(a),recordGameEvent:a.recordGameEvent.bind(a),recordPerformanceMetric:a.recordPerformanceMetric.bind(a),recordUXElement:a.recordUXElement.bind(a),flushMetricsBuffer:a.flushMetricsBuffer.bind(a),useMCPContext:d,MCPStatusDisplay:h}}}]);