"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[529],{2201:(t,e,s)=>{s.d(e,{aF:()=>i});var n=s(9509);let o=()=>{let t=void 0!==n&&n.env&&("1"===n.env.VERCEL||"production"===n.env.NEXT_PUBLIC_VERCEL_ENV),e=window.location&&(window.location.hostname.includes("vercel.app")||"manaby-typing.vercel.app"===window.location.hostname);return t||e},i=t=>{if(!t)return"";let e=(t.startsWith("/")?t:"/".concat(t)).split("/"),s=e[e.length-1];e[e.length-1]=encodeURIComponent(s);let n=e.join("/");window.location&&window.location.hostname.includes("github.io")||window.location.href.includes("github.io");let i="/manaby-typing";o()?i="":i||(i="/manaby-typing");let r="".concat(i).concat(n);if(t.includes(".mp3")){let e=new Image;e.onerror=()=>{if(t.includes("Hit")||t.includes("hit")){let e=t.includes("Hit")?t.replace("Hit","hit"):t.replace("hit","Hit");r="".concat(i).concat(e.startsWith("/")?e:"/".concat(e))}},e.src=r}return r}},9529:(t,e,s)=>{s.d(e,{A:()=>c});var n=s(2201),o=s(9509);let i=!1;window.__DEBUG_STATIC_PATH=!1,window.location&&window.location.hostname.includes("github.io")&&(i=!0,window.__DEBUG_STATIC_PATH=!0,console.log("GitHub Pages環境を検出、拡張デバッグログを有効化します"));let r={debug:function(t){for(var e=arguments.length,s=Array(e>1?e-1:0),n=1;n<e;n++)s[n-1]=arguments[n];i&&console.log("[SoundDebug]",t,...s)}};class a{_getSoundPathWithFallback(t,e){let s=(0,n.aF)("/sounds/".concat(t)),a=(0,n.aF)("/sounds/".concat(e));return void 0!==o&&o.env&&"1"===o.env.VERCEL?(i&&r.debug("Vercel環境検出: ".concat(a," を使用")),a):(i&&r.debug("非Vercel環境: ".concat(s," を使用")),s)}_loadSettingsFromStorage(){if(window.localStorage)try{let t=localStorage.getItem("sound_bgmEnabled");null!==t&&(this.bgmEnabled="true"===t);let e=localStorage.getItem("sound_bgmVolume");null!==e&&(this.bgmVolume=parseFloat(e));let s=localStorage.getItem("sound_sfxEnabled");null!==s&&(this.sfxEnabled="true"===s);let n=localStorage.getItem("sound_sfxVolume");null!==n&&(this.volume=parseFloat(n)),r.debug("ローカルストレージから音声設定を読み込みました",{bgmEnabled:this.bgmEnabled,bgmVolume:this.bgmVolume,sfxEnabled:this.sfxEnabled,sfxVolume:this.volume})}catch(t){console.error("設定の読み込みに失敗しました:",t)}}_saveSettingsToStorage(){}_handleUserInteraction(){if(!this.userInteracted&&(this.userInteracted=!0,r.debug("ユーザーインタラクションを検知しました"),this.context&&"suspended"===this.context.state&&this.context.resume().catch(t=>{console.error("AudioContextの再開に失敗:",t)}),this.pendingBgm)){let{name:t,loop:e}=this.pendingBgm;r.debug("保留中のBGM「".concat(t,"」を再生します")),this._playBgmInternal(t,e),this.pendingBgm=null}}async initializeAllSounds(){try{let t=[];for(let t of(i&&r.debug("サウンドプリセット:",{success:this.soundPresets.success,error:this.soundPresets.error,button:this.soundPresets.button,complete:this.soundPresets.complete}),["success","error"]))if(this.soundPresets[t])try{await this.loadSound(t,this.soundPresets[t]),i&&r.debug("優先".concat(t,"音声のロードに成功しました"))}catch(e){console.error("優先".concat(t,"音声のロードに失敗しました:"),e)}for(let e of["button","complete"])this.soundPresets[e]&&t.push(this.loadSound(e,this.soundPresets[e]).then(()=>i&&r.debug("".concat(e,"音声のロードに成功しました"))).catch(t=>console.error("".concat(e,"音声のロードに失敗しました:"),t)));return await Promise.all(t),i&&r.debug("基本的な効果音のロードが完了しました"),!0}catch(t){return console.error("効果音の初期化に失敗しました:",t),!1}}async loadSound(t,e){try{let s=t.toLowerCase();i&&(r.debug("サウンド「".concat(t,"」をロード中: ").concat(e)),r.debug("".concat(t,"の読み込み開始: ").concat(e)));let n=await fetch(e);if(!n.ok){console.warn("".concat(t,"のロードに失敗 (").concat(n.status,")。代替URLで再試行..."));let s=e.split("/"),o=s[s.length-1],a=o;if(o.startsWith("hit")&&o.endsWith(".mp3")?a="H"+o.substring(1):o.startsWith("Hit")&&o.endsWith(".mp3")&&(a="h"+o.substring(1)),a!==o){s[s.length-1]=a;let t=s.join("/")+"?t=".concat(this.timestamp);i&&r.debug("代替URL試行: ".concat(t," (元: ").concat(o,")")),n=await fetch(t)}}if(!n.ok)throw console.error("".concat(t,"のHTTPエラー:"),n.status,n.statusText),Error("HTTP error! status: ".concat(n.status,", url: ").concat(e));i&&r.debug("".concat(t,"のレスポンス取得成功"));let o=await n.arrayBuffer();return i&&r.debug("".concat(t,"のバッファ取得成功:"),o.byteLength,"bytes"),new Promise((e,n)=>{try{this.context.decodeAudioData(o,n=>{this.sfxBuffers[s]=n,i&&r.debug("サウンド「".concat(t,"」のロード・デコード完了")),e()},e=>{console.error("サウンド「".concat(t,"」のデコードに失敗:"),e),n(e)})}catch(e){console.error("サウンド「".concat(t,"」のデコード処理例外:"),e),n(e)}})}catch(e){return console.error("効果音「".concat(t,"」のロード中にエラー発生:"),e),this.sfxBuffers[t.toLowerCase()]=null,Promise.resolve()}}playSound(t){if(!this.sfxEnabled)return;let e=t.toLowerCase();try{if("success"===e||"error"===e||"miss"===e){if(this.sfxBuffers[e])return void this._fastPlayBuffer(this.sfxBuffers[e])}else{let t=Date.now();this._lastPlayTimes||(this._lastPlayTimes={});let s=this._lastPlayTimes[e]||0;if(t-s<20)return;this._lastPlayTimes[e]=t}if(this.sfxBuffers[e])return void this._playBuffer(this.sfxBuffers[e]);this.context&&"suspended"===this.context.state&&this.context.resume().catch(t=>console.warn("AudioContext再開失敗:",t));let s=Object.keys(this.soundPresets).find(t=>t.toLowerCase()===e);if(s){let n=this.soundPresets[s];i&&r.debug("".concat(t,"サウンド自動ロード開始:"),n),this.loadSound(e,n).then(()=>{i&&r.debug("".concat(t,"サウンドのロードに成功、再生を試みます")),this.sfxBuffers[e]&&this._playBuffer(this.sfxBuffers[e])}).catch(e=>{console.error("".concat(t,"サウンドのロードに失敗:"),e)})}else console.warn("未知のサウンド名が指定されました: ".concat(t))}catch(t){console.error("プレイサウンドエラー:",t)}}preloadTypingSounds(){if(!this.context)return Promise.resolve();let t=["success","error","miss"].filter(t=>!this.sfxBuffers[t.toLowerCase()]);return 0===t.length?Promise.resolve():Promise.all(t.map(t=>{let e=Object.keys(this.soundPresets).find(e=>e.toLowerCase()===t.toLowerCase());return e?this.loadSound(t.toLowerCase(),this.soundPresets[e]):Promise.resolve()})).then(()=>{console.log("タイピング音の事前ロードが完了しました")}).catch(t=>{console.warn("タイピング音の事前ロード中にエラーが発生しました",t)})}ultraFastPlayTypingSound(t){if(!this.sfxEnabled||!t||!this.context)return!1;let e=t.toLowerCase();if("success"!==e&&"error"!==e&&"miss"!==e)return!1;try{let s=this.sfxBuffers[e];if(!s)return this.playSound(t),!1;let n=this.context.createBufferSource();return n.buffer=s,n.connect(this.gainNode),n.start(0),!0}catch(t){return!1}}_fastPlayBuffer(t){if(this.context&&t)try{let e=this.context.createBufferSource();return e.buffer=t,e.connect(this.gainNode),e.start(0),!0}catch(t){return!1}}play(t){return("success"===t||"error"===t||"miss"===t)&&"function"==typeof this.ultraFastPlayTypingSound?this.ultraFastPlayTypingSound(t):this.playSound(t)}_playBuffer(t){if(this.context){if(!t)return void console.warn("再生しようとしたバッファが存在しません");try{"suspended"===this.context.state&&this.context.resume().catch(t=>(console.warn("AudioContext再開に失敗(1回目):",t),this.context.resume().catch(t=>(console.warn("AudioContext再開に失敗(2回目):",t),this.context.resume().catch(t=>{console.error("AudioContext再開に失敗(最終):",t)})))));let e=this.context.createBufferSource();return e.buffer=t,e.connect(this.gainNode),e.start(0),e.onended=()=>{e.disconnect()},!0}catch(e){return console.error("効果音の再生に失敗:",{error:e.toString(),contextState:this.context?this.context.state:"unknown",bufferSize:t?t.length:"null",stack:e.stack}),!1}}}setSfxVolume(t){this.gainNode&&(this.volume=Math.max(0,Math.min(1,t)),this.sfxEnabled&&(this.gainNode.gain.value=this.volume),r.debug("効果音の音量を設定: ".concat(this.volume)))}setSfxEnabled(t){this.gainNode&&(this.sfxEnabled=t,this.gainNode.gain.value=t?this.volume:0,r.debug("効果音を".concat(t?"有効":"無効","にしました")))}setEnabled(t){this.setSfxEnabled(t),this.setBgmEnabled(t)}setBgmVolume(t){this.bgmVolume=Math.max(0,Math.min(1,t)),this.bgmElement&&(this.bgmElement.volume=this.bgmEnabled?this.bgmVolume:0),r.debug("BGMの音量を設定: ".concat(this.bgmVolume))}setBgmEnabled(t){this.bgmEnabled=t,t?this.bgmElement&&(this.bgmElement.volume=this.bgmVolume,this.bgmElement.paused&&this.resumeBgm()):this.stopBgm(),r.debug("BGMを".concat(t?"有効":"無効","にしました"))}resume(){this.context&&"suspended"===this.context.state&&this.context.resume()}playBgm(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(!this.bgmEnabled)return void this.stopBgm();if(this.currentBgm!==t||!this.bgmElement||this.bgmElement.paused){if(this.stopBgm(),!this.bgmPresets[t])return void console.error("BGM「".concat(t,"」はプリセットに存在しません"));if(!this.userInteracted){r.debug("BGM「".concat(t,"」は保留状態にセットされました。ユーザーインタラクション後に再生されます")),this.pendingBgm={name:t,loop:e};return}this._playBgmInternal(t,e)}}_playBgmInternal(t,e){try{let s=this.bgmPresets[t];if(!s)throw Error("BGM「".concat(t,"」はプリセットに存在しません"));let n=new Audio(s);n.loop=e,n.volume=this.bgmVolume,this.context&&"suspended"===this.context.state&&this.context.resume().catch(t=>{console.error("AudioContextの再開に失敗:",t)});let o=n.play();void 0!==o&&o.catch(s=>{console.error("BGM「".concat(t,"」の再生開始に失敗:"),s),this.pendingBgm||(this.pendingBgm={name:t,loop:e},r.debug("BGM「".concat(t,"」が自動再生ポリシーでブロックされました。保留状態に設定しました")))}),this.currentBgm=t,this.bgmElement=n,r.debug("BGM「".concat(t,"」を再生開始しました"))}catch(e){console.error("BGM「".concat(t,"」の再生に失敗:"),e)}}pauseBgm(){this.bgmElement&&!this.bgmElement.paused&&(this.bgmElement.pause(),r.debug("BGM「".concat(this.currentBgm,"」を一時停止しました")))}resumeBgm(){if(this.bgmElement&&this.bgmElement.paused&&this.bgmEnabled){let t=this.bgmElement.play();void 0!==t&&t.catch(t=>{console.error("BGM「".concat(this.currentBgm,"」の再開に失敗:"),t)}),r.debug("BGM「".concat(this.currentBgm,"」を再開しました"))}}stopBgm(){this.bgmElement&&(this.bgmElement.pause(),this.bgmElement.currentTime=0,this.bgmElement=null,r.debug("BGM「".concat(this.currentBgm,"」を停止しました"))),this.currentBgm&&(this.currentBgm=null),this.pendingBgm&&(this.pendingBgm=null)}getCurrentBgm(){return this.currentBgm}getSfxVolume(){return this.volume}getBgmVolume(){return this.bgmVolume}isSfxEnabled(){return this.sfxEnabled}isBgmEnabled(){return this.bgmEnabled}async checkSoundFileExists(t){try{return(await fetch(t,{method:"HEAD"})).ok}catch(e){return console.warn("ファイル存在確認エラー (".concat(t,"):"),e),!1}}getVersionInfo(){return{version:"1.0.1",buildDate:"2025-05-14",environment:"production",basePath:"/manaby-typing",useMCP:!1,audioContext:this.context?{state:this.context.state,sampleRate:this.context.sampleRate}:"なし"}}async diagnoseAudioSystem(){let t={audioContext:!!this.context,contextState:this.context?this.context.state:"none",userInteracted:this.userInteracted,sfxEnabled:this.sfxEnabled,gainValue:this.gainNode?this.gainNode.gain.value:"none",loadedBuffers:Object.keys(this.sfxBuffers),fileChecks:{}};for(let e of["success","error","button","complete"]){let s=this.soundPresets[e];s&&(t.fileChecks[e]={url:s,exists:await this.checkSoundFileExists(s)})}return t}getAudioContext(){return this.context}constructor(){{let t=window.AudioContext||window.webkitAudioContext;this.context=new t,this.gainNode=this.context.createGain(),this.gainNode.connect(this.context.destination),this.bgmGainNode=this.context.createGain(),this.bgmGainNode.connect(this.context.destination)}this.sfxBuffers={},this.currentBgm=null,this.bgmElement=null,this.bgmVolume=.5,this.bgmEnabled=!1,this.pendingBgm=null,this.userInteracted=!1,this.volume=1,this.sfxEnabled=!0,this.soundPresets={success:(0,n.aF)("/sounds/Hit05-1.mp3"),error:(0,n.aF)("/sounds/Hit04-1.mp3"),complete:(0,n.aF)("/sounds/resultsound.mp3"),clear:(0,n.aF)("/sounds/resultsound.mp3"),button:(0,n.aF)("/sounds/buttonsound1.mp3")},i&&r.debug("環境情報:",{NODE_ENV:"production",basePath:"/manaby-typing",例示パス:(0,n.aF)("/sounds/buttonsound1.mp3")}),this.bgmPresets={lobby:(0,n.aF)("/sounds/battle_of_the_emperor.mp3"),battle:(0,n.aF)("/sounds/battle.mp3")},this.timestamp=Date.now(),["mousedown","keydown","touchstart","click"].forEach(t=>{window.addEventListener(t,this._handleUserInteraction.bind(this),{once:!1,passive:!0})}),r.debug("サウンドシステム初期化完了")}}let c=new a}}]);