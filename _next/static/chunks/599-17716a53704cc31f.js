"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[599],{9980:(t,e,n)=>{n.d(e,{A:()=>l});var r=n(8740);let i={debug:()=>{},warn:()=>{},error:()=>{}},s={あ:["a"],い:["i","yi"],う:["u","wu"],え:["e"],お:["o"],か:["ka","ca"],き:["ki"],く:["ku","cu","qu"],け:["ke"],こ:["ko","co"],さ:["sa"],し:["si","shi","ci"],す:["su"],せ:["se","ce"],そ:["so"],た:["ta"],ち:["ti","chi"],つ:["tu","tsu"],て:["te"],と:["to"],な:["na"],に:["ni"],ぬ:["nu"],ね:["ne"],の:["no"],は:["ha"],ひ:["hi"],ふ:["fu","hu"],へ:["he"],ほ:["ho"],ま:["ma"],み:["mi"],む:["mu"],め:["me"],も:["mo"],や:["ya"],ゆ:["yu"],よ:["yo"],ら:["ra"],り:["ri"],る:["ru"],れ:["re"],ろ:["ro"],わ:["wa"],を:["wo"],ん:["nn","n","xn"],が:["ga"],ぎ:["gi"],ぐ:["gu"],げ:["ge"],ご:["go"],ざ:["za"],じ:["zi","ji"],ず:["zu"],ぜ:["ze"],ぞ:["zo"],だ:["da"],ぢ:["di","ji"],づ:["du","zu"],で:["de"],ど:["do"],ば:["ba"],び:["bi"],ぶ:["bu"],べ:["be"],ぼ:["bo"],ぱ:["pa"],ぴ:["pi"],ぷ:["pu"],ぺ:["pe"],ぽ:["po"],きゃ:["kya"],きゅ:["kyu"],きょ:["kyo"],しゃ:["sya","sha","sixya","shixya"],しゅ:["syu","shu","sixyu","shixyu"],しょ:["syo","sho","sixyo","shixyo"],ちゃ:["tya","cha","tixya","chixya"],ちゅ:["tyu","chu","tixyu","chixyu"],ちょ:["tyo","cho","tixyo","chixyo"],にゃ:["nya"],にゅ:["nyu"],にょ:["nyo"],ひゃ:["hya"],ひゅ:["hyu"],ひょ:["hyo"],みゃ:["mya"],みゅ:["myu"],みょ:["myo"],りゃ:["rya"],りゅ:["ryu"],りょ:["ryo"],ぎゃ:["gya"],ぎゅ:["gyu"],ぎょ:["gyo"],じゃ:["zya","ja","zixya","jixya"],じゅ:["zyu","ju","zixyu","jixyu"],じょ:["zyo","jo","zixyo","jixyo"],びゃ:["bya"],びゅ:["byu"],びょ:["byo"],ぴゃ:["pya"],ぴゅ:["pyu"],ぴょ:["pyo"],っか:["kka"],っき:["kki"],っく:["kku"],っけ:["kke"],っこ:["kko"],っさ:["ssa"],っし:["sshi","ssi"],っす:["ssu"],っせ:["sse"],っそ:["sso"],った:["tta"],っち:["cchi","tti"],っつ:["ttsu","ttu"],って:["tte"],っと:["tto"],っぱ:["ppa"],っぴ:["ppi"],っぷ:["ppu"],っぺ:["ppe"],っぽ:["ppo"],ぁ:["xa","la"],ぃ:["xi","li"],ぅ:["xu","lu"],ぇ:["xe","le"],ぉ:["xo","lo"],ゃ:["xya","lya"],ゅ:["xyu","lyu"],ょ:["xyo","lyo"],っ:["xtu","ltu","xtsu","ltsu"],"、":[","],"。":["."],"・":["/"],",":[","],".":["."],"/":["/"]},u={k:!0,s:!0,t:!0,p:!0,c:!0,h:!0,f:!0,m:!0,y:!0,r:!0,w:!0,g:!0,z:!0,d:!0,b:!0,j:!0},a={a:!0,i:!0,u:!0,e:!0,o:!0,y:!0,n:!0},h=new Map;class l{static convertFullWidthToHalfWidth(t){return t?t>="！"&&t<="～"?String.fromCharCode(t.charCodeAt(0)-65248):"　"===t?" ":t:""}static getAcceptableInputs(t){if(h.has(t))return h.get(t);let e=s[t]||[];if(!e.length){let e=r.Mz(t);return e?(h.set(t,[e[0]]),[e[0]]):[]}let n=[];for(let t of e)t.length>0&&!n.includes(t[0])&&n.push(t[0]);return h.set(t,n),n}static isDirectMatch(t,e){let n=s[t];if(!n)return!1;for(let t of n)if(t[0]===e)return!0;return!1}static parseTextToRomajiPatterns(t){if(!t)return[];let e="string"==typeof t?r.zU(t):t;if(this._patternCache&&this._patternCache.text===e)return[...this._patternCache.patterns];let n=[],h=0;for(;h<e.length;){let t=e[h],l=h+1<e.length?e[h+1]:null;if(l&&["ゃ","ゅ","ょ","ぁ","ぃ","ぅ","ぇ","ぉ"].includes(l)){let e=t+l;if(s[e]){n.push(s[e]),h+=2;continue}}if("っ"===t&&l){try{let a=h+2<e.length?e[h+2]:null;if(a&&["ゃ","ゅ","ょ"].includes(a)){let e=l+a,c=s[e]||(r.Mz(e)?[r.Mz(e)]:[""]);if(c[0]&&c[0].length>0){let e=c[0][0];if(i.debug('[TypingUtils] 促音+拗音処理: "'.concat(t).concat(l).concat(a,'" -> 最初の文字: "').concat(e,'"')),u[e]){n.push([e]),h++;continue}}}else{let e=s[l]||(r.Mz(l)?[r.Mz(l)]:[""]);if(e[0]&&e[0].length>0){let r=e[0][0];if(i.debug('[TypingUtils] 通常促音処理: "'.concat(t).concat(l,'" -> 最初の文字: "').concat(r,'"')),u[r]){n.push([r]),h++;continue}}}}catch(e){console.error('[TypingUtils] 促音処理エラー: "'.concat(t).concat(l,'"'),e)}n.push(["xtu","ltu"]),h++;continue}if("ん"===t){let t=h===e.length-1,r=l?l[0]:"";t?(n.push(["nn","n","xn"]),i.debug("[TypingUtils] 「ん」処理: 文末位置 - パターン:",["nn","n","xn"])):a[r]?(n.push(["nn","xn"]),i.debug("[TypingUtils] 「ん」処理: 母音/y前 - パターン:",["nn","xn"],"次の文字:",r)):(n.push(["nn","n","xn"]),i.debug("[TypingUtils] 「ん」処理: その他位置 - パターン:",["nn","n","xn"],"次の文字:",r)),h++;continue}if(s[t])n.push(s[t]);else if(""===t.trim())n.push([" "]);else{let e=r.Mz(t);n.push([e])}h++}return this._patternCache={text:e,patterns:n.map(t=>[...t]),timestamp:Date.now(),info:{patternCount:n.length,textLength:e.length}},i.debug("[TypingUtils] ローマ字パターン生成結果:",n.slice(0,10).map((t,n)=>({kana:e[n]||"",patterns:t}))),n}static createTypingSession(t){if(!t||!t.kanaText)return i.error("[TypingUtils] 有効な問題データが必要です"),null;try{let e=r.zU(String(t.kanaText||"").trim());if(!e)return i.warn("[TypingUtils] 問題のかなテキストが空です"),null;i.debug("[TypingUtils] セッション作成:",{問題:t.displayText,かな:e,長さ:e.length});let n=this.parseTextToRomajiPatterns(e);if(!n||!n.length)return i.error("[TypingUtils] 有効なパターンを生成できませんでした"),null;let s=Array(n.length),u=Array(n.length),a=Array(n.length),h=Array(n.length),l=0,c="";try{c=n.map((t,e)=>{Array.isArray(t)&&0!==t.length||(i.warn("[TypingUtils] 無効なパターンが見つかりました: index=".concat(e)),t=[""]),s[e]=l;let n=t[0]||"";return u[e]=n.length,h[e]=n.length>0?n[0]:"",a[e]=new Set(t.map(t=>t&&t.length>0?t[0]:"").filter(Boolean)),l+=n.length,n}).join(""),i.debug("[TypingUtils] 生成されたローマ字 (長さ: ".concat(c.length,"):"),c.length>50?c.substring(0,50)+"...":c)}catch(t){console.error("[TypingUtils] ローマ字生成エラー:",t),c=""}return{originalText:t.displayText,kanaText:e,displayRomaji:c,patterns:n,displayIndices:s,patternLengths:u,expectedChars:a,firstChars:h,currentCharIndex:0,typedRomaji:"",currentInput:"",completed:!1,getCurrentExpectedKey(){if(this.completed||this.currentCharIndex>=this.patterns.length)return null;if(!this.currentInput)return this.firstChars[this.currentCharIndex];for(let t of this.patterns[this.currentCharIndex])if(t.startsWith(this.currentInput)&&this.currentInput.length<t.length)return t[this.currentInput.length];return this.firstChars[this.currentCharIndex]},getCurrentCharRomaji(){if(this.currentCharIndex>=this.patterns.length)return"";let t=this.patterns[this.currentCharIndex];return t?t[0]:""},processInput(t){if(this.completed||this.currentCharIndex>=this.patterns.length)return{success:!1,status:"inactive_session"};let e=this.patterns[this.currentCharIndex],n=this.currentInput+t,r=!1,i=!1;for(let t=0;t<e.length;t++){let s=e[t];if(s===n){r=!0;break}if(s.startsWith(n)&&(i=!0,t===e.length-1))break}return(this.currentInput=n,r)?(this.typedRomaji+=n,this.currentCharIndex++,this.currentInput="",this.currentCharIndex>=this.patterns.length)?(this.completed=!0,{success:!0,status:"all_completed"}):{success:!0,status:"char_completed"}:i?{success:!0,status:"in_progress"}:this._fastSplitInputCheck()?{success:!0,status:"split_continue"}:(this.currentInput=n.slice(0,-1),{success:!1,status:"no_match"})},_fastSplitInputCheck(){if(this.currentInput.length<=1)return!1;let t=this.currentInput.slice(0,-1),e=this.currentInput.slice(-1),n=this.currentCharIndex;for(let r of this.patterns[n])if(r===t){if(this.typedRomaji+=t,this.currentCharIndex++,this.currentInput=e,this.currentCharIndex>=this.patterns.length)return this.completed=!0,!0;let n=this.patterns[this.currentCharIndex];if(!n)return!1;for(let t of n)if(t[0]===e)return!0;this.currentCharIndex--,this.typedRomaji=this.typedRomaji.slice(0,-t.length),this.currentInput=t+e;break}return!1},getColoringInfo(){if(this.completed)return{romaji:this.displayRomaji,typedLength:this.displayRomaji.length,currentInputLength:0,completed:!0,currentCharIndex:this.currentCharIndex,currentInput:"",expectedNextChar:null,currentCharRomaji:""};let t=this.currentCharIndex,e=t>0?this.displayIndices[t-1]+this.patternLengths[t-1]:0;return{romaji:this.displayRomaji,typedLength:e,currentInputLength:this.currentInput.length,completed:this.completed,currentCharIndex:t,currentInput:this.currentInput,expectedNextChar:this.getCurrentExpectedKey(),currentCharRomaji:this.getCurrentCharRomaji()}},getCompletionPercentage(){return this.completed?100:0===this.patterns.length?0:Math.floor(this.currentCharIndex/this.patterns.length*100)}}}catch(t){return console.error("タイピングセッションの作成中にエラー:",t),null}}static getRank(t){return t>=400?"S":t>=300?"A":t>=200?"B":t>=150?"C":t>=100?"D":t>=50?"E":"F"}static getRankColor(t){switch(t){case"S":return"#00ff66";case"A":return"#33ff00";case"B":return"#ffff00";case"C":return"#ff9900";case"D":return"#ff3300";case"E":return"#ff0000";case"F":return"#cc0000";default:return"#ffffff"}}static calculateAverageKPM(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!t||!Array.isArray(t)||0===t.length)return 0;let e=t.filter(t=>t&&void 0!==t.problemKeyCount&&t.problemKeyCount>0&&void 0!==t.problemElapsedMs&&t.problemElapsedMs>0);if(0===e.length)return 0;i.debug("【calculateAverageKPM】有効な問題データ数:",e.length);let n=e.map(t=>{let e=t.problemKeyCount||0,n=t.problemElapsedMs||0;if(e<=0||n<=0)return 0;let r=e/(n/6e4);return i.debug("【問題KPM計算】問題キー数: ".concat(e,", 時間: ").concat(n,"ms, KPM: ").concat(r.toFixed(2))),r}),r=n.reduce((t,e)=>t+e,0),s=n.length>0?r/n.length:0;return i.debug("【平均KPM計算】合計KPM: ".concat(r.toFixed(2),", 問題数: ").concat(n.length,", 平均: ").concat(s.toFixed(2))),Math.min(Math.floor(s),600)}static splitReading(t){if(!t)return[[],[]];if(1===t.length&&s[t])return[[t],s[t]];let e=this.parseTextToRomajiPatterns(t);return[[...Array(e.length).keys()].map(e=>t[e]||""),e]}}}}]);