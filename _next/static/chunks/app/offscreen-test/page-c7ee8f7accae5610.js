(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[903],{737:e=>{e.exports={canvas:"OffscreenEffects_canvas__WKEWN",fallback:"OffscreenEffects_fallback__4XvYI",effectsAPI:"OffscreenEffects_effectsAPI__R9TH3"}},1888:(e,n,t)=>{Promise.resolve().then(t.bind(t,9561))},7777:e=>{e.exports={main:"page_main__thJP1",status:"page_status__X3PA1",warning:"page_warning__QzdcT",controls:"page_controls__MCU3l",controlGroup:"page_controlGroup__wQD5k",spawnButton:"page_spawnButton__S4Uqp",stats:"page_stats__Uyd_n",count:"page_count__nkmBN",demoContainer:"page_demoContainer__9k_UM",demoContent:"page_demoContent__HKV0M",clickHere:"page_clickHere__81WwI",effects:"page_effects__aajnZ",performance:"page_performance__iwfuh"}},9561:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>f});var r=t(5155),s=t(2115),a=t(737),c=t.n(a);let l=s.forwardRef(e=>{let{enabled:n=!0,className:t="",onEffectSpawned:a=null,fps:l=60}=e,i=(0,s.useRef)(null),o=(0,s.useRef)(null),[f,u]=(0,s.useState)(!1),[d,h]=(0,s.useState)({width:0,height:0}),p=(0,s.useRef)(null),_=(0,s.useRef)([]),x=(0,s.useRef)(0),m=(0,s.useRef)(1e3/l);(0,s.useEffect)(()=>{if(!i.current)return;let e=()=>{if(!i.current)return;let e=i.current.getBoundingClientRect(),n=e.width,t=e.height;i.current.width=n,i.current.height=t,h({width:n,height:t})};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),(0,s.useEffect)(()=>{if(!n||!i.current||0===d.width)return;o.current=i.current.getContext("2d");let e=n=>{o.current&&i.current&&(n-x.current>=m.current&&(x.current=n,o.current.clearRect(0,0,d.width,d.height),_.current=_.current.filter(e=>{let t=e.lifetime||1e3,r=n-e.createdAt;return!(r>t)&&(j(o.current,e,r/t,d),!0)})),p.current=requestAnimationFrame(e))};return x.current=performance.now(),p.current=requestAnimationFrame(e),u(!0),()=>{p.current&&(cancelAnimationFrame(p.current),p.current=null),u(!1)}},[n,d]);let v=e=>{let n={...e,createdAt:performance.now(),id:"effect_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))};_.current=[..._.current,n],a&&a(n)},j=(e,n,t,r)=>{let{type:s,x:a,y:c,color:l="#4a90e2",size:i=20}=n,o="string"==typeof a&&a.endsWith("%")?parseFloat(a)/100*r.width:parseFloat(a),f="string"==typeof c&&c.endsWith("%")?parseFloat(c)/100*r.height:parseFloat(c);switch(e.save(),e.globalAlpha=1-t,s){case"ripple":e.strokeStyle=l,e.lineWidth=2*(1-t),e.beginPath(),e.arc(o,f,i*(.2+2*t),0,2*Math.PI),e.stroke();break;case"particle":let u=i*(1-.5*t);e.fillStyle=l;for(let n=0;n<5;n++){let r=2*Math.PI*(n/5),s=i*t*2,a=o+Math.cos(r)*s,c=f+Math.sin(r)*s;e.beginPath(),e.arc(a,c,u/4,0,2*Math.PI),e.fill()}break;case"text":let{text:d="✓"}=n;e.font="bold ".concat(i*(1+.5*t),"px Arial"),e.fillStyle=l,e.textAlign="center",e.textBaseline="middle",e.fillText(d,o,f+-t*i);break;default:e.fillStyle=l,e.beginPath(),e.arc(o,f,i*(1-.5*t),0,2*Math.PI),e.fill()}e.restore()};return s.useImperativeHandle(ref,()=>({addEffect:v,isActive:()=>f}),[f]),(0,r.jsx)("canvas",{ref:i,className:"".concat(c().effectsCanvas," ").concat(t),"data-active":f})});var i=t(7777),o=t.n(i);function f(){let[e,n]=(0,s.useState)(null),[t,a]=(0,s.useState)(!0),[c,i]=(0,s.useState)(60),[f,u]=(0,s.useState)(0),d=(0,s.useRef)(null),h=(0,s.useRef)(null);return(0,s.useEffect)(()=>{n("OffscreenCanvas"in window&&"transferControlToOffscreen"in document.createElement("canvas"))},[]),(0,r.jsxs)("main",{className:o().main,children:[(0,r.jsx)("h1",{children:"Offscreen Canvas テスト"}),(0,r.jsxs)("div",{className:o().status,children:[(0,r.jsxs)("p",{children:["Offscreen Canvas対応状況: ",(0,r.jsx)("strong",{children:null===e?"確認中...":e?"対応":"非対応"})]}),!1===e&&(0,r.jsxs)("div",{className:o().warning,children:[(0,r.jsx)("p",{children:"お使いのブラウザはOffscreen Canvasに対応していません。"}),(0,r.jsx)("p",{children:"Chrome 69以降、Edge 79以降、またはFirefox 71以降の使用をお勧めします。"})]})]}),(0,r.jsxs)("div",{className:o().controls,children:[(0,r.jsx)("div",{className:o().controlGroup,children:(0,r.jsxs)("label",{children:[(0,r.jsx)("input",{type:"checkbox",checked:t,onChange:()=>a(!t)}),"エフェクト表示"]})}),(0,r.jsx)("div",{className:o().controlGroup,children:(0,r.jsxs)("label",{children:["FPS:",(0,r.jsxs)("select",{value:c,onChange:e=>i(Number(e.target.value)),children:[(0,r.jsx)("option",{value:30,children:"30 FPS"}),(0,r.jsx)("option",{value:60,children:"60 FPS"}),(0,r.jsx)("option",{value:90,children:"90 FPS"}),(0,r.jsx)("option",{value:120,children:"120 FPS"})]})]})}),(0,r.jsx)("button",{className:o().spawnButton,onClick:()=>{if(!d.current||!h.current)return;let e=d.current.getBoundingClientRect(),n=Math.random()*e.width,t=Math.random()*e.height;h.current.spawnEffect(n,t)},disabled:!e||!t,children:"ランダムな位置でエフェクト発生"})]}),(0,r.jsx)("div",{className:o().stats,children:(0,r.jsxs)("p",{children:["発生したエフェクト数: ",(0,r.jsx)("span",{className:o().count,children:f})]})}),(0,r.jsxs)("div",{className:o().demoContainer,ref:d,children:[(0,r.jsxs)("div",{className:o().demoContent,children:[(0,r.jsx)("h2",{children:"Offscreen Canvas デモ"}),(0,r.jsx)("p",{children:"このエリア内をクリックするか、上部の「ランダムな位置でエフェクト発生」ボタンを押すと、パーティクルエフェクトが発生します。"}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"通常のCanvas vs Offscreen Canvas:"}),"Offscreen Canvasを使用すると、メインスレッド（UIスレッド）を占有せずに、 バックグラウンドのワーカースレッドで描画処理を行うことができます。 これにより、UIの応答性が向上し、高フレームレートのアニメーションでもスムーズに動作します。"]}),(0,r.jsx)("div",{className:o().clickHere,children:"ここをクリックしてエフェクト発生！"})]}),(0,r.jsx)(l,{ref:h,enabled:t&&e,className:o().effects,onEffectSpawned:()=>{u(e=>e+1)},fps:c})]}),(0,r.jsxs)("div",{className:o().performance,children:[(0,r.jsx)("h2",{children:"パフォーマンスについて"}),(0,r.jsx)("p",{children:"Offscreen Canvasは以下のような利点があります："}),(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:"メインスレッド（UIスレッド）の負荷軽減"}),(0,r.jsx)("li",{children:"複雑なアニメーションでもUIの応答性が維持される"}),(0,r.jsx)("li",{children:"マルチコアCPUのリソースをより効率的に活用"}),(0,r.jsx)("li",{children:"リアルタイム描画処理の高速化"})]}),(0,r.jsx)("p",{children:"タイピングゲームでは、タイピング入力のアニメーション効果やパーティクル表示などを Offscreen Canvasで処理することで、ゲームの応答性と体験を向上させることができます。"})]})]})}}},e=>{var n=n=>e(e.s=n);e.O(0,[905,441,684,358],()=>n(1888)),_N_E=e.O()}]);