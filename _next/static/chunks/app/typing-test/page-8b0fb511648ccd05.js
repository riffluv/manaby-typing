(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[63],{1725:e=>{e.exports={typingText:"SimpleTypingDisplay_typingText__PuN34",typingTextContent:"SimpleTypingDisplay_typingTextContent__tdPQE",typed:"SimpleTypingDisplay_typed__TTdR0",consonant:"SimpleTypingDisplay_consonant__4jwbq",currentCharRemaining:"SimpleTypingDisplay_currentCharRemaining__Wcj49",nextChar:"SimpleTypingDisplay_nextChar__lJyRp","pulse-focus":"SimpleTypingDisplay_pulse-focus__T4VTI",optimizedFocus:"SimpleTypingDisplay_optimizedFocus__eN_Xd","optimized-pulse":"SimpleTypingDisplay_optimized-pulse__hkgv0",remaining:"SimpleTypingDisplay_remaining__ytnjo",ellipsis:"SimpleTypingDisplay_ellipsis__SXLfh",typingCursor:"SimpleTypingDisplay_typingCursor__6GF97",cursorBlink:"SimpleTypingDisplay_cursorBlink__fg7Lj",errorShake:"SimpleTypingDisplay_errorShake___TWiZ",focusHint:"SimpleTypingDisplay_focusHint__a8RTd"}},4311:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>g});var r=n(5155),i=n(2115),a=n(1427),s=n(3055);let l={debug:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r]},error:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];console.error(e,...n)}};var o=n(1725),u=n.n(o);let c=(0,i.memo)(e=>{let{romaji:t,typedLength:n=0,nextChar:a="",isError:s=!1,className:l="",inputMode:o="normal",currentInput:c="",currentCharRomaji:p="",visiblePortion:d={start:0,end:0}}=e,m=(0,i.useRef)(null),g=(0,i.useRef)(null),y=(0,i.useRef)(null),h=(0,i.useRef)(null),f=(0,i.useRef)(n),x="string"==typeof t?t:"",_=Number.isInteger(n)&&n>=0?n:0,T=x.substring(0,_)||"",v="string"==typeof c?c:"",j="string"==typeof a?a:"",S="",b=!d||0===d.start&&0===d.end||!Number.isInteger(d.start)||!Number.isInteger(d.end),C=d&&"object"==typeof d&&Number.isInteger(d.start)&&Number.isInteger(d.end)&&d.start>=0&&d.end>d.start&&d.end<=x.length,N=!C||b?x:x.substring(d.start,d.end),k=Math.max(0,n-(b?0:(null==d?void 0:d.start)||0));if("consonant"===o&&c){v=c,j=p&&p.length>c.length?p.charAt(c.length):"a";let e=n+p.length;if(b)S=x.substring(e)||"";else{let t=Math.max(0,e-((null==d?void 0:d.start)||0));S=N.substring(t)||""}}else if(j=a,b){let e=n+ +!!a;S=x.substring(e)||""}else{let e=k+ +!!a;S=N.substring(e)||""}let E=(0,i.useCallback)(()=>{if(g.current&&m.current&&f.current!==n){try{let e=g.current,t=m.current;if(!(()=>{let n=t.scrollTop,r=n+t.clientHeight,i=e.offsetTop,a=i+e.offsetHeight;return i>=n&&a<=r})()){let n=e.offsetTop-t.clientHeight/2+e.offsetHeight/2;h.current=n,t.scrollTo({top:n,behavior:"smooth"})}}catch(e){console.error("フォーカス文字のスクロール処理エラー:",e)}f.current=n}},[n]);(0,i.useEffect)(()=>{let e=requestAnimationFrame(()=>{E()});return()=>{cancelAnimationFrame(e)}},[n,E]),(0,i.useEffect)(()=>{m.current&&y.current&&n>0&&(m.current.scrollLeft=0)},[d]);let I="".concat(u().typingText," ").concat(l||""," ").concat(s?u().errorShake:"");if(!x)return(0,r.jsx)("div",{className:I,ref:m,children:(0,r.jsx)("span",{className:u().typingCursor})});let L=!b&&C&&d.start>0?"...":"",R=!b&&C&&d.end<x.length?"...":"";return(0,r.jsx)("div",{className:I,ref:m,children:(0,r.jsxs)("div",{className:u().typingTextContent,ref:y,children:[L&&(0,r.jsx)("span",{className:u().ellipsis,children:L}),T&&(0,r.jsx)("span",{className:u().typed,children:b?T:N.substring(0,Math.min(k,N.length))}),"consonant"===o&&v&&(0,r.jsx)("span",{className:u().consonant,children:v}),j&&(0,r.jsx)("span",{className:"".concat(u().nextChar," ").concat(u().optimizedFocus),ref:g,children:j})," ","consonant"===o&&"string"==typeof p&&p.length>((null==c?void 0:c.length)||0)+1&&(0,r.jsx)("span",{className:u().currentCharRemaining,children:p.substring(((null==c?void 0:c.length)||0)+1)}),S&&(0,r.jsx)("span",{className:u().remaining,children:S}),R&&(0,r.jsx)("span",{className:u().ellipsis,children:R}),(0,r.jsx)("span",{className:u().typingCursor})]})})});c.displayName="SimpleTypingDisplay";var p=n(5886),d=n.n(p);let m=()=>{var e;let[t,n]=(0,i.useState)({displayText:"テストの日本語",kanaText:"てすとのにほんご",romaji:[["te"],["su"],["to"],["no"],["ni"],["ho"],["n"],["go"]]}),o=(0,a.z)({initialProblem:t,playSound:!0}),u=function(e){var t,n,r,a,o,u,c,p,d,m,g;let y=(0,i.useRef)(""),h=(0,i.useRef)(""),[f]=(0,i.useState)(()=>Math.random().toString(36).substring(2,9)),x=(0,i.useRef)({}),_=(0,i.useCallback)(async e=>{if(!e)return null;try{let t="".concat(e.currentCharIndex||0,"_").concat(e.currentInput||"","_").concat(+!!e.completed);if(t===h.current&&x.current.data)return x.current.data;h.current=t;let n=await s.A.getColoringInfo(e);return x.current={key:t,data:n,timestamp:Date.now()},n}catch(e){return l.error("ワーカーデータ取得エラー:",e),null}},[]);return((0,i.useCallback)(async e=>{if(!e)return"";try{let t=await s.A.getNextExpectedKey(e);return(null==t?void 0:t.key)||""}catch(e){return""}},[]),e)?((0,i.useEffect)(()=>{if(!e||!e.typingSession)return;let t=!0;return(async()=>{let n=e.typingSession,r="".concat(n.currentCharIndex||0,"_").concat(n.currentInput||"","_").concat(+!!n.completed);if(h.current!==r||!x.current.data)try{if(s.A.initialized&&!n.completed&&void 0!==n.currentCharIndex){let e=await _(n);t&&e&&(x.current.data=e)}}catch(e){}})(),()=>{t=!1}},[null==e||null==(t=e.typingSession)?void 0:t.currentCharIndex,null==e||null==(n=e.typingSession)?void 0:n.currentInput,null==e||null==(r=e.typingSession)?void 0:r.completed,_]),(0,i.useMemo)(()=>{try{var t,n;let r=(e,t,n)=>{if(!e)return n;let r=t.split("."),i=e;for(let e of r){if(void 0===i[e]||null===i[e])return n;i=i[e]}return i},i=x.current.data,a=r(e,"displayInfo",{}),s=r(e,"coloringInfo",{})||i||{},o=0;i&&void 0!==i.typedLength?o=i.typedLength:s&&void 0!==s.typedLength?o=s.typedLength:a&&void 0!==a.typedLength?o=a.typedLength:null!==r(e,"typingSession.typedLength",null)&&(o=r(e,"typingSession.typedLength",0));let u="";i&&i.expectedNextChar?u=i.expectedNextChar:s&&s.expectedNextChar?u=s.expectedNextChar:a&&a.expectedNextChar?u=a.expectedNextChar:null!==r(e,"typingSession.expectedNextChar",null)&&(u=r(e,"typingSession.expectedNextChar",""));let c=r(i,"currentInput","")||r(s,"currentInput","")||r(a,"currentInput","")||r(e,"typingSession.currentInput",""),p=r(i,"currentCharRomaji","")||r(s,"currentCharRomaji","")||r(a,"currentCharRomaji","")||r(e,"typingSession.currentCharRomaji",""),d="",m="",g=r(e,"typingSession",null);if(m=d=g&&g.displayRomaji?g.displayRomaji:r(e,"displayInfo.romaji","")?r(e,"displayInfo.romaji",""):r(e,"mcpSession.romaji","")?r(e,"mcpSession.romaji",""):r(e,"displayRomaji",""),d&&d.endsWith("|")&&(d=d.slice(0,-1)),d&&(d=d.replace(/\r\n/g," ").replace(/\n/g," ")),d&&""!==d.trim())y.current=d;else if(y.current)l.debug("[useSimpleTypingAdapter] ローマ字が空のため、前回の有効なローマ字を使用: ".concat(y.current)),d=y.current;else{let t=r(e,"problem.text","")||r(e,"currentProblem.text","")||r(a,"problem","");t&&(l.debug("[useSimpleTypingAdapter] ローマ字の再構築を試みます:",t),d=m||t)}let h=0,_=d?d.length:0;d&&d.length>60&&(h=Math.max(0,o-30),_=Math.min(d.length,o+30+((null==u?void 0:u.length)||1))),u&&d&&o+u.length>_&&(_=o+u.length);let T=r(e,"typingSession",{}),v=r(T,"consonantInput",!1),j="normal";(v||c&&(t=c)&&0!==t.length&&["b","c","d","f","g","h","j","k","m","n","p","q","r","s","t","v","w","x","y","z"].includes(t.toLowerCase().charAt(0))&&p&&p.length>c.length||p&&c&&p.length>c.length)&&(j="consonant");let S="consonant"===j&&c?(n=c)&&0!==n.length&&({k:["a","i","u","e","o","y"],g:["a","i","u","e","o","y"],s:["a","i","u","e","o","h"],z:["a","i","u","e","o"],t:["a","i","u","e","o","s"],d:["a","i","u","e","o"],n:["a","i","u","e","o"],h:["a","i","u","e","o","y"],f:["a","i","u","e","o"],b:["a","i","u","e","o","y"],p:["a","i","u","e","o","y"],m:["a","i","u","e","o"],y:["a","u","o"],r:["a","i","u","e","o","y"],w:["a","i","e","o"],v:["a","i","u","e","o"],c:["a","i","u","e","o","h"],j:["a","i","u","e","o"],q:["a","i","u","e","o"],x:["a","i","u","e","o"]})[n.toLowerCase().charAt(0)]||["a","i","u","e","o"]:[];return{romaji:d,typedLength:o,nextChar:u,isError:r(e,"errorAnimation",!1),isCompleted:r(e,"isCompleted",!1),inputMode:j,currentInput:c,currentCharRomaji:p,visiblePortion:{start:h,end:_},usingWorkerData:!!i,adapterId:f,possibleFollowingVowels:S,originalHook:e,debug:void 0}}catch(e){return l.error("useSimpleTypingAdapter エラー:",e),{romaji:y.current||"",typedLength:0,nextChar:"",isError:!1,isCompleted:!1,inputMode:"normal",currentInput:"",currentCharRomaji:"",visiblePortion:{start:0,end:0},adapterId:f,usingWorkerData:!1}}},[f,null==e?void 0:e.displayRomaji,null==e||null==(a=e.displayInfo)?void 0:a.romaji,null==e||null==(o=e.mcpSession)?void 0:o.romaji,null==e||null==(u=e.typingSession)?void 0:u.displayRomaji,null==e?void 0:e.coloringInfo,null==e?void 0:e.displayInfo,null==e?void 0:e.errorAnimation,null==e?void 0:e.isCompleted,null==e||null==(c=e.typingSession)?void 0:c.currentInput,null==e||null==(p=e.typingSession)?void 0:p.typedLength,null==e||null==(d=e.typingSession)?void 0:d.consonantInput,null==e||null==(m=e.problem)?void 0:m.text,null==e||null==(g=e.currentProblem)?void 0:g.text,x.current.data])):{romaji:"",typedLength:0,nextChar:"",isError:!1,isCompleted:!1,inputMode:"normal",currentInput:"",currentCharRomaji:"",visiblePortion:{start:0,end:0}}}(o);return(0,i.useEffect)(()=>{let e=e=>{!e.isComposing&&(1!==e.key.length||e.ctrlKey||e.altKey||e.metaKey||o.handleInput(e.key))};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[o]),(0,r.jsxs)("div",{className:d().testerContainer,children:[(0,r.jsx)("h2",{className:d().testerTitle,children:"シンプルタイピング表示テスト"}),(0,r.jsxs)("div",{className:d().problemText,children:[(0,r.jsx)("div",{className:d().japaneseText,children:t.displayText}),(0,r.jsx)("div",{className:d().kanaText,children:t.kanaText})]}),(0,r.jsx)("div",{className:d().typingDisplayWrapper,children:(0,r.jsx)(c,{romaji:u.romaji,typedLength:u.typedLength,nextChar:u.nextChar,isError:u.isError})}),(0,r.jsxs)("div",{className:d().controlPanel,children:[(0,r.jsx)("button",{onClick:()=>{n({displayText:"こんにちは世界",kanaText:"こんにちはせかい",romaji:[["ko"],["n"],["ni"],["chi"],["ha"],["se"],["ka"],["i"]]})},className:d().controlButton,children:"問題を変更"}),(0,r.jsx)("button",{onClick:()=>o.initializeSession(t),className:d().controlButton,children:"リセット"})]}),(0,r.jsxs)("div",{className:d().statusPanel,children:[(0,r.jsxs)("div",{className:d().statusItem,children:[(0,r.jsx)("span",{className:d().statusLabel,children:"入力状況:"}),(0,r.jsx)("span",{className:d().statusValue,children:u.isCompleted?"完了":"入力中"})]}),(0,r.jsxs)("div",{className:d().statusItem,children:[(0,r.jsx)("span",{className:d().statusLabel,children:"タイプ数:"}),(0,r.jsxs)("span",{className:d().statusValue,children:[u.typedLength," / ",(null==(e=u.romaji)?void 0:e.length)||0]})]}),(0,r.jsxs)("div",{className:d().statusItem,children:[(0,r.jsx)("span",{className:d().statusLabel,children:"次の入力:"}),(0,r.jsx)("span",{className:d().statusValue,children:u.nextChar||"-"})]})]})]})};function g(){let[e,t]=(0,i.useState)(!1);return((0,i.useEffect)(()=>{t(!0)},[]),e)?(0,r.jsxs)("div",{style:{padding:"20px"},children:[(0,r.jsx)("h1",{style:{textAlign:"center",marginBottom:"2rem",color:"#ff9a28"},children:"タイピング表示テストページ"}),(0,r.jsx)(m,{}),(0,r.jsx)("div",{style:{marginTop:"2rem",textAlign:"center"},children:(0,r.jsx)("a",{href:"/",style:{color:"#ff9a28",textDecoration:"underline"},children:"トップページに戻る"})})]}):null}},5886:e=>{e.exports={testerContainer:"SimpleTypingTester_testerContainer__iTsNU",testerTitle:"SimpleTypingTester_testerTitle__wNqkw",problemText:"SimpleTypingTester_problemText__97ULt",japaneseText:"SimpleTypingTester_japaneseText__gE4Ux",kanaText:"SimpleTypingTester_kanaText__C698E",typingDisplayWrapper:"SimpleTypingTester_typingDisplayWrapper__3t2BT",controlPanel:"SimpleTypingTester_controlPanel__IdyuI",controlButton:"SimpleTypingTester_controlButton__D8_Sl",statusPanel:"SimpleTypingTester_statusPanel__0De2L",statusItem:"SimpleTypingTester_statusItem__VIYvS",statusLabel:"SimpleTypingTester_statusLabel__0bhfg",statusValue:"SimpleTypingTester_statusValue__HoU6o"}},7062:(e,t,n)=>{"use strict";n.d(t,{A2:()=>a,LV:()=>p});let r=Symbol("Comlink.proxy"),i=Symbol("Comlink.endpoint"),a=Symbol("Comlink.releaseProxy"),s=Symbol("Comlink.finalizer"),l=Symbol("Comlink.thrown"),o=e=>"object"==typeof e&&null!==e||"function"==typeof e,u=new Map([["proxy",{canHandle:e=>o(e)&&e[r],serialize(e){let{port1:t,port2:n}=new MessageChannel;return function e(t,n=globalThis,i=["*"]){n.addEventListener("message",function a(o){let u;if(!o||!o.data)return;if(!function(e,t){for(let n of e)if(t===n||"*"===n||n instanceof RegExp&&n.test(t))return!0;return!1}(i,o.origin))return void console.warn(`Invalid origin '${o.origin}' for comlink proxy`);let{id:p,type:d,path:m}=Object.assign({path:[]},o.data),g=(o.data.argumentList||[]).map(_);try{var y,h,T;let n=m.slice(0,-1).reduce((e,t)=>e[t],t),i=m.reduce((e,t)=>e[t],t);switch(d){case"GET":u=i;break;case"SET":n[m.slice(-1)[0]]=_(o.data.value),u=!0;break;case"APPLY":u=i.apply(n,g);break;case"CONSTRUCT":y=new i(...g),u=Object.assign(y,{[r]:!0});break;case"ENDPOINT":{let{port1:n,port2:r}=new MessageChannel;e(t,r),h=n,T=[n],f.set(h,T),u=h}break;case"RELEASE":u=void 0;break;default:return}}catch(e){u={value:e,[l]:0}}Promise.resolve(u).catch(e=>({value:e,[l]:0})).then(e=>{let[r,i]=x(e);n.postMessage(Object.assign(Object.assign({},r),{id:p}),i),"RELEASE"===d&&(n.removeEventListener("message",a),c(n),s in t&&"function"==typeof t[s]&&t[s]())}).catch(e=>{let[t,r]=x({value:TypeError("Unserializable return value"),[l]:0});n.postMessage(Object.assign(Object.assign({},t),{id:p}),r)})}),n.start&&n.start()}(e,t),[n,[n]]},deserialize:e=>(e.start(),p(e))}],["throw",{canHandle:e=>o(e)&&l in e,serialize({value:e}){let t;return[e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[]]},deserialize(e){if(e.isError)throw Object.assign(Error(e.value.message),e.value);throw e.value}}]]);function c(e){"MessagePort"===e.constructor.name&&e.close()}function p(e,t){let n=new Map;return e.addEventListener("message",function(e){let{data:t}=e;if(!t||!t.id)return;let r=n.get(t.id);if(r)try{r(t)}finally{n.delete(t.id)}}),function e(t,n,r=[],s=function(){}){let l=!1,o=new Proxy(s,{get(i,s){if(d(l),s===a)return()=>{y&&y.unregister(o),m(t),n.clear(),l=!0};if("then"===s){if(0===r.length)return{then:()=>o};let e=T(t,n,{type:"GET",path:r.map(e=>e.toString())}).then(_);return e.then.bind(e)}return e(t,n,[...r,s])},set(e,i,a){d(l);let[s,o]=x(a);return T(t,n,{type:"SET",path:[...r,i].map(e=>e.toString()),value:s},o).then(_)},apply(a,s,o){d(l);let u=r[r.length-1];if(u===i)return T(t,n,{type:"ENDPOINT"}).then(_);if("bind"===u)return e(t,n,r.slice(0,-1));let[c,p]=h(o);return T(t,n,{type:"APPLY",path:r.map(e=>e.toString()),argumentList:c},p).then(_)},construct(e,i){d(l);let[a,s]=h(i);return T(t,n,{type:"CONSTRUCT",path:r.map(e=>e.toString()),argumentList:a},s).then(_)}}),u=(g.get(t)||0)+1;return g.set(t,u),y&&y.register(o,t,o),o}(e,n,[],t)}function d(e){if(e)throw Error("Proxy has been released and is not useable")}function m(e){return T(e,new Map,{type:"RELEASE"}).then(()=>{c(e)})}let g=new WeakMap,y="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{let t=(g.get(e)||0)-1;g.set(e,t),0===t&&m(e)});function h(e){var t;let n=e.map(x);return[n.map(e=>e[0]),(t=n.map(e=>e[1]),Array.prototype.concat.apply([],t))]}let f=new WeakMap;function x(e){for(let[t,n]of u)if(n.canHandle(e)){let[r,i]=n.serialize(e);return[{type:"HANDLER",name:t,value:r},i]}return[{type:"RAW",value:e},f.get(e)||[]]}function _(e){switch(e.type){case"HANDLER":return u.get(e.name).deserialize(e.value);case"RAW":return e.value}}function T(e,t,n,r){return new Promise(i=>{let a=[,,,,].fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");t.set(a,i),e.start&&e.start(),e.postMessage(Object.assign({id:a},n),r)})}},7150:(e,t,n)=>{Promise.resolve().then(n.bind(n,4311))}},e=>{var t=t=>e(e.s=t);e.O(0,[418,740,55,599,427,441,684,358],()=>t(7150)),_N_E=e.O()}]);