(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[63],{5886:e=>{e.exports={testerContainer:"SimpleTypingTester_testerContainer__iTsNU",testerTitle:"SimpleTypingTester_testerTitle__wNqkw",problemText:"SimpleTypingTester_problemText__97ULt",japaneseText:"SimpleTypingTester_japaneseText__gE4Ux",kanaText:"SimpleTypingTester_kanaText__C698E",typingDisplayWrapper:"SimpleTypingTester_typingDisplayWrapper__3t2BT",controlPanel:"SimpleTypingTester_controlPanel__IdyuI",controlButton:"SimpleTypingTester_controlButton__D8_Sl",statusPanel:"SimpleTypingTester_statusPanel__0De2L",statusItem:"SimpleTypingTester_statusItem__VIYvS",statusLabel:"SimpleTypingTester_statusLabel__0bhfg",statusValue:"SimpleTypingTester_statusValue__HoU6o"}},7062:(e,t,n)=>{"use strict";n.d(t,{A2:()=>i,LV:()=>p});let r=Symbol("Comlink.proxy"),a=Symbol("Comlink.endpoint"),i=Symbol("Comlink.releaseProxy"),s=Symbol("Comlink.finalizer"),l=Symbol("Comlink.thrown"),o=e=>"object"==typeof e&&null!==e||"function"==typeof e,u=new Map([["proxy",{canHandle:e=>o(e)&&e[r],serialize(e){let{port1:t,port2:n}=new MessageChannel;return function e(t,n=globalThis,a=["*"]){n.addEventListener("message",function i(o){let u;if(!o||!o.data)return;if(!function(e,t){for(let n of e)if(t===n||"*"===n||n instanceof RegExp&&n.test(t))return!0;return!1}(a,o.origin))return void console.warn(`Invalid origin '${o.origin}' for comlink proxy`);let{id:p,type:d,path:m}=Object.assign({path:[]},o.data),g=(o.data.argumentList||[]).map(v);try{var h,y,j;let n=m.slice(0,-1).reduce((e,t)=>e[t],t),a=m.reduce((e,t)=>e[t],t);switch(d){case"GET":u=a;break;case"SET":n[m.slice(-1)[0]]=v(o.data.value),u=!0;break;case"APPLY":u=a.apply(n,g);break;case"CONSTRUCT":h=new a(...g),u=Object.assign(h,{[r]:!0});break;case"ENDPOINT":{let{port1:n,port2:r}=new MessageChannel;e(t,r),y=n,j=[n],f.set(y,j),u=y}break;case"RELEASE":u=void 0;break;default:return}}catch(e){u={value:e,[l]:0}}Promise.resolve(u).catch(e=>({value:e,[l]:0})).then(e=>{let[r,a]=x(e);n.postMessage(Object.assign(Object.assign({},r),{id:p}),a),"RELEASE"===d&&(n.removeEventListener("message",i),c(n),s in t&&"function"==typeof t[s]&&t[s]())}).catch(e=>{let[t,r]=x({value:TypeError("Unserializable return value"),[l]:0});n.postMessage(Object.assign(Object.assign({},t),{id:p}),r)})}),n.start&&n.start()}(e,t),[n,[n]]},deserialize:e=>(e.start(),p(e))}],["throw",{canHandle:e=>o(e)&&l in e,serialize({value:e}){let t;return[e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[]]},deserialize(e){if(e.isError)throw Object.assign(Error(e.value.message),e.value);throw e.value}}]]);function c(e){"MessagePort"===e.constructor.name&&e.close()}function p(e,t){let n=new Map;return e.addEventListener("message",function(e){let{data:t}=e;if(!t||!t.id)return;let r=n.get(t.id);if(r)try{r(t)}finally{n.delete(t.id)}}),function e(t,n,r=[],s=function(){}){let l=!1,o=new Proxy(s,{get(a,s){if(d(l),s===i)return()=>{h&&h.unregister(o),m(t),n.clear(),l=!0};if("then"===s){if(0===r.length)return{then:()=>o};let e=j(t,n,{type:"GET",path:r.map(e=>e.toString())}).then(v);return e.then.bind(e)}return e(t,n,[...r,s])},set(e,a,i){d(l);let[s,o]=x(i);return j(t,n,{type:"SET",path:[...r,a].map(e=>e.toString()),value:s},o).then(v)},apply(i,s,o){d(l);let u=r[r.length-1];if(u===a)return j(t,n,{type:"ENDPOINT"}).then(v);if("bind"===u)return e(t,n,r.slice(0,-1));let[c,p]=y(o);return j(t,n,{type:"APPLY",path:r.map(e=>e.toString()),argumentList:c},p).then(v)},construct(e,a){d(l);let[i,s]=y(a);return j(t,n,{type:"CONSTRUCT",path:r.map(e=>e.toString()),argumentList:i},s).then(v)}}),u=(g.get(t)||0)+1;return g.set(t,u),h&&h.register(o,t,o),o}(e,n,[],t)}function d(e){if(e)throw Error("Proxy has been released and is not useable")}function m(e){return j(e,new Map,{type:"RELEASE"}).then(()=>{c(e)})}let g=new WeakMap,h="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{let t=(g.get(e)||0)-1;g.set(e,t),0===t&&m(e)});function y(e){var t;let n=e.map(x);return[n.map(e=>e[0]),(t=n.map(e=>e[1]),Array.prototype.concat.apply([],t))]}let f=new WeakMap;function x(e){for(let[t,n]of u)if(n.canHandle(e)){let[r,a]=n.serialize(e);return[{type:"HANDLER",name:t,value:r},a]}return[{type:"RAW",value:e},f.get(e)||[]]}function v(e){switch(e.type){case"HANDLER":return u.get(e.name).deserialize(e.value);case"RAW":return e.value}}function j(e,t,n,r){return new Promise(a=>{let i=[,,,,].fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");t.set(i,a),e.start&&e.start(),e.postMessage(Object.assign({id:i},n),r)})}},7150:(e,t,n)=>{Promise.resolve().then(n.bind(n,7884))},7884:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var r=n(5155),a=n(2115),i=n(1427),s=n(3055);let l={debug:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r]},error:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];console.error(e,...n)}};var o=n(7745),u=n(5886),c=n.n(u);let p=()=>{var e;let[t,n]=(0,a.useState)({displayText:"テストの日本語",kanaText:"てすとのにほんご",romaji:[["te"],["su"],["to"],["no"],["ni"],["ho"],["n"],["go"]]}),u=(0,i.z)({initialProblem:t,playSound:!0}),p=function(e){var t,n,r,i,o,u,c,p,d,m,g;let h=(0,a.useRef)(""),y=(0,a.useRef)(""),[f]=(0,a.useState)(()=>Math.random().toString(36).substring(2,9)),x=(0,a.useRef)({}),v=(0,a.useCallback)(async e=>{if(!e)return null;try{let t="".concat(e.currentCharIndex||0,"_").concat(e.currentInput||"","_").concat(+!!e.completed);if(t===y.current&&x.current.data)return x.current.data;y.current=t;let n=await s.A.getColoringInfo(e);return x.current={key:t,data:n,timestamp:Date.now()},n}catch(e){return l.error("ワーカーデータ取得エラー:",e),null}},[]);return((0,a.useCallback)(async e=>{if(!e)return"";try{let t=await s.A.getNextExpectedKey(e);return(null==t?void 0:t.key)||""}catch(e){return""}},[]),e)?((0,a.useEffect)(()=>{if(!e||!e.typingSession)return;let t=!0;return(async()=>{let n=e.typingSession,r="".concat(n.currentCharIndex||0,"_").concat(n.currentInput||"","_").concat(+!!n.completed);if(y.current!==r||!x.current.data)try{if(s.A.initialized&&!n.completed&&void 0!==n.currentCharIndex){let e=await v(n);t&&e&&(x.current.data=e)}}catch(e){}})(),()=>{t=!1}},[null==e||null==(t=e.typingSession)?void 0:t.currentCharIndex,null==e||null==(n=e.typingSession)?void 0:n.currentInput,null==e||null==(r=e.typingSession)?void 0:r.completed,v]),(0,a.useMemo)(()=>{try{var t,n;let r=(e,t,n)=>{if(!e)return n;let r=t.split("."),a=e;for(let e of r){if(void 0===a[e]||null===a[e])return n;a=a[e]}return a},a=x.current.data,i=r(e,"displayInfo",{}),s=r(e,"coloringInfo",{})||a||{},o=0;a&&void 0!==a.typedLength?o=a.typedLength:s&&void 0!==s.typedLength?o=s.typedLength:i&&void 0!==i.typedLength?o=i.typedLength:null!==r(e,"typingSession.typedLength",null)&&(o=r(e,"typingSession.typedLength",0));let u="";a&&a.expectedNextChar?u=a.expectedNextChar:s&&s.expectedNextChar?u=s.expectedNextChar:i&&i.expectedNextChar?u=i.expectedNextChar:null!==r(e,"typingSession.expectedNextChar",null)&&(u=r(e,"typingSession.expectedNextChar",""));let c=r(a,"currentInput","")||r(s,"currentInput","")||r(i,"currentInput","")||r(e,"typingSession.currentInput",""),p=r(a,"currentCharRomaji","")||r(s,"currentCharRomaji","")||r(i,"currentCharRomaji","")||r(e,"typingSession.currentCharRomaji",""),d="",m="",g=r(e,"typingSession",null);if(m=d=g&&g.displayRomaji?g.displayRomaji:r(e,"displayInfo.romaji","")?r(e,"displayInfo.romaji",""):r(e,"mcpSession.romaji","")?r(e,"mcpSession.romaji",""):r(e,"displayRomaji",""),d&&d.endsWith("|")&&(d=d.slice(0,-1)),d&&(d=d.replace(/\r\n/g," ").replace(/\n/g," ")),d&&""!==d.trim())h.current=d;else if(h.current)l.debug("[useSimpleTypingAdapter] ローマ字が空のため、前回の有効なローマ字を使用: ".concat(h.current)),d=h.current;else{let t=r(e,"problem.text","")||r(e,"currentProblem.text","")||r(i,"problem","");t&&(l.debug("[useSimpleTypingAdapter] ローマ字の再構築を試みます:",t),d=m||t)}let y=0,v=d?d.length:0;d&&d.length>60&&(y=Math.max(0,o-30),v=Math.min(d.length,o+30+((null==u?void 0:u.length)||1))),u&&d&&o+u.length>v&&(v=o+u.length);let j=r(e,"typingSession",{}),T=r(j,"consonantInput",!1),S="normal";(T||c&&(t=c)&&0!==t.length&&["b","c","d","f","g","h","j","k","m","n","p","q","r","s","t","v","w","x","y","z"].includes(t.toLowerCase().charAt(0))&&p&&p.length>c.length||p&&c&&p.length>c.length)&&(S="consonant");let b="consonant"===S&&c?(n=c)&&0!==n.length&&({k:["a","i","u","e","o","y"],g:["a","i","u","e","o","y"],s:["a","i","u","e","o","h"],z:["a","i","u","e","o"],t:["a","i","u","e","o","s"],d:["a","i","u","e","o"],n:["a","i","u","e","o"],h:["a","i","u","e","o","y"],f:["a","i","u","e","o"],b:["a","i","u","e","o","y"],p:["a","i","u","e","o","y"],m:["a","i","u","e","o"],y:["a","u","o"],r:["a","i","u","e","o","y"],w:["a","i","e","o"],v:["a","i","u","e","o"],c:["a","i","u","e","o","h"],j:["a","i","u","e","o"],q:["a","i","u","e","o"],x:["a","i","u","e","o"]})[n.toLowerCase().charAt(0)]||["a","i","u","e","o"]:[];return{romaji:d,typedLength:o,nextChar:u,isError:r(e,"errorAnimation",!1),isCompleted:r(e,"isCompleted",!1),inputMode:S,currentInput:c,currentCharRomaji:p,visiblePortion:{start:y,end:v},usingWorkerData:!!a,adapterId:f,possibleFollowingVowels:b,originalHook:e,debug:void 0}}catch(e){return l.error("useSimpleTypingAdapter エラー:",e),{romaji:h.current||"",typedLength:0,nextChar:"",isError:!1,isCompleted:!1,inputMode:"normal",currentInput:"",currentCharRomaji:"",visiblePortion:{start:0,end:0},adapterId:f,usingWorkerData:!1}}},[f,null==e?void 0:e.displayRomaji,null==e||null==(i=e.displayInfo)?void 0:i.romaji,null==e||null==(o=e.mcpSession)?void 0:o.romaji,null==e||null==(u=e.typingSession)?void 0:u.displayRomaji,null==e?void 0:e.coloringInfo,null==e?void 0:e.displayInfo,null==e?void 0:e.errorAnimation,null==e?void 0:e.isCompleted,null==e||null==(c=e.typingSession)?void 0:c.currentInput,null==e||null==(p=e.typingSession)?void 0:p.typedLength,null==e||null==(d=e.typingSession)?void 0:d.consonantInput,null==e||null==(m=e.problem)?void 0:m.text,null==e||null==(g=e.currentProblem)?void 0:g.text,x.current.data])):{romaji:"",typedLength:0,nextChar:"",isError:!1,isCompleted:!1,inputMode:"normal",currentInput:"",currentCharRomaji:"",visiblePortion:{start:0,end:0}}}(u);return(0,a.useEffect)(()=>{let e=e=>{!e.isComposing&&(1!==e.key.length||e.ctrlKey||e.altKey||e.metaKey||u.handleInput(e.key))};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[u]),(0,r.jsxs)("div",{className:c().testerContainer,children:[(0,r.jsx)("h2",{className:c().testerTitle,children:"シンプルタイピング表示テスト"}),(0,r.jsxs)("div",{className:c().problemText,children:[(0,r.jsx)("div",{className:c().japaneseText,children:t.displayText}),(0,r.jsx)("div",{className:c().kanaText,children:t.kanaText})]}),(0,r.jsx)("div",{className:c().typingDisplayWrapper,children:(0,r.jsx)(o.A,{romaji:p.romaji,typedLength:p.typedLength,nextChar:p.nextChar,isError:p.isError})}),(0,r.jsxs)("div",{className:c().controlPanel,children:[(0,r.jsx)("button",{onClick:()=>{n({displayText:"こんにちは世界",kanaText:"こんにちはせかい",romaji:[["ko"],["n"],["ni"],["chi"],["ha"],["se"],["ka"],["i"]]})},className:c().controlButton,children:"問題を変更"}),(0,r.jsx)("button",{onClick:()=>u.initializeSession(t),className:c().controlButton,children:"リセット"})]}),(0,r.jsxs)("div",{className:c().statusPanel,children:[(0,r.jsxs)("div",{className:c().statusItem,children:[(0,r.jsx)("span",{className:c().statusLabel,children:"入力状況:"}),(0,r.jsx)("span",{className:c().statusValue,children:p.isCompleted?"完了":"入力中"})]}),(0,r.jsxs)("div",{className:c().statusItem,children:[(0,r.jsx)("span",{className:c().statusLabel,children:"タイプ数:"}),(0,r.jsxs)("span",{className:c().statusValue,children:[p.typedLength," / ",(null==(e=p.romaji)?void 0:e.length)||0]})]}),(0,r.jsxs)("div",{className:c().statusItem,children:[(0,r.jsx)("span",{className:c().statusLabel,children:"次の入力:"}),(0,r.jsx)("span",{className:c().statusValue,children:p.nextChar||"-"})]})]})]})};function d(){let[e,t]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{t(!0)},[]),e)?(0,r.jsxs)("div",{style:{padding:"20px"},children:[(0,r.jsx)("h1",{style:{textAlign:"center",marginBottom:"2rem",color:"#ff9a28"},children:"タイピング表示テストページ"}),(0,r.jsx)(p,{}),(0,r.jsx)("div",{style:{marginTop:"2rem",textAlign:"center"},children:(0,r.jsx)("a",{href:"/",style:{color:"#ff9a28",textDecoration:"underline"},children:"トップページに戻る"})})]}):null}}},e=>{var t=t=>e(e.s=t);e.O(0,[980,740,55,599,475,441,684,358],()=>t(7150)),_N_E=e.O()}]);