(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{173:e=>{e.exports={keyboard_container:"RetroKeyboard_keyboard_container__Lhw5O",keyboard_canvas:"RetroKeyboard_keyboard_canvas___Llte",keyboardGlow:"RetroKeyboard_keyboardGlow__LZcpr"}},1774:e=>{e.exports={performance_monitor:"PerformanceMonitor_performance_monitor__7EyTc",monitor_header:"PerformanceMonitor_monitor_header___bPVQ",title:"PerformanceMonitor_title__ushy1",indicator_light:"PerformanceMonitor_indicator_light__KP4M2",pulse:"PerformanceMonitor_pulse__jMFgr",metrics_table:"PerformanceMonitor_metrics_table__7k8Wq",normal_value:"PerformanceMonitor_normal_value__HYoiu",warning_value:"PerformanceMonitor_warning_value__8ay3m",error_value:"PerformanceMonitor_error_value__4bgVI",details_section:"PerformanceMonitor_details_section__2CiYd",details_content:"PerformanceMonitor_details_content__yMDK8",hidden:"PerformanceMonitor_hidden__nkYSc",compact:"PerformanceMonitor_compact__xlGIq",fullscreen:"PerformanceMonitor_fullscreen__OFJ80"}},2219:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>m});let n={SETTINGS:"typingGameSettings",IS_ADMIN:"isAdmin",BACKGROUND_IMAGE:"savedBackgroundImage",BACKGROUND_STYLE:"savedBackgroundStyle",HIGH_SCORES:"highScores",SCREEN_BACKGROUNDS:"screenBackgrounds",USER_PREFERENCES:"userPreferences",USERNAME:"username",LAST_PLAYED_DATE:"lastPlayedDate",SCREEN_SIZE:"screenSize"},s=(e,t)=>{try{let a="object"==typeof t?JSON.stringify(t):t;return localStorage.setItem(e,a),!0}catch(t){return console.error("Storage save error for key [".concat(e,"]:"),t),!1}},o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{let a=localStorage.getItem(e);if(null===a)return t;try{return JSON.parse(a)}catch(e){return a}}catch(a){return console.error("Storage get error for key [".concat(e,"]:"),a),t}},r=()=>!0===o(n.IS_ADMIN,!1),i=()=>o(n.BACKGROUND_IMAGE,null),l=()=>o(n.BACKGROUND_STYLE,null),c=e=>o(n.SCREEN_BACKGROUNDS,{})[e]||null,d=async function(){let{targetSelector:e="#__next > div",delay:t=100}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!r())return!1;try{let a=i(),n=l();if(!a&&!n)return!1;await new Promise(e=>setTimeout(e,t));let s=document.querySelector(e);if(!s)return console.warn("背景を適用する要素が見つかりませんでした: ".concat(e)),!1;return n&&Object.entries(n).forEach(e=>{let[t,a]=e;"backgroundImage"!==t&&a&&(s.style[t]=a)}),a&&(s.style.backgroundImage="url(".concat(a,")"),s.style.backgroundSize="cover",s.style.backgroundPosition="center"),!0}catch(e){return console.error("背景適用中にエラーが発生しました:",e),!1}},u=async e=>{if(!r())return!1;let t=c(e);if(!t)return d();try{let a=document.querySelector("#__next > div");if(!a)return!1;return t.imageUrl&&(a.style.backgroundImage="url(".concat(t.imageUrl,")"),a.style.backgroundSize="cover",a.style.backgroundPosition="center"),t.styleObject&&Object.entries(t.styleObject).forEach(e=>{let[t,n]=e;"backgroundImage"!==t&&n&&(a.style[t]=n)}),console.log("".concat(e,"画面用の背景を適用しました")),!0}catch(e){return console.error("画面背景適用中にエラーが発生しました:",e),!1}},m={STORAGE_KEYS:n,saveToStorage:s,getFromStorage:o,removeFromStorage:e=>{try{return localStorage.removeItem(e),!0}catch(t){return console.error("Storage remove error for key [".concat(e,"]:"),t),!1}},saveGameSettings:e=>s(n.SETTINGS,e),getGameSettings:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(n.SETTINGS,e)},isAdminMode:r,setAdminMode:e=>s(n.IS_ADMIN,e),saveBackgroundImage:e=>s(n.BACKGROUND_IMAGE,e),saveBackgroundStyle:e=>s(n.BACKGROUND_STYLE,e),getBackgroundImage:i,getBackgroundStyle:l,saveScreenBackground:(e,t)=>{let a=o(n.SCREEN_BACKGROUNDS,{});return a[e]=t,s(n.SCREEN_BACKGROUNDS,a)},getScreenBackground:c,saveUsername:e=>s(n.USERNAME,e),getUsername:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"プレイヤー";return o(n.USERNAME,e)},saveHighScore:(e,t)=>{let a=o(n.HIGH_SCORES,{});return(!a[e]||t.kpm>a[e].kpm)&&(a[e]={...t,date:new Date().toISOString()}),s(n.HIGH_SCORES,a)},getHighScore:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=o(n.HIGH_SCORES,{});return e?t[e]||null:t},saveLastPlayedDate:()=>s(n.LAST_PLAYED_DATE,new Date().toISOString()),getLastPlayedDate:()=>o(n.LAST_PLAYED_DATE,null),saveScreenSize:e=>s(n.SCREEN_SIZE,e),getScreenSize:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{width:800,height:600};return o(n.SCREEN_SIZE,e)},applyBackgroundFromStorage:d,applyScreenBackground:u}},2494:e=>{e.exports={typing_area:"TypingArea_typing_area__24oZY",typing_area__problem:"TypingArea_typing_area__problem__yfpXs",typing_area__keyboard_container:"TypingArea_typing_area__keyboard_container__DSa2u",typing_loading:"TypingArea_typing_loading__nAda1",pulse:"TypingArea_pulse__kwFfg",problem_container:"TypingArea_problem_container__DrDCR",problem_text:"TypingArea_problem_text__5ePtR",input_area:"TypingArea_input_area__GDCyp"}},2574:e=>{e.exports={button:"Button_button__qCupi","button--disabled":"Button_button--disabled__LPoAO","button--primary":"Button_button--primary__uZOtY","button--secondary":"Button_button--secondary__O_Gm8","button--danger":"Button_button--danger__5vqLf","button--success":"Button_button--success__ZB9VJ","button--small":"Button_button--small__EwPRw","button--large":"Button_button--large__Xq3St","button--round":"Button_button--round___Izcj","button--active":"Button_button--active__NcvUE",button__icon:"Button_button__icon__u_LOV",toggle:"Button_toggle__lMu2e","toggle--on":"Button_toggle--on__idOhz","toggle--off":"Button_toggle--off__i_YR2","button--menu":"Button_button--menu__AXmIR","button--difficulty":"Button_button--difficulty__6mgjA","button--control":"Button_button--control__yI0zZ","button--back":"Button_button--back__VjTxq","button--loading":"Button_button--loading__2a2Vs",button__spinner:"Button_button__spinner__K8gfm",spinner:"Button_spinner__51Com",spin:"Button_spin__ezNAC"}},2610:e=>{e.exports={typing_game__wrapper:"GameScreen_typing_game__wrapper__t9Z_q",typing_game:"GameScreen_typing_game__KJGki",typing_game__header:"GameScreen_typing_game__header__Ga3yt",typing_game__level_display:"GameScreen_typing_game__level_display__Jfh1q",typing_game__status:"GameScreen_typing_game__status__1gf4s",typing_game__status_item:"GameScreen_typing_game__status_item___24z5",typing_game__display_toggle:"GameScreen_typing_game__display_toggle__7xDSb",typing_game__back_button:"GameScreen_typing_game__back_button__EaVM_",typing_game__main:"GameScreen_typing_game__main__4y7Pv",typing_game__content:"GameScreen_typing_game__content___sSj6",typing_game__problem:"GameScreen_typing_game__problem__5a191",typing_game__keyboard:"GameScreen_typing_game__keyboard__8Cyuw",typing_game__problem_text:"GameScreen_typing_game__problem_text__mobG0",typing_game__input:"GameScreen_typing_game__input__i3j2Q",typing_game__next_char:"GameScreen_typing_game__next_char__CJep4",typing_game__completed:"GameScreen_typing_game__completed__GsVwc",errorShake:"GameScreen_errorShake__mpCyv",typing_game__menu_button:"GameScreen_typing_game__menu_button__BeIuc",typing_game__corner:"GameScreen_typing_game__corner__ZNH9_",typing_game__corner_tech:"GameScreen_typing_game__corner_tech__D_p3y",typing_game__scanlines:"GameScreen_typing_game__scanlines__JHzVF",typing_game__dot_pattern:"GameScreen_typing_game__dot_pattern__T7ekH",typing_game__performance:"GameScreen_typing_game__performance__Gbm_q",gameContainer:"GameScreen_gameContainer__nTReN GameScreen_typing_game__KJGki",gameHeader:"GameScreen_gameHeader__ZGkP6 GameScreen_typing_game__header__Ga3yt",gameArea:"GameScreen_gameArea__eDsqs GameScreen_typing_game__main__4y7Pv",typingProblem:"GameScreen_typingProblem__sx0Q3 GameScreen_typing_game__problem_text__mobG0",simpleTypingText:"GameScreen_simpleTypingText__hNzyI GameScreen_typing_game__input__i3j2Q"}},2937:e=>{e.exports={resultContainer:"ResultScreen_resultContainer__v7Rr_",resultHeader:"ResultScreen_resultHeader__79lqO",resultTitle:"ResultScreen_resultTitle__8lPNA",escHint:"ResultScreen_escHint__E1hWu",pulse:"ResultScreen_pulse__GNsrL",resultSubtitle:"ResultScreen_resultSubtitle__Rc3FZ",resultContent:"ResultScreen_resultContent__CZiXS",rankDisplay:"ResultScreen_rankDisplay__qK1SC",rankValue:"ResultScreen_rankValue__5m3F7",rankLabel:"ResultScreen_rankLabel__V1cz3",rankBackdrop:"ResultScreen_rankBackdrop__A4PAd",statsContainer:"ResultScreen_statsContainer__sNIeF",statCard:"ResultScreen_statCard__MNuue",statValue:"ResultScreen_statValue__4_0Bz",statLabel:"ResultScreen_statLabel__9eivu",keyStatCard:"ResultScreen_keyStatCard__yJWh2",rankCard:"ResultScreen_rankCard__mBR9f",rankGlow:"ResultScreen_rankGlow__BEN_P",buttonContainer:"ResultScreen_buttonContainer__ncbc3",resultButton:"ResultScreen_resultButton__3bC6W",scanlines:"ResultScreen_scanlines__GxIwx",dotPattern:"ResultScreen_dotPattern__FQ_Xu",cornerDecoration:"ResultScreen_cornerDecoration__zhSBD",cornerTech:"ResultScreen_cornerTech__tD_Wc"}},2942:e=>{e.exports={error_boundary:"ErrorBoundary_error_boundary__OeuY9",error_container:"ErrorBoundary_error_container__wBl5s",pulse:"ErrorBoundary_pulse__4MFhF",error_title:"ErrorBoundary_error_title__316mE",error_message:"ErrorBoundary_error_message__evYyd",error_actions:"ErrorBoundary_error_actions__E128T",error_details:"ErrorBoundary_error_details__ZEgUX"}},5521:e=>{e.exports={toast:"Toast_toast__TFOz_","toast--top-right":"Toast_toast--top-right__4gLzo","toast--top-left":"Toast_toast--top-left__GXMzd","toast--bottom-right":"Toast_toast--bottom-right__BeJey","toast--bottom-left":"Toast_toast--bottom-left__RmffP",toast__content:"Toast_toast__content__HEigP",toast__icon:"Toast_toast__icon__hk1HK",toast__message:"Toast_toast__message__x01b5",toast__close_button:"Toast_toast__close_button__lWYh7",toast__progress:"Toast_toast__progress__kelfW","toast--success":"Toast_toast--success__CJsOd","toast--error":"Toast_toast--error__6nyYC","toast--warning":"Toast_toast--warning__buF5o","toast--info":"Toast_toast--info__Appi3"}},6144:e=>{e.exports={sound_settings:"SoundSettings_sound_settings__242MH","sound_settings--compact":"SoundSettings_sound_settings--compact__SztGN",sound_settings__section:"SoundSettings_sound_settings__section__pMinV",sound_settings__title:"SoundSettings_sound_settings__title__vgHfM",sound_settings__toggle:"SoundSettings_sound_settings__toggle__92jaU",sound_settings__volume_control:"SoundSettings_sound_settings__volume_control__IY_hg",sound_settings__volume_label:"SoundSettings_sound_settings__volume_label__8ha20",sound_settings__slider:"SoundSettings_sound_settings__slider__hESee",sound_settings__volume_value:"SoundSettings_sound_settings__volume_value__K2RFQ"}},6527:e=>{e.exports={modal:"Modal_modal__EMSm6",modal__overlay:"Modal_modal__overlay__uHy3L",modal__content:"Modal_modal__content__amxE3",modal__header:"Modal_modal__header__pc_vI",modal__body:"Modal_modal__body__t3NVI",modal__title:"Modal_modal__title__ze_zJ",modal__close_button:"Modal_modal__close_button__z82qy","modal--small":"Modal_modal--small__ShPD5","modal--large":"Modal_modal--large__wydrS"}},7643:e=>{e.exports={adminPopup__overlay:"AdminPopup_adminPopup__overlay__f7PR6",adminPopup:"AdminPopup_adminPopup__GNkgZ",popIn:"AdminPopup_popIn__vQ99v",adminPopup__header:"AdminPopup_adminPopup__header__I4gsd",adminPopup__title:"AdminPopup_adminPopup__title__Mzscv",adminPopup__closeButton:"AdminPopup_adminPopup__closeButton__BmZE9",adminPopup__content:"AdminPopup_adminPopup__content__o5Kxz",adminPopup__formGroup:"AdminPopup_adminPopup__formGroup__h_AOx",adminPopup__label:"AdminPopup_adminPopup__label__Wl6ky",adminPopup__input:"AdminPopup_adminPopup__input__rSFj8",adminPopup__info:"AdminPopup_adminPopup__info__IN1_k",adminPopup__footer:"AdminPopup_adminPopup__footer__xzIxg",adminPopup__button:"AdminPopup_adminPopup__button__ap1TR","adminPopup__button--primary":"AdminPopup_adminPopup__button--primary__5I6N6","adminPopup__button--secondary":"AdminPopup_adminPopup__button--secondary__h97xt",adminPopup__tabs:"AdminPopup_adminPopup__tabs__9bU9j",adminPopup__tab:"AdminPopup_adminPopup__tab__0I90P","adminPopup__tab--active":"AdminPopup_adminPopup__tab--active__ZqFJ7",adminPopup__backgroundSave:"AdminPopup_adminPopup__backgroundSave__ryMov","adminPopup__button--special":"AdminPopup_adminPopup__button--special__V8Zbq",adminPopup__successMessage:"AdminPopup_adminPopup__successMessage__APQHJ",fadeIn:"AdminPopup_fadeIn__yI8Pv",adminPopup__successIcon:"AdminPopup_adminPopup__successIcon__ugudh",adminPopup__backgroundGallery:"AdminPopup_adminPopup__backgroundGallery__wDVe_",adminPopup__subTitle:"AdminPopup_adminPopup__subTitle__GUQAt",adminPopup__loading:"AdminPopup_adminPopup__loading__uygEE",adminPopup__grid:"AdminPopup_adminPopup__grid__wfFxl",adminPopup__backgroundItem:"AdminPopup_adminPopup__backgroundItem__6p479",adminPopup__backgroundImageContainer:"AdminPopup_adminPopup__backgroundImageContainer__SPDBY",adminPopup__backgroundImage:"AdminPopup_adminPopup__backgroundImage__4Da4D",adminPopup__backgroundInfo:"AdminPopup_adminPopup__backgroundInfo__20fMV",adminPopup__backgroundTitle:"AdminPopup_adminPopup__backgroundTitle__qmJ7j",adminPopup__backgroundMeta:"AdminPopup_adminPopup__backgroundMeta__GsbHr","adminPopup__button--apply":"AdminPopup_adminPopup__button--apply__b3m1O",adminPopup__refreshContainer:"AdminPopup_adminPopup__refreshContainer__P3Uq7","adminPopup__button--refresh":"AdminPopup_adminPopup__button--refresh__KWJlJ",adminPopup__resetContainer:"AdminPopup_adminPopup__resetContainer__Ee149","adminPopup__button--reset":"AdminPopup_adminPopup__button--reset__TdYQ4","adminPopup__button--delete":"AdminPopup_adminPopup__button--delete__5NwA7",adminPopup__radioGroup:"AdminPopup_adminPopup__radioGroup__KdoGy",adminPopup__radioLabel:"AdminPopup_adminPopup__radioLabel__jntK2",adminPopup__radio:"AdminPopup_adminPopup__radio__ZHfQv"}},7785:e=>{e.exports={status_bar:"GameStatusBar_status_bar__JeGwC",empty_bar:"GameStatusBar_empty_bar__MM97W",logo_container:"GameStatusBar_logo_container__IiJqk",manaby_logo:"GameStatusBar_manaby_logo__Nn9Op",status_info:"GameStatusBar_status_info__imU2E",status_item:"GameStatusBar_status_item__elgdV",status_label:"GameStatusBar_status_label__ws42F",status_value:"GameStatusBar_status_value__lpYBC",status_rank:"GameStatusBar_status_rank__WzXS3",level_display:"GameStatusBar_level_display__rEibH",level_text:"GameStatusBar_level_text__8UN3U",progress_bar:"GameStatusBar_progress_bar__nbOcs",progress_fill:"GameStatusBar_progress_fill__W953B",combo_container:"GameStatusBar_combo_container__JslVE",combo_value:"GameStatusBar_combo_value__D7U0h",combo_label:"GameStatusBar_combo_label__sRM1p",stats_container:"GameStatusBar_stats_container__ct0MW",score_display:"GameStatusBar_score_display__9oKyN",score_label:"GameStatusBar_score_label__0VaT0",score_value:"GameStatusBar_score_value__Cvdk6",rank_display:"GameStatusBar_rank_display__CcjZv",rank_label:"GameStatusBar_rank_label__TjkJW",rank_value:"GameStatusBar_rank_value__AglP3",rank_s:"GameStatusBar_rank_s__1w62L",rank_a:"GameStatusBar_rank_a__zZEWC",rank_b:"GameStatusBar_rank_b__oWKZz",rank_c:"GameStatusBar_rank_c__1o4OX",rank_d:"GameStatusBar_rank_d__cYZJ4",rank_f:"GameStatusBar_rank_f__jmhY0",typing_stats:"GameStatusBar_typing_stats__ortLF",kpm_display:"GameStatusBar_kpm_display__aELFH",kpm_label:"GameStatusBar_kpm_label__YHTOW",kpm_value:"GameStatusBar_kpm_value__XuN4D",completion:"GameStatusBar_completion__WgZTz"}},7975:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>tb});var n=a(5155),s=a(2115),o=a(8334),r=a.n(o);let i={GENERAL:"general",POSITIVE:"positive"},l={EASY:"easy",NORMAL:"normal",HARD:"hard",ALL:"all"},c=[{displayText:"笑顔",kanaText:"えがお",category:i.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"希望",kanaText:"きぼう",category:i.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"元気",kanaText:"げんき",category:i.POSITIVE,tags:["状態","ポジティブ"]},{displayText:"勇気",kanaText:"ゆうき",category:i.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"夢",kanaText:"ゆめ",category:i.POSITIVE,tags:["概念","ポジティブ"]},{displayText:"愛",kanaText:"あい",category:i.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"光",kanaText:"ひかり",category:i.POSITIVE,tags:["自然","ポジティブ"]},{displayText:"前進",kanaText:"ぜんしん",category:i.POSITIVE,tags:["行動","ポジティブ"]},{displayText:"成功",kanaText:"せいこう",category:i.POSITIVE,tags:["達成","ポジティブ"]},{displayText:"努力",kanaText:"どりょく",category:i.POSITIVE,tags:["行動","ポジティブ"]},{displayText:"信頼",kanaText:"しんらい",category:i.POSITIVE,tags:["関係","ポジティブ"]},{displayText:"感謝",kanaText:"かんしゃ",category:i.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"挑戦",kanaText:"ちょうせん",category:i.POSITIVE,tags:["行動","ポジティブ"]},{displayText:"自信",kanaText:"じしん",category:i.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"幸福",kanaText:"こうふく",category:i.POSITIVE,tags:["状態","ポジティブ"]},{displayText:"成長",kanaText:"せいちょう",category:i.POSITIVE,tags:["変化","ポジティブ"]},{displayText:"平和",kanaText:"へいわ",category:i.POSITIVE,tags:["状態","ポジティブ"]},{displayText:"安心",kanaText:"あんしん",category:i.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"笑い",kanaText:"わらい",category:i.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"喜び",kanaText:"よろこび",category:i.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"友情",kanaText:"ゆうじょう",category:i.POSITIVE,tags:["関係","ポジティブ"]},{displayText:"愛情",kanaText:"あいじょう",category:i.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"誠実",kanaText:"せいじつ",category:i.POSITIVE,tags:["特性","ポジティブ"]},{displayText:"忍耐",kanaText:"にんたい",category:i.POSITIVE,tags:["特性","ポジティブ"]},{displayText:"力",kanaText:"ちから",category:i.POSITIVE,tags:["特性","ポジティブ"]},{displayText:"知恵",kanaText:"ちえ",category:i.POSITIVE,tags:["特性","ポジティブ"]},{displayText:"未来",kanaText:"みらい",category:i.POSITIVE,tags:["時間","ポジティブ"]},{displayText:"信念",kanaText:"しんねん",category:i.POSITIVE,tags:["考え","ポジティブ"]}],d=[{displayText:"今日も一日頑張ろう",kanaText:"きょうもいちにちがんばろう",category:i.POSITIVE,tags:["励まし","日常"]},{displayText:"笑顔で過ごそう",kanaText:"えがおですごそう",category:i.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"自分を信じて",kanaText:"じぶんをしんじて",category:i.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"夢に向かって進もう",kanaText:"ゆめにむかってすすもう",category:i.POSITIVE,tags:["励まし","目標"]},{displayText:"小さな幸せを大切に",kanaText:"ちいさなしあわせをたいせつに",category:i.POSITIVE,tags:["励まし","幸福"]},{displayText:"前向きな気持ちで",kanaText:"まえむきなきもちで",category:i.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"新しい挑戦を楽しもう",kanaText:"あたらしいちょうせんをたのしもう",category:i.POSITIVE,tags:["励まし","挑戦"]},{displayText:"失敗は成功のもと",kanaText:"しっぱいはせいこうのもと",category:i.POSITIVE,tags:["格言","励まし"]},{displayText:"努力は必ず報われる",kanaText:"どりょくはかならずむくわれる",category:i.POSITIVE,tags:["励まし","努力"]},{displayText:"一歩ずつ前進しよう",kanaText:"いっぽずつぜんしんしよう",category:i.POSITIVE,tags:["励まし","成長"]},{displayText:"心に太陽を持とう",kanaText:"こころにたいようをもとう",category:i.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"自分らしく生きよう",kanaText:"じぶんらしくいきよう",category:i.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"感謝の気持ちを忘れずに",kanaText:"かんしゃのきもちをわすれずに",category:i.POSITIVE,tags:["励まし","感謝"]},{displayText:"仲間と共に歩もう",kanaText:"なかまとともにあゆもう",category:i.POSITIVE,tags:["励まし","協力"]},{displayText:"笑う門には福来る",kanaText:"わらうかどにはふくきたる",category:i.POSITIVE,tags:["格言","ポジティブ"]},{displayText:"明日は明日の風が吹く",kanaText:"あしたはあしたのかぜがふく",category:i.POSITIVE,tags:["格言","未来"]},{displayText:"七転び八起き",kanaText:"ななころびやおき",category:i.POSITIVE,tags:["格言","挑戦"]},{displayText:"継続は力なり",kanaText:"けいぞくはちからなり",category:i.POSITIVE,tags:["格言","努力"]},{displayText:"雨降って地固まる",kanaText:"あめふってじかたまる",category:i.POSITIVE,tags:["格言","希望"]},{displayText:"思い立ったが吉日",kanaText:"おもいたったがきちじつ",category:i.POSITIVE,tags:["格言","行動"]},{displayText:"夢を持ち続けよう",kanaText:"ゆめをもちつづけよう",category:i.POSITIVE,tags:["励まし","夢"]},{displayText:"自分のペースで進もう",kanaText:"じぶんのぺーすですすもう",category:i.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"小さな一歩が大きな成果に",kanaText:"ちいさないっぽがおおきなせいかに",category:i.POSITIVE,tags:["励まし","成長"]},{displayText:"前向きな言葉を口にしよう",kanaText:"まえむきなことばをくちにしよう",category:i.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"心の声に耳を傾けよう",kanaText:"こころのこえにみみをかたむけよう",category:i.POSITIVE,tags:["励まし","自己理解"]},{displayText:"自分を大切にしよう",kanaText:"じぶんをたいせつにしよう",category:i.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"新しい自分に出会おう",kanaText:"あたらしいじぶんにであおう",category:i.POSITIVE,tags:["励まし","成長"]},{displayText:"可能性は無限大",kanaText:"かのうせいはむげんだい",category:i.POSITIVE,tags:["励まし","可能性"]},{displayText:"変化を楽しもう",kanaText:"へんかをたのしもう",category:i.POSITIVE,tags:["励まし","変化"]},{displayText:"自分の道を信じて",kanaText:"じぶんのみちをしんじて",category:i.POSITIVE,tags:["励まし","自己肯定"]}],u=[{displayText:"失敗は成功のもと",kanaText:"しっぱいはせいこうのもと",category:i.POSITIVE,tags:["格言","励まし"]},{displayText:"継続は力なり",kanaText:"けいぞくはちからなり",category:i.POSITIVE,tags:["格言","努力"]},{displayText:"七転び八起き",kanaText:"ななころびやおき",category:i.POSITIVE,tags:["格言","挑戦"]},{displayText:"雨降って地固まる",kanaText:"あめふってじかたまる",category:i.POSITIVE,tags:["格言","希望"]},{displayText:"思い立ったが吉日",kanaText:"おもいたったがきちじつ",category:i.POSITIVE,tags:["格言","行動"]},{displayText:"笑う門には福来る",kanaText:"わらうかどにはふくきたる",category:i.POSITIVE,tags:["格言","ポジティブ"]},{displayText:"明日は明日の風が吹く",kanaText:"あしたはあしたのかぜがふく",category:i.POSITIVE,tags:["格言","未来"]},{displayText:"自分を信じて前に進もう",kanaText:"じぶんをしんじてまえにすすもう",category:i.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"努力は必ず報われる",kanaText:"どりょくはかならずむくわれる",category:i.POSITIVE,tags:["励まし","努力"]},{displayText:"夢を持ち続けよう",kanaText:"ゆめをもちつづけよう",category:i.POSITIVE,tags:["励まし","夢"]},{displayText:"心の声に耳を傾けよう",kanaText:"こころのこえにみみをかたむけよう",category:i.POSITIVE,tags:["励まし","自己理解"]},{displayText:"自分の可能性を信じて",kanaText:"じぶんのかのうせいをしんじて",category:i.POSITIVE,tags:["励まし","可能性"]},{displayText:"新しい挑戦を恐れずに",kanaText:"あたらしいちょうせんをおそれずに",category:i.POSITIVE,tags:["励まし","挑戦"]},{displayText:"自分の道を信じて進もう",kanaText:"じぶんのみちをしんじてすすもう",category:i.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"毎日を笑顔で過ごそう",kanaText:"まいにちをえがおですごそう",category:i.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"自分を褒めてあげよう",kanaText:"じぶんをほめてあげよう",category:i.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"新しい自分を見つけよう",kanaText:"あたらしいじぶんをみつけよう",category:i.POSITIVE,tags:["励まし","成長"]},{displayText:"自分の可能性を広げよう",kanaText:"じぶんのかのうせいをひろげよう",category:i.POSITIVE,tags:["励まし","可能性"]},{displayText:"一歩ずつ夢に近づこう",kanaText:"いっぽずつゆめにちかづこう",category:i.POSITIVE,tags:["励まし","目標"]},{displayText:"自分の心に正直に",kanaText:"じぶんのこころにしょうじきに",category:i.POSITIVE,tags:["励まし","自己理解"]},{displayText:"毎日を楽しもう",kanaText:"まいにちをたのしもう",category:i.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"自分の人生を大切に",kanaText:"じぶんのじんせいをたいせつに",category:i.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"新しい発見を楽しもう",kanaText:"あたらしいはっけんをたのしもう",category:i.POSITIVE,tags:["励まし","成長"]},{displayText:"自分の成長を感じよう",kanaText:"じぶんのせいちょうをかんじよう",category:i.POSITIVE,tags:["励まし","成長"]},{displayText:"未来は自分の手で切り開こう",kanaText:"みらいはじぶんのてできりひらこう",category:i.POSITIVE,tags:["励まし","未来"]},{displayText:"困難は成長のチャンス",kanaText:"こんなんはせいちょうのちゃんす",category:i.POSITIVE,tags:["励まし","成長"]},{displayText:"自分の夢を信じて進もう",kanaText:"じぶんのゆめをしんじてすすもう",category:i.POSITIVE,tags:["励まし","夢"]},{displayText:"小さな一歩が大きな成果に",kanaText:"ちいさないっぽがおおきなせいかに",category:i.POSITIVE,tags:["励まし","成長"]},{displayText:"自分の力を信じて挑戦しよう",kanaText:"じぶんのちからをしんじてちょうせんしよう",category:i.POSITIVE,tags:["励まし","挑戦"]},{displayText:"前向きな気持ちで毎日を過ごそう",kanaText:"まえむきなきもちでまいにちをすごそう",category:i.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"自分の価値を信じて生きよう",kanaText:"じぶんのかちをしんじていきよう",category:i.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"新しい自分に出会う旅に出よう",kanaText:"あたらしいじぶんにであうたびにでよう",category:i.POSITIVE,tags:["励まし","成長"]},{displayText:"自分の可能性を信じて進もう",kanaText:"じぶんのかのうせいをしんじてすすもう",category:i.POSITIVE,tags:["励まし","可能性"]},{displayText:"毎日を大切に生きよう",kanaText:"まいにちをたいせつにいきよう",category:i.POSITIVE,tags:["励まし","日常"]},{displayText:"自分の夢を追いかけ続けよう",kanaText:"じぶんのゆめをおいかけつづけよう",category:i.POSITIVE,tags:["励まし","夢"]},{displayText:"心の中の光を信じて進もう",kanaText:"こころのなかのひかりをしんじてすすもう",category:i.POSITIVE,tags:["励まし","希望"]},{displayText:"自分の歩幅で前に進もう",kanaText:"じぶんのほはばでまえにすすもう",category:i.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"毎日を笑顔で過ごすことを忘れずに",kanaText:"まいにちをえがおですごすことをわすれずに",category:i.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"自分を大切にすることを忘れずに",kanaText:"じぶんをたいせつにすることをわすれずに",category:i.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"新しい挑戦を楽しもう",kanaText:"あたらしいちょうせんをたのしもう",category:i.POSITIVE,tags:["励まし","挑戦"]},{displayText:"自分の成長を喜ぼう",kanaText:"じぶんのせいちょうをよろこぼう",category:i.POSITIVE,tags:["励まし","成長"]},{displayText:"未来への一歩を踏み出そう",kanaText:"みらいへのいっぽをふみだそう",category:i.POSITIVE,tags:["励まし","行動"]},{displayText:"自分の可能性を信じて挑戦しよう",kanaText:"じぶんのかのうせいをしんじてちょうせんしよう",category:i.POSITIVE,tags:["励まし","挑戦"]},{displayText:"毎日を楽しむことを忘れずに",kanaText:"まいにちをたのしむことをわすれずに",category:i.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"自分の夢を追い続けよう",kanaText:"じぶんのゆめをおいつづけよう",category:i.POSITIVE,tags:["励まし","夢"]},{displayText:"心の声に従って生きよう",kanaText:"こころのこえにしたがっていきよう",category:i.POSITIVE,tags:["励まし","自己理解"]},{displayText:"自分の人生を自分らしく生きよう",kanaText:"じぶんのじんせいをじぶんらしくいきよう",category:i.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"新しい自分を見つける旅に出よう",kanaText:"あたらしいじぶんをみつけるたびにでよう",category:i.POSITIVE,tags:["励まし","成長"]},{displayText:"自分の可能性を信じて未来へ進もう",kanaText:"じぶんのかのうせいをしんじてみらいへすすもう",category:i.POSITIVE,tags:["励まし","可能性"]},{displayText:"毎日を笑顔で過ごすことを心がけよう",kanaText:"まいにちをえがおですごすことをこころがけよう",category:i.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"自分を信じて前に進む勇気を持とう",kanaText:"じぶんをしんじてまえにすすむゆうきをもとう",category:i.POSITIVE,tags:["励まし","勇気"]}],m=[...c,...d,...u],_=e=>{switch(e){case l.EASY:return c;case l.NORMAL:return d;case l.HARD:return u;default:return m}},p=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=_(e);a&&(n=n.filter(e=>e.category===a));let s=[...n].sort(()=>Math.random()-.5);return t&&t>0&&t<s.length?s.slice(0,t):s};var g=a(9529),y=a(2219);let h=(0,s.createContext)(),x=()=>{let e=(0,s.useContext)(h);if(!e)throw Error("useGameContext must be used within a GameProvider");return e},b={MAIN_MENU:"MAIN_MENU",GAME:"GAME",SETTINGS:"SETTINGS",CREDITS:"CREDITS",RESULT:"RESULT",RANKING:"RANKING"},f={difficulty:l.NORMAL,soundEnabled:!0,bgmEnabled:!0,bgmVolume:.5,sfxEnabled:!0,sfxVolume:1,requiredProblemCount:8,highPerformanceMode:!0,useRefactoredGameScreen:!1},S={level:1,solvedCount:0,currentProblemIndex:0,typingProgress:"",mistakes:0,isGameOver:!1,isGameClear:!1,playerName:"プレイヤー",correctKeyCount:0,startTime:null,endTime:null,hasStartedTyping:!1,problemKPMs:[],currentProblemStartTime:null,currentProblemKeyCount:0},v=e=>{let{children:t}=e,[a,o]=(0,s.useState)(b.MAIN_MENU),[r,i]=(0,s.useState)(f),[c,d]=(0,s.useState)([]),[u,m]=(0,s.useState)({...S});(0,s.useEffect)(()=>{try{let e=y.Ay.getGameSettings(f);i(e);let t=y.Ay.getUsername();t&&m(e=>({...e,playerName:t}));let a=p(e.difficulty);d(a),y.Ay.applyBackgroundFromStorage(),y.Ay.saveLastPlayedDate(),console.log("[GameContext] サウンドシステムの初期化を実行..."),g.A.initializeAllSounds().then(e=>{e&&console.log("[GameContext] 効果音の先行ロード完了")}),console.log("[GameContext] 初期化完了")}catch(e){console.error("[GameContext] 初期化エラー:",e)}},[]),(0,s.useEffect)(()=>{try{y.Ay.saveGameSettings(r);let e=p(r.difficulty);d(e),console.log("[GameContext] 難易度「".concat(r.difficulty,"」に更新"))}catch(e){console.error("[GameContext] 難易度更新エラー:",e)}},[r.difficulty]),(0,s.useEffect)(()=>{try{let e=r.soundEnabled;g.A.setSfxEnabled(e&&r.sfxEnabled),g.A.setSfxVolume(r.sfxVolume),g.A.setBgmEnabled(e&&r.bgmEnabled),g.A.setBgmVolume(r.bgmVolume),console.log("[GameContext] サウンド設定更新: SFX=".concat(e&&r.sfxEnabled,", BGM=").concat(e&&r.bgmEnabled))}catch(e){console.error("[GameContext] サウンド設定更新エラー:",e)}},[r.soundEnabled,r.sfxEnabled,r.sfxVolume,r.bgmEnabled,r.bgmVolume]),(0,s.useEffect)(()=>{try{y.Ay.isAdminMode()&&(y.Ay.applyScreenBackground(a),console.log("[GameContext] 画面背景更新: ".concat(a)))}catch(e){console.error("[GameContext] 背景更新エラー:",e)}},[a]);let _=(0,s.useCallback)(()=>{try{let e=r.requiredProblemCount||f.requiredProblemCount;console.log("[GameContext] ゲームリセット - 難易度設定:",{設定難易度:r.difficulty,問題数:e});let t=p(r.difficulty,e);d(t);let a=t&&t.length>0?t[0]:null;if(!a)return void console.error("[ERROR] 初期問題を設定できません。問題データが不足しています。");let n={...S,currentProblem:a,problems:t,requiredProblemCount:e,playerName:y.Ay.getUsername()||S.playerName,difficulty:r.difficulty,category:"all"};m(n),console.log("[GameContext] ゲームリセット完了",n)}catch(e){console.error("[GameContext] ゲームリセットエラー:",e)}},[r.difficulty,r.requiredProblemCount]),x=(0,s.useCallback)(e=>{Object.values(b).includes(e)?(e===b.GAME&&_(),o(e),console.log("[GameContext] 画面遷移: ".concat(e))):console.error("[ERROR] 無効な画面: ".concat(e))},[_]),v=(0,s.useCallback)(()=>c[u.currentProblemIndex]||null,[c,u.currentProblemIndex]),k=(0,s.useCallback)(e=>{e&&"string"==typeof e&&(m(t=>({...t,playerName:e})),y.Ay.saveUsername(e),console.log("[GameContext] ユーザー名を設定: ".concat(e)))},[]),T=(0,s.useCallback)(e=>{try{let t={...r,...e};i(t),y.Ay.saveGameSettings(t),console.log("[GameContext] 設定を更新しました")}catch(e){console.error("[GameContext] 設定更新エラー:",e)}},[r]),P=(0,s.useCallback)(e=>{try{if(e&&e.kpm)return y.Ay.saveHighScore(r.difficulty,e),console.log("[GameContext] ゲーム結果保存: KPM=".concat(e.kpm)),!0;return!1}catch(e){return console.error("[GameContext] ゲーム結果保存エラー:",e),!1}},[r.difficulty]),N=(0,s.useCallback)(e=>{Object.values(l).includes(e)?(T({difficulty:e}),console.log("[GameContext] 難易度変更: ".concat(e))):console.error("[ERROR] 無効な難易度: ".concat(e))},[T]),C={currentScreen:a,navigateTo:x,settings:r,setSettings:T,gameState:u,setGameState:m,resetGame:_,problems:c,getCurrentProblem:v,setUsername:k,saveGameResult:P,changeDifficulty:N,isAdminMode:y.Ay.isAdminMode};return(0,n.jsx)(h.Provider,{value:C,children:t})};var k=a(5561),T=a(760);let P={SOUND_ENABLED:"sound_soundEnabled",BGM_ENABLED:"sound_bgmEnabled",BGM_VOLUME:"sound_bgmVolume",SFX_ENABLED:"sound_sfxEnabled",SFX_VOLUME:"sound_sfxVolume"},N={soundEnabled:!0,bgmEnabled:!0,bgmVolume:.5,sfxEnabled:!0,sfxVolume:1},C=(0,s.createContext)(null),E=()=>{let e=(0,s.useContext)(C);if(!e)throw Error("useSoundContext must be used within a SoundProvider");return e},M=e=>{let{children:t}=e,[a,o]=(0,s.useState)(N),r=(0,s.useCallback)(()=>{if(!window.localStorage)return N;try{let e={soundEnabled:"true"===localStorage.getItem(P.SOUND_ENABLED),bgmEnabled:"true"===localStorage.getItem(P.BGM_ENABLED),bgmVolume:parseFloat(localStorage.getItem(P.BGM_VOLUME)||"0.5"),sfxEnabled:"true"===localStorage.getItem(P.SFX_ENABLED),sfxVolume:parseFloat(localStorage.getItem(P.SFX_VOLUME)||"1.0")},t={soundEnabled:null!==localStorage.getItem(P.SOUND_ENABLED)?e.soundEnabled:N.soundEnabled,bgmEnabled:null!==localStorage.getItem(P.BGM_ENABLED)?e.bgmEnabled:N.bgmEnabled,bgmVolume:isNaN(e.bgmVolume)?N.bgmVolume:Math.max(0,Math.min(1,e.bgmVolume)),sfxEnabled:null!==localStorage.getItem(P.SFX_ENABLED)?e.sfxEnabled:N.sfxEnabled,sfxVolume:isNaN(e.sfxVolume)?N.sfxVolume:Math.max(0,Math.min(1,e.sfxVolume))};return console.log("[SoundContext] 設定を読み込みました:",t),t}catch(e){return console.error("[SoundContext] 設定の読み込みに失敗しました:",e),N}},[]),i=(0,s.useCallback)(e=>{if(!window.localStorage)return!1;try{return localStorage.setItem(P.SOUND_ENABLED,e.soundEnabled),localStorage.setItem(P.BGM_ENABLED,e.bgmEnabled),localStorage.setItem(P.BGM_VOLUME,e.bgmVolume),localStorage.setItem(P.SFX_ENABLED,e.sfxEnabled),localStorage.setItem(P.SFX_VOLUME,e.sfxVolume),console.log("[SoundContext] 設定を保存しました:",e),!0}catch(e){return console.error("[SoundContext] 設定の保存に失敗しました:",e),!1}},[]);(0,s.useEffect)(()=>{let e=r();o(e),g.A.setSfxEnabled(e.soundEnabled&&e.sfxEnabled),g.A.setSfxVolume(e.sfxVolume),g.A.setBgmEnabled(e.soundEnabled&&e.bgmEnabled),g.A.setBgmVolume(e.bgmVolume),console.log("[SoundContext] SoundUtilsに設定を適用しました"),g.A.initializeAllSounds().then(e=>{e?console.log("[SoundContext] 基本効果音のプリロードに成功しました"):(console.warn("[SoundContext] 一部の効果音のロードに失敗しました"),setTimeout(()=>{Promise.all([g.A.loadSound("success",g.A.soundPresets.success),g.A.loadSound("error",g.A.soundPresets.error)]).catch(e=>console.warn("[SoundContext] タイピング音声の再ロードも失敗:",e))},2e3))}).catch(e=>{console.error("[SoundContext] 効果音の初期化中にエラーが発生しました:",e)})},[r]);let l=(0,s.useCallback)(e=>{o(t=>{let a={...t,...e};return("soundEnabled"in e||"sfxEnabled"in e)&&g.A.setSfxEnabled(a.soundEnabled&&a.sfxEnabled),"sfxVolume"in e&&g.A.setSfxVolume(a.sfxVolume),("soundEnabled"in e||"bgmEnabled"in e)&&g.A.setBgmEnabled(a.soundEnabled&&a.bgmEnabled),"bgmVolume"in e&&g.A.setBgmVolume(a.bgmVolume),i(a),a})},[i]),c=(0,s.useCallback)(()=>{l({soundEnabled:!a.soundEnabled})},[a.soundEnabled,l]),d=(0,s.useCallback)(()=>{l({bgmEnabled:!a.bgmEnabled})},[a.bgmEnabled,l]),u=(0,s.useCallback)(()=>{l({sfxEnabled:!a.sfxEnabled})},[a.sfxEnabled,l]),m=(0,s.useCallback)(e=>{l({bgmVolume:Math.max(0,Math.min(1,e))})},[l]),_=(0,s.useCallback)(e=>{l({sfxVolume:Math.max(0,Math.min(1,e))})},[l]),p=(0,s.useCallback)(()=>{a.soundEnabled&&a.sfxEnabled&&g.A.playSound("button")},[a.soundEnabled,a.sfxEnabled]),y={soundEnabled:a.soundEnabled,bgmEnabled:a.bgmEnabled,bgmVolume:a.bgmVolume,sfxEnabled:a.sfxEnabled,sfxVolume:a.sfxVolume,toggleSound:c,toggleBGM:d,toggleSFX:u,setBGMVolume:m,setSFXVolume:_,updateSoundSettings:l,playButtonSound:p,soundSystem:g.A};return(0,n.jsx)(C.Provider,{value:y,children:t})};var j=a(9254),I=a.n(j),w=a(6766),A=a(6527),R=a.n(A);let B=e=>{let{isOpen:t,onClose:a,title:o,children:r,size:i="medium",disableEscKey:l=!1,disableOverlayClick:c=!1,className:d=""}=e,u={base:R().modal,size:"medium"!==i?R()["modal--".concat(i)]:"",custom:d},m=(0,s.useCallback)(e=>{"Escape"===e.key&&t&&!l&&(e.preventDefault(),a())},[t,a,l]),_=(0,s.useCallback)(e=>{c||a()},[a,c]);return(0,s.useEffect)(()=>(t&&(document.addEventListener("keydown",m),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",m),document.body.style.overflow=""}),[t,m]),(0,n.jsx)(T.N,{children:t&&(0,n.jsx)("div",{className:[u.base,u.size,u.custom].filter(Boolean).join(" "),role:"dialog","aria-labelledby":"modal-title","aria-modal":"true",children:(0,n.jsx)(k.P.div,{className:R().modal__overlay,onClick:_,...{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2}},children:(0,n.jsxs)(k.P.div,{className:R().modal__content,onClick:e=>{e.stopPropagation()},...{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:400,damping:30,mass:1}},children:[(0,n.jsxs)("div",{className:R().modal__header,children:[(0,n.jsx)("h2",{className:R().modal__title,id:"modal-title",children:o}),(0,n.jsx)("button",{className:R().modal__close_button,onClick:a,"aria-label":"閉じる",children:"✕"})]}),(0,n.jsx)("div",{className:R().modal__body,children:r})]})})})})};var G=a(2574),O=a.n(G);let L={whileTap:{scale:.95},whileHover:{scale:1.05},transition:{type:"spring",stiffness:400,damping:25}},D=e=>{let{isOn:t,onToggle:a,disabled:o=!1,className:r="",onText:i="ON",offText:l="OFF"}=e,c=(0,s.useMemo)(()=>{let e=t?"toggle--on":"toggle--off";return[O().button,O().toggle,O()[e],o?O()["button--disabled"]:"",r].filter(Boolean).join(" ")},[t,o,r]);return(0,n.jsx)(k.P.button,{className:c,onClick:a,disabled:o,whileTap:o?void 0:L.whileTap,whileHover:o?void 0:L.whileHover,transition:L.transition,style:{},"aria-pressed":t,role:"switch",children:t?i:l})},V=e=>{let{variant:t="default",size:a="medium",round:o=!1,active:r=!1,icon:i,onClick:l,disabled:c=!1,className:d="",loading:u,children:m,..._}=e,p=(0,s.useMemo)(()=>{let e=["button"];return"default"!==t&&e.push("button--".concat(t)),"medium"!==a&&e.push("button--".concat(a)),o&&e.push("button--round"),r&&e.push("button--active"),u&&e.push("button--loading"),e.map(e=>O()[e]).filter(Boolean).concat(d).join(" ")},[t,a,o,r,d,u]),g=c||u,y={..._};return delete y.loading,(0,n.jsxs)(k.P.button,{className:p,onClick:l,disabled:g,whileTap:g?void 0:L.whileTap,whileHover:g?void 0:L.whileHover,transition:L.transition,style:{},...y,children:[u&&(0,n.jsx)("span",{className:O().button__spinner,children:(0,n.jsx)("span",{className:O().spinner})}),i&&(0,n.jsx)("span",{className:O().button__icon,children:i}),m]})};var F=a(6144),K=a.n(F);let U=e=>{let{className:t="",showMasterToggle:a=!0,compact:o=!1,idPrefix:r=""}=e,{soundEnabled:i,bgmEnabled:l,bgmVolume:c,sfxEnabled:d,sfxVolume:u,toggleSound:m,toggleBGM:_,toggleSFX:p,setBGMVolume:g,setSFXVolume:y,playButtonSound:h}=E(),x=(0,s.useCallback)(()=>{h()},[h]),b=(0,s.useCallback)(()=>{h()},[h]),f=(0,s.useCallback)(e=>{g(parseFloat(e.target.value))},[g]),S=(0,s.useCallback)(e=>{y(parseFloat(e.target.value))},[y]),v="".concat(K().sound_settings," ").concat(t," ").concat(o?K()["sound_settings--compact"]:""),k=K().sound_settings__section,T=K().sound_settings__title,P=K().sound_settings__toggle,N=K().sound_settings__volume_control,C=K().sound_settings__volume_label,M=K().sound_settings__slider,j=K().sound_settings__volume_value;return(0,n.jsxs)("div",{className:v,"data-testid":"sound-settings",children:[a&&(0,n.jsxs)("div",{className:k,children:[(0,n.jsx)("h3",{className:T,id:"".concat(r,"sound-title"),children:"サウンド"}),(0,n.jsx)("div",{className:P,children:(0,n.jsx)(D,{isOn:i,onToggle:m,"aria-labelledby":"".concat(r,"sound-title")})})]}),(0,n.jsxs)("div",{className:k,children:[(0,n.jsx)("h3",{className:T,id:"".concat(r,"bgm-title"),children:"BGM"}),(0,n.jsx)("div",{className:P,children:(0,n.jsx)(D,{isOn:l,onToggle:_,disabled:!i,"aria-labelledby":"".concat(r,"bgm-title")})}),(0,n.jsxs)("div",{className:N,children:[(0,n.jsx)("span",{className:C,id:"".concat(r,"bgm-volume-label"),children:"音量:"}),(0,n.jsx)("input",{type:"range",min:"0",max:"1",step:"0.01",value:null!=c?c:.5,onChange:f,onMouseUp:b,onTouchEnd:b,className:M,disabled:!i||!l,"aria-labelledby":"".concat(r,"bgm-volume-label"),"aria-valuenow":Math.round((null!=c?c:.5)*100),"aria-valuemin":0,"aria-valuemax":100}),(0,n.jsxs)("span",{className:j,children:[Math.round((null!=c?c:.5)*100),"%"]})]})]}),(0,n.jsxs)("div",{className:k,children:[(0,n.jsx)("h3",{className:T,id:"".concat(r,"sfx-title"),children:"効果音"}),(0,n.jsx)("div",{className:P,children:(0,n.jsx)(D,{isOn:d,onToggle:p,disabled:!i,"aria-labelledby":"".concat(r,"sfx-title")})}),(0,n.jsxs)("div",{className:N,children:[(0,n.jsx)("span",{className:C,id:"".concat(r,"sfx-volume-label"),children:"音量:"}),(0,n.jsx)("input",{type:"range",min:"0",max:"1",step:"0.01",value:null!=u?u:1,onChange:S,onMouseUp:x,onTouchEnd:x,className:M,disabled:!i||!d,"aria-labelledby":"".concat(r,"sfx-volume-label"),"aria-valuenow":Math.round((null!=u?u:1)*100),"aria-valuemin":0,"aria-valuemax":100}),(0,n.jsxs)("span",{className:j,children:[Math.round((null!=u?u:1)*100),"%"]})]})]})]})};var z=a(8637),H=a.n(z);let q=e=>{let{credits:t,showAcknowledgements:a=!1,creditSectionClass:s,sectionTitleClass:o,creditTextClass:r,creditsListClass:i,creditsItemClass:l}=e,c={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};return(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[t.development&&(0,n.jsxs)(k.P.div,{className:s,initial:"hidden",animate:"visible",variants:c,transition:{duration:.5,delay:.1},children:[(0,n.jsx)("h3",{className:o,children:t.development.title}),t.development.credits.map((e,t)=>(0,n.jsx)("p",{className:r,children:e},"dev-".concat(t)))]}),t.design&&(0,n.jsxs)(k.P.div,{className:s,initial:"hidden",animate:"visible",variants:c,transition:{duration:.5,delay:.2},children:[(0,n.jsx)("h3",{className:o,children:t.design.title}),t.design.credits.map((e,t)=>(0,n.jsx)("p",{className:r,children:e},"design-".concat(t)))]}),t.technology&&(0,n.jsxs)(k.P.div,{className:s,initial:"hidden",animate:"visible",variants:c,transition:{duration:.5,delay:.3},children:[(0,n.jsx)("h3",{className:o,children:t.technology.title}),t.technology.credits.map((e,t)=>(0,n.jsx)("p",{className:r,children:e},"tech-".concat(t)))]}),t.resources&&(0,n.jsxs)(k.P.div,{className:s,initial:"hidden",animate:"visible",variants:c,transition:{duration:.5,delay:.4},children:[(0,n.jsx)("h3",{className:o,children:t.resources.title}),(0,n.jsx)("ul",{className:i,children:t.resources.listItems.map((e,t)=>(0,n.jsx)("li",{className:l,children:e},"resource-".concat(t)))})]}),a&&t.acknowledgements&&(0,n.jsxs)(k.P.div,{className:s,initial:"hidden",animate:"visible",variants:c,transition:{duration:.5,delay:.5},children:[(0,n.jsx)("h3",{className:o,children:t.acknowledgements.title}),(0,n.jsx)("p",{className:r,children:t.acknowledgements.text})]}),t.license&&(0,n.jsxs)(k.P.div,{className:s,initial:"hidden",animate:"visible",variants:c,transition:{duration:.5,delay:.6},style:{marginTop:"10px"},children:[(0,n.jsx)("h3",{className:o,children:t.license.title}),(0,n.jsx)("p",{className:r,children:t.license.text})]})]})};q.propTypes={credits:H().shape({development:H().shape({title:H().string.isRequired,credits:H().arrayOf(H().string).isRequired}),design:H().shape({title:H().string.isRequired,credits:H().arrayOf(H().string).isRequired}),technology:H().shape({title:H().string.isRequired,credits:H().arrayOf(H().string).isRequired}),resources:H().shape({title:H().string.isRequired,listItems:H().arrayOf(H().string).isRequired}),acknowledgements:H().shape({title:H().string.isRequired,text:H().string.isRequired}),license:H().shape({title:H().string.isRequired,text:H().string.isRequired})}).isRequired,showAcknowledgements:H().bool,creditSectionClass:H().string,sectionTitleClass:H().string,creditTextClass:H().string,creditsListClass:H().string,creditsItemClass:H().string};let Y={development:{title:"企画・開発",credits:["カフェイン中毒","Google大先生"]},license:{title:"ライセンス",text:"\xa9 2024 Manaby Typing Game. All Rights Reserved."}};var J=a(9344),W=a(3055),Z=a(2201);let X=()=>{let[e,t]=(0,s.useState)(!1),a=(0,s.useCallback)(()=>{t(!0)},[]),n=(0,s.useCallback)(()=>{t(!1)},[]);return{showSettingsModal:e,setShowSettingsModal:t,openSettingsModal:a,closeSettingsModal:n}},Q=()=>{let{settings:e,setSettings:t}=x(),{soundSystem:a,soundEnabled:o,sfxEnabled:r,bgmEnabled:i}=E(),{goToScreen:l,isTransitioning:c}=e3(),d=(0,s.useRef)(null),{isActive:u,recordUXElement:m,recordGameEvent:_}=(0,J.Rz)(),[p,g]=(0,s.useState)(!1),{showSettingsModal:y,setShowSettingsModal:h,openSettingsModal:f,closeSettingsModal:S}=X();(0,s.useEffect)(()=>{u&&m({type:"component-mount",componentName:"MainMenu",timestamp:Date.now()}),a.initializeAllSounds().then(()=>{u&&_({type:"sound-system-initialized",status:"success"})}).catch(e=>{console.error("効果音の初期ロードに失敗:",e),u&&_({type:"sound-system-error",errorMessage:e.message})}),o&&i?(a.playBgm("lobby",!0),console.log("[MainMenu] BGM再生開始: soundEnabled="+o+", bgmEnabled="+i)):(a.stopBgm(),console.log("[MainMenu] BGM再生停止: soundEnabled="+o+", bgmEnabled="+i));let e=setInterval(()=>{let e=document.querySelector(".".concat(I().mainContainer));e&&setTimeout(()=>{e.classList.add(I().scanlineEffect),setTimeout(()=>{e.classList.remove(I().scanlineEffect)},1500)},3e3*Math.random())},8e3);return()=>{u&&m({type:"component-unmount",componentName:"MainMenu",timestamp:Date.now(),duration:Date.now()-performance.now()}),clearInterval(e),W.A&&"function"==typeof W.A.reset&&(console.log("[MainMenu] コンポーネントのアンマウント時にWorkerをリセットします"),W.A.reset().catch(e=>{console.warn("[MainMenu] Worker終了中にエラーが発生しました:",e)}))}},[a,o,i,u,m,_]);let v=(0,s.useCallback)(()=>{o&&r&&a.playSound("button")},[o,r,a]),T=(0,s.useCallback)(a=>{v(),u&&_({type:"difficulty-changed",previousDifficulty:e.difficulty,newDifficulty:a}),t({...e,difficulty:a})},[v,u,_,e,t]),P=(0,s.useCallback)(()=>{c||(u&&_({type:"game-started",difficulty:e.difficulty,timestamp:Date.now()}),l(b.GAME))},[c,u,_,e.difficulty,l]),N=(0,s.useCallback)(()=>{v(),u&&m({type:"modal-open",modalName:"settings",timestamp:Date.now()}),f()},[v,u,m,f]),C=(0,s.useCallback)(()=>{v(),u&&m({type:"modal-open",modalName:"credits",timestamp:Date.now()}),g(!0)},[v,u,m]),M=(0,s.useCallback)(()=>{v(),u&&m({type:"modal-close",modalName:p?"credits":"settings",timestamp:Date.now()}),g(!1),y&&S()},[v,u,m,p,S,y]),j={easy:"やさしい",normal:"ふつう",hard:"むずかしい"},[A,R]=(0,s.useState)(!1);(0,s.useCallback)(()=>{v(),R(!A),u&&m({type:"menu-toggle",menuName:"difficulty-selector",state:A?"closed":"open",timestamp:Date.now()})},[v,A,u,m]),(0,s.useCallback)(e=>{v(),T(e),R(!1),u&&m({type:"menu-select",menuName:"difficulty-selector",selectedValue:e,timestamp:Date.now()})},[v,T,u,m]),(0,s.useEffect)(()=>{let e=e=>{A&&!e.target.closest(".".concat(I().difficultySelector))&&(R(!1),u&&m({type:"menu-close",menuName:"difficulty-selector",reason:"outside-click",timestamp:Date.now()}))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[A,u,m]);let G={hidden:{y:20,opacity:0},show:{y:0,opacity:1,transition:{type:"spring",stiffness:300}}},O=(0,s.useCallback)(()=>(0,n.jsxs)("div",{className:I().settingsContainer,children:[(0,n.jsxs)("div",{className:I().settingsSection,children:[(0,n.jsxs)("div",{className:I().sectionHeader,children:[(0,n.jsx)("div",{className:I().sectionDecoration}),(0,n.jsx)("h3",{className:I().sectionTitle,children:"音声設定"})]}),(0,n.jsx)("div",{className:I().settingsPanel,children:(0,n.jsx)(U,{className:I().enhancedSoundSettings,showVolumeIndicator:!0,showEffects:!0})})]}),(0,n.jsxs)("div",{className:I().settingsSection,children:[(0,n.jsx)("h3",{className:I().settingsSectionTitle,children:"パフォーマンス設定"}),(0,n.jsxs)("div",{className:I().settingsRow,children:[(0,n.jsxs)("label",{className:I().settingsLabel,children:["高パフォーマンスモード",(0,n.jsx)("small",{className:I().settingsSubLabel,children:"（入力レスポンスを最適化します）"})]}),(0,n.jsxs)("div",{className:I().settingsControl,children:[(0,n.jsx)("input",{type:"checkbox",checked:!0,disabled:!0,className:I().settingsCheckbox}),(0,n.jsx)("span",{className:I().checkboxLabel,children:"常に有効"})]})]})]}),(0,n.jsxs)("div",{className:I().keyboardShortcuts,children:[(0,n.jsxs)("div",{className:I().shortcutsHeader,children:[(0,n.jsx)("div",{className:I().shortcutsDecoration}),(0,n.jsx)("span",{children:"キーボードショートカット"})]}),(0,n.jsxs)("div",{className:I().shortcutsList,children:[(0,n.jsxs)("div",{className:I().shortcutItem,children:[(0,n.jsx)("kbd",{children:"Space"}),(0,n.jsx)("span",{children:"ゲーム開始"})]}),(0,n.jsxs)("div",{className:I().shortcutItem,children:[(0,n.jsx)("kbd",{children:"S"}),(0,n.jsx)("span",{children:"設定を開く"})]}),(0,n.jsxs)("div",{className:I().shortcutItem,children:[(0,n.jsx)("kbd",{children:"R"}),(0,n.jsx)("span",{children:"ランキング表示"})]}),(0,n.jsxs)("div",{className:I().shortcutItem,children:[(0,n.jsx)("kbd",{children:"ESC"}),(0,n.jsx)("span",{children:"メニューに戻る"})]})]})]})]}),[e.difficulty,t,T]),L=(0,s.useCallback)(()=>(0,n.jsx)(q,{credits:Y,showAcknowledgements:!1,creditSectionClass:I().creditSection,sectionTitleClass:I().sectionTitle,creditTextClass:I().creditText,creditsListClass:I().creditsList,creditsItemClass:I().creditsItem}),[]);return(0,s.useEffect)(()=>{let e=e=>{if(y||p)return"Escape"===e.key?void M():void 0;!c&&(" "===e.key||"Space"===e.code?(e.preventDefault(),v(),u&&m({type:"keyboard-shortcut",key:"Space",action:"start-game",timestamp:Date.now()}),l(b.GAME)):"s"!==e.key&&"S"!==e.key||e.ctrlKey||e.metaKey?"c"!==e.key&&"C"!==e.key||e.ctrlKey||e.metaKey?"r"!==e.key&&"R"!==e.key||e.ctrlKey||e.metaKey||(e.preventDefault(),v(),u&&m({type:"keyboard-shortcut",key:"R",action:"open-ranking",timestamp:Date.now()}),l(b.RANKING)):(e.preventDefault(),v(),u&&m({type:"keyboard-shortcut",key:"C",action:"open-credits",timestamp:Date.now()}),g(!0)):(e.preventDefault(),v(),u&&m({type:"keyboard-shortcut",key:"S",action:"open-settings",timestamp:Date.now()}),f()))};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[c,y,p,v,u,m,l,f,M]),(0,n.jsxs)("div",{className:I().mainContainer,ref:d,children:[(0,n.jsx)(()=>(0,n.jsx)(n.Fragment,{}),{})," ",(0,n.jsxs)("div",{className:I().shipIdBadge,children:[(0,n.jsx)("div",{className:I().shipIdLabel,children:"MANABY SPACE CREW"}),(0,n.jsx)("div",{className:I().shipIdValue,children:"SRX-2025"})]}),(0,n.jsx)("div",{className:I().cornerButtons,children:(0,n.jsx)("button",{className:I().iconButton,onClick:N,"aria-label":"設定",children:(0,n.jsx)("div",{className:I().gearIcon,children:(0,n.jsx)("div",{className:I().gearInner})})})}),(0,n.jsx)(k.P.div,{className:I().mascotContainer,initial:{x:-100,opacity:0},animate:{x:0,opacity:1},transition:{type:"spring",delay:.5,duration:1},onAnimationComplete:()=>{u&&m({type:"animation-complete",elementName:"mascot",timestamp:Date.now()})},children:(0,n.jsx)("img",{src:(0,Z.aF)("/images/manabymario.png"),alt:"Manaby Mario Mascot",className:I().mascotImage})}),(0,n.jsxs)(k.P.div,{className:I().menuContainer,variants:{hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1,delayChildren:.3}}},initial:"hidden",animate:"show",children:[(0,n.jsxs)(k.P.div,{className:I().titleContainer,variants:G,children:[(0,n.jsx)("h1",{className:"screen-title ".concat(I().title),children:"manaby typing"}),(0,n.jsxs)("div",{className:I().subTitleContainer,children:[(0,n.jsx)("span",{className:I().subTitle,children:"SPACE CREW TYPING MISSION"}),(0,n.jsx)("div",{className:I().titleDecoration})]})]}),(0,n.jsx)(k.P.div,{className:I().logoContainer,variants:G,whileHover:{scale:1.05},whileTap:{scale:.95},children:(0,n.jsx)("button",{className:I().startButton,onClick:P,"aria-label":"ゲームを開始する",children:(0,n.jsx)(w.default,{src:(0,Z.aF)("/images/manabylogodot.png"),alt:"Start Game",width:200,height:200,className:I().logoImage,priority:!0,unoptimized:!0})})}),(0,n.jsx)(k.P.div,{className:I().difficultyToggleGroup,variants:G,children:Object.keys(j).map(t=>(0,n.jsx)("button",{className:"".concat(I().difficultyToggleButton," ").concat(e.difficulty===t?I().active:""),onClick:()=>T(t),"aria-pressed":e.difficulty===t,children:(0,n.jsx)("span",{className:I().btnText,children:j[t]})},t))}),(0,n.jsx)(k.P.div,{className:I().instructions,variants:G,children:(0,n.jsx)("div",{className:I().instructionText,children:"ロゴをクリックまたはSPACEキーでスタート！"})})]})," ",(0,n.jsx)("div",{className:I().earlyAccessBadge,"aria-label":"アーリーアクセスバージョン",children:"Early Access v0.9"}),(0,n.jsx)("button",{className:I().creditButton,onClick:C,"aria-label":"クレジット",children:(0,n.jsx)("div",{className:I().infoIcon,children:"ⓘ"})}),(0,n.jsx)(B,{isOpen:y,onClose:M,title:"設定",children:O()})," ",(0,n.jsx)(B,{isOpen:p,onClose:M,title:"クレジット",disableEscKey:!1,disableOverlayClick:!1,children:L()}),!1," "]})};var $=a(2610),ee=a.n($),et=a(2942),ea=a.n(et);class en extends s.Component{static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?this.props.fallback?this.props.fallback({error:this.state.error,resetError:this.resetErrorState}):(0,n.jsx)("div",{className:ea().error_boundary,children:(0,n.jsxs)("div",{className:ea().error_container,children:[(0,n.jsx)("h2",{className:ea().error_title,children:"予期せぬエラーが発生しました"}),(0,n.jsx)("p",{className:ea().error_message,children:"申し訳ありません。プログラムの実行中に問題が発生しました。"}),(0,n.jsxs)("div",{className:ea().error_actions,children:[(0,n.jsx)(V,{onClick:this.resetErrorState,variant:"primary",children:"再試行"}),this.props.onReturnToMenu&&(0,n.jsx)(V,{onClick:this.props.onReturnToMenu,variant:"secondary",children:"メニューに戻る"})]}),!1]})}):this.props.children}constructor(e){super(e),this.resetErrorState=()=>{this.setState({hasError:!1,error:null,errorInfo:null})},this.state={hasError:!1,error:null,errorInfo:null}}}function es(e){let{children:t,fallback:a}=e,{goToScreen:s}=x();return(0,n.jsx)(en,{fallback:a,onReturnToMenu:()=>{s(b.MAIN_MENU)},children:t})}var eo=a(1774),er=a.n(eo);let ei=(0,s.memo)(e=>{let{text:t="",animate:a=!0,className:o=""}=e,r="string"==typeof t,i="typing-problem ".concat(ee().typingProblem," ").concat(o||"").trim();return(0,n.jsx)("p",{className:i,"data-testid":"problem-display",children:(e=>{if(!e)return null;try{let t=e.split("\n");return(0,n.jsx)(n.Fragment,{children:t.map((e,a)=>(0,n.jsxs)(s.Fragment,{children:[(0,n.jsx)("span",{children:e}),a<t.length-1&&(0,n.jsx)("br",{})]},a))})}catch(t){return console.error("[ProblemDisplay] テキスト処理エラー:",t),(0,n.jsx)("span",{children:String(e||"")})}})(r?t:"")})},(e,t)=>{if(e.text!==t.text){var a,n;return console.log("[ProblemDisplay] テキストが変更されたため再レンダリング:",{prevText:(null==(a=e.text)?void 0:a.substring(0,10))+"...",newText:(null==(n=t.text)?void 0:n.substring(0,10))+"..."}),!1}return e.animate===t.animate&&e.className===t.className});var el=a(7745),ec=a(173),ed=a.n(ec);let eu=[["1","2","3","4","5","6","7","8","9","0","-","^","\\"],["q","w","e","r","t","y","u","i","o","p","@","["],["a","s","d","f","g","h","j","k","l",";",":","]"],["z","x","c","v","b","n","m",",",".","/","\\"],[" "]],em="#FF8800",e_="#00AAFF",ep=e=>{let{nextKey:t="",lastPressedKey:a="",width:o=800,height:r=300}=e,i=(0,s.useRef)(null),l=(0,s.useRef)(null),[c,d]=(0,s.useState)(null),[u,m]=(0,s.useState)(null),[_,p]=(0,s.useState)({}),[g,y]=(0,s.useState)([]),h=(0,s.useRef)(null),[x,b]=(0,s.useState)({width:0,height:0});(0,s.useMemo)(()=>({width:Math.max(45*eu[0].length-5,45*eu[1].length-5,45*eu[2].length-5,45*eu[3].length-5,250),height:45*eu.length-5}),[]);let f=(0,s.useCallback)(()=>{let e={},t=0;return eu.forEach((a,n)=>{let s=0,o=1===a.length?250:45*a.length-5,r=(x.width-o)/2;a.forEach((a,o)=>{let i=" "===a?250:40;e[a]={x:r+s,y:t,width:i,height:40,row:n,column:o},s+=i+5}),t+=45}),e},[x.width]),S=(0,s.useMemo)(()=>f(),[f]),v=(0,s.useCallback)(()=>{if(!c||!h.current)return;c.clearRect(0,0,c.canvas.width,c.canvas.height);let e=c.createLinearGradient(0,0,0,c.canvas.height);e.addColorStop(0,"rgba(0, 20, 40, 0.8)"),e.addColorStop(.5,"rgba(0, 30, 60, 0.7)"),e.addColorStop(1,"rgba(0, 20, 40, 0.8)"),c.fillStyle=e,c.fillRect(0,0,c.canvas.width,c.canvas.height),c.strokeStyle="rgba(0, 150, 255, 0.1)",c.lineWidth=.5;for(let e=0;e<c.canvas.height;e+=10)c.beginPath(),c.moveTo(0,e),c.lineTo(c.canvas.width,e),c.stroke();for(let e=0;e<c.canvas.width;e+=10)c.beginPath(),c.moveTo(e,0),c.lineTo(e,c.canvas.height),c.stroke();c.strokeStyle=em,c.lineWidth=2,c.beginPath(),c.roundRect(10,10,c.canvas.width-20,c.canvas.height-20,10),c.stroke(),c.strokeStyle=e_,c.lineWidth=1,c.beginPath(),c.roundRect(15,15,c.canvas.width-30,c.canvas.height-30,8),c.stroke();let n=Math.floor((c.canvas.height-40)/20);for(let e=0;e<n;e++){let t=20+20*e;c.fillStyle=e%2==0?em:e_,c.fillRect(5,t,5,30),c.fillRect(c.canvas.width-5-5,t,5,30)}Object.entries(S).forEach(e=>{let[n,s]=e,o=n.toLowerCase()===t.toLowerCase(),r=n.toLowerCase()===a.toLowerCase(),i=_[n]||{glow:0,press:0},l=15*i.glow,d=Math.min(4,Math.max(0,4*i.press));c.save(),c.shadowColor="rgba(0, 0, 0, 0.6)",c.shadowBlur=3,c.shadowOffsetX=1,c.shadowOffsetY=2,c.fillStyle="rgba(0, 0, 0, 0.4)",c.beginPath(),c.roundRect(s.x+1.5,s.y+3+d,s.width-1,s.height-d-1,6),c.fill(),c.restore();let u=c.createLinearGradient(s.x,s.y+d,s.x,s.y+s.height);if(u.addColorStop(0,"#3a3a3a"),u.addColorStop(.9,"#2d2d2d"),u.addColorStop(1,"#252525"),c.fillStyle=u,c.beginPath(),c.roundRect(s.x,s.y+d,s.width,s.height-d,6),c.fill(),c.fillStyle="rgba(255, 255, 255, 0.07)",c.beginPath(),c.roundRect(s.x+2,s.y+d+2,s.width-4,(s.height-d)*.3,4),c.fill(),o){c.save(),c.shadowColor=em,c.shadowBlur=15,c.fillStyle="rgba(255, 136, 0, 0.8)";let e=.6*l;c.beginPath(),c.roundRect(s.x-e,s.y-e+d,s.width+2*e,s.height+2*e-d,6+e),c.fill(),c.restore();let t=1.5*Math.sin(Date.now()/500)+2.5;c.strokeStyle="rgba(255, 136, 0, 0.5)",c.lineWidth=1.5,c.beginPath(),c.roundRect(s.x-t,s.y-t+d,s.width+2*t,s.height+2*t-d,6+t),c.stroke();let a=c.createLinearGradient(s.x,s.y,s.x,s.y+s.height);a.addColorStop(0,"rgba(255, 136, 0, 0.4)"),a.addColorStop(1,"rgba(255, 80, 0, 0.25)"),c.fillStyle=a,c.beginPath(),c.roundRect(s.x,s.y+d,s.width,s.height-d,6),c.fill()}else if(r&&d>0){let e=c.createLinearGradient(s.x,s.y+d,s.x,s.y+s.height);e.addColorStop(0,"rgba(70, 75, 90, 0.6)"),e.addColorStop(1,"rgba(50, 55, 65, 0.4)"),c.fillStyle=e,c.beginPath(),c.roundRect(s.x,s.y+d,s.width,s.height-d,6),c.fill(),c.strokeStyle="rgba(0, 150, 255, 0.15)",c.lineWidth=1,c.beginPath(),c.roundRect(s.x+1,s.y+d+1,s.width-2,s.height-d-2,5),c.stroke()}c.save(),o?(c.shadowColor=em,c.shadowBlur=8,c.fillStyle="#FFCC00"):c.fillStyle="#DDD",c.font='bold 18px "SF Mono", "Courier New", monospace',c.textAlign="center",c.textBaseline="middle";let m=s.y+s.height/2+d,p=" "===n?"SPACE":n.toUpperCase();if(" "===n){if(o){let e=s.y+.7*s.height+d,t=c.createLinearGradient(s.x+20,e,s.x+s.width-40,e);t.addColorStop(0,"rgba(255, 136, 0, 0.3)"),t.addColorStop(.5,"rgba(255, 136, 0, 0.7)"),t.addColorStop(1,"rgba(255, 136, 0, 0.3)"),c.fillStyle=t,c.fillRect(s.x+30,e,s.width-60,1.5)}c.fillText("SPACE",s.x+s.width/2,m)}else c.fillText(p,s.x+s.width/2,m),o&&(c.font='bold 7px "SF Mono", "Courier New", monospace',c.fillText("●●●",s.x+s.width/2,s.y+s.height-8+d));if(c.restore(),o){c.save();let e=c.createLinearGradient(s.x,s.y+s.height-1+d,s.x+s.width,s.y+s.height-1+d);e.addColorStop(0,"rgba(255, 136, 0, 0.3)"),e.addColorStop(.5,"rgba(255, 136, 0, 0.8)"),e.addColorStop(1,"rgba(255, 136, 0, 0.3)"),c.fillStyle=e,c.fillRect(s.x+2,s.y+s.height-1.5+d,s.width-4,1.5),c.restore()}if(d>0){let e=Math.min(4,d);if(c.fillStyle="rgba(0, 0, 0, 0.7)",c.beginPath(),c.moveTo(s.x,s.y+s.height),c.lineTo(s.x+s.width,s.y+s.height),c.lineTo(s.x+s.width,s.y+s.height-e),c.lineTo(s.x,s.y+s.height-e),c.fill(),c.fillStyle="rgba(0, 0, 0, 0.5)",c.beginPath(),c.moveTo(s.x+s.width,s.y+e),c.lineTo(s.x+s.width,s.y+s.height),c.lineTo(s.x+s.width-3,s.y+s.height-3),c.lineTo(s.x+s.width-3,s.y+e+3),c.fill(),i.press>.7){let e=Math.max(.1,(1-(i.press-.7)/.3)*12);c.save(),c.strokeStyle="rgba(255, 255, 255, ".concat((1-i.press)*.4,")"),c.lineWidth=1.5,c.beginPath(),c.arc(s.x+s.width/2,s.y+s.height/2+d,e,0,2*Math.PI),c.stroke(),c.strokeStyle="rgba(255, 160, 70, ".concat((1-i.press)*.3,")"),c.lineWidth=1,c.beginPath(),c.arc(s.x+s.width/2,s.y+s.height/2+d,.7*e,0,2*Math.PI),c.stroke(),c.restore()}}}),c.strokeStyle="rgba(0, 180, 255, 0.15)",c.lineWidth=1,[["q","w"],["w","e"],["e","r"],["a","s"],["s","d"],["f","g"],["z","x"],["x","c"],["c","v"],["v","b"],["g","h"],["h","j"],["j","k"],["k","l"],["y","u"],["u","i"],["i","o"],["o","p"]].forEach(e=>{let[t,a]=e,n=S[t],s=S[a];n&&s&&(c.beginPath(),c.moveTo(n.x+n.width/2,n.y+n.height/2),c.lineTo(s.x+s.width/2,s.y+s.height/2),c.stroke())}),g.length>0&&g.forEach(e=>{c.fillStyle="rgba(".concat(e.color.r,", ").concat(e.color.g,", ").concat(e.color.b,", ").concat(e.alpha,")"),c.strokeStyle="rgba(".concat(e.color.r,", ").concat(e.color.g,", ").concat(e.color.b,", ").concat(e.alpha,")"),"square"===e.type?(c.save(),c.translate(e.x,e.y),c.rotate(e.life*Math.PI),c.fillRect(-e.size/2,-e.size/2,e.size,e.size),c.restore()):"line"===e.type?(c.save(),c.lineWidth=1+Math.random(),c.beginPath(),c.moveTo(e.x,e.y),c.lineTo(e.x-Math.cos(e.angle)*e.size,e.y-Math.sin(e.angle)*e.size),c.stroke(),c.restore()):(c.beginPath(),c.arc(e.x,e.y,e.size/2,0,2*Math.PI),c.fill(),Math.random()>.8&&(c.save(),c.globalAlpha=.5*e.alpha,c.beginPath(),c.arc(e.x,e.y,e.size,0,2*Math.PI),c.stroke(),c.restore()))})},[c,S,t,a,_,u]);(0,s.useCallback)(e=>{queueMicrotask(()=>{})},[]);let k=(0,s.useCallback)(()=>{if(c){if(p(e=>{let n={...e},s=new Set;return t&&s.add(t.toLowerCase()),a&&s.add(a.toLowerCase()),Object.keys(n).forEach(e=>{let o=n[e],r=e.toLowerCase();void 0!==o.glow&&(r===t.toLowerCase()?n[e]={...o,glow:Math.min(1,o.glow+.05)}:o.glow>0&&(n[e]={...o,glow:Math.max(0,o.glow-.1)})),void 0!==o.press&&(r===a.toLowerCase()&&o.press<1?n[e]={...o,press:Math.min(1,o.press+.3)}:o.press>0?n[e]={...o,press:Math.max(0,o.press-.15)}:0!==o.press||s.has(r)||delete n[e]);let i=n[e];i&&!s.has(r)&&(0===i.glow||void 0===i.glow)&&(0===i.press||void 0===i.press)&&delete n[e]}),t&&!n[t]&&(n[t]={glow:0,press:0}),a&&!n[a]&&(n[a]={glow:0,press:1}),n}),a&&a!==u){m(a);let e=S[a];if(e){let t=e.x+e.width/2,a=e.y+e.height/2,n=[],s=25+Math.floor(10*Math.random());for(let e=0;e<s;e++){let e=Math.random()*Math.PI*2,s=2+5*Math.random(),o=Math.random()>.3?{r:220+Math.floor(35*Math.random()),g:100+Math.floor(60*Math.random()),b:Math.floor(50*Math.random())}:{r:240+Math.floor(15*Math.random()),g:200+Math.floor(55*Math.random()),b:Math.floor(80*Math.random())},r=Math.random(),i=r>.7?"square":r>.3?"circle":"line",l="line"===i?2+6*Math.random():1+3*Math.random();n.push({x:t+(Math.random()-.5)*10,y:a+(Math.random()-.5)*10,vx:Math.cos(e)*s,vy:Math.sin(e)*s,size:l,alpha:.8+.2*Math.random(),color:o,life:1,decay:.008+.02*Math.random(),type:i,angle:e})}y(e=>[...e,...n])}}v(),y(e=>0===e.length?e:e.map(e=>"line"===e.type?{...e,x:e.x+1.2*e.vx,y:e.y+1.2*e.vy,vy:e.vy+.03,size:.97*e.size,alpha:.94*e.alpha,life:e.life-e.decay}:{...e,x:e.x+e.vx,y:e.y+e.vy,vx:.98*e.vx,vy:.98*e.vy+.07,size:"square"===e.type?e.size*(1-2*e.decay):e.size*(e.life>.5?1.01:.98),alpha:.95*e.alpha,life:e.life-e.decay}).filter(e=>e.life>0&&e.x>-50&&e.x<c.canvas.width+50&&e.y>-50&&e.y<c.canvas.height+50)),Date.now()%5e3<16&&p(e=>{let n={...e};return Object.keys(n).forEach(e=>{let s=e.toLowerCase();if(s!==t.toLowerCase()&&s!==a.toLowerCase()){let t=n[e];(0===t.press||void 0===t.press)&&(0===t.glow||void 0===t.glow)&&delete n[e]}}),n}),l.current=requestAnimationFrame(k)}},[c,v,t,a,u]);return(0,s.useEffect)(()=>{if(!i.current)return;let e=i.current.getContext("2d");return e&&d(e),()=>{l.current&&cancelAnimationFrame(l.current)}},[]),(0,s.useEffect)(()=>{if(!h.current)return;let e=()=>{if(!h.current)return;let e=h.current.getBoundingClientRect();b({width:e.width,height:e.height})},t=setTimeout(e,10),a=new ResizeObserver(e);return a.observe(h.current),()=>{clearTimeout(t),h.current&&a.unobserve(h.current)}},[]),(0,s.useEffect)(()=>{if(!i.current||!c)return;let e=window.devicePixelRatio||1;i.current.width=x.width*e,i.current.height=x.height*e,c.scale(e,e),i.current.style.width="".concat(x.width,"px"),i.current.style.height="".concat(x.height,"px")},[c,x]),(0,s.useEffect)(()=>{},[a]),(0,s.useEffect)(()=>{if(c)return l.current=requestAnimationFrame(k),()=>{l.current&&cancelAnimationFrame(l.current)}},[c,k]),(0,n.jsx)("div",{ref:h,className:ed().keyboard_container,style:{width:"100%",height:"".concat(r,"px")},children:(0,n.jsx)("canvas",{ref:i,className:ed().keyboard_canvas,style:{width:"100%",height:"100%"}})})};var eg=a(2494),ey=a.n(eg);let eh=e=>{var t,a,o,r,i,l,c,d,u,m;let{typing:_,currentProblem:p,lastPressedKey:g="",className:y=""}=e,h=function(e){for(var t=arguments.length,a=Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n]},[x,b]=(0,s.useState)({romaji:"",typedLength:0,currentCharIndex:0,hasError:!1,lastUpdated:Date.now()}),f=(0,s.useMemo)(()=>{if(!_||"function"!=typeof _.getNextKey)return"";try{let e=_.getNextKey()||"";return h("次のキー:",e),e}catch(e){return console.error("[TypingArea] 次のキー取得エラー:",e),""}},[_,!1,null==_||null==(t=_.displayInfo)?void 0:t.currentCharIndex,null==_||null==(a=_.displayInfo)?void 0:a.typedLength]);if((0,s.useEffect)(()=>{if(!_)return void h("typingオブジェクトがありません");if(!_.displayInfo)return void h("表示情報が見つかりません");try{let{romaji:e="",typedLength:t=0,currentCharIndex:a=0,currentInput:n="",currentCharRomaji:s="",expectedNextChar:o=""}=_.displayInfo,r="string"==typeof e;h("表示データ更新:",{romaji:r?e.substring(0,20)+(e.length>20?"...":""):"<無効>",typedLength:t,currentCharIndex:a,currentInput:n,expectedNextChar:o,valid:r}),b({romaji:e||"",typedLength:t||0,currentCharIndex:a||0,currentInput:n||"",currentCharRomaji:s||"",expectedNextChar:o||"",hasError:!1,lastUpdated:Date.now()})}catch(e){console.error("[TypingArea] 表示データ更新エラー:",e),b(t=>({...t,hasError:!0,errorMessage:e.message,lastUpdated:Date.now()}))}},[null==_||null==(o=_.displayInfo)?void 0:o.romaji,null==_||null==(r=_.displayInfo)?void 0:r.typedLength,null==_||null==(i=_.displayInfo)?void 0:i.currentCharIndex,null==_||null==(l=_.displayInfo)?void 0:l.currentInput,null==_||null==(c=_.displayInfo)?void 0:c.currentCharRomaji,null==_||null==(d=_.displayInfo)?void 0:d.expectedNextChar]),!_)return h("typingオブジェクトがありません"),(0,n.jsx)("div",{className:"".concat(ey().typing_area," ").concat(y||""),children:(0,n.jsx)("div",{className:ey().typing_loading,children:"読み込み中..."})});if(!p)return h("問題データがありません"),(0,n.jsx)("div",{className:"".concat(ey().typing_area," ").concat(y||""),children:(0,n.jsx)("div",{className:ey().typing_loading,children:"問題を読み込み中..."})});let S=(null==_?void 0:_.errorAnimation)?ey().typing_area__problem_error:"",v={romaji:x.romaji||"",typedLength:x.typedLength||0,currentCharIndex:x.currentCharIndex||0,expectedNextChar:x.expectedNextChar||"",currentInput:x.currentInput||(null==_||null==(u=_.displayInfo)?void 0:u.currentInput)||"",currentCharRomaji:x.currentCharRomaji||(null==_||null==(m=_.displayInfo)?void 0:m.currentCharRomaji)||""},k=x.hasError||(null==_?void 0:_.errorAnimation);return(0,n.jsxs)("div",{className:"".concat(ey().typing_area," ").concat(y||""),children:[(0,n.jsxs)("div",{className:ey().typing_area__problem,"data-error":k?"true":"false",children:[(0,n.jsx)(ei,{text:(null==p?void 0:p.displayText)||"表示するお題がありません",animate:!1,className:S},"problem-".concat((null==p?void 0:p.displayText)||"default")),(0,n.jsx)(el.A,{romaji:v.romaji,typedLength:v.typedLength,nextChar:v.expectedNextChar||f,isError:k,className:ey().typing_area__romaji,currentInput:v.currentInput,currentCharRomaji:v.currentCharRomaji,inputMode:x.currentInput?"consonant":"normal"}),"      "]}),(0,n.jsx)("div",{className:ey().typing_area__keyboard_container,children:(0,n.jsx)(ep,{nextKey:v.expectedNextChar||f,lastPressedKey:g})})]})};var ex=a(7785),eb=a.n(ex);let ef=e=>{let{solvedCount:t=0,requiredCount:a=5,typingStats:o={},className:r="",scoreInfo:i={}}=e;(0,s.useEffect)(()=>{},[i,!1]);let l=(0,s.useMemo)(()=>({header:{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.3}},combo:{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:300,damping:15}},score:{initial:{x:20,opacity:0},animate:{x:0,opacity:1},transition:{duration:.3,delay:.1}}}),[]),{score:c=0,combo:d=0,maxCombo:u=0,rank:m="F"}=i||{},_=d>=2,p=(0,s.useMemo)(()=>1+Math.min(d/20,.5),[d]),g=(0,s.useMemo)(()=>{switch(m.toUpperCase()){case"SSS":return eb().rank_sss;case"SS":return eb().rank_ss;case"S+":case"S":return eb().rank_s;case"A+":case"A":return eb().rank_a;case"B+":case"B":return eb().rank_b;case"C+":case"C":return eb().rank_c;case"D+":case"D":return eb().rank_d;default:return""}},[m]);return(0,n.jsxs)(k.P.header,{className:"".concat(eb().status_bar," ").concat(r," ").concat(eb().empty_bar),initial:l.header.initial,animate:l.header.animate,transition:l.header.transition,children:[(0,n.jsx)("div",{className:eb().logo_container,children:(0,n.jsx)(k.P.img,{src:(0,Z.aF)("/images/manaby01_.png"),alt:"manaby ロゴ",className:eb().manaby_logo,initial:{opacity:.7},animate:{opacity:1},whileHover:{scale:1.05,y:-1},transition:{type:"spring",stiffness:300,damping:10},title:"manaby - 就労支援"})}),(0,n.jsxs)("div",{className:eb().stats_container,children:[(0,n.jsxs)(k.P.div,{className:eb().score_display,initial:l.score.initial,animate:l.score.animate,transition:l.score.transition,children:[" ",(0,n.jsx)("span",{className:eb().score_label,children:"Score:"}),(0,n.jsx)("span",{className:eb().score_value,children:("number"==typeof c?c:0).toLocaleString()})]}),(0,n.jsxs)(k.P.div,{className:eb().rank_display,initial:{opacity:0},animate:{opacity:1},transition:{duration:.3,delay:.2},children:[(0,n.jsx)("span",{className:eb().rank_label,children:"Rank:"})," ",(0,n.jsx)("span",{className:"".concat(eb().rank_value," ").concat(g),children:m})]})]})," ",_&&(0,n.jsxs)(k.P.div,{className:eb().combo_container,initial:l.combo.initial,animate:{scale:p,opacity:1,y:d>10?[-2,2,-2]:0},transition:{y:{repeat:1/0,duration:.5},scale:{type:"spring",stiffness:300,damping:15}},exit:{scale:.8,opacity:0},children:[(0,n.jsx)("span",{className:eb().combo_value,children:d}),(0,n.jsx)("span",{className:eb().combo_label,children:"COMBO"})]}),(0,n.jsxs)("div",{className:eb().typing_stats,children:[(0,n.jsxs)("div",{className:eb().kpm_display,children:[(0,n.jsx)("span",{className:eb().kpm_label,children:"KPM:"}),(0,n.jsx)("span",{className:eb().kpm_value,children:o.kpm||0})]}),(0,n.jsxs)("div",{className:eb().completion,children:[(0,n.jsx)("span",{children:t}),(0,n.jsx)("span",{children:"/"}),(0,n.jsx)("span",{children:a})]})]})]})};var eS=a(1427);let ev=new Set;function ek(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{difficulty:t=l.ALL,category:a=null,excludeRecent:n=[],useMemory:s=!0}=e;console.log("[ProblemSelector] 問題選択:",{指定された難易度:t,カテゴリ:a||"指定なし",除外数:n.length,難易度設定値チェック:{ALL:l.ALL,EASY:l.EASY,NORMAL:l.NORMAL,HARD:l.HARD,入力値との一致:{ALL:t===l.ALL,EASY:t===l.EASY,NORMAL:t===l.NORMAL,HARD:t===l.HARD}}});let o=[];(t===l.EASY||t===l.ALL)&&(o=o.concat(c),console.log("[ProblemSelector] EASY問題を追加:",c.length)),(t===l.NORMAL||t===l.ALL)&&(o=o.concat(d),console.log("[ProblemSelector] NORMAL問題を追加:",d.length)),(t===l.HARD||t===l.ALL)&&(o=o.concat(u),console.log("[ProblemSelector] HARD問題を追加:",u.length)),console.log("[ProblemSelector] 難易度「".concat(t,"」の選択可能な問題数:"),o.length),a&&"all"!==a&&(o=o.filter(e=>e.category===a));let r=new Set(n);s&&ev.forEach(e=>r.add(e));let i=o.filter(e=>!r.has(e.displayText));if(0===i.length)return console.warn("候補問題がないため、全問題から選択します"),eT(o)||eP();let m=eT(i)||eP();if(s&&m){if(ev.size>=15){let e=Array.from(ev)[0];ev.delete(e)}ev.add(m.displayText)}return m}function eT(e){if(!e||0===e.length)return null;let t=Math.floor(Math.random()*e.length);return e[t]}function eP(){return{displayText:"問題を読み込めません",kanaText:"もんだいをよみこめません",category:i.GENERAL}}var eN=a(9980);let eC=()=>{var e;let{gameState:t}=x(),{goToScreen:a}=e3(),[o,r]=(0,s.useState)({}),[i,l]=(0,s.useState)(""),{typing:c,typingRef:d,performanceMetrics:u,getNextKey:m,gameState:_,scoreInfo:p}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{onDebugInfoUpdate:t=null,onLastPressedKeyChange:a=null,goToScreen:n}=e||{},o=(0,s.useCallback)(function(e){for(var t=arguments.length,a=Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n]},[!1]),{gameState:r}=x(),[i,l]=(0,s.useState)({score:0,combo:0,maxCombo:0,rank:"F"}),[c,d]=(0,s.useState)(null);(0,s.useRef)({solvedCount:0,requiredProblemCount:0,lastUpdated:Date.now()});let u=(0,s.useRef)({lastKeyPressTime:0,inputLatency:0,frameDrops:0,totalKeyPresses:0}),m=(0,s.useRef)(null);(0,s.useRef)(!1);let{setGameState:_}=x(),p=(0,s.useCallback)(e=>{var t,a,s,o,i,l,u,m,p,g,h,x,f,S,v,k,T,P,N,C,E,M;let j=r.solvedCount+1;if(j>=r.requiredProblemCount){let e=Date.now(),c=r.startTime||(null==(s=y.typingStats)||null==(a=s.statsRef)||null==(t=a.current)?void 0:t.startTime)||e,d=e-c,v=0,k=[...r.problemKPMs||[],(null==y||null==(i=y.typingStats)||null==(o=i.displayStats)?void 0:o.kpm)||0].filter(e=>e>0);v=k&&k.length>0?k.reduce((e,t)=>e+t,0)/k.length:Math.floor(((null==y||null==(S=y.typingStats)||null==(f=S.statsRef)||null==(x=f.current)?void 0:x.correctKeyCount)||0)/(d/6e4));let T=(null==y||null==(m=y.typingStats)||null==(u=m.statsRef)||null==(l=u.current)?void 0:l.correctKeyCount)||0,P=(null==y||null==(h=y.typingStats)||null==(g=h.statsRef)||null==(p=g.current)?void 0:p.mistakeCount)||0,N=(r.totalCorrectKeys||0)+T,C=(r.totalMissKeys||0)+P,E=N+C,M=E>0?Math.round(N/E*100):100;_(t=>({...t,solvedCount:j,isGameClear:!0,problemKPMs:k,startTime:c,endTime:e,totalCorrectKeys:N,totalMissKeys:C,stats:{kpm:Math.round(10*v)/10,correctCount:N,missCount:C,accuracy:M,rank:eN.A.getRank(v)||"F",problemKPMs:k,elapsedTimeMs:d,totalTime:d/1e3,solvedProblems:j}})),window.lastResultTransition=Date.now(),setTimeout(()=>{n(b.RESULT,{playSound:!0,soundType:"result",gameState:{}})},300)}else{let e=(null==y||null==(k=y.typingStats)||null==(v=k.displayStats)?void 0:v.kpm)||0,t=(null==y||null==(N=y.typingStats)||null==(P=N.statsRef)||null==(T=P.current)?void 0:T.correctKeyCount)||0,a=(null==y||null==(M=y.typingStats)||null==(E=M.statsRef)||null==(C=E.current)?void 0:C.mistakeCount)||0,n=[...r.problemKPMs||[],e].filter(e=>e>0);_(e=>({...e,solvedCount:j,problemKPMs:n,totalCorrectKeys:(e.totalCorrectKeys||0)+t,totalMissKeys:(e.totalMissKeys||0)+a})),queueMicrotask(()=>{try{let e=ek({difficulty:r.difficulty,category:r.category,excludeRecent:[null==c?void 0:c.displayText]});d(e),(null==y?void 0:y.setProblem)&&y.setProblem(e)}catch(e){console.error("[GameController] 問題設定エラー:",e)}})}},[r,c,_,n]),y=(0,eS.z)({initialProblem:c,playSound:!0,soundSystem:g.A,onProblemComplete:p,onDebugInfoUpdate:t});m.current=y,(0,s.useEffect)(()=>{if(!y||!y.typingSession)return;let e=setInterval(()=>{try{var e,t,a,n,s;let o=null==y?void 0:y.typingSession,r=(null==o||null==(e=o.getCombo)?void 0:e.call(o))||0,i=(null==o||null==(t=o.getMaxCombo)?void 0:t.call(o))||0,c=(null==y?void 0:y.scoreData)||{},d=(null==c?void 0:c.score)||0,u=(null==y||null==(a=y.displayStats)?void 0:a.rank)||(null==y||null==(s=y.typingStats)||null==(n=s.displayStats)?void 0:n.rank)||"F";l({score:d,combo:r,maxCombo:i,rank:u})}catch(e){console.error("[GameController] スコア情報更新エラー:",e)}},50);return()=>{clearInterval(e)}},[y,!1,o]);let h=(0,s.useCallback)(e=>{if(null==e?void 0:e.key){if("Escape"===e.key)return void n(b.MAIN_MENU,{playSound:!0,soundType:"button"});if(a&&queueMicrotask(()=>{a(e.key)}),!y||!y.typingSession)return void o("タイピングセッションがありません - 入力を無視します");try{let t=y.handleInput(e.key);queueMicrotask(()=>{u.current.totalKeyPresses++,u.current.lastKeyPressTime=Date.now()}),(null==t?void 0:t.success)&&e.preventDefault()}catch(e){}}},[y,n,a]),f=(0,s.useCallback)(()=>{var e;return(null==y||null==(e=y.typingSession)?void 0:e.getCurrentExpectedKey())||""},[y]);return(0,s.useEffect)(()=>(window.addEventListener("keydown",h),()=>{window.removeEventListener("keydown",h),W.A&&"function"==typeof W.A.reset&&(console.log("[GameController] コンポーネントのアンマウント時にWorkerをリセットします"),W.A.reset().catch(e=>{console.warn("[GameController] Worker終了中にエラーが発生しました:",e)}))}),[h]),(0,s.useEffect)(()=>{if(!c){let e=ek({difficulty:r.difficulty,category:r.category});d(e),e&&(null==y?void 0:y.setProblem)&&setTimeout(()=>{y.setProblem(e)},20)}},[r.difficulty,r.category,c,y]),{typing:y,typingRef:m,currentProblem:c,gameState:r,gameState:{currentProblem:c},scoreInfo:i,getNextKey:f,performanceMetrics:{get inputLatency(){return u.current.inputLatency},get lastKeyPressTime(){return u.current.lastKeyPressTime}}}}({onDebugInfoUpdate:null,onLastPressedKeyChange:l,goToScreen:a});!function(e,t,a){(0,s.useEffect)(()=>{if(!0===e.isGameClear){let e=window.lastResultTransition||0,a=Date.now();a-e>500&&(window.lastResultTransition=a,setTimeout(()=>{t(b.RESULT,{playSound:!0,gameState:{}})},250))}},[e,t,a])}(t,a,d);let y=(0,s.useCallback)(()=>{a(b.MAIN_MENU,{playSound:!0,soundType:"button"})},[a]);return((0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&y()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[y]),!0===t.isGameClear)?null:(0,n.jsx)(es,{children:(0,n.jsx)("div",{className:ee().typing_game__wrapper,children:(0,n.jsxs)("div",{className:ee().typing_game,children:[" ",(0,n.jsx)(ef,{solvedCount:t.solvedCount,requiredCount:t.requiredProblemCount||5,typingStats:(null==c?void 0:c.stats)||{},scoreInfo:p})," ",(0,n.jsxs)("main",{className:ee().typing_game__main,children:[" "," ",(0,n.jsx)(eh,{typing:c,currentProblem:(null==c||null==(e=c.typingSession)?void 0:e.problem)||(null==_?void 0:_.currentProblem)||t.currentProblem,lastPressedKey:i,className:ee().typing_game__typing_area}),!1," "]}),(0,n.jsxs)("button",{onClick:y,className:ee().typing_game__menu_button,children:[(0,n.jsx)("span",{children:"Esc:"})," メニュー"]})]})})})};var eE=a(2937),eM=a.n(eE);let ej=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=eI(),a=e.kpm||0,n=eN.A.getRank?eN.A.getRank(a):"F",s={username:e.username||"Anonymous",kpm:parseFloat(a)||0,rank:n,accuracy:parseFloat(e.accuracy)||0,correctCount:e.correctCount||0,missCount:e.missCount||0,difficulty:e.difficulty||"normal",date:e.timestamp?new Date(e.timestamp).toISOString():new Date().toISOString()};t.unshift(s);let o=t.slice(0,10);return localStorage.setItem("typingGameRecords",JSON.stringify(o)),console.log("ゲーム記録を保存しました。残り記録数: ".concat(o.length,"/10")),ew(s),!0}catch(e){return console.error("記録の保存中にエラーが発生しました:",e),!1}},eI=()=>{try{let e=localStorage.getItem("typingGameRecords");return e?JSON.parse(e):[]}catch(e){return console.error("記録の取得中にエラーが発生しました:",e),[]}},ew=e=>{try{var t,a;let n=eA(),s=e.difficulty,o=!1;e.kpm>((null==(t=n[s])?void 0:t.kpm)||0)&&(n[s]={...n[s],kpm:e.kpm,date:e.date},o=!0),e.accuracy>((null==(a=n[s])?void 0:a.accuracy)||0)&&(n[s]={...n[s],accuracy:e.accuracy,date:e.date},o=!0),o&&localStorage.setItem("typingGameHighScores",JSON.stringify(n))}catch(e){console.error("ハイスコア更新中にエラーが発生しました:",e)}},eA=()=>{try{let e=localStorage.getItem("typingGameHighScores");return e?JSON.parse(e):{}}catch(e){return console.error("ハイスコアの取得中にエラーが発生しました:",e),{}}},eR=e=>{var t;let{stats:a,onClickRetry:o,onClickMenu:r,onClickRanking:i,playSound:l=!0}=e,{goToScreen:c}=e3(),{gameState:d}=x();(0,s.useEffect)(()=>{console.log("ResultScreen: 受け取ったstats",a),console.log("ResultScreen: gameStateからのstats",null==d?void 0:d.stats);let e=a||(null==d?void 0:d.stats);if(console.log("ResultScreen: 使用する統計情報",e),e&&void 0!==e.kpm&&0!==e.kpm||console.warn("ResultScreen: statsデータが不足しているか、KPMが0です",e),e&&e.kpm>0)try{ej({username:"Player",kpm:e.kpm,correctCount:e.correctCount||0,missCount:e.missCount||0,accuracy:e.accuracy||0,timestamp:Date.now()}),console.log("ResultScreen: ローカルランキングにスコアを保存しました")}catch(e){console.error("ResultScreen: ランキング保存でエラーが発生しました:",e)}else console.log("ResultScreen: スコアデータが無いためランキング保存をスキップします")},[a,d]);let u=(0,s.useCallback)(()=>{console.log("メニューに戻ります"),"function"==typeof r?r():c(b.MAIN_MENU,{playSound:!0})},[r,c]);(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&(console.log("ResultScreen: Escキーが押されました: メニューに戻ります"),e.preventDefault(),e.stopPropagation(),u())};return window.addEventListener("keydown",e,{capture:!0}),()=>{window.removeEventListener("keydown",e,{capture:!0})}},[u]),(0,s.useEffect)(()=>{if(l)try{console.log("ResultScreen: 結果画面の効果音を再生します"),g.A.sfxBuffers.complete?g.A.play("complete"):g.A.loadSound("complete",(0,Z.aF)("/sounds/resultsound.mp3")).then(()=>g.A.play("complete")).catch(e=>console.error("効果音のロードに失敗しました:",e))}catch(e){console.error("効果音の再生に失敗しました:",e)}else console.log("ResultScreen: playSoundがfalseのため効果音をスキップします")},[l]);let m=e=>null==e?(console.warn("formatDecimal: 値が未定義です"),"0.0"):Number(e).toFixed(1),_={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}},p=(0,s.useMemo)(()=>{let e=a||(null==d?void 0:d.stats);return(console.log("ResultScreen: 統計データ処理:",e),e&&"object"==typeof e)?(console.log("ResultScreen: 詳細なステータスデータ",{入力されたcorrectCount:e.correctCount,入力されたmissCount:e.missCount,入力されたaccuracy:e.accuracy,解答した問題数:e.solvedProblems,残りのデータ:e}),{kpm:e.kpm||0,correctCount:"number"==typeof e.correctCount?e.correctCount:0,missCount:"number"==typeof e.missCount?e.missCount:0,accuracy:e.accuracy||0,totalTime:e.totalTime||0,elapsedTimeMs:e.elapsedTimeMs||0,rank:e.rank||"F",problemKPMs:e.problemKPMs||[],solvedProblems:e.solvedProblems}):{kpm:0,correctCount:0,missCount:0,accuracy:0,totalTime:0,elapsedTimeMs:0,rank:"F",problemKPMs:[]}},[a,null==d?void 0:d.stats]);console.log("ResultScreen: 詳細なKPM分析",{safeStatsのKPM値:p.kpm,元のstatsのKPM値:null==a?void 0:a.kpm,gameStateのKPM値:null==d||null==(t=d.stats)?void 0:t.kpm,safeStats全体:p}),p.kpm>500&&(console.warn("ResultScreen: KPM値が異常に高い値です:",p.kpm),console.warn("元の計算データ:",{correctCount:p.correctCount,elapsedTimeMs:p.elapsedTimeMs,elapsedMinutes:p.elapsedTimeMs/6e4}));let y=(0,s.useMemo)(()=>{console.log("ResultScreen: 統計情報を表示用に整形"),p.kpm>500&&console.warn("ResultScreen: KPM値が異常に高い値です:",p.kpm);let e=eN.A.getRankColor(p.rank||"F"),t=p.kpm?m(p.kpm):"0.0",a=p.accuracy?m(p.accuracy):"0.0";return{totalTime:p.totalTime?m(p.totalTime):"0.0",accuracy:a,kpm:t,correctCount:p.correctCount||0,missCount:p.missCount||0,rank:p.rank||"-",rankColor:e,problemKPMs:p.problemKPMs||[]}},[p]);return(0,n.jsxs)(k.P.div,{className:eM().resultContainer,initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{delayChildren:.3,staggerChildren:.2}}},children:[(0,n.jsx)(k.P.div,{className:eM().resultHeader,variants:_,children:(0,n.jsx)("h1",{className:"screen-title ".concat(eM().resultTitle),children:"RESULT"})}),(0,n.jsxs)(k.P.div,{className:eM().resultContent,variants:_,children:[(0,n.jsxs)(k.P.div,{className:eM().rankDisplay,variants:{hidden:{scale:0,opacity:0},visible:{scale:1,opacity:1,transition:{type:"spring",stiffness:300,damping:10,delay:.5}}},children:[(0,n.jsx)("h2",{className:eM().rankValue,style:{color:y.rankColor},children:y.rank}),(0,n.jsx)("p",{className:eM().rankLabel,children:"YOUR RANK"}),(0,n.jsx)("div",{className:eM().rankBackdrop})]}),(0,n.jsxs)(k.P.div,{className:eM().statsContainer,variants:_,children:[(0,n.jsxs)(k.P.div,{className:"".concat(eM().statCard," ").concat(eM().keyStatCard),whileHover:{scale:1.05},transition:{type:"spring",stiffness:300,damping:15},children:[(0,n.jsx)("div",{className:eM().statLabel,children:"KPM"}),(0,n.jsx)("div",{className:eM().statValue,children:y.kpm})]}),(0,n.jsxs)(k.P.div,{className:"".concat(eM().statCard," ").concat(eM().keyStatCard),whileHover:{scale:1.05},transition:{type:"spring",stiffness:300,damping:15},children:[(0,n.jsx)("div",{className:eM().statLabel,children:"Accuracy"}),(0,n.jsxs)("div",{className:eM().statValue,children:[y.accuracy,"%"]})]}),"          ",(0,n.jsxs)(k.P.div,{className:eM().statCard,whileHover:{scale:1.03},children:[(0,n.jsx)("div",{className:eM().statLabel,children:"Correct"}),(0,n.jsx)("div",{className:eM().statValue,children:y.correctCount})]}),(0,n.jsxs)(k.P.div,{className:eM().statCard,whileHover:{scale:1.03},children:[(0,n.jsx)("div",{className:eM().statLabel,children:"Miss"}),(0,n.jsx)("div",{className:eM().statValue,children:y.missCount})]}),void 0!==y.solvedProblems&&(0,n.jsxs)(k.P.div,{className:eM().statCard,whileHover:{scale:1.03},children:[(0,n.jsx)("div",{className:eM().statLabel,children:"Problems"}),(0,n.jsx)("div",{className:eM().statValue,children:y.solvedProblems})]})]})]}),(0,n.jsxs)(k.P.div,{className:eM().buttonContainer,variants:_,children:[(0,n.jsx)(k.P.button,{className:eM().resultButton,onClick:e=>{e.preventDefault(),console.log("ランキングボタンがクリックされました"),"function"==typeof i?i():c(b.RANKING,{playSound:!0,gameState:a})},whileHover:{scale:1.05},whileTap:{scale:.95},children:"ランキング"}),(0,n.jsx)(k.P.button,{className:eM().resultButton,onClick:e=>{e.preventDefault(),console.log("リトライボタンがクリックされました"),"function"==typeof o?o():console.error("onClickRetry関数が提供されていません")},whileHover:{scale:1.05},whileTap:{scale:.95},children:"リトライ"}),(0,n.jsx)(k.P.button,{className:eM().resultButton,onClick:e=>{e.preventDefault(),console.log("メニューボタンがクリックされました"),u()},whileHover:{scale:1.05},whileTap:{scale:.95},children:"メニューへ"})]})]})};var eB=a(8618),eG=a.n(eB),eO=a(3915),eL=a(1115),eD=a(6864);let eV={apiKey:"AIzaSyBB6UAYtMbTbf2pMlIAmz79MXPzLYx6ohg",authDomain:"manaby-typing.firebaseapp.com",databaseURL:"https://manaby-typing-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"manaby-typing",storageBucket:"manaby-typing.firebasestorage.app",messagingSenderId:"58110409261",appId:"1:58110409261:web:1f23739378545fab9196a4",measurementId:"G-FSD7ECC1B0"},eF=null,eK=null,eU=()=>{if(!eF)try{return eF=(0,eO.Wp)(eV),eK=(0,eL.C3)(eF),(0,eD.P5)(eF),console.log("Firebase initialized successfully"),!0}catch(e){return console.error("Firebase initialization failed:",e),!1}return!!eF},ez=async(e,t,a,n,s,o,r)=>{if(!eU()||!eK)return console.error("Firebase not initialized"),null;try{let i,l=Math.floor(t),c=parseFloat(a.toFixed(1)),d=new Date().toISOString(),u=r||(void 0!==eN.A?eN.A.getKPMRank(l):""),m=(0,eL.KR)(eK,"scores"),_=await (0,eL.Jt)(m),p=null,g=null;if(_.exists()&&_.forEach(t=>{let a=t.val();a.playerName===e&&a.difficulty===o&&(p=t.key,g=a)}),p&&l>0){if(i=(0,eL.jf)(m,p),!g||!(l>g.kpm)&&(l!==g.kpm||!(c>g.accuracy)))return console.log("既存のエントリーの方が良いスコアなので更新しません"),p;console.log("既存のエントリーを更新します:",p)}else i=(0,eL.VC)(m);let y={score:l,stats:{kpm:l,accuracy:c,mistakes:s||0},timestamp:d,username:e||"Anonymous",playerName:e||"Anonymous",kpm:l,accuracy:c,time:n||0,mistakes:s||0,difficulty:o||"normal",date:d,timestamp_num:Date.now(),rank:u};return await (0,eL.hZ)(i,y),console.log("オンラインランキングを保存しました - KPM: ".concat(l,", ランク: ").concat(u,", 正解率: ").concat(c,"%")),i.key}catch(e){return console.error("Error saving online ranking:",e),null}},eH=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!eU()||!eK)return console.error("Firebase not initialized"),[];try{let a=(0,eL.KR)(eK,"scores"),n=await (0,eL.Jt)(a);if(console.log("Firebase data retrieved for difficulty ".concat(e,":"),n.exists()),!n.exists())return console.log("No data available in Firebase"),[];let s=[];n.forEach(e=>{let t=e.val();s.push({id:e.key,...t})});let o=s.filter(t=>t.difficulty&&t.difficulty===e||t.gameMode===e||!t.difficulty&&!t.gameMode&&"normal"===e);console.log("Retrieved ".concat(s.length," total records, filtered to ").concat(o.length," records for difficulty: ").concat(e));let r={};return o.forEach(e=>{var t;let a=e.playerName||e.username||"Anonymous",n=void 0!==e.kpm?e.kpm:e.score||0,s=void 0!==e.accuracy?e.accuracy:(null==(t=e.stats)?void 0:t.accuracy)!==void 0?e.stats.accuracy:0;(!r[a]||n>r[a].kpm||n===r[a].kpm&&s>r[a].accuracy)&&(r[a]=e)}),Object.values(r).sort((e,t)=>{let a=void 0!==e.kpm?e.kpm:e.score||0,n=void 0!==t.kpm?t.kpm:t.score||0;if(n!==a)return n-a;{var s,o;let a=void 0!==e.accuracy?e.accuracy:(null==(s=e.stats)?void 0:s.accuracy)!==void 0?e.stats.accuracy:0;return(void 0!==t.accuracy?t.accuracy:(null==(o=t.stats)?void 0:o.accuracy)!==void 0?t.stats.accuracy:0)-a}}).slice(0,t)}catch(e){return console.error("Error fetching rankings:",e),[]}},eq=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!eU()||!eK)return console.error("Firebase not initialized"),[];try{let a=(0,eL.KR)(eK,"scores"),n=await (0,eL.Jt)(a);if(console.log("Recent Firebase data retrieved:",n.exists()),!n.exists())return console.log("No recent data available in Firebase"),[];let s=[];n.forEach(e=>{s.push({id:e.key,...e.val()})}),console.log("Retrieved ".concat(s.length," recent records"));let o=t?s.filter(e=>e.difficulty&&e.difficulty===t||e.gameMode===t||!e.difficulty&&!e.gameMode&&"normal"===t):s;console.log("Filtered to ".concat(o.length," records for difficulty: ").concat(t||"all"));let r={};return o.forEach(e=>{let t=e.playerName||e.username||"Anonymous",a=e.timestamp_num||(e.timestamp?new Date(e.timestamp).getTime():e.date?new Date(e.date).getTime():0);(!r[t]||a>r[t].timestamp)&&(r[t]={...e,timestamp:a})}),Object.values(r).sort((e,t)=>t.timestamp-e.timestamp).slice(0,e)}catch(e){return console.error("Error fetching recent rankings:",e),[]}},eY=async()=>{if(!eU()||!eK)return console.error("Firebase not initialized"),[];try{let e=(0,eL.KR)(eK,"scores"),t=await (0,eL.Jt)(e);if(console.log("DEBUG: Firebase connection test result:",t.exists()),!t.exists())return console.log("DEBUG: No data available in scores node"),[];let a=[];return t.forEach(e=>{a.push({id:e.key,...e.val()})}),console.log("DEBUG: Found ".concat(a.length," total records in database")),console.log("DEBUG: Sample record:",a.length>0?a[0]:"No records"),a}catch(e){return console.error("DEBUG: Error checking database:",e),[]}},eJ=e=>({MAIN_MENU:"メインメニュー",GAME:"ゲーム画面",RESULT:"リザルト画面",RANKING:"ランキング画面",SETTINGS:"設定画面",CREDITS:"クレジット画面",ALL:"全画面"})[e]||e,eW={saveBackgroundToFirebase:async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(!eU()||!eK)return console.error("Firebase not initialized"),null;try{let o=(0,eL.KR)(eK,"backgrounds"),r=(0,eL.VC)(o),i=new Date().toISOString(),l=Date.now(),c=s;if(!c)try{let e=document.querySelector("#__next > div");if(e){let t=window.getComputedStyle(e);c={backgroundColor:t.backgroundColor,borderColor:t.borderColor,borderWidth:t.borderWidth,borderStyle:t.borderStyle,boxShadow:t.boxShadow,backgroundImage:""}}}catch(e){console.error("背景スタイル情報の取得に失敗しました:",e)}let d={playerName:e||"Anonymous",title:a||"".concat(e||"Anonymous","が保存した背景"),imageData:t,cssStyleInfo:c,metadata:{...n,createdAt:i},timestamp:i,timestamp_num:l};return await (0,eL.hZ)(r,d),console.log("背景画像とスタイル情報を保存しました - 保存者: ".concat(e,", タイトル: ").concat(a)),r.key}catch(e){return console.error("Error saving background to Firebase:",e),null}},getBackgroundsFromFirebase:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;if(!eU()||!eK)return console.error("Firebase not initialized"),[];try{let t=(0,eL.KR)(eK,"backgrounds"),a=await (0,eL.Jt)(t);if(!a.exists())return console.log("保存された背景画像データがありません"),[];let n=[];return a.forEach(e=>{n.push({id:e.key,...e.val()})}),n.sort((e,t)=>t.timestamp_num-e.timestamp_num).slice(0,e)}catch(e){return console.error("Error fetching backgrounds from Firebase:",e),[]}},deleteBackgroundFromFirebase:async e=>{if(!eU()||!eK)return console.error("Firebase not initialized"),!1;try{let t=(0,eL.KR)(eK,"backgrounds/".concat(e));return await (0,eL.hZ)(t,null),console.log("背景画像を削除しました - ID: ".concat(e)),!0}catch(e){return console.error("Error deleting background from Firebase:",e),!1}},saveScreenBackgroundToFirebase:async function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(!eU()||!eK)return console.error("Firebase not initialized"),null;try{let o=(0,eL.KR)(eK,"backgrounds"),r=(0,eL.VC)(o),i=new Date().toISOString(),l=Date.now(),c=e||"ALL",d=s;if(!d)try{let e=document.querySelector("#__next > div");if(e){let t=window.getComputedStyle(e);d={backgroundColor:t.backgroundColor,borderColor:t.borderColor,borderWidth:t.borderWidth,borderStyle:t.borderStyle,boxShadow:t.boxShadow,backgroundImage:""}}}catch(e){console.error("背景スタイル情報の取得に失敗しました:",e)}let u=n||"".concat(t||"Anonymous","の").concat(eJ(c),"用背景"),m={playerName:t||"Anonymous",title:u,imageData:a,cssStyleInfo:d,screenId:c,metadata:{createdAt:i,type:"screen-specific-background",targetScreen:c},timestamp:i,timestamp_num:l};return await (0,eL.hZ)(r,m),console.log("画面「".concat(eJ(c),"」用の背景を保存しました - 保存者: ").concat(t,", タイトル: ").concat(u)),r.key}catch(e){return console.error("Error saving screen background to Firebase:",e),null}},getScreenBackgroundsFromFirebase:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;if(!eU()||!eK)return console.error("Firebase not initialized"),[];try{let a=(0,eL.KR)(eK,"backgrounds"),n=await (0,eL.Jt)(a);if(!n.exists())return console.log("保存された背景画像データがありません"),[];let s=[];return n.forEach(t=>{var a;let n=t.val();e&&n.screenId!==e&&"ALL"!==n.screenId&&(null==(a=n.metadata)?void 0:a.targetScreen)!==e&&n.screenId||s.push({id:t.key,...n})}),s.sort((e,t)=>t.timestamp_num-e.timestamp_num).slice(0,t)}catch(e){return console.error("Error fetching screen backgrounds from Firebase:",e),[]}},deleteRankingsByDifficulty:async e=>{if(!eU()||!eK)return console.error("Firebase not initialized"),!1;try{let t=(0,eL.KR)(eK,"scores"),a=await (0,eL.Jt)(t);if(!a.exists())return console.log("削除対象のランキングデータがありません"),!0;let n=[];return a.forEach(t=>{let a=t.val();if((a.difficulty||a.gameMode||"normal")===e){let e=(0,eL.KR)(eK,"scores/".concat(t.key));n.push((0,eL.hZ)(e,null))}}),n.length>0&&await Promise.all(n),console.log("難易度「".concat(e,"」のランキングデータを").concat(n.length,"件削除しました")),!0}catch(t){return console.error("難易度「".concat(e,"」のランキング削除中にエラーが発生しました:"),t),!1}},deleteAllRankings:async()=>{if(!eU()||!eK)return console.error("Firebase not initialized"),!1;try{let e=(0,eL.KR)(eK,"scores");return await (0,eL.hZ)(e,null),console.log("すべてのランキングデータを削除しました"),!0}catch(e){return console.error("ランキングデータの削除中にエラーが発生しました:",e),!1}}};var eZ=a(5695);let eX={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}},exit:{opacity:0,transition:{duration:.3}}},eQ={hidden:{y:20,opacity:0},show:{y:0,opacity:1,transition:{type:"spring",stiffness:300,damping:20}},exit:{opacity:0,y:20,transition:{duration:.2}}},e$=()=>{(0,eZ.useRouter)();let{goToScreen:e}=e3(),{gameState:t}=x(),[a,o]=(0,s.useState)(!1),[r,i]=(0,s.useState)(!1),[l,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)({difficulty:"normal"}),[m,_]=(0,s.useState)("normal");(0,s.useEffect)(()=>{console.log("RankingScreen: 受け取ったゲーム状態データ:",t)},[t]);let[p,y]=(0,s.useState)([]),[h,f]=(0,s.useState)({}),[S,v]=(0,s.useState)([]),[T,P]=(0,s.useState)(!0),[N,C]=(0,s.useState)(!1),[E,M]=(0,s.useState)(!1),[j,I]=(0,s.useState)(""),[w,A]=(0,s.useState)({success:!1,message:""}),[R,B]=(0,s.useState)([]),[G,O]=(0,s.useState)(!1),[L,D]=(0,s.useState)(b.MAIN_MENU);(0,s.useEffect)(()=>{window.history.state&&window.history.state.options&&window.history.state.options.from?D(window.history.state.options.from):D(b.MAIN_MENU),g.A.resume(),eU(),K(),_(d.difficulty);let e=localStorage.getItem("playerName");e&&I(e),F()},[]);let F=()=>{if(t)try{var e,a,n;let s=JSON.parse(sessionStorage.getItem("registeredGames")||"[]"),o=0;if(t.stats&&void 0!==t.stats.kpm)o=Math.floor(t.stats.kpm);else if(t.stats&&t.stats.problemStats&&t.stats.problemStats.length>0)o=Math.floor(eN.A.calculateAverageKPM(t.stats.problemStats));else if(t.problemKPMs&&t.problemKPMs.length>0){let e=t.problemKPMs.filter(e=>e>0);e.length>0&&(o=Math.floor(e.reduce((e,t)=>e+t,0)/e.length))}let r=(null==(e=t.stats)?void 0:e.accuracy)||t.accuracy||(t.correctKeyCount&&(t.mistakes||0===t.mistakes)?t.correctKeyCount/(t.correctKeyCount+t.mistakes)*100:0),i=(null==(a=t.stats)?void 0:a.missCount)||t.mistakes||0,l=(null==(n=t.stats)?void 0:n.elapsedTimeMs)||t.playTime||0,d="".concat(o,"-").concat(r.toFixed(1),"-").concat(i,"-").concat(l);s.includes(d)&&(c(!0),console.log("このスコアは既に登録済みです"))}catch(e){console.error("登録済みゲーム確認エラー:",e)}};(0,s.useEffect)(()=>{T?U():K()},[T,m]);let K=()=>{y([...eI()].sort((e,t)=>t.kpm!==e.kpm?t.kpm-e.kpm:t.accuracy!==e.accuracy?t.accuracy-e.accuracy:e.mistakes-t.mistakes)),f(eA())},U=async()=>{C(!0);try{let e=await eH(m,20);console.log("Loaded ".concat(e.length," online rankings for difficulty: ").concat(m)),v(e)}catch(e){console.error("オンラインランキングの取得に失敗しました:",e)}finally{C(!1)}},z=()=>{g.A.playSound("Button");let e=!T;P(e),e?console.log("オンラインモードに切り替えました"):console.log("ローカルモードに切り替えました")},H=e=>{g.A.playSound("Button"),_(e)},q=()=>[...p].filter(e=>e.difficulty===m).sort((e,t)=>t.kpm-e.kpm).slice(0,20),Y=e=>{let t=new Date(e);return"".concat(t.getMonth()+1,"/").concat(t.getDate()," ").concat(String(t.getHours()).padStart(2,"0"),":").concat(String(t.getMinutes()).padStart(2,"0"))},J=()=>{g.A.playSound("Button"),M(!1)},W=async()=>{if(!l&&!N){if(!t)return void A({success:!1,message:"登録するスコアがありません。プレイ後に再度お試しください。"});if(!j.trim())return void A({success:!1,message:"名前を入力してください。"});C(!0);try{localStorage.setItem("playerName",j);let e=0;if(t.stats&&void 0!==t.stats.kpm)e=Math.floor(t.stats.kpm);else if(t.stats&&t.stats.problemStats&&t.stats.problemStats.length>0)e=Math.floor(eN.A.calculateAverageKPM(t.stats.problemStats));else if(t.problemKPMs&&t.problemKPMs.length>0){let a=t.problemKPMs.filter(e=>e>0);a.length>0&&(e=Math.floor(a.reduce((e,t)=>e+t,0)/a.length))}else if(t.startTime&&t.endTime&&t.correctKeyCount){let a=t.endTime-t.startTime;e=Math.floor(t.correctKeyCount/(a/6e4))}let a=t.correctKeyCount||t.stats&&t.stats.correctCount||0;e<=0&&a>0&&(e=1);let n=eN.A.getRank(e),s=0;if(t.stats&&"number"==typeof t.stats.accuracy)s=t.stats.accuracy;else if("number"!=typeof t.accuracy||isNaN(t.accuracy)){if((t.correctKeyCount>=0||t.stats&&t.stats.correctCount>=0)&&(t.mistakes>=0||0===t.mistakes||t.stats&&(t.stats.missCount>=0||0===t.stats.missCount))){let e=t.correctKeyCount||t.stats&&t.stats.correctCount||0,a=t.mistakes||t.stats&&t.stats.missCount||0,n=e+a;n>0&&(s=e/n*100)}}else s=t.accuracy;console.log("送信する統計データ:",{kpm:e,accuracy:s,rank:n}),t.correctKeyCount||t.stats&&t.stats.correctCount;let o=t.mistakes||t.stats&&t.stats.missCount||0,r=t.playTime||t.stats&&t.stats.elapsedTimeMs||0;if(await ez(j,e,s,r,o,d.difficulty||"normal",n)){c(!0),A({success:!0,message:"ランキングに登録しました！"});try{let t="".concat(e,"-").concat(s.toFixed(1),"-").concat(o,"-").concat(r),a=JSON.parse(sessionStorage.getItem("registeredGames")||"[]");a.push(t),sessionStorage.setItem("registeredGames",JSON.stringify(a))}catch(e){console.error("登録済みゲームの保存に失敗:",e)}P(!0),await U()}else throw Error("登録に失敗しました")}catch(e){console.error("スコア登録エラー:",e),A({success:!1,message:"ランキング登録中にエラーが発生しました。ネットワーク接続を確認してください。"})}finally{C(!1)}}},Z=async()=>{console.log("Testing Firebase connection..."),C(!0);try{let e=await eY();B(e),O(!0),console.log("Debug data loaded:",e)}catch(e){console.error("Debug error:",e)}finally{C(!1)}},X=()=>{O(!1)};return(0,s.useEffect)(()=>{let t=t=>{"Escape"===t.key&&(t.preventDefault(),G?(g.A.playSound("Button"),X()):E?(g.A.playSound("Button"),J()):r||a||(g.A.playSound("Button"),o(!0),setTimeout(()=>{e(L,{playSound:!1})},300)))};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[E,G,r,a]),(0,s.useEffect)(()=>(o(!1),i(!1),()=>{o(!1),i(!1)}),[]),(0,n.jsxs)("div",{className:eG().rankingContainer,children:[(0,n.jsx)("div",{className:eG().cornerDecoration,style:{top:10,left:10},children:(0,n.jsx)("div",{className:eG().cornerTech})}),(0,n.jsx)("div",{className:eG().cornerDecoration,style:{top:10,right:10,transform:"scaleX(-1)"},children:(0,n.jsx)("div",{className:eG().cornerTech})}),(0,n.jsx)("div",{className:eG().cornerDecoration,style:{bottom:10,left:10,transform:"scaleY(-1)"},children:(0,n.jsx)("div",{className:eG().cornerTech})}),(0,n.jsx)("div",{className:eG().cornerDecoration,style:{bottom:10,right:10,transform:"scale(-1)"},children:(0,n.jsx)("div",{className:eG().cornerTech})}),(0,n.jsx)("div",{className:eG().scanlines}),(0,n.jsx)("div",{className:eG().dotPattern}),(0,n.jsx)(k.P.div,{className:eG().rankingHeader,initial:{y:-50,opacity:0},animate:{y:0,opacity:1},exit:{y:-50,opacity:0},transition:{type:"spring",damping:20,duration:.8},children:(0,n.jsx)("h1",{className:"screen-title ".concat(eG().rankingTitle),children:"RANKING"})}),(0,n.jsxs)("div",{className:eG().onlineModeToggle,style:{display:"flex",justifyContent:"center",gap:"10px",marginBottom:"15px",zIndex:10,position:"relative"},children:[(0,n.jsx)(V,{variant:T?"default":"primary",active:!T,onClick:()=>{T&&z()},size:"small",children:"ローカル"}),(0,n.jsx)(V,{variant:T?"primary":"default",active:T,onClick:()=>{T||z()},size:"small",children:"オンライン"})]}),(0,n.jsxs)("div",{className:eG().difficultyNav,children:[(0,n.jsx)(V,{className:"button--difficulty",active:"easy"===m,variant:"easy"===m?"primary":"default",onClick:()=>H("easy"),children:"やさしい"}),(0,n.jsx)(V,{className:"button--difficulty",active:"normal"===m,variant:"normal"===m?"primary":"default",onClick:()=>H("normal"),children:"普通"}),(0,n.jsx)(V,{className:"button--difficulty",active:"hard"===m,variant:"hard"===m?"primary":"default",onClick:()=>H("hard"),children:"むずかしい"})]}),(0,n.jsx)("div",{className:eG().rankingContent,children:N?(0,n.jsx)("div",{className:eG().loadingSpinner,children:"読み込み中..."}):T?(0,n.jsxs)(k.P.div,{className:eG().tableContainer,variants:eX,initial:"hidden",animate:a?"exit":"show",exit:"exit",children:[(0,n.jsxs)("table",{className:eG().rankingTable,children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"順位"}),(0,n.jsx)("th",{children:"プレイヤー"}),(0,n.jsx)("th",{children:"KPM"}),(0,n.jsx)("th",{children:"ランク"}),(0,n.jsx)("th",{children:"正解率"}),(0,n.jsx)("th",{children:"ミス"}),(0,n.jsx)("th",{children:"日付"})]})}),(0,n.jsx)("tbody",{children:S.map((e,t)=>{var a,s;return(0,n.jsxs)(k.P.tr,{variants:eQ,children:[(0,n.jsx)("td",{children:t+1}),(0,n.jsx)("td",{children:e.playerName||e.username||"Anonymous"}),(0,n.jsx)("td",{children:Math.floor(e.kpm)===e.kpm?Math.floor(e.kpm):e.kpm.toFixed(1)}),(0,n.jsx)("td",{style:{color:eN.A.getRankColor(e.rank||eN.A.getRank(e.kpm))},children:e.rank||eN.A.getRank(e.kpm)}),(0,n.jsxs)("td",{children:[(void 0!==e.accuracy?e.accuracy:(null==(a=e.stats)?void 0:a.accuracy)!==void 0?e.stats.accuracy:0).toFixed(1),"%"]}),(0,n.jsx)("td",{children:e.mistakes||(null==(s=e.stats)?void 0:s.mistakes)||0}),(0,n.jsx)("td",{children:Y(e.date||e.timestamp||new Date().toISOString())})]},e.id||t)})})]}),0===S.length&&(0,n.jsx)("div",{className:eG().noRecords,children:"オンラインの記録がありません"})]}):(0,n.jsxs)(k.P.div,{className:eG().tableContainer,variants:eX,initial:"hidden",animate:a?"exit":"show",exit:"exit",children:[(0,n.jsxs)("table",{className:eG().rankingTable,children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"順位"}),(0,n.jsx)("th",{children:"KPM"}),(0,n.jsx)("th",{children:"ランク"}),(0,n.jsx)("th",{children:"正解率"}),(0,n.jsx)("th",{children:"ミス"}),(0,n.jsx)("th",{children:"日付"})]})}),(0,n.jsx)("tbody",{children:q().map((e,t)=>(0,n.jsxs)(k.P.tr,{variants:eQ,children:[(0,n.jsx)("td",{children:t+1}),(0,n.jsx)("td",{children:Math.floor(e.kpm)===e.kpm?Math.floor(e.kpm):e.kpm.toFixed(1)}),(0,n.jsx)("td",{style:{color:eN.A.getRankColor(e.rank||eN.A.getRank(e.kpm))},children:e.rank||eN.A.getRank(e.kpm)}),(0,n.jsxs)("td",{children:[e.accuracy.toFixed(1),"%"]}),(0,n.jsx)("td",{children:e.mistakes}),(0,n.jsx)("td",{children:Y(e.date)})]},t))})]}),0===q().length&&(0,n.jsx)("div",{className:eG().noRecords,children:"記録がありません"})]})}),(0,n.jsxs)(k.P.div,{className:eG().buttonContainer,initial:{opacity:0,y:30},animate:{opacity:+!a,y:50*!!a},exit:{opacity:0,y:50},transition:{delay:.6*!a,duration:.5},children:[(0,n.jsx)(k.P.div,{whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},children:(0,n.jsx)(V,{variant:"primary",size:"medium",onClick:()=>{g.A.playSound("Button"),M(!0),A({success:!1,message:""})},disabled:!t||!t.correctKeyCount&&!t.stats||l,children:l?"すでに登録済み":"ランキング登録"})}),(0,n.jsx)(k.P.div,{whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},children:(0,n.jsx)(V,{variant:"default",size:"medium",onClick:()=>{console.log("戻るボタンがクリックされました"),a||r||(g.A.playSound("Button"),o(!0),i(!0),setTimeout(()=>{o(!1),i(!1),e(L||b.MAIN_MENU,{playSound:!1})},300))},children:"戻る"})}),(0,n.jsx)(k.P.div,{whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},children:(0,n.jsx)(V,{variant:"default",size:"medium",onClick:()=>{console.log("メインメニューボタンがクリックされました"),a||r||(g.A.playSound("Button"),o(!0),i(!0),setTimeout(()=>{o(!1),i(!1),e(b.MAIN_MENU,{playSound:!1})},300))},children:"メインメニュー"})}),(0,n.jsx)(k.P.div,{whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},children:(0,n.jsx)(V,{variant:"default",size:"medium",onClick:Z,disabled:N,children:"接続確認"})})]}),E&&(0,n.jsx)("div",{className:eG().modalOverlay,children:(0,n.jsxs)(k.P.div,{className:eG().modalContent,initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:400,damping:30},children:[(0,n.jsx)("div",{className:eG().cornerDecoration,style:{top:10,left:10},children:(0,n.jsx)("div",{className:eG().cornerTech})}),(0,n.jsx)("div",{className:eG().cornerDecoration,style:{top:10,right:10,transform:"scaleX(-1)"},children:(0,n.jsx)("div",{className:eG().cornerTech})}),(0,n.jsx)("div",{className:eG().cornerDecoration,style:{bottom:10,left:10,transform:"scaleY(-1)"},children:(0,n.jsx)("div",{className:eG().cornerTech})}),(0,n.jsx)("div",{className:eG().cornerDecoration,style:{bottom:10,right:10,transform:"scale(-1)"},children:(0,n.jsx)("div",{className:eG().cornerTech})}),(0,n.jsx)("div",{className:eG().scanlines}),(0,n.jsx)("div",{className:eG().dotPattern}),(0,n.jsxs)("div",{className:eG().modalHeader,children:[(0,n.jsx)("h2",{className:eG().modalTitle,children:"オンラインランキング登録"}),(0,n.jsx)(V,{variant:"default",size:"small",onClick:J,className:eG().closeButton,children:"✕"})]}),(0,n.jsxs)("div",{className:eG().modalBody,children:[(0,n.jsx)("p",{children:"名前を入力してオンラインランキングに登録しましょう！"}),w.message&&(0,n.jsx)("div",{className:"".concat(eG().statusMessage," ").concat(w.success?eG().successMessage:eG().errorMessage),children:w.message}),(0,n.jsxs)("div",{className:eG().inputGroup,children:[(0,n.jsx)("label",{htmlFor:"playerName",children:"プレイヤー名："}),(0,n.jsx)("input",{id:"playerName",type:"text",value:j,onChange:e=>{I(e.target.value)},maxLength:20,placeholder:"名前を入力（最大20文字）",disabled:N,className:eG().nameInput})]}),t&&(0,n.jsxs)("div",{className:eG().scorePreview,children:[(0,n.jsxs)("div",{className:eG().previewItem,children:[(0,n.jsx)("span",{children:"難易度:"}),(0,n.jsx)("span",{children:"easy"===d.difficulty?"やさしい":"normal"===d.difficulty?"普通":"むずかしい"})]}),(0,n.jsxs)("div",{className:eG().previewItem,children:[(0,n.jsx)("span",{children:"KPM:"}),(0,n.jsx)("span",{children:t.stats&&"number"==typeof t.stats.kpm?Math.floor(t.stats.kpm):t.problemKPMs&&t.problemKPMs.length>0?Math.floor(t.problemKPMs.filter(e=>e>0).reduce((e,t)=>e+t,0)/t.problemKPMs.filter(e=>e>0).length):0})]}),(0,n.jsxs)("div",{className:eG().previewItem,children:[(0,n.jsx)("span",{children:"ランク:"}),(0,n.jsx)("span",{style:{color:eN.A.getRankColor(eN.A.getRank(t.stats&&"number"==typeof t.stats.kpm?Math.floor(t.stats.kpm):t.problemKPMs&&t.problemKPMs.length>0?Math.floor(t.problemKPMs.filter(e=>e>0).reduce((e,t)=>e+t,0)/t.problemKPMs.filter(e=>e>0).length):0))},children:eN.A.getRank(t.stats&&"number"==typeof t.stats.kpm?Math.floor(t.stats.kpm):t.problemKPMs&&t.problemKPMs.length>0?Math.floor(t.problemKPMs.filter(e=>e>0).reduce((e,t)=>e+t,0)/t.problemKPMs.filter(e=>e>0).length):0)})]}),(0,n.jsxs)("div",{className:eG().previewItem,children:[(0,n.jsx)("span",{children:"正解率:"}),(0,n.jsx)("span",{children:t.stats&&"number"==typeof t.stats.accuracy?t.stats.accuracy.toFixed(1):t.accuracy?t.accuracy.toFixed(1):t.correctKeyCount&&(t.mistakes||0===t.mistakes)?(t.correctKeyCount/(t.correctKeyCount+t.mistakes)*100).toFixed(1):0})]})]})]}),(0,n.jsx)("div",{className:eG().modalFooter,children:(0,n.jsx)(V,{variant:"primary",size:"medium",onClick:W,loading:N,disabled:N||l||w.success,className:"".concat(eG().registerButton," ").concat(l||w.success?eG().disabledButton:""),children:w.success?"登録完了":l?"すでに登録済み":"登録"})})]})}),G&&(0,n.jsx)("div",{className:eG().modalOverlay,children:(0,n.jsxs)(k.P.div,{className:eG().modalContent,initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:400,damping:30},children:[(0,n.jsx)("div",{className:eG().cornerDecoration,style:{top:10,left:10},children:(0,n.jsx)("div",{className:eG().cornerTech})}),(0,n.jsx)("div",{className:eG().cornerDecoration,style:{top:10,right:10,transform:"scaleX(-1)"},children:(0,n.jsx)("div",{className:eG().cornerTech})}),(0,n.jsx)("div",{className:eG().cornerDecoration,style:{bottom:10,left:10,transform:"scaleY(-1)"},children:(0,n.jsx)("div",{className:eG().cornerTech})}),(0,n.jsx)("div",{className:eG().cornerDecoration,style:{bottom:10,right:10,transform:"scale(-1)"},children:(0,n.jsx)("div",{className:eG().cornerTech})}),(0,n.jsx)("div",{className:eG().scanlines}),(0,n.jsx)("div",{className:eG().dotPattern}),(0,n.jsxs)("div",{className:eG().modalHeader,children:[(0,n.jsx)("h2",{className:eG().modalTitle,children:"デバッグ情報"}),(0,n.jsx)(V,{variant:"default",size:"small",onClick:X,className:eG().closeButton,children:"✕"})]}),(0,n.jsx)("div",{className:eG().modalBody,children:(0,n.jsx)("pre",{className:eG().debugInfo,children:JSON.stringify(R,null,2)})}),(0,n.jsx)("div",{className:eG().modalFooter,children:(0,n.jsx)(V,{variant:"primary",size:"medium",onClick:X,className:eG().closeButton,children:"閉じる"})})]})})]})},e0={fade:{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:1.05},transition:{type:"spring",stiffness:350,damping:25,duration:.4}},gameComplete:{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1,transition:{type:"spring",stiffness:450,damping:25,duration:.4}},exit:{opacity:0,scale:1.05,transition:{duration:.2}}},menuReveal:{initial:{y:-100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{type:"spring",stiffness:500,damping:30,duration:.6}}},e1=(e,t)=>t===b.RESULT?e0.gameComplete:t===b.MAIN_MENU?e0.menuReveal:e0.fade,e5=e=>{let{isActive:t}=e;return(0,n.jsx)(k.P.div,{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.12)",zIndex:10,pointerEvents:"none"},initial:{opacity:0},animate:{opacity:.3*!!t},exit:{opacity:0},transition:{duration:.1}})},e2=null,e3=()=>{let{navigateTo:e}=x(),[t,a]=(0,s.useState)(!1);return{goToScreen:function(n){var s;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{playSound:!0,soundType:"button",immediate:!1,gameState:null};if(t&&!o.immediate)return;let r=(null==(s=window.history.state)?void 0:s.screen)||b.MAIN_MENU;if(n===b.SETTINGS){try{g.A.context&&"suspended"===g.A.context.state&&g.A.context.resume(),!1!==o.playSound&&g.A.play(o.soundType||"button")}catch(e){console.error("音声再生でエラーが発生しました:",e)}e(b.MAIN_MENU),setTimeout(()=>{e2&&e2.openSettingsModal()},100);return}try{g.A.context&&"suspended"===g.A.context.state&&g.A.context.resume(),!1!==o.playSound&&n!==b.RESULT&&(o.from!==b.GAME||n!==b.MAIN_MENU)&&g.A.play(o.soundType||"button"),console.log("画面遷移を実行します:",n,"サウンド:",!1!==o.playSound?"有効 (".concat(o.soundType||"button",")"):"無効","遷移元:",o.from||r)}catch(e){console.error("音声再生でエラーが発生しました:",e)}a(!0);let i={screen:n,options:{...o,from:o.from||r}};window.history.replaceState(i,"",window.location.pathname);let l=20;(n===b.RESULT||o.immediate)&&(l=0),n===b.MAIN_MENU&&o.from===b.RESULT&&(console.log("ResultScreenからメインメニューへの遷移を優先処理します"),l=0,a(!1)),setTimeout(()=>{o.gameState&&n===b.RANKING?(console.log("ランキング画面に遷移するためのゲーム状態データ:",o.gameState),e(n,o.gameState)):e(n),setTimeout(()=>{a(!1)},200)},l)},isTransitioning:t}},e4=()=>{let{currentScreen:e,navigateTo:t,gameState:a}=x(),[o,r]=(0,s.useState)(null),[i,l]=(0,s.useState)(!1),{goToScreen:c}=e3(),[d,u]=(0,s.useState)(!1),m=E(),{soundEnabled:_,bgmEnabled:p,sfxEnabled:g}=m||{};null==m||m.soundSystem,e2=X(),(0,s.useEffect)(()=>{if(e===b.SETTINGS&&o!==b.SETTINGS&&(t(b.MAIN_MENU),setTimeout(()=>{e2?(e2.openSettingsModal(),console.log("設定モーダルを開きました")):console.warn("設定モーダルコントローラが見つかりません")},100)),o!==e){l(!0);let t=setTimeout(()=>{l(!1)},200);return r(e),()=>clearTimeout(t)}},[e,o,t]),(0,s.useEffect)(()=>{null===o&&l(!1)},[o]);let y=e1(o,e);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e5,{isActive:i}),(0,n.jsx)(T.N,{mode:"wait",children:(0,n.jsx)(k.P.div,{initial:"initial",animate:"animate",exit:"exit",variants:y,style:{width:"100%",height:"100%"},children:(()=>{let{settings:t}=x();switch(e){case b.GAME:return(0,n.jsx)(eC,{});case b.SETTINGS:return(0,n.jsx)(Q,{});case b.RESULT:let s=a.stats||{};return console.log("TransitionManager: ResultScreenに渡す統計データ",s),(0,n.jsx)(eR,{stats:s,onClickRetry:()=>c(b.GAME,{playSound:!0}),onClickMenu:()=>c(b.MAIN_MENU,{playSound:!0}),onClickRanking:()=>c(b.RANKING,{playSound:!0,gameState:{stats:s}}),playSound:!0});case b.RANKING:return(0,n.jsx)(e$,{});case b.MAIN_MENU:default:return(0,n.jsx)(Q,{})}})()},e)})]})};var e7=a(1368),e9=a(5521),e6=a.n(e9);let e8=e=>{let{type:t="info",message:a,visible:o,onClose:r,duration:i=3e3,showIcon:l=!0,position:c="top-right"}=e,d=(0,s.useMemo)(()=>{switch(t){case"success":return{icon:"✓",className:"toast--success",ariaRole:"status",ariaLive:"polite"};case"error":return{icon:"✕",className:"toast--error",ariaRole:"alert",ariaLive:"assertive"};case"warning":return{icon:"!",className:"toast--warning",ariaRole:"status",ariaLive:"polite"};default:return{icon:"i",className:"toast--info",ariaRole:"status",ariaLive:"polite"}}},[t]),u=(0,s.useMemo)(()=>"toast--".concat(c),[c]);(0,s.useEffect)(()=>{if(o&&i>0){let e=setTimeout(r,i);return()=>clearTimeout(e)}},[o,i,r]);let m={topVariants:{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20}},bottomVariants:{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20}},transition:{type:"spring",stiffness:500,damping:30,mass:1}},_=c.includes("top")?m.topVariants:m.bottomVariants;return(0,n.jsx)(T.N,{children:o&&(0,n.jsxs)(k.P.div,{className:"".concat(e6().toast," ").concat(e6()[d.className]," ").concat(e6()[u]),role:d.ariaRole,"aria-live":d.ariaLive,initial:_.initial,animate:_.animate,exit:_.exit,transition:m.transition,children:[(0,n.jsxs)("div",{className:e6().toast__content,children:[l&&(0,n.jsx)("div",{className:e6().toast__icon,"aria-hidden":"true",children:(0,n.jsx)("span",{children:d.icon})}),(0,n.jsx)("div",{className:e6().toast__message,children:a}),(0,n.jsx)("button",{className:e6().toast__close_button,onClick:r,"aria-label":"通知を閉じる",children:"✕"})]}),i>0&&(0,n.jsx)(k.P.div,{className:e6().toast__progress,initial:{width:"100%"},animate:{width:0},transition:{duration:i/1e3,ease:"linear"},"aria-hidden":"true"})]})})},te=(0,s.createContext)(),tt=e=>{let{children:t}=e,[a,o]=(0,s.useState)([]),r=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,n=(0,e7.A)(),s={id:n,message:e,type:t,duration:a,visible:!0};return o(e=>[...e,s]),n},[]),i=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;return r(e,"success",t)},[r]),l=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;return r(e,"error",t)},[r]),c=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;return r(e,"warning",t)},[r]),d=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;return r(e,"info",t)},[r]),u=(0,s.useCallback)(e=>{o(t=>t.filter(t=>t.id!==e))},[]),m=(0,s.useCallback)(e=>{o(t=>t.map(t=>t.id===e?{...t,visible:!1}:t)),setTimeout(()=>{u(e)},300)},[u]),_=(0,s.useCallback)(()=>{o([])},[]);return(0,n.jsxs)(te.Provider,{value:{addToast:r,showSuccess:i,showError:l,showWarning:c,showInfo:d,closeToast:m,clearAllToasts:_},children:[t,(0,n.jsx)("div",{className:"toast-container",children:a.map(e=>(0,n.jsx)(e8,{type:e.type,message:e.message,visible:e.visible,duration:e.duration,onClose:()=>m(e.id)},e.id))})]})};function ta(e){let{children:t}=e;return(0,n.jsx)(tt,{children:(0,n.jsx)(M,{children:(0,n.jsx)(v,{children:t})})})}var tn=a(7643),ts=a.n(tn),to=a(2699),tr=a.n(to);let ti=(e,t)=>{},tl=(e,t)=>{console.error(e,t)},tc=e=>{let{isOpen:t,onClose:o,backgroundRef:r}=e,{gameState:i,setGameState:l,currentScreen:c}=x(),[d,u]=(0,s.useState)(5),[m,_]=(0,s.useState)("settings");(0,s.useEffect)(()=>{t&&i&&i.requiredProblemCount&&(u(i.requiredProblemCount),ti("[管理者設定] 現在のお題数を読み込みました:",i.requiredProblemCount))},[t,i]);let[p,g]=(0,s.useState)(!1),[y,h]=(0,s.useState)(!1),[b,f]=(0,s.useState)(""),[S,v]=(0,s.useState)([]),[k,T]=(0,s.useState)(!1),[P,N]=(0,s.useState)(!1),[C,E]=(0,s.useState)("ALL"),[M,j]=(0,s.useState)("spa"),[I,w]=(0,s.useState)("normal"),[A,R]=(0,s.useState)(!1),[B,G]=(0,s.useState)(!1),O=[{id:"ALL",name:"全ての画面"},{id:"MAIN_MENU",name:"メインメニュー"},{id:"GAME",name:"ゲーム画面"},{id:"RESULT",name:"リザルト画面"},{id:"RANKING",name:"ランキング画面"},{id:"SETTINGS",name:"設定画面"},{id:"CREDITS",name:"クレジット画面"}],L=(0,s.useCallback)(()=>{let e=document.querySelector("body > div")||document.querySelector("#__next > div")||document.querySelector("main")||document.body;if(!e)throw Error("メインコンテナ要素が見つかりません");return e},[]),D=(0,s.useCallback)(()=>{try{ti("内部背景要素を検索中..."),ti("現在の選択画面: ".concat(C));let e={MAIN_MENU:['[class*="MainMenu_mainContainer"]',".MainMenu_mainContainer",'[class*="mainContainer"]',".mainContainer","#main-menu"],GAME:['[class*="GameScreen_gameContainer"]',".GameScreen_gameContainer",'[class*="gameContainer"]',".gameContainer","#game-screen"],RESULT:['[class*="ResultScreen_container"]',".ResultScreen_container","#result-screen"],RANKING:['[class*="RankingScreen_container"]',".RankingScreen_container","#ranking-screen"],SETTINGS:['[class*="SettingsScreen_container"]',".SettingsScreen_container","#settings-screen"],CREDITS:['[class*="CreditsScreen_container"]',".CreditsScreen_container","#credits-screen"]}[C]||[],t=null;for(let a of e){let e=Array.from(document.querySelectorAll(a));if(ti('セレクタ "'.concat(a,'" で ').concat(e.length," 個の要素が見つかりました")),e.length>0){let a=e.filter(e=>{let t=e.getBoundingClientRect(),a=window.getComputedStyle(e);return"none"!==a.display&&"hidden"!==a.visibility&&t.width>50&&t.height>50&&t.top>=0&&t.left>=0&&t.bottom<=window.innerHeight&&t.right<=window.innerWidth});if(a.length>0){t=a[0],ti("表示中の要素を発見しました",t);break}t||(t=e[0],ti("非表示状態の要素を発見しました",t))}}if(!t)for(let e of(ti("特定の要素が見つからなかったため、汎用セレクタを試します"),['[class*="menu"]','[class*="container"]','[class*="content"]','[class*="screen"]','[class*="wrapper"]','[class*="page"]',".container",".main",".content",".app-container","main","#__next > div","body > div"])){let a=Array.from(document.querySelectorAll(e));if(a.length>0){let e=a.filter(e=>{let t=e.getBoundingClientRect(),a=window.getComputedStyle(e);return"none"!==a.display&&"hidden"!==a.visibility&&t.width>100&&t.height>100});if(e.length>0){t=e.sort((e,t)=>{let a=e.getBoundingClientRect(),n=t.getBoundingClientRect();return n.width*n.height-a.width*a.height})[0],ti("汎用セレクタから要素を発見しました",t);break}t||(t=a[0],ti("汎用セレクタから非表示要素を発見しました",t))}}if(!t&&"MAIN_MENU"===C){let e=Array.from(document.body.querySelectorAll("*")).filter(e=>{let t=e.getBoundingClientRect(),a=window.getComputedStyle(e),n=e.parentNode===document.body||e.parentNode.parentNode===document.body,s=t.width>200&&t.height>200,o="none"!==a.display&&"hidden"!==a.visibility;return n&&s&&o}).sort((e,t)=>{let a=e.getBoundingClientRect(),n=t.getBoundingClientRect();return n.width*n.height-a.width*a.height});e.length>0&&(t=e[0],ti("最終手段: サイズの大きな要素を発見しました",t))}if(!t){ti("物理的なDOM要素を探索します");let e=[];document.querySelectorAll('h1, h2, [class*="title"]').forEach(t=>{let a=t.textContent.toLowerCase();if(a.includes("manaby typing")||a.includes("typing game")||a.includes("タイピングゲーム")){let a=t.parentElement;for(;a&&a!==document.body;){let t=a.getBoundingClientRect();if(t.width>300&&t.height>300){e.push(a);break}a=a.parentElement}}}),document.querySelectorAll("img").forEach(t=>{let a=t.src.toLowerCase();if(a.includes("logo")||a.includes("manaby")||a.includes("icon")){let a=t.parentElement;for(;a&&a!==document.body;){let t=a.getBoundingClientRect();if(t.width>300&&t.height>300){e.push(a);break}a=a.parentElement}}}),e.length>0&&(t=e.sort((e,t)=>{let a=e.getBoundingClientRect(),n=t.getBoundingClientRect();return n.width*n.height-a.width*a.height})[0],ti("コンテンツマーカーから親要素を発見しました",t))}return t||(t=L(),ti("内部要素は見つからなかったため、メインコンテナを使用します",t)),t}catch(e){throw tl("内部背景要素の検索中にエラーが発生しました:",e),alert("内部背景要素の検出に問題が発生しました。別のキャプチャモードをお試しください。"),Error("内部背景要素の検出に失敗しました")}},[C,L]),V=(0,s.useCallback)(e=>{e(!0),setTimeout(()=>{e(!1)},3e3)},[]);(0,s.useEffect)(()=>{let e=i.requiredProblemCount||5;ti("[管理者モード] 現在のお題数設定:",e),u(e),E(c||"ALL")},[i,t,c]),(0,s.useEffect)(()=>{t&&"gallery"===m&&C&&F()},[t,m,C]);let F=async()=>{T(!0);try{let e=await eW.getScreenBackgroundsFromFirebase(C,20);ti("".concat(K(C),"用の背景を取得しました:"),e.length),v(e)}catch(e){tl("背景の取得中にエラーが発生しました:",e)}finally{T(!1)}},K=(0,s.useCallback)(e=>{let t=O.find(t=>t.id===e);return t?t.name:e},[O]),U=(0,s.useCallback)(e=>{"Escape"===e.key&&t&&o()},[t,o]);(0,s.useEffect)(()=>(t&&document.addEventListener("keydown",U),()=>{document.removeEventListener("keydown",U)}),[t,U]);let z=e=>{switch(e){case"spa":return"SPA画面全体";case"container":return"オレンジドット背景";case"spa-background":return"SPA内部背景";default:return e}},H=async()=>{try{let e;switch(g(!0),M){case"container":if(null==r?void 0:r.current)e=r.current,ti("外側ドット背景をキャプチャします:",e);else throw Error("外側ドット背景要素の参照が取得できません");break;case"spa-background":try{e=D(),ti("SPA内部背景をキャプチャします:",e)}catch(e){throw tl("SPA内部背景の取得に失敗しました:",e),alert("現在の画面(".concat(K(C),")から内部背景を特定できませんでした。別の画面に切り替えるか、別のキャプチャモードを選択してください。")),e}break;default:e=L(),ti("SPA画面全体をキャプチャします:",e)}let t=(await tr()(e,{useCORS:!0,allowTaint:!0,backgroundColor:null,logging:!1})).toDataURL("image/png"),a=z(M),n="".concat(b||"管理者","の").concat(K(C),"用").concat(a),s=await eW.saveScreenBackgroundToFirebase(C,b||"管理者",t,n,{captureMode:M});s&&(ti("背景を保存しました！ ID:",s),V(h),"gallery"===m&&F())}catch(e){tl("背景の保存中にエラーが発生しました:",e),alert("背景の保存に失敗しました: ".concat(e.message))}finally{g(!1)}},q=e=>{try{var t;let a=(null==(t=e.cssStyleInfo)?void 0:t.captureMode)||"spa",n=e.screenId||"ALL",s=e.imageData;switch(a){case"container":if(null==r?void 0:r.current){let e=r.current;e.style.backgroundImage="url(".concat(s,")"),e.style.backgroundSize="cover",e.style.backgroundPosition="center",ti("外側ドット背景を適用しました")}else throw Error("外側ドット背景要素の参照が取得できません");break;case"spa-background":try{let e=D();e.style.backgroundImage="url(".concat(s,")"),e.style.backgroundSize="cover",e.style.backgroundPosition="center",ti("SPA内部背景を適用しました")}catch(e){throw Error("SPA内部背景の適用に失敗しました。画面を切り替えてみてください。")}break;default:let o=L();o.style.backgroundImage="url(".concat(s,")"),o.style.backgroundSize="cover",o.style.backgroundPosition="center",ti("SPA画面全体の背景を適用しました")}let i=e.cssStyleInfo||null;if(i){let e;e="container"===a&&(null==r?void 0:r.current)?r.current:"spa-background"===a?D():L(),Object.entries(i).forEach(t=>{let[a,n]=t;"backgroundImage"!==a&&"captureMode"!==a&&(e.style[a]=n)})}try{localStorage.setItem("isAdmin","true"),localStorage.setItem("savedBackgroundImage_".concat(a,"_").concat(n),s),i&&localStorage.setItem("savedBackgroundStyle_".concat(a,"_").concat(n),JSON.stringify(i));let t=JSON.parse(localStorage.getItem("activeBackgrounds")||"{}");t[a]||(t[a]={}),t[a][n]={id:e.id,timestamp:new Date().toISOString()},localStorage.setItem("activeBackgrounds",JSON.stringify(t)),ti("".concat(K(n),"用の").concat(z(a),"を適用しました"))}catch(e){tl("背景情報をlocalStorageに保存できませんでした:",e)}V(N)}catch(e){tl("背景の適用中にエラーが発生しました:",e),alert("背景の適用に失敗しました: ".concat(e.message))}},Y=async e=>{if(window.confirm("この背景を本当に削除しますか？この操作は取り消せません。"))try{await eW.deleteBackgroundFromFirebase(e)&&(ti("背景を削除しました:",e),V(N),F())}catch(e){tl("背景の削除中にエラーが発生しました:",e)}},J=async()=>{if(window.confirm("難易度「".concat(Z(I),"」のランキングをすべて削除しますか？この操作は取り消せません。")))try{R(!0),await eW.deleteRankingsByDifficulty(I)&&(ti("難易度「".concat(I,"」のランキングを削除しました")),V(G))}catch(e){tl("ランキング削除中にエラーが発生しました:",e),alert("ランキングの削除に失敗しました: ".concat(e.message))}finally{R(!1)}},W=async()=>{if(window.confirm("すべての難易度のランキングを削除しますか？この操作は取り消せません。"))try{R(!0),await eW.deleteAllRankings()&&(ti("すべてのランキングデータを削除しました"),V(G))}catch(e){tl("ランキング削除中にエラーが発生しました:",e),alert("ランキングの削除に失敗しました: ".concat(e.message))}finally{R(!1)}},Z=e=>({easy:"かんたん",normal:"ふつう",hard:"むずかしい"})[e]||e,X=e=>_(e),Q=e=>E(e.target.value),$=e=>j(e);return t?(0,n.jsx)("div",{className:ts().adminPopup__overlay,onClick:e=>{e.target.classList.contains(ts().adminPopup__overlay)&&o()},children:(0,n.jsxs)("div",{className:ts().adminPopup,children:[(0,n.jsxs)("div",{className:ts().adminPopup__header,children:[(0,n.jsx)("h2",{className:ts().adminPopup__title,children:"管理者設定"}),(0,n.jsx)("button",{className:ts().adminPopup__closeButton,onClick:o,"aria-label":"閉じる",children:"\xd7"})]}),(0,n.jsxs)("div",{className:ts().adminPopup__tabs,children:[(0,n.jsx)("button",{className:"".concat(ts().adminPopup__tab," ").concat("settings"===m?ts()["adminPopup__tab--active"]:""),onClick:()=>X("settings"),children:"設定"}),(0,n.jsx)("button",{className:"".concat(ts().adminPopup__tab," ").concat("background"===m?ts()["adminPopup__tab--active"]:""),onClick:()=>X("background"),children:"背景保存"}),(0,n.jsx)("button",{className:"".concat(ts().adminPopup__tab," ").concat("gallery"===m?ts()["adminPopup__tab--active"]:""),onClick:()=>X("gallery"),children:"着せ替え"}),(0,n.jsx)("button",{className:"".concat(ts().adminPopup__tab," ").concat("rankings"===m?ts()["adminPopup__tab--active"]:""),onClick:()=>X("rankings"),children:"ランキング"})]}),(0,n.jsxs)("div",{className:ts().adminPopup__content,children:["settings"===m&&(0,n.jsxs)("div",{className:ts().adminPopup__formGroup,children:[(0,n.jsx)("label",{className:ts().adminPopup__label,htmlFor:"problemCount",children:"クリアに必要なお題数"}),(0,n.jsx)("input",{className:ts().adminPopup__input,id:"problemCount",type:"number",min:"1",max:"20",value:d,onChange:e=>u(parseInt(e.target.value,10)||1)}),(0,n.jsx)("p",{className:ts().adminPopup__info,children:"ゲームをクリアするために必要なお題の数を設定します（1〜20の範囲）"})]}),"background"===m&&(0,n.jsxs)("div",{className:ts().adminPopup__backgroundSave,children:[(0,n.jsxs)("div",{className:ts().adminPopup__formGroup,children:[(0,n.jsx)("label",{className:ts().adminPopup__label,htmlFor:"playerName",children:"保存者名"}),(0,n.jsx)("input",{className:ts().adminPopup__input,id:"playerName",type:"text",value:b,onChange:e=>f(e.target.value),placeholder:"名前を入力（例：マナビー）",maxLength:20})]}),(0,n.jsxs)("div",{className:ts().adminPopup__formGroup,children:[(0,n.jsx)("label",{className:ts().adminPopup__label,htmlFor:"screenSelector",children:"背景を適用する画面"}),(0,n.jsx)("select",{className:ts().adminPopup__select,id:"screenSelector",value:C,onChange:Q,children:O.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))}),(0,n.jsx)("p",{className:ts().adminPopup__info,children:"背景を適用する画面を選択します。「全ての画面」を選ぶとすべての画面に適用されます。"})]}),(0,n.jsxs)("div",{className:ts().adminPopup__formGroup,children:[(0,n.jsx)("label",{className:ts().adminPopup__label,children:"キャプチャする範囲"}),(0,n.jsxs)("div",{className:ts().adminPopup__radioGroup,children:[(0,n.jsxs)("label",{className:ts().adminPopup__radioLabel,children:[(0,n.jsx)("input",{type:"radio",name:"captureMode",value:"spa",checked:"spa"===M,onChange:()=>$("spa"),className:ts().adminPopup__radio}),(0,n.jsx)("span",{children:"SPA画面全体"})]}),(0,n.jsxs)("label",{className:ts().adminPopup__radioLabel,children:[(0,n.jsx)("input",{type:"radio",name:"captureMode",value:"container",checked:"container"===M,onChange:()=>$("container"),className:ts().adminPopup__radio}),(0,n.jsx)("span",{children:"オレンジドット背景のみ"})]}),(0,n.jsxs)("label",{className:ts().adminPopup__radioLabel,children:[(0,n.jsx)("input",{type:"radio",name:"captureMode",value:"spa-background",checked:"spa-background"===M,onChange:()=>$("spa-background"),className:ts().adminPopup__radio}),(0,n.jsx)("span",{children:"SPA内部背景のみ"})]})]}),(0,n.jsxs)("p",{className:ts().adminPopup__info,children:["「SPA画面全体」：ゲーム画面を含むページ全体をキャプチャします。",(0,n.jsx)("br",{}),"「オレンジドット背景のみ」：画面外側のドットパターン背景だけをキャプチャします。",(0,n.jsx)("br",{}),"「SPA内部背景のみ」：ゲーム画面内の背景部分だけをキャプチャします。"]})]}),(0,n.jsxs)("div",{className:ts().adminPopup__formGroup,children:[(0,n.jsx)("button",{className:"".concat(ts().adminPopup__button," ").concat(ts()["adminPopup__button--special"]),onClick:H,disabled:p,children:p?"保存中...":"".concat(z(M),"を").concat(K(C),"用に保存")}),(0,n.jsx)("p",{className:ts().adminPopup__info,children:"選択した範囲をキャプチャして保存します。保存した背景は後で再利用できます。"})]}),y&&(0,n.jsxs)("div",{className:ts().adminPopup__successMessage,children:[(0,n.jsx)("span",{className:ts().adminPopup__successIcon,children:"✓"})," ","背景を保存しました！"]})]}),"gallery"===m&&(0,n.jsxs)("div",{className:ts().adminPopup__backgroundGallery,children:[(0,n.jsx)("h3",{className:ts().adminPopup__subTitle,children:"着せ替えギャラリー"}),(0,n.jsxs)("div",{className:ts().adminPopup__formGroup,children:[(0,n.jsx)("label",{className:ts().adminPopup__label,htmlFor:"screenSelectorGallery",children:"表示する画面"}),(0,n.jsx)("select",{className:ts().adminPopup__select,id:"screenSelectorGallery",value:C,onChange:Q,children:O.map(e=>(0,n.jsxs)("option",{value:e.id,children:[e.name,"用"]},e.id))})]}),(0,n.jsx)("div",{className:ts().adminPopup__resetContainer,children:(0,n.jsxs)("button",{className:"".concat(ts().adminPopup__button," ").concat(ts()["adminPopup__button--reset"]),onClick:()=>{try{["spa","container","spa-background"].forEach(e=>{try{switch(e){case"container":(null==r?void 0:r.current)&&(r.current.style.backgroundImage="",ti("外側ドット背景をリセットしました"));break;case"spa-background":try{D().style.backgroundImage="",ti("SPA内部背景をリセットしました")}catch(e){ti("SPA内部背景のリセットをスキップしました（要素が見つかりません）")}break;default:L().style.backgroundImage="",ti("SPA画面全体の背景をリセットしました")}localStorage.removeItem("savedBackgroundImage_".concat(e,"_").concat(C)),localStorage.removeItem("savedBackgroundStyle_".concat(e,"_").concat(C));let t=JSON.parse(localStorage.getItem("activeBackgrounds")||"{}");t[e]&&delete t[e][C],localStorage.setItem("activeBackgrounds",JSON.stringify(t))}catch(t){tl("".concat(e,"モードの背景リセット中にエラーが発生しました:"),t)}}),V(N)}catch(e){tl("背景のリセット中にエラーが発生しました:",e)}},children:[K(C),"の全背景をリセット"]})}),k?(0,n.jsx)("div",{className:ts().adminPopup__loading,children:"読み込み中..."}):0===S.length?(0,n.jsxs)("p",{className:ts().adminPopup__info,children:[K(C),"用の保存された背景がありません"]}):(0,n.jsx)("div",{className:ts().adminPopup__grid,children:S.map(e=>{var t;return(0,n.jsxs)("div",{className:ts().adminPopup__backgroundItem,children:[(0,n.jsx)("div",{className:ts().adminPopup__backgroundImageContainer,children:(0,n.jsx)("img",{src:e.imageData,alt:e.title||"保存された背景",className:ts().adminPopup__backgroundImage})}),(0,n.jsxs)("div",{className:ts().adminPopup__backgroundInfo,children:[(0,n.jsx)("p",{className:ts().adminPopup__backgroundTitle,children:e.title||"無題の背景"}),(0,n.jsxs)("p",{className:ts().adminPopup__backgroundMeta,children:[e.playerName||"匿名"," |",e.screenId?" ".concat(K(e.screenId),"用"):"全画面用"," ","|",z((null==(t=e.cssStyleInfo)?void 0:t.captureMode)||"spa")," |",new Date(e.timestamp).toLocaleDateString("ja-JP")]}),(0,n.jsxs)("div",{className:ts().adminPopup__buttonGroup,children:[(0,n.jsx)("button",{className:"".concat(ts().adminPopup__button," ").concat(ts()["adminPopup__button--apply"]),onClick:()=>q(e),children:"適用"}),(0,n.jsx)("button",{className:"".concat(ts().adminPopup__button," ").concat(ts()["adminPopup__button--delete"]),onClick:()=>Y(e.id),children:"削除"})]})]})]},e.id)})}),P&&(0,n.jsxs)("div",{className:ts().adminPopup__successMessage,children:[(0,n.jsx)("span",{className:ts().adminPopup__successIcon,children:"✓"})," ","背景を適用しました！"]}),(0,n.jsx)("div",{className:ts().adminPopup__refreshContainer,children:(0,n.jsx)("button",{className:"".concat(ts().adminPopup__button," ").concat(ts()["adminPopup__button--refresh"]),onClick:F,disabled:k,children:k?"更新中...":"一覧を更新"})})]}),"rankings"===m&&(0,n.jsxs)("div",{className:ts().adminPopup__rankingManagement,children:[(0,n.jsx)("h3",{className:ts().adminPopup__subTitle,children:"ランキング管理"}),(0,n.jsxs)("div",{className:ts().adminPopup__formGroup,children:[(0,n.jsx)("label",{className:ts().adminPopup__label,htmlFor:"difficultySelector",children:"難易度を選択"}),(0,n.jsxs)("select",{className:ts().adminPopup__select,id:"difficultySelector",value:I,onChange:e=>w(e.target.value),children:[(0,n.jsx)("option",{value:"easy",children:"かんたん"}),(0,n.jsx)("option",{value:"normal",children:"ふつう"}),(0,n.jsx)("option",{value:"hard",children:"むずかしい"})]}),(0,n.jsx)("p",{className:ts().adminPopup__info,children:"削除する難易度を選択します。"})]}),(0,n.jsxs)("div",{className:ts().adminPopup__buttonGroup,children:[(0,n.jsx)("button",{className:"".concat(ts().adminPopup__button," ").concat(ts()["adminPopup__button--delete"]),onClick:J,disabled:A,children:A?"削除中...":"".concat(Z(I),"のランキングを削除")}),(0,n.jsx)("button",{className:"".concat(ts().adminPopup__button," ").concat(ts()["adminPopup__button--danger"]),onClick:W,disabled:A,children:A?"削除中...":"すべてのランキングを削除"})]}),(0,n.jsx)("div",{className:ts().adminPopup__warningBox,children:(0,n.jsxs)("p",{className:ts().adminPopup__warning,children:[(0,n.jsx)("span",{className:ts().adminPopup__warningIcon,children:"⚠️"}),"注意: 削除したランキングデータは復元できません。"]})}),B&&(0,n.jsxs)("div",{className:ts().adminPopup__successMessage,children:[(0,n.jsx)("span",{className:ts().adminPopup__successIcon,children:"✓"})," ","ランキングデータを削除しました！"]})]})]}),(0,n.jsxs)("div",{className:ts().adminPopup__footer,children:[(0,n.jsx)("button",{className:"".concat(ts().adminPopup__button," ").concat(ts()["adminPopup__button--secondary"]),onClick:o,children:"閉じる"}),"settings"===m&&(0,n.jsx)("button",{className:"".concat(ts().adminPopup__button," ").concat(ts()["adminPopup__button--primary"]),onClick:()=>{ti("[管理者設定] お題数を変更:",d),l({...i,requiredProblemCount:d});try{let e=a(2219).Ay;if(e&&"function"==typeof e.saveGameSettings){let t={...e.getGameSettings(),requiredProblemCount:d};e.saveGameSettings(t),ti("[管理者設定] 設定を永続化しました",t)}}catch(e){tl("設定の永続化中にエラーが発生しました:",e)}o()},children:"保存"})]})]})}):null},td=()=>y.Ay.isAdminMode(),tu=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;try{return await eW.getBackgroundsFromFirebase(e)}catch(e){return console.error("クラウド背景の取得中にエラーが発生しました:",e),[]}},tm=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;try{return await eW.getScreenBackgroundsFromFirebase(e,t)}catch(t){return console.error("画面用背景の取得中にエラーが発生しました (".concat(e,"):"),t),[]}},t_={enableAdminMode:()=>y.Ay.setAdminMode(!0),disableAdminMode:()=>y.Ay.setAdminMode(!1),isAdminMode:td},tp=e=>{let{backgroundRef:t}=e,[a,o]=(0,s.useState)(!1);(0,s.useEffect)(()=>{console.log("[管理者モード] 現在の状態:",t_.isAdminMode()?"有効":"無効")},[]),(0,s.useEffect)(()=>{let e=e=>{(e.ctrlKey||e.metaKey)&&(64===e.keyCode||"@"===e.key)&&(e.preventDefault(),console.log("[管理者モード] Ctrl + @ キーが検出されました"),t_.enableAdminMode(),console.log("[管理者モード] 有効化されました"),o(!0))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[]);let r=()=>{o(!1),console.log("[管理者モード] モーダルを閉じました")};return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(tc,{isOpen:a,onClose:r,onDisable:()=>{t_.disableAdminMode(),console.log("[管理者モード] 無効化されました"),r()},backgroundRef:t})})};var tg=a(8450),ty=a.n(tg);let th=(0,s.forwardRef)((e,t)=>{let{className:a=""}=e,[o,r]=(0,s.useState)([]),[i,l]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{l(!0);let e=["#FF8C00","#FFA500","#FFD700","#FF4500","#FF7F50","#551800"],t=[];for(let a=0;a<150;a++)t.push({id:a,left:100*Math.random(),top:100*Math.random(),size:3*Math.random()+2,color:e[Math.floor(Math.random()*e.length)],animationDuration:3*Math.random()+2,animationDelay:2*Math.random(),isRound:Math.random()>.5});r(t)},[]),i)?(0,n.jsxs)("div",{ref:t,className:"".concat(ty().retroBackground," ").concat(a),"aria-hidden":"true",children:[(0,n.jsx)("div",{className:ty().backgroundBase}),o.map(e=>(0,n.jsx)("div",{style:{position:"absolute",left:"".concat(e.left,"%"),top:"".concat(e.top,"%"),width:"".concat(e.size,"px"),height:"".concat(e.size,"px"),backgroundColor:e.color,borderRadius:e.isRound?"50%":"0",boxShadow:"0 0 4px currentColor",animation:"".concat(ty().blink," ").concat(e.animationDuration,"s infinite ").concat(e.animationDelay,"s")}},e.id)),(0,n.jsx)("div",{className:ty().gridOverlay})]}):null});function tx(e){let{position:t="bottom-right"}=e;return(0,n.jsx)(J.Pz,{position:t})}function tb(){let[e,t]=(0,s.useState)(!1),a=(0,s.useRef)(null);return((0,s.useEffect)(()=>{t(!0)},[]),e)?(0,n.jsx)(ta,{children:(0,n.jsxs)("div",{className:r().container,children:[(0,n.jsx)(th,{ref:a}),(0,n.jsxs)(v,{children:[(0,n.jsx)(e4,{}),(0,n.jsx)(tp,{backgroundRef:a})]}),(0,n.jsx)(tx,{position:"bottom-right"})]})}):null}th.displayName="RetroBackground"},8001:(e,t,a)=>{Promise.resolve().then(a.bind(a,7975))},8334:e=>{e.exports={container:"page_container__aoG4z"}},8450:e=>{e.exports={retroBackground:"RetroBackground_retroBackground___1dfX",backgroundBase:"RetroBackground_backgroundBase__3nFa_",dotsContainer:"RetroBackground_dotsContainer__ZojHT",dot:"RetroBackground_dot__8seEJ",blink:"RetroBackground_blink__h_mSH",gridOverlay:"RetroBackground_gridOverlay__PvIZk"}},8618:e=>{e.exports={rankingContainer:"RankingScreen_rankingContainer__5fh4X",rankingHeader:"RankingScreen_rankingHeader__3SyFQ",rankingTitle:"RankingScreen_rankingTitle__igbNU",difficultyNav:"RankingScreen_difficultyNav__lipCh",difficultyButton:"RankingScreen_difficultyButton__xzqEg",difficultyButton__active:"RankingScreen_difficultyButton__active__3pcds",rankingContent:"RankingScreen_rankingContent__LPH4z",tableContainer:"RankingScreen_tableContainer__8GFWz",rankingTable:"RankingScreen_rankingTable__c0E4S",noRecords:"RankingScreen_noRecords__yHgIp",onlineModeToggle:"RankingScreen_onlineModeToggle__ZYiUe",modeButton:"RankingScreen_modeButton__iYQFa",modeButton__active:"RankingScreen_modeButton__active__a_uaP",buttonContainer:"RankingScreen_buttonContainer__mtwyV",registerButton:"RankingScreen_registerButton__QkBHe",disabledButton:"RankingScreen_disabledButton__TF9OV",backButton:"RankingScreen_backButton__yF95g",mainMenuButton:"RankingScreen_mainMenuButton__mF4Ib",debugButton:"RankingScreen_debugButton__OYmTj",modalOverlay:"RankingScreen_modalOverlay__qi5nD",modalContent:"RankingScreen_modalContent__DtQPc",cornerDecoration:"RankingScreen_cornerDecoration__7DYV7",cornerTech:"RankingScreen_cornerTech__lNB_b",modalHeader:"RankingScreen_modalHeader__J3hMS",modalTitle:"RankingScreen_modalTitle__IAvZD",closeButton:"RankingScreen_closeButton__Zrh4C",modalBody:"RankingScreen_modalBody__BPdG5",scanlines:"RankingScreen_scanlines__X2Kgb",dotPattern:"RankingScreen_dotPattern__dvlBW",modalFooter:"RankingScreen_modalFooter__4ofb9",inputGroup:"RankingScreen_inputGroup__FzEUB",nameInput:"RankingScreen_nameInput__nkcpf",scorePreview:"RankingScreen_scorePreview__BTbnj",previewItem:"RankingScreen_previewItem__pjGYc",statusMessage:"RankingScreen_statusMessage__HaIu5",successMessage:"RankingScreen_successMessage__53TLe",errorMessage:"RankingScreen_errorMessage__1iitL",modalActions:"RankingScreen_modalActions__xEYr7",registerActionButton:"RankingScreen_registerActionButton__vwSPc",cancelButton:"RankingScreen_cancelButton__7y_Ly",loadingSpinner:"RankingScreen_loadingSpinner__7gdef",spin:"RankingScreen_spin__oYweb"}},9254:e=>{e.exports={mainContainer:"MainMenu_mainContainer__12qmh",earlyAccessBadge:"MainMenu_earlyAccessBadge___OMwy",pulse:"MainMenu_pulse__GbdRa",titleContainer:"MainMenu_titleContainer__QIxi8",title:"MainMenu_title__Cei1U",subTitleContainer:"MainMenu_subTitleContainer__2ERhH",subTitle:"MainMenu_subTitle__6G1CQ",titleDecoration:"MainMenu_titleDecoration__o5UCq",menuContainer:"MainMenu_menuContainer__9ZLlc",logoContainer:"MainMenu_logoContainer__3CVXg",startButton:"MainMenu_startButton__46LI8",logoImage:"MainMenu_logoImage__Yok1d",difficultyToggleGroup:"MainMenu_difficultyToggleGroup__uqB3l",difficultyToggleButton:"MainMenu_difficultyToggleButton__iLQZ9",btnText:"MainMenu_btnText__VDOoL",active:"MainMenu_active__CsNux",instructions:"MainMenu_instructions__c2fXk",instructionText:"MainMenu_instructionText__jkD7I",pulsateText:"MainMenu_pulsateText__oNHCh",statusBar:"MainMenu_statusBar__SnyFY",statusItem:"MainMenu_statusItem__P5GVn",statusLabel:"MainMenu_statusLabel__IEJpz",statusValue:"MainMenu_statusValue__UjCkv",statusDivider:"MainMenu_statusDivider__KqyiF",shipIdBadge:"MainMenu_shipIdBadge__Ssz7q",shipIdLabel:"MainMenu_shipIdLabel__xuww2",shipIdValue:"MainMenu_shipIdValue__A2cFy",cornerButtons:"MainMenu_cornerButtons__37I9i",iconButton:"MainMenu_iconButton__YUba0",gearIcon:"MainMenu_gearIcon__fmBAW",gearInner:"MainMenu_gearInner__0YZXq",creditButton:"MainMenu_creditButton__2pr2g",mascotContainer:"MainMenu_mascotContainer__n4wU2",float:"MainMenu_float__k_B8t",mascotImage:"MainMenu_mascotImage__5cdjq",wiggle:"MainMenu_wiggle__cNoa1",cornerDecoration:"MainMenu_cornerDecoration__J17N_",cornerTech:"MainMenu_cornerTech__rbYD4",cornerLine:"MainMenu_cornerLine__T5S_k",techBorder:"MainMenu_techBorder__Dwk1l",techLights:"MainMenu_techLights___S_aj",techLightBlink:"MainMenu_techLightBlink__4woEL",scanlines:"MainMenu_scanlines__lquzv",dotPattern:"MainMenu_dotPattern__UGxSb",startButtonFrame:"MainMenu_startButtonFrame__ZR_9T",frameCorner:"MainMenu_frameCorner__BQdQw",keyboardShortcuts:"MainMenu_keyboardShortcuts__rLiaa",shortcutsHeader:"MainMenu_shortcutsHeader__fAxuY",shortcutsDecoration:"MainMenu_shortcutsDecoration__DL4Jh",shortcutsList:"MainMenu_shortcutsList__1S_y4",shortcutItem:"MainMenu_shortcutItem__hjZ3G",developerOptions:"MainMenu_developerOptions__j4_99",developerOptionTitle:"MainMenu_developerOptionTitle__vgujF",optionRow:"MainMenu_optionRow__5RV_M",optionLabel:"MainMenu_optionLabel__H8c7H",optionDescription:"MainMenu_optionDescription__G6w6a",versionInfo:"MainMenu_versionInfo__PJZTR",debugInfo:"MainMenu_debugInfo__oyp7f",devButton:"MainMenu_devButton__Fv7f4",devIcon:"MainMenu_devIcon__9R6hC",blink:"MainMenu_blink__SYv53",scanline:"MainMenu_scanline__EFGIm"}}},e=>{var t=t=>e(e.s=t);e.O(0,[108,829,316,507,740,406,55,599,475,529,344,441,684,358],()=>t(8001)),_N_E=e.O()}]);