(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[950],{322:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>y});var n=r(5155),a=r(2115);let i=null,o=!1,s=!1,l=null,c=null;function u(){return"undefined"!=typeof navigator&&(o||"gpu"in navigator)}async function d(){return s?i:c||(c=(async()=>{try{if(!u())return console.warn("[WebGPU] ブラウザがWeb GPUをサポートしていません"),null;if(!(l=await navigator.gpu.requestAdapter({powerPreference:"high-performance"})))return console.warn("[WebGPU] 対応するGPUアダプターが見つかりませんでした"),null;return(i=await l.requestDevice()).lost.then(e=>{console.error("[WebGPU] デバイスが失われました: ".concat(e.message)),s=!1,i=null}),o=!0,s=!0,console.log("[WebGPU] 初期化完了:",{adapterInfo:await l.requestAdapterInfo(),features:[...i.features].join(", "),limits:{maxBindGroups:i.limits.maxBindGroups,maxStorageBufferSize:i.limits.maxStorageBufferSize,maxComputeWorkgroupSizeX:i.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:i.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:i.limits.maxComputeWorkgroupSizeZ}}),i}catch(e){return console.error("[WebGPU] 初期化エラー:",e),o=!1,s=!1,i=null,null}})())}async function h(){return i||d()}async function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=await h();if(!r)return null;let n={...{alphaMode:"premultiplied",format:"bgra8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,devicePixelRatio:window.devicePixelRatio||1},...t},a=n.devicePixelRatio,i=e.clientWidth*a,o=e.clientHeight*a;e.width=i,e.height=o;let s=e.getContext("webgpu");return s?(s.configure({device:r,format:n.format,alphaMode:n.alphaMode,usage:n.usage}),{context:s,device:r}):(console.error("[WebGPU] canvasからWebGPUコンテキストを取得できませんでした"),null)}function p(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]?arguments[3]:GPUShaderStage.FRAGMENT,e.createShaderModule({code:t})}async function g(e){var t;let r=await f(e);if(!r)return null;let{device:n,context:a}=r,i=p(n,"\n    struct VertexOutput {\n      @builtin(position) position: vec4f,\n      @location(0) color: vec4f,\n      @location(1) uv: vec2f,\n    }\n    \n    @vertex\n    fn main(\n      @location(0) position: vec2f,\n      @location(1) color: vec4f,\n      @location(2) uv: vec2f,\n    ) -> VertexOutput {\n      var output: VertexOutput;\n      output.position = vec4f(position, 0.0, 1.0);\n      output.color = color;\n      output.uv = uv;\n      return output;\n    }\n  ","main",GPUShaderStage.VERTEX),o=p(n,"\n    @fragment\n    fn main(\n      @location(0) color: vec4f,\n      @location(1) uv: vec2f,\n    ) -> @location(0) vec4f {\n      return color;\n    }\n  ","main",GPUShaderStage.FRAGMENT),s=(t={vertexShader:i,fragmentShader:o,vertexBuffers:[{arrayStride:32,attributes:[{shaderLocation:0,offset:0,format:"float32x2"},{shaderLocation:1,offset:8,format:"float32x4"},{shaderLocation:2,offset:24,format:"float32x2"}]}],format:"bgra8unorm",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}}},n.createRenderPipeline({layout:t.layout||"auto",vertex:{module:t.vertexShader,entryPoint:t.vertexEntryPoint||"main",buffers:t.vertexBuffers||[]},fragment:{module:t.fragmentShader,entryPoint:t.fragmentEntryPoint||"main",targets:t.targets||[{format:t.format||"bgra8unorm",blend:t.blend||void 0}]},primitive:t.primitive||{topology:"triangle-list",cullMode:"none"},depthStencil:t.depthStencil||void 0}));return{device:n,context:a,pipeline:s,clear:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=n.createCommandEncoder();o.beginRenderPass({colorAttachments:[{view:a.getCurrentTexture().createView(),clearValue:{r:e,g:t,b:r,a:i},loadOp:"clear",storeOp:"store"}]}).end(),n.queue.submit([o.finish()])},drawRect:function(t,r,i,o){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1,1,1],c=t/e.width*2-1,u=-(r/e.height*2-1),d=(t+i)/e.width*2-1,h=-((r+o)/e.height*2-1),f=function(e,t,r){let n=e.createBuffer({size:t.byteLength,usage:r|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});return new t.constructor(n.getMappedRange()).set(t),n.unmap(),n}(n,new Float32Array([c,u,l[0],l[1],l[2],l[3],0,0,d,u,l[0],l[1],l[2],l[3],1,0,d,h,l[0],l[1],l[2],l[3],1,1,c,u,l[0],l[1],l[2],l[3],0,0,d,h,l[0],l[1],l[2],l[3],1,1,c,h,l[0],l[1],l[2],l[3],0,1]),GPUBufferUsage.VERTEX),p=n.createCommandEncoder(),g=p.beginRenderPass({colorAttachments:[{view:a.getCurrentTexture().createView(),loadOp:"load",storeOp:"store"}]});return g.setPipeline(s),g.setVertexBuffer(0,f),g.draw(6),g.end(),n.queue.submit([p.finish()]),f},resize:()=>{let t=window.devicePixelRatio||1,r=e.clientWidth*t,i=e.clientHeight*t;return(e.width!==r||e.height!==i)&&(e.width=r,e.height=i,a.configure({device:n,format:"bgra8unorm",alphaMode:"premultiplied"}),!0)}}}var m=r(6489),x=r.n(m);let v=[["1","2","3","4","5","6","7","8","9","0","-","^","\xa5"],["q","w","e","r","t","y","u","i","o","p","@","["],["a","s","d","f","g","h","j","k","l",";",":","]"],["z","x","c","v","b","n","m",",",".","/","\\"]],w=[["1","2","3","4","5","6","7","8","9","0","-","="],["q","w","e","r","t","y","u","i","o","p","[","]"],["a","s","d","f","g","h","j","k","l",";","'","\\"],["z","x","c","v","b","n","m",",",".","/"]],b={default:[.3,.3,.3,1],highlight:[.2,.7,1,1],pressed:[0,1,.4,1],error:[1,.3,.3,1]},j=e=>{let{nextKey:t="",lastPressedKey:r="",isError:i=!1,layout:o="jp",className:s=""}=e,l=(0,a.useRef)(null),c=(0,a.useRef)(null),[d,h]=(0,a.useState)(!0),[f,p]=(0,a.useState)({width:0,height:0}),m=(0,a.useRef)(null),j=(0,a.useRef)(null),[P,_]=(0,a.useState)(""),y="jp"===o?v:w;(0,a.useEffect)(()=>{let e=u();if(h(e),!e||!l.current)return void console.warn("[WebGPUKeyboard] Web GPU がサポートされていないか、canvasが利用できません");let t=()=>{if(!l.current)return;let e=l.current.getBoundingClientRect();p({width:e.width,height:e.height})};return t(),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t),m.current&&cancelAnimationFrame(m.current),j.current&&clearTimeout(j.current)}},[]),(0,a.useEffect)(()=>{if(d&&l.current&&0!==f.width)return(async()=>{try{let e=await g(l.current);e?(c.current=e,S()):console.error("[WebGPUKeyboard] レンダラーの作成に失敗しました")}catch(e){console.error("[WebGPUKeyboard] Web GPUレンダラーの初期化エラー:",e),h(!1)}})(),()=>{}},[f,d]),(0,a.useEffect)(()=>{i&&r&&(_(r),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{_("")},300))},[i,r]),(0,a.useEffect)(()=>{c.current&&S()},[t,r,P]);let S=()=>{let e=c.current;if(!e||!l.current)return;e.clear(.15,.15,.15,1);let n=l.current,a=y.length,i=Math.max(...y.map(e=>e.length)),o=Math.min((n.width-5*(i+1))/i,(n.height-5*(a+1))/a),s=5*o,u=(n.width-s)/2,d=5*(a+1)+o*a,h=" "===t,f=" "===r,p=" "===P,g=b.default;p?g=b.error:h?g=b.highlight:f&&(g=b.pressed),e.drawRect(u,d,s,o,g),y.forEach((a,i)=>{let s=5+i*(o+5),l=a.length*o+(a.length-1)*5,c=(n.width-l)/2;a.forEach((n,a)=>{let i=c+a*(o+5),l=n.toLowerCase()===t.toLowerCase(),u=n.toLowerCase()===r.toLowerCase(),d=n.toLowerCase()===P.toLowerCase(),h=b.default;d?h=b.error:l?h=b.highlight:u&&(h=b.pressed),e.drawRect(i,s,o,o,h)})})};return d?(0,n.jsx)("canvas",{ref:l,className:"".concat(x().canvas," ").concat(s),width:f.width||600,height:f.height||200}):(0,n.jsxs)("div",{className:"".concat(x().fallback," ").concat(s),children:[(0,n.jsx)("p",{children:"Web GPUキーボードを表示できません。ブラウザが対応していない可能性があります。"}),(0,n.jsx)("p",{children:"現在のブラウザでは、従来のCanvas 2Dでキーボードを表示します。"})]})};var P=r(8750),_=r.n(P);function y(){let[e,t]=(0,a.useState)(null),[r,i]=(0,a.useState)(null),[o,s]=(0,a.useState)("a"),[l,c]=(0,a.useState)(""),[h,f]=(0,a.useState)(!1),[p,g]=(0,a.useState)("jp");return(0,a.useEffect)(()=>{(async()=>{let e=u();if(t(e),e)try{if(await d()){let e=await navigator.gpu.requestAdapter({powerPreference:"high-performance"});if(e){let t=await e.requestAdapterInfo();i(t)}}}catch(e){console.error("Web GPU初期化エラー:",e),t(!1)}})()},[]),(0,a.useEffect)(()=>{let e=e=>{let t=e.key.toLowerCase();if(c(t),t===o.toLowerCase()){let e="abcdefghijklmnopqrstuvwxyz0123456789";s(e.charAt(Math.floor(Math.random()*e.length))),f(!1)}else f(!0),setTimeout(()=>{f(!1)},300)};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[o]),(0,n.jsxs)("main",{className:_().main,children:[(0,n.jsx)("h1",{children:"Web GPU キーボードテスト"}),(0,n.jsxs)("div",{className:_().status,children:[(0,n.jsxs)("p",{children:["Web GPU対応状況: ",(0,n.jsx)("strong",{children:null===e?"確認中...":e?"対応":"非対応"})]}),e&&r&&(0,n.jsxs)("div",{className:_().adapterInfo,children:[(0,n.jsx)("h3",{children:"GPUアダプタ情報:"}),(0,n.jsxs)("ul",{children:[(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"ベンダー:"})," ",r.vendor||"不明"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"アーキテクチャ:"})," ",r.architecture||"不明"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"デバイス:"})," ",r.device||"不明"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"説明:"})," ",r.description||"情報なし"]})]})]}),!1===e&&(0,n.jsxs)("div",{className:_().warning,children:[(0,n.jsx)("p",{children:"お使いのブラウザはWeb GPUに対応していません。"}),(0,n.jsx)("p",{children:"Chrome 113以降、Edge 113以降、またはSafari 16.4以降の使用をお勧めします。"})]})]}),(0,n.jsxs)("div",{className:_().keyboardContainer,children:[(0,n.jsx)("h2",{children:"キーボードデモ"}),(0,n.jsxs)("p",{children:["次に押すキー: ",(0,n.jsx)("span",{className:_().nextKey,children:o})]}),(0,n.jsxs)("p",{children:["最後に押したキー: ",(0,n.jsx)("span",{className:_().lastKey,children:l||"(なし)"})]}),(0,n.jsxs)("div",{className:_().layoutSwitch,children:[(0,n.jsx)("button",{className:"jp"===p?_().active:"",onClick:()=>g("jp"),children:"日本語配列"}),(0,n.jsx)("button",{className:"en"===p?_().active:"",onClick:()=>g("en"),children:"英語配列"})]}),(0,n.jsx)(j,{nextKey:o,lastPressedKey:l,isError:h,layout:p,className:_().keyboard}),(0,n.jsxs)("p",{className:_().instructions,children:["キーボードを押して、ハイライトされたキーと一致するか試してみてください。",(0,n.jsx)("br",{}),"正解すると次のキーがランダムに選ばれます。"]})]}),(0,n.jsxs)("div",{className:_().performance,children:[(0,n.jsx)("h2",{children:"パフォーマンスについて"}),(0,n.jsx)("p",{children:"Web GPUは従来のCanvas 2Dと比較して、以下の点で優れています："}),(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:"GPUハードウェアアクセラレーションによる高速描画"}),(0,n.jsx)("li",{children:"多数の要素を同時描画する場合の効率的な処理"}),(0,n.jsx)("li",{children:"複雑なエフェクトやアニメーションの滑らかな表示"}),(0,n.jsx)("li",{children:"CPUリソースの節約とバッテリー効率の向上"})]}),(0,n.jsx)("p",{children:"タイピングゲームでは、多数のキーの状態変化や色の変更が高速に行われるため、 Web GPUの利点を活かすことができます。"})]})]})}},6489:e=>{e.exports={canvas:"WebGPUKeyboard_canvas__ZRH1a",fallback:"WebGPUKeyboard_fallback__xVBqm"}},7247:(e,t,r)=>{Promise.resolve().then(r.bind(r,322))},8750:e=>{e.exports={main:"page_main__PEJLm",status:"page_status___yzw7",adapterInfo:"page_adapterInfo__Sq1x6",warning:"page_warning__aWupO",keyboardContainer:"page_keyboardContainer__eGftM",nextKey:"page_nextKey__5jt_1",lastKey:"page_lastKey__qzxPf",layoutSwitch:"page_layoutSwitch__R5CrV",active:"page_active__THZ6W",keyboard:"page_keyboard__eShyY",instructions:"page_instructions__w3O0r",performance:"page_performance__hZNvA"}}},e=>{var t=t=>e(e.s=t);e.O(0,[37,441,684,358],()=>t(7247)),_N_E=e.O()}]);