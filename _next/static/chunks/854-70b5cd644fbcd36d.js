(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[854],{173:e=>{e.exports={keyboard_container:"RetroKeyboard_keyboard_container__Lhw5O",keyboard_canvas:"RetroKeyboard_keyboard_canvas___Llte",keyboardGlow:"RetroKeyboard_keyboardGlow__LZcpr"}},528:(e,t,a)=>{"use strict";a.d(t,{Ke:()=>r,R6:()=>n,To:()=>s,_v:()=>o,aK:()=>l,hb:()=>u});let n={ANIMALS:"animals",NATURE:"nature",COLORS:"colors",FOOD:"food",TRANSPORT:"transport",ACTIVITIES:"activities",SENTENCES:"sentences",PROGRAMMING:"programming",GEOGRAPHY:"geography",SCIENCE:"science",GENERAL:"general",POSITIVE:"positive"},r={EASY:"easy",NORMAL:"normal",HARD:"hard",ALL:"all"},s=[{displayText:"笑顔",kanaText:"えがお",category:n.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"希望",kanaText:"きぼう",category:n.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"元気",kanaText:"げんき",category:n.POSITIVE,tags:["状態","ポジティブ"]},{displayText:"勇気",kanaText:"ゆうき",category:n.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"夢",kanaText:"ゆめ",category:n.POSITIVE,tags:["概念","ポジティブ"]},{displayText:"愛",kanaText:"あい",category:n.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"光",kanaText:"ひかり",category:n.POSITIVE,tags:["自然","ポジティブ"]},{displayText:"前進",kanaText:"ぜんしん",category:n.POSITIVE,tags:["行動","ポジティブ"]},{displayText:"成功",kanaText:"せいこう",category:n.POSITIVE,tags:["達成","ポジティブ"]},{displayText:"努力",kanaText:"どりょく",category:n.POSITIVE,tags:["行動","ポジティブ"]},{displayText:"信頼",kanaText:"しんらい",category:n.POSITIVE,tags:["関係","ポジティブ"]},{displayText:"感謝",kanaText:"かんしゃ",category:n.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"挑戦",kanaText:"ちょうせん",category:n.POSITIVE,tags:["行動","ポジティブ"]},{displayText:"自信",kanaText:"じしん",category:n.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"幸福",kanaText:"こうふく",category:n.POSITIVE,tags:["状態","ポジティブ"]},{displayText:"成長",kanaText:"せいちょう",category:n.POSITIVE,tags:["変化","ポジティブ"]},{displayText:"平和",kanaText:"へいわ",category:n.POSITIVE,tags:["状態","ポジティブ"]},{displayText:"安心",kanaText:"あんしん",category:n.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"笑い",kanaText:"わらい",category:n.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"喜び",kanaText:"よろこび",category:n.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"友情",kanaText:"ゆうじょう",category:n.POSITIVE,tags:["関係","ポジティブ"]},{displayText:"愛情",kanaText:"あいじょう",category:n.POSITIVE,tags:["感情","ポジティブ"]},{displayText:"誠実",kanaText:"せいじつ",category:n.POSITIVE,tags:["特性","ポジティブ"]},{displayText:"忍耐",kanaText:"にんたい",category:n.POSITIVE,tags:["特性","ポジティブ"]},{displayText:"力",kanaText:"ちから",category:n.POSITIVE,tags:["特性","ポジティブ"]},{displayText:"知恵",kanaText:"ちえ",category:n.POSITIVE,tags:["特性","ポジティブ"]},{displayText:"未来",kanaText:"みらい",category:n.POSITIVE,tags:["時間","ポジティブ"]},{displayText:"信念",kanaText:"しんねん",category:n.POSITIVE,tags:["考え","ポジティブ"]}],o=[{displayText:"今日も一日頑張ろう",kanaText:"きょうもいちにちがんばろう",category:n.POSITIVE,tags:["励まし","日常"]},{displayText:"笑顔で過ごそう",kanaText:"えがおですごそう",category:n.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"自分を信じて",kanaText:"じぶんをしんじて",category:n.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"夢に向かって進もう",kanaText:"ゆめにむかってすすもう",category:n.POSITIVE,tags:["励まし","目標"]},{displayText:"小さな幸せを大切に",kanaText:"ちいさなしあわせをたいせつに",category:n.POSITIVE,tags:["励まし","幸福"]},{displayText:"前向きな気持ちで",kanaText:"まえむきなきもちで",category:n.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"新しい挑戦を楽しもう",kanaText:"あたらしいちょうせんをたのしもう",category:n.POSITIVE,tags:["励まし","挑戦"]},{displayText:"失敗は成功のもと",kanaText:"しっぱいはせいこうのもと",category:n.POSITIVE,tags:["格言","励まし"]},{displayText:"努力は必ず報われる",kanaText:"どりょくはかならずむくわれる",category:n.POSITIVE,tags:["励まし","努力"]},{displayText:"一歩ずつ前進しよう",kanaText:"いっぽずつぜんしんしよう",category:n.POSITIVE,tags:["励まし","成長"]},{displayText:"心に太陽を持とう",kanaText:"こころにたいようをもとう",category:n.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"自分らしく生きよう",kanaText:"じぶんらしくいきよう",category:n.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"感謝の気持ちを忘れずに",kanaText:"かんしゃのきもちをわすれずに",category:n.POSITIVE,tags:["励まし","感謝"]},{displayText:"仲間と共に歩もう",kanaText:"なかまとともにあゆもう",category:n.POSITIVE,tags:["励まし","協力"]},{displayText:"笑う門には福来る",kanaText:"わらうかどにはふくきたる",category:n.POSITIVE,tags:["格言","ポジティブ"]},{displayText:"明日は明日の風が吹く",kanaText:"あしたはあしたのかぜがふく",category:n.POSITIVE,tags:["格言","未来"]},{displayText:"七転び八起き",kanaText:"ななころびやおき",category:n.POSITIVE,tags:["格言","挑戦"]},{displayText:"継続は力なり",kanaText:"けいぞくはちからなり",category:n.POSITIVE,tags:["格言","努力"]},{displayText:"雨降って地固まる",kanaText:"あめふってじかたまる",category:n.POSITIVE,tags:["格言","希望"]},{displayText:"思い立ったが吉日",kanaText:"おもいたったがきちじつ",category:n.POSITIVE,tags:["格言","行動"]},{displayText:"夢を持ち続けよう",kanaText:"ゆめをもちつづけよう",category:n.POSITIVE,tags:["励まし","夢"]},{displayText:"自分のペースで進もう",kanaText:"じぶんのぺーすですすもう",category:n.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"小さな一歩が大きな成果に",kanaText:"ちいさないっぽがおおきなせいかに",category:n.POSITIVE,tags:["励まし","成長"]},{displayText:"前向きな言葉を口にしよう",kanaText:"まえむきなことばをくちにしよう",category:n.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"心の声に耳を傾けよう",kanaText:"こころのこえにみみをかたむけよう",category:n.POSITIVE,tags:["励まし","自己理解"]},{displayText:"自分を大切にしよう",kanaText:"じぶんをたいせつにしよう",category:n.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"新しい自分に出会おう",kanaText:"あたらしいじぶんにであおう",category:n.POSITIVE,tags:["励まし","成長"]},{displayText:"可能性は無限大",kanaText:"かのうせいはむげんだい",category:n.POSITIVE,tags:["励まし","可能性"]},{displayText:"変化を楽しもう",kanaText:"へんかをたのしもう",category:n.POSITIVE,tags:["励まし","変化"]},{displayText:"自分の道を信じて",kanaText:"じぶんのみちをしんじて",category:n.POSITIVE,tags:["励まし","自己肯定"]}],l=[{displayText:"失敗は成功のもと",kanaText:"しっぱいはせいこうのもと",category:n.POSITIVE,tags:["格言","励まし"]},{displayText:"継続は力なり",kanaText:"けいぞくはちからなり",category:n.POSITIVE,tags:["格言","努力"]},{displayText:"七転び八起き",kanaText:"ななころびやおき",category:n.POSITIVE,tags:["格言","挑戦"]},{displayText:"雨降って地固まる",kanaText:"あめふってじかたまる",category:n.POSITIVE,tags:["格言","希望"]},{displayText:"思い立ったが吉日",kanaText:"おもいたったがきちじつ",category:n.POSITIVE,tags:["格言","行動"]},{displayText:"笑う門には福来る",kanaText:"わらうかどにはふくきたる",category:n.POSITIVE,tags:["格言","ポジティブ"]},{displayText:"明日は明日の風が吹く",kanaText:"あしたはあしたのかぜがふく",category:n.POSITIVE,tags:["格言","未来"]},{displayText:"自分を信じて前に進もう",kanaText:"じぶんをしんじてまえにすすもう",category:n.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"努力は必ず報われる",kanaText:"どりょくはかならずむくわれる",category:n.POSITIVE,tags:["励まし","努力"]},{displayText:"夢を持ち続けよう",kanaText:"ゆめをもちつづけよう",category:n.POSITIVE,tags:["励まし","夢"]},{displayText:"心の声に耳を傾けよう",kanaText:"こころのこえにみみをかたむけよう",category:n.POSITIVE,tags:["励まし","自己理解"]},{displayText:"自分の可能性を信じて",kanaText:"じぶんのかのうせいをしんじて",category:n.POSITIVE,tags:["励まし","可能性"]},{displayText:"新しい挑戦を恐れずに",kanaText:"あたらしいちょうせんをおそれずに",category:n.POSITIVE,tags:["励まし","挑戦"]},{displayText:"自分の道を信じて進もう",kanaText:"じぶんのみちをしんじてすすもう",category:n.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"毎日を笑顔で過ごそう",kanaText:"まいにちをえがおですごそう",category:n.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"自分を褒めてあげよう",kanaText:"じぶんをほめてあげよう",category:n.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"新しい自分を見つけよう",kanaText:"あたらしいじぶんをみつけよう",category:n.POSITIVE,tags:["励まし","成長"]},{displayText:"自分の可能性を広げよう",kanaText:"じぶんのかのうせいをひろげよう",category:n.POSITIVE,tags:["励まし","可能性"]},{displayText:"一歩ずつ夢に近づこう",kanaText:"いっぽずつゆめにちかづこう",category:n.POSITIVE,tags:["励まし","目標"]},{displayText:"自分の心に正直に",kanaText:"じぶんのこころにしょうじきに",category:n.POSITIVE,tags:["励まし","自己理解"]},{displayText:"毎日を楽しもう",kanaText:"まいにちをたのしもう",category:n.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"自分の人生を大切に",kanaText:"じぶんのじんせいをたいせつに",category:n.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"新しい発見を楽しもう",kanaText:"あたらしいはっけんをたのしもう",category:n.POSITIVE,tags:["励まし","成長"]},{displayText:"自分の成長を感じよう",kanaText:"じぶんのせいちょうをかんじよう",category:n.POSITIVE,tags:["励まし","成長"]},{displayText:"未来は自分の手で切り開こう",kanaText:"みらいはじぶんのてできりひらこう",category:n.POSITIVE,tags:["励まし","未来"]},{displayText:"困難は成長のチャンス",kanaText:"こんなんはせいちょうのちゃんす",category:n.POSITIVE,tags:["励まし","成長"]},{displayText:"自分の夢を信じて進もう",kanaText:"じぶんのゆめをしんじてすすもう",category:n.POSITIVE,tags:["励まし","夢"]},{displayText:"小さな一歩が大きな成果に",kanaText:"ちいさないっぽがおおきなせいかに",category:n.POSITIVE,tags:["励まし","成長"]},{displayText:"自分の力を信じて挑戦しよう",kanaText:"じぶんのちからをしんじてちょうせんしよう",category:n.POSITIVE,tags:["励まし","挑戦"]},{displayText:"前向きな気持ちで毎日を過ごそう",kanaText:"まえむきなきもちでまいにちをすごそう",category:n.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"自分の価値を信じて生きよう",kanaText:"じぶんのかちをしんじていきよう",category:n.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"新しい自分に出会う旅に出よう",kanaText:"あたらしいじぶんにであうたびにでよう",category:n.POSITIVE,tags:["励まし","成長"]},{displayText:"自分の可能性を信じて進もう",kanaText:"じぶんのかのうせいをしんじてすすもう",category:n.POSITIVE,tags:["励まし","可能性"]},{displayText:"毎日を大切に生きよう",kanaText:"まいにちをたいせつにいきよう",category:n.POSITIVE,tags:["励まし","日常"]},{displayText:"自分の夢を追いかけ続けよう",kanaText:"じぶんのゆめをおいかけつづけよう",category:n.POSITIVE,tags:["励まし","夢"]},{displayText:"心の中の光を信じて進もう",kanaText:"こころのなかのひかりをしんじてすすもう",category:n.POSITIVE,tags:["励まし","希望"]},{displayText:"自分の歩幅で前に進もう",kanaText:"じぶんのほはばでまえにすすもう",category:n.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"毎日を笑顔で過ごすことを忘れずに",kanaText:"まいにちをえがおですごすことをわすれずに",category:n.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"自分を大切にすることを忘れずに",kanaText:"じぶんをたいせつにすることをわすれずに",category:n.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"新しい挑戦を楽しもう",kanaText:"あたらしいちょうせんをたのしもう",category:n.POSITIVE,tags:["励まし","挑戦"]},{displayText:"自分の成長を喜ぼう",kanaText:"じぶんのせいちょうをよろこぼう",category:n.POSITIVE,tags:["励まし","成長"]},{displayText:"未来への一歩を踏み出そう",kanaText:"みらいへのいっぽをふみだそう",category:n.POSITIVE,tags:["励まし","行動"]},{displayText:"自分の可能性を信じて挑戦しよう",kanaText:"じぶんのかのうせいをしんじてちょうせんしよう",category:n.POSITIVE,tags:["励まし","挑戦"]},{displayText:"毎日を楽しむことを忘れずに",kanaText:"まいにちをたのしむことをわすれずに",category:n.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"自分の夢を追い続けよう",kanaText:"じぶんのゆめをおいつづけよう",category:n.POSITIVE,tags:["励まし","夢"]},{displayText:"心の声に従って生きよう",kanaText:"こころのこえにしたがっていきよう",category:n.POSITIVE,tags:["励まし","自己理解"]},{displayText:"自分の人生を自分らしく生きよう",kanaText:"じぶんのじんせいをじぶんらしくいきよう",category:n.POSITIVE,tags:["励まし","自己肯定"]},{displayText:"新しい自分を見つける旅に出よう",kanaText:"あたらしいじぶんをみつけるたびにでよう",category:n.POSITIVE,tags:["励まし","成長"]},{displayText:"自分の可能性を信じて未来へ進もう",kanaText:"じぶんのかのうせいをしんじてみらいへすすもう",category:n.POSITIVE,tags:["励まし","可能性"]},{displayText:"毎日を笑顔で過ごすことを心がけよう",kanaText:"まいにちをえがおですごすことをこころがけよう",category:n.POSITIVE,tags:["励まし","ポジティブ"]},{displayText:"自分を信じて前に進む勇気を持とう",kanaText:"じぶんをしんじてまえにすすむゆうきをもとう",category:n.POSITIVE,tags:["励まし","勇気"]}],i=[...s,...o,...l],c=e=>{switch(e){case r.EASY:return s;case r.NORMAL:return o;case r.HARD:return l;default:return i}},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=c(e);a&&(n=n.filter(e=>e.category===a));let r=[...n].sort(()=>Math.random()-.5);return t&&t>0&&t<r.length?r.slice(0,t):r}},854:(e,t,a)=>{"use strict";a.d(t,{A:()=>ej,w:()=>eN});var n=a(5155),r=a(2115),s=a(5561),o=a(760),l=a(2737),i=a(6646),c=a(9529),u=a(9254),d=a.n(u),m=a(6766),g=a(6527),_=a.n(g);let y=e=>{let{isOpen:t,onClose:a,title:l,children:i,size:c="medium",disableEscKey:u=!1,disableOverlayClick:d=!1,className:m=""}=e,g={base:_().modal,size:"medium"!==c?_()["modal--".concat(c)]:"",custom:m},y=(0,r.useCallback)(e=>{"Escape"===e.key&&t&&!u&&(e.preventDefault(),a())},[t,a,u]),p=(0,r.useCallback)(e=>{d||a()},[a,d]);return(0,r.useEffect)(()=>(t&&(document.addEventListener("keydown",y),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",y),document.body.style.overflow=""}),[t,y]),(0,n.jsx)(o.N,{children:t&&(0,n.jsx)("div",{className:[g.base,g.size,g.custom].filter(Boolean).join(" "),role:"dialog","aria-labelledby":"modal-title","aria-modal":"true",children:(0,n.jsx)(s.P.div,{className:_().modal__overlay,onClick:p,...{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2}},children:(0,n.jsxs)(s.P.div,{className:_().modal__content,onClick:e=>{e.stopPropagation()},...{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:400,damping:30,mass:1}},children:[(0,n.jsxs)("div",{className:_().modal__header,children:[(0,n.jsx)("h2",{className:_().modal__title,id:"modal-title",children:l}),(0,n.jsx)("button",{className:_().modal__close_button,onClick:a,"aria-label":"閉じる",children:"✕"})]}),(0,n.jsx)("div",{className:_().modal__body,children:i})]})})})})};var p=a(2574),h=a.n(p);let x={whileTap:{scale:.95},whileHover:{scale:1.05},transition:{type:"spring",stiffness:400,damping:25}},f=e=>{let{isOn:t,onToggle:a,disabled:o=!1,className:l="",onText:i="ON",offText:c="OFF"}=e,u=(0,r.useMemo)(()=>{let e=t?"toggle--on":"toggle--off";return[h().button,h().toggle,h()[e],o?h()["button--disabled"]:"",l].filter(Boolean).join(" ")},[t,o,l]);return(0,n.jsx)(s.P.button,{className:u,onClick:a,disabled:o,whileTap:o?void 0:x.whileTap,whileHover:o?void 0:x.whileHover,transition:x.transition,style:{},"aria-pressed":t,role:"switch",children:t?i:c})},S=e=>{let{variant:t="default",size:a="medium",round:o=!1,active:l=!1,icon:i,onClick:c,disabled:u=!1,className:d="",loading:m,children:g,..._}=e,y=(0,r.useMemo)(()=>{let e=["button"];return"default"!==t&&e.push("button--".concat(t)),"medium"!==a&&e.push("button--".concat(a)),o&&e.push("button--round"),l&&e.push("button--active"),m&&e.push("button--loading"),e.map(e=>h()[e]).filter(Boolean).concat(d).join(" ")},[t,a,o,l,d,m]),p=u||m,f={..._};return delete f.loading,(0,n.jsxs)(s.P.button,{className:y,onClick:c,disabled:p,whileTap:p?void 0:x.whileTap,whileHover:p?void 0:x.whileHover,transition:x.transition,style:{},...f,children:[m&&(0,n.jsx)("span",{className:h().button__spinner,children:(0,n.jsx)("span",{className:h().spinner})}),i&&(0,n.jsx)("span",{className:h().button__icon,children:i}),g]})};var b=a(6144),v=a.n(b);let k=e=>{let{className:t="",showMasterToggle:a=!0,compact:s=!1,idPrefix:o=""}=e,{soundEnabled:l,bgmEnabled:c,bgmVolume:u,sfxEnabled:d,sfxVolume:m,toggleSound:g,toggleBGM:_,toggleSFX:y,setBGMVolume:p,setSFXVolume:h,playButtonSound:x}=(0,i.yL)(),S=(0,r.useCallback)(()=>{x()},[x]),b=(0,r.useCallback)(()=>{x()},[x]),k=(0,r.useCallback)(e=>{p(parseFloat(e.target.value))},[p]),T=(0,r.useCallback)(e=>{h(parseFloat(e.target.value))},[h]),C="".concat(v().sound_settings," ").concat(t," ").concat(s?v()["sound_settings--compact"]:""),E=v().sound_settings__section,I=v().sound_settings__title,M=v().sound_settings__toggle,N=v().sound_settings__volume_control,j=v().sound_settings__volume_label,P=v().sound_settings__slider,w=v().sound_settings__volume_value;return(0,n.jsxs)("div",{className:C,"data-testid":"sound-settings",children:[a&&(0,n.jsxs)("div",{className:E,children:[(0,n.jsx)("h3",{className:I,id:"".concat(o,"sound-title"),children:"サウンド"}),(0,n.jsx)("div",{className:M,children:(0,n.jsx)(f,{isOn:l,onToggle:g,"aria-labelledby":"".concat(o,"sound-title")})})]}),(0,n.jsxs)("div",{className:E,children:[(0,n.jsx)("h3",{className:I,id:"".concat(o,"bgm-title"),children:"BGM"}),(0,n.jsx)("div",{className:M,children:(0,n.jsx)(f,{isOn:c,onToggle:_,disabled:!l,"aria-labelledby":"".concat(o,"bgm-title")})}),(0,n.jsxs)("div",{className:N,children:[(0,n.jsx)("span",{className:j,id:"".concat(o,"bgm-volume-label"),children:"音量:"}),(0,n.jsx)("input",{type:"range",min:"0",max:"1",step:"0.01",value:null!=u?u:.5,onChange:k,onMouseUp:b,onTouchEnd:b,className:P,disabled:!l||!c,"aria-labelledby":"".concat(o,"bgm-volume-label"),"aria-valuenow":Math.round((null!=u?u:.5)*100),"aria-valuemin":0,"aria-valuemax":100}),(0,n.jsxs)("span",{className:w,children:[Math.round((null!=u?u:.5)*100),"%"]})]})]}),(0,n.jsxs)("div",{className:E,children:[(0,n.jsx)("h3",{className:I,id:"".concat(o,"sfx-title"),children:"効果音"}),(0,n.jsx)("div",{className:M,children:(0,n.jsx)(f,{isOn:d,onToggle:y,disabled:!l,"aria-labelledby":"".concat(o,"sfx-title")})}),(0,n.jsxs)("div",{className:N,children:[(0,n.jsx)("span",{className:j,id:"".concat(o,"sfx-volume-label"),children:"音量:"}),(0,n.jsx)("input",{type:"range",min:"0",max:"1",step:"0.01",value:null!=m?m:1,onChange:T,onMouseUp:S,onTouchEnd:S,className:P,disabled:!l||!d,"aria-labelledby":"".concat(o,"sfx-volume-label"),"aria-valuenow":Math.round((null!=m?m:1)*100),"aria-valuemin":0,"aria-valuemax":100}),(0,n.jsxs)("span",{className:w,children:[Math.round((null!=m?m:1)*100),"%"]})]})]})]})};var T=a(8637),C=a.n(T);let E=e=>{let{credits:t,showAcknowledgements:a=!1,creditSectionClass:r,sectionTitleClass:o,creditTextClass:l,creditsListClass:i,creditsItemClass:c}=e,u={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};return(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[t.development&&(0,n.jsxs)(s.P.div,{className:r,initial:"hidden",animate:"visible",variants:u,transition:{duration:.5,delay:.1},children:[(0,n.jsx)("h3",{className:o,children:t.development.title}),t.development.credits.map((e,t)=>(0,n.jsx)("p",{className:l,children:e},"dev-".concat(t)))]}),t.design&&(0,n.jsxs)(s.P.div,{className:r,initial:"hidden",animate:"visible",variants:u,transition:{duration:.5,delay:.2},children:[(0,n.jsx)("h3",{className:o,children:t.design.title}),t.design.credits.map((e,t)=>(0,n.jsx)("p",{className:l,children:e},"design-".concat(t)))]}),t.technology&&(0,n.jsxs)(s.P.div,{className:r,initial:"hidden",animate:"visible",variants:u,transition:{duration:.5,delay:.3},children:[(0,n.jsx)("h3",{className:o,children:t.technology.title}),t.technology.credits.map((e,t)=>(0,n.jsx)("p",{className:l,children:e},"tech-".concat(t)))]}),t.resources&&(0,n.jsxs)(s.P.div,{className:r,initial:"hidden",animate:"visible",variants:u,transition:{duration:.5,delay:.4},children:[(0,n.jsx)("h3",{className:o,children:t.resources.title}),(0,n.jsx)("ul",{className:i,children:t.resources.listItems.map((e,t)=>(0,n.jsx)("li",{className:c,children:e},"resource-".concat(t)))})]}),a&&t.acknowledgements&&(0,n.jsxs)(s.P.div,{className:r,initial:"hidden",animate:"visible",variants:u,transition:{duration:.5,delay:.5},children:[(0,n.jsx)("h3",{className:o,children:t.acknowledgements.title}),(0,n.jsx)("p",{className:l,children:t.acknowledgements.text})]}),t.license&&(0,n.jsxs)(s.P.div,{className:r,initial:"hidden",animate:"visible",variants:u,transition:{duration:.5,delay:.6},style:{marginTop:"10px"},children:[(0,n.jsx)("h3",{className:o,children:t.license.title}),(0,n.jsx)("p",{className:l,children:t.license.text})]})]})};E.propTypes={credits:C().shape({development:C().shape({title:C().string.isRequired,credits:C().arrayOf(C().string).isRequired}),design:C().shape({title:C().string.isRequired,credits:C().arrayOf(C().string).isRequired}),technology:C().shape({title:C().string.isRequired,credits:C().arrayOf(C().string).isRequired}),resources:C().shape({title:C().string.isRequired,listItems:C().arrayOf(C().string).isRequired}),acknowledgements:C().shape({title:C().string.isRequired,text:C().string.isRequired}),license:C().shape({title:C().string.isRequired,text:C().string.isRequired})}).isRequired,showAcknowledgements:C().bool,creditSectionClass:C().string,sectionTitleClass:C().string,creditTextClass:C().string,creditsListClass:C().string,creditsItemClass:C().string};let I={development:{title:"企画・開発",credits:["カフェイン中毒","Google大先生"]},license:{title:"ライセンス",text:"\xa9 2024 Manaby Typing Game. All Rights Reserved."}};var M=a(9344),N=a(3055),j=a(2201);let P=()=>{let[e,t]=(0,r.useState)(!1),a=(0,r.useCallback)(()=>{t(!0)},[]),n=(0,r.useCallback)(()=>{t(!1)},[]);return{showSettingsModal:e,setShowSettingsModal:t,openSettingsModal:a,closeSettingsModal:n}},w=()=>{let{settings:e,setSettings:t}=(0,l.xg)(),{soundSystem:a,soundEnabled:o,sfxEnabled:c,bgmEnabled:u}=(0,i.yL)(),{goToScreen:g,isTransitioning:_}=eN(),p=(0,r.useRef)(null),{isActive:h,recordUXElement:x,recordGameEvent:f}=(0,M.Rz)(),[S,b]=(0,r.useState)(!1),{showSettingsModal:v,setShowSettingsModal:T,openSettingsModal:C,closeSettingsModal:w}=P();(0,r.useEffect)(()=>{h&&x({type:"component-mount",componentName:"MainMenu",timestamp:Date.now()}),a.initializeAllSounds().then(()=>{h&&f({type:"sound-system-initialized",status:"success"})}).catch(e=>{console.error("効果音の初期ロードに失敗:",e),h&&f({type:"sound-system-error",errorMessage:e.message})}),o&&u?(a.playBgm("lobby",!0),console.log("[MainMenu] BGM再生開始: soundEnabled="+o+", bgmEnabled="+u)):(a.stopBgm(),console.log("[MainMenu] BGM再生停止: soundEnabled="+o+", bgmEnabled="+u));let e=setInterval(()=>{let e=document.querySelector(".".concat(d().mainContainer));e&&setTimeout(()=>{e.classList.add(d().scanlineEffect),setTimeout(()=>{e.classList.remove(d().scanlineEffect)},1500)},3e3*Math.random())},8e3);return()=>{h&&x({type:"component-unmount",componentName:"MainMenu",timestamp:Date.now(),duration:Date.now()-performance.now()}),clearInterval(e),N.A&&"function"==typeof N.A.reset&&(console.log("[MainMenu] コンポーネントのアンマウント時にWorkerをリセットします"),N.A.reset().catch(e=>{console.warn("[MainMenu] Worker終了中にエラーが発生しました:",e)}))}},[a,o,u,h,x,f]);let R=(0,r.useCallback)(()=>{o&&c&&a.playSound("button")},[o,c,a]),A=(0,r.useCallback)(a=>{R(),h&&f({type:"difficulty-changed",previousDifficulty:e.difficulty,newDifficulty:a}),t({...e,difficulty:a})},[R,h,f,e,t]),B=(0,r.useCallback)(()=>{_||(h&&f({type:"game-started",difficulty:e.difficulty,timestamp:Date.now()}),g(l.cq.GAME))},[_,h,f,e.difficulty,g]),G=(0,r.useCallback)(()=>{R(),h&&x({type:"modal-open",modalName:"settings",timestamp:Date.now()}),C()},[R,h,x,C]),O=(0,r.useCallback)(()=>{R(),h&&x({type:"modal-open",modalName:"credits",timestamp:Date.now()}),b(!0)},[R,h,x]),D=(0,r.useCallback)(()=>{R(),h&&x({type:"modal-close",modalName:S?"credits":"settings",timestamp:Date.now()}),b(!1),v&&w()},[R,h,x,S,w,v]),L={easy:"やさしい",normal:"ふつう",hard:"むずかしい"},[V,K]=(0,r.useState)(!1);(0,r.useCallback)(()=>{R(),K(!V),h&&x({type:"menu-toggle",menuName:"difficulty-selector",state:V?"closed":"open",timestamp:Date.now()})},[R,V,h,x]),(0,r.useCallback)(e=>{R(),A(e),K(!1),h&&x({type:"menu-select",menuName:"difficulty-selector",selectedValue:e,timestamp:Date.now()})},[R,A,h,x]),(0,r.useEffect)(()=>{let e=e=>{V&&!e.target.closest(".".concat(d().difficultySelector))&&(K(!1),h&&x({type:"menu-close",menuName:"difficulty-selector",reason:"outside-click",timestamp:Date.now()}))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[V,h,x]);let F={hidden:{y:20,opacity:0},show:{y:0,opacity:1,transition:{type:"spring",stiffness:300}}},q=(0,r.useCallback)(()=>(0,n.jsxs)("div",{className:d().settingsContainer,children:[(0,n.jsxs)("div",{className:d().settingsSection,children:[(0,n.jsxs)("div",{className:d().sectionHeader,children:[(0,n.jsx)("div",{className:d().sectionDecoration}),(0,n.jsx)("h3",{className:d().sectionTitle,children:"音声設定"})]}),(0,n.jsx)("div",{className:d().settingsPanel,children:(0,n.jsx)(k,{className:d().enhancedSoundSettings,showVolumeIndicator:!0,showEffects:!0})})]}),(0,n.jsxs)("div",{className:d().settingsSection,children:[(0,n.jsx)("h3",{className:d().settingsSectionTitle,children:"パフォーマンス設定"}),(0,n.jsxs)("div",{className:d().settingsRow,children:[(0,n.jsxs)("label",{className:d().settingsLabel,children:["高パフォーマンスモード",(0,n.jsx)("small",{className:d().settingsSubLabel,children:"（入力レスポンスを最適化します）"})]}),(0,n.jsxs)("div",{className:d().settingsControl,children:[(0,n.jsx)("input",{type:"checkbox",checked:!0,disabled:!0,className:d().settingsCheckbox}),(0,n.jsx)("span",{className:d().checkboxLabel,children:"常に有効"})]})]})]}),(0,n.jsxs)("div",{className:d().keyboardShortcuts,children:[(0,n.jsxs)("div",{className:d().shortcutsHeader,children:[(0,n.jsx)("div",{className:d().shortcutsDecoration}),(0,n.jsx)("span",{children:"キーボードショートカット"})]}),(0,n.jsxs)("div",{className:d().shortcutsList,children:[(0,n.jsxs)("div",{className:d().shortcutItem,children:[(0,n.jsx)("kbd",{children:"Space"}),(0,n.jsx)("span",{children:"ゲーム開始"})]}),(0,n.jsxs)("div",{className:d().shortcutItem,children:[(0,n.jsx)("kbd",{children:"S"}),(0,n.jsx)("span",{children:"設定を開く"})]}),(0,n.jsxs)("div",{className:d().shortcutItem,children:[(0,n.jsx)("kbd",{children:"R"}),(0,n.jsx)("span",{children:"ランキング表示"})]}),(0,n.jsxs)("div",{className:d().shortcutItem,children:[(0,n.jsx)("kbd",{children:"ESC"}),(0,n.jsx)("span",{children:"メニューに戻る"})]})]})]})]}),[e.difficulty,t,A]),U=(0,r.useCallback)(()=>(0,n.jsx)(E,{credits:I,showAcknowledgements:!1,creditSectionClass:d().creditSection,sectionTitleClass:d().sectionTitle,creditTextClass:d().creditText,creditsListClass:d().creditsList,creditsItemClass:d().creditsItem}),[]);return(0,r.useEffect)(()=>{let e=e=>{if(v||S)return"Escape"===e.key?void D():void 0;!_&&(" "===e.key||"Space"===e.code?(e.preventDefault(),R(),h&&x({type:"keyboard-shortcut",key:"Space",action:"start-game",timestamp:Date.now()}),g(l.cq.GAME)):"s"!==e.key&&"S"!==e.key||e.ctrlKey||e.metaKey?"c"!==e.key&&"C"!==e.key||e.ctrlKey||e.metaKey?"r"!==e.key&&"R"!==e.key||e.ctrlKey||e.metaKey||(e.preventDefault(),R(),h&&x({type:"keyboard-shortcut",key:"R",action:"open-ranking",timestamp:Date.now()}),g(l.cq.RANKING)):(e.preventDefault(),R(),h&&x({type:"keyboard-shortcut",key:"C",action:"open-credits",timestamp:Date.now()}),b(!0)):(e.preventDefault(),R(),h&&x({type:"keyboard-shortcut",key:"S",action:"open-settings",timestamp:Date.now()}),C()))};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[_,v,S,R,h,x,g,C,D]),(0,n.jsxs)("div",{className:d().mainContainer,ref:p,children:[(0,n.jsx)(()=>(0,n.jsx)(n.Fragment,{}),{})," ",(0,n.jsxs)("div",{className:d().shipIdBadge,children:[(0,n.jsx)("div",{className:d().shipIdLabel,children:"MANABY SPACE CREW"}),(0,n.jsx)("div",{className:d().shipIdValue,children:"SRX-2025"})]}),(0,n.jsx)("div",{className:d().cornerButtons,children:(0,n.jsx)("button",{className:d().iconButton,onClick:G,"aria-label":"設定",children:(0,n.jsx)("div",{className:d().gearIcon,children:(0,n.jsx)("div",{className:d().gearInner})})})}),(0,n.jsx)(s.P.div,{className:d().mascotContainer,initial:{x:-100,opacity:0},animate:{x:0,opacity:1},transition:{type:"spring",delay:.5,duration:1},onAnimationComplete:()=>{h&&x({type:"animation-complete",elementName:"mascot",timestamp:Date.now()})},children:(0,n.jsx)("img",{src:(0,j.aF)("/images/manabymario.png"),alt:"Manaby Mario Mascot",className:d().mascotImage})}),(0,n.jsxs)(s.P.div,{className:d().menuContainer,variants:{hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1,delayChildren:.3}}},initial:"hidden",animate:"show",children:[(0,n.jsxs)(s.P.div,{className:d().titleContainer,variants:F,children:[(0,n.jsx)("h1",{className:"screen-title ".concat(d().title),children:"manaby typing"}),(0,n.jsxs)("div",{className:d().subTitleContainer,children:[(0,n.jsx)("span",{className:d().subTitle,children:"SPACE CREW TYPING MISSION"}),(0,n.jsx)("div",{className:d().titleDecoration})]})]}),(0,n.jsx)(s.P.div,{className:d().logoContainer,variants:F,whileHover:{scale:1.05},whileTap:{scale:.95},children:(0,n.jsx)("button",{className:d().startButton,onClick:B,"aria-label":"ゲームを開始する",children:(0,n.jsx)(m.default,{src:(0,j.aF)("/images/manabylogodot.png"),alt:"Start Game",width:200,height:200,className:d().logoImage,priority:!0,unoptimized:!0})})}),(0,n.jsx)(s.P.div,{className:d().difficultyToggleGroup,variants:F,children:Object.keys(L).map(t=>(0,n.jsx)("button",{className:"".concat(d().difficultyToggleButton," ").concat(e.difficulty===t?d().active:""),onClick:()=>A(t),"aria-pressed":e.difficulty===t,children:(0,n.jsx)("span",{className:d().btnText,children:L[t]})},t))}),(0,n.jsx)(s.P.div,{className:d().instructions,variants:F,children:(0,n.jsx)("div",{className:d().instructionText,children:"ロゴをクリックまたはSPACEキーでスタート！"})})]})," ",(0,n.jsx)("div",{className:d().earlyAccessBadge,"aria-label":"アーリーアクセスバージョン",children:"Early Access v0.9"}),(0,n.jsx)("button",{className:d().creditButton,onClick:O,"aria-label":"クレジット",children:(0,n.jsx)("div",{className:d().infoIcon,children:"ⓘ"})}),(0,n.jsx)(y,{isOpen:v,onClose:D,title:"設定",children:q()})," ",(0,n.jsx)(y,{isOpen:S,onClose:D,title:"クレジット",disableEscKey:!1,disableOverlayClick:!1,children:U()}),!1," "]})};var R=a(2610),A=a.n(R),B=a(2942),G=a.n(B);class O extends r.Component{static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?this.props.fallback?this.props.fallback({error:this.state.error,resetError:this.resetErrorState}):(0,n.jsx)("div",{className:G().error_boundary,children:(0,n.jsxs)("div",{className:G().error_container,children:[(0,n.jsx)("h2",{className:G().error_title,children:"予期せぬエラーが発生しました"}),(0,n.jsx)("p",{className:G().error_message,children:"申し訳ありません。プログラムの実行中に問題が発生しました。"}),(0,n.jsxs)("div",{className:G().error_actions,children:[(0,n.jsx)(S,{onClick:this.resetErrorState,variant:"primary",children:"再試行"}),this.props.onReturnToMenu&&(0,n.jsx)(S,{onClick:this.props.onReturnToMenu,variant:"secondary",children:"メニューに戻る"})]}),!1]})}):this.props.children}constructor(e){super(e),this.resetErrorState=()=>{this.setState({hasError:!1,error:null,errorInfo:null})},this.state={hasError:!1,error:null,errorInfo:null}}}function D(e){let{children:t,fallback:a}=e,{goToScreen:r}=(0,l.xg)();return(0,n.jsx)(O,{fallback:a,onReturnToMenu:()=>{r(l.cq.MAIN_MENU)},children:t})}var L=a(1774),V=a.n(L);let K=(0,r.memo)(e=>{let{text:t="",animate:a=!0,className:s=""}=e,o="string"==typeof t,l="typing-problem ".concat(A().typingProblem," ").concat(s||"").trim();return(0,n.jsx)("p",{className:l,"data-testid":"problem-display",children:(e=>{if(!e)return null;try{let t=e.split("\n");return(0,n.jsx)(n.Fragment,{children:t.map((e,a)=>(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)("span",{children:e}),a<t.length-1&&(0,n.jsx)("br",{})]},a))})}catch(t){return console.error("[ProblemDisplay] テキスト処理エラー:",t),(0,n.jsx)("span",{children:String(e||"")})}})(o?t:"")})},(e,t)=>{if(e.text!==t.text){var a,n;return console.log("[ProblemDisplay] テキストが変更されたため再レンダリング:",{prevText:(null==(a=e.text)?void 0:a.substring(0,10))+"...",newText:(null==(n=t.text)?void 0:n.substring(0,10))+"..."}),!1}return e.animate===t.animate&&e.className===t.className});a(7745);var F=a(1943),q=a.n(F);(0,r.memo)(e=>{let{char:t,state:a}=e;return(0,n.jsx)("span",{className:q()[a],children:t})}).displayName="TypingCharacter",(0,r.memo)(e=>{let{expectedKey:t,errorAnimation:a}=e;return t?(0,n.jsxs)("div",{className:"".concat(q().expectedKey," ").concat(a?q().error:""),children:["次のキー: ",(0,n.jsx)("strong",{children:t})]}):null}).displayName="ExpectedKeyDisplay",(0,r.memo)(e=>{let{progress:t}=e;return(0,n.jsx)("div",{className:q().progressContainer,children:(0,n.jsx)("div",{className:q().progressBar,style:{width:"".concat(t,"%")}})})}).displayName="ProgressBar";let U=(0,r.memo)(e=>{let{displayInfo:t,progress:a=0,errorAnimation:s=!1}=e,{typedText:o,currentChar:l,remainingText:i}=(0,r.useMemo)(()=>{let{romaji:e,typedLength:a,currentCharRomaji:n}=t;if(!e)return{typedText:"",currentChar:"",remainingText:""};let r=e.substring(0,a);return{typedText:r,currentChar:e.substring(a,a+((null==n?void 0:n.length)||1)),remainingText:e.substring(a+((null==n?void 0:n.length)||1))}},[t]);return(0,r.useMemo)(()=>t.expectedNextChar||"",[t.expectedNextChar]),(0,n.jsx)("div",{className:q().typingDisplayContainer,children:(0,n.jsxs)("div",{className:q().typingText,children:[(0,n.jsx)("span",{className:q().typed,children:o}),(0,n.jsx)("span",{className:"".concat(q().current," ").concat(s?q().errorAnimation:""),children:l}),(0,n.jsx)("span",{className:q().remaining,children:i})]})})});var H=a(173),z=a.n(H);let Y=[["1","2","3","4","5","6","7","8","9","0","-","^","\\"],["q","w","e","r","t","y","u","i","o","p","@","["],["a","s","d","f","g","h","j","k","l",";",":","]"],["z","x","c","v","b","n","m",",",".","/","\\"],[" "]],J="#FF8800",W="#00AAFF",Z=e=>{let{nextKey:t="",lastPressedKey:a="",width:s=800,height:o=300}=e,l=(0,r.useRef)(null),i=(0,r.useRef)(null),[c,u]=(0,r.useState)(null),[d,m]=(0,r.useState)(null),[g,_]=(0,r.useState)({}),[y,p]=(0,r.useState)([]),h=(0,r.useRef)(null),[x,f]=(0,r.useState)({width:0,height:0});(0,r.useMemo)(()=>({width:Math.max(45*Y[0].length-5,45*Y[1].length-5,45*Y[2].length-5,45*Y[3].length-5,250),height:45*Y.length-5}),[]);let S=(0,r.useCallback)(()=>{let e={},t=0;return Y.forEach((a,n)=>{let r=0,s=1===a.length?250:45*a.length-5,o=(x.width-s)/2;a.forEach((a,s)=>{let l=" "===a?250:40;e[a]={x:o+r,y:t,width:l,height:40,row:n,column:s},r+=l+5}),t+=45}),e},[x.width]),b=(0,r.useMemo)(()=>S(),[S]),v=(0,r.useCallback)(()=>{if(!c||!h.current)return;c.clearRect(0,0,c.canvas.width,c.canvas.height);let e=c.createLinearGradient(0,0,0,c.canvas.height);e.addColorStop(0,"rgba(0, 20, 40, 0.8)"),e.addColorStop(.5,"rgba(0, 30, 60, 0.7)"),e.addColorStop(1,"rgba(0, 20, 40, 0.8)"),c.fillStyle=e,c.fillRect(0,0,c.canvas.width,c.canvas.height),c.strokeStyle="rgba(0, 150, 255, 0.1)",c.lineWidth=.5;for(let e=0;e<c.canvas.height;e+=10)c.beginPath(),c.moveTo(0,e),c.lineTo(c.canvas.width,e),c.stroke();for(let e=0;e<c.canvas.width;e+=10)c.beginPath(),c.moveTo(e,0),c.lineTo(e,c.canvas.height),c.stroke();c.strokeStyle=J,c.lineWidth=2,c.beginPath(),c.roundRect(10,10,c.canvas.width-20,c.canvas.height-20,10),c.stroke(),c.strokeStyle=W,c.lineWidth=1,c.beginPath(),c.roundRect(15,15,c.canvas.width-30,c.canvas.height-30,8),c.stroke();let n=Math.floor((c.canvas.height-40)/20);for(let e=0;e<n;e++){let t=20+20*e;c.fillStyle=e%2==0?J:W,c.fillRect(5,t,5,30),c.fillRect(c.canvas.width-5-5,t,5,30)}Object.entries(b).forEach(e=>{let[n,r]=e,s=n.toLowerCase()===t.toLowerCase(),o=n.toLowerCase()===a.toLowerCase(),l=g[n]||{glow:0,press:0},i=15*l.glow,u=Math.min(4,Math.max(0,4*l.press));c.save(),c.shadowColor="rgba(0, 0, 0, 0.6)",c.shadowBlur=3,c.shadowOffsetX=1,c.shadowOffsetY=2,c.fillStyle="rgba(0, 0, 0, 0.4)",c.beginPath(),c.roundRect(r.x+1.5,r.y+3+u,r.width-1,r.height-u-1,6),c.fill(),c.restore();let d=c.createLinearGradient(r.x,r.y+u,r.x,r.y+r.height);if(d.addColorStop(0,"#3a3a3a"),d.addColorStop(.9,"#2d2d2d"),d.addColorStop(1,"#252525"),c.fillStyle=d,c.beginPath(),c.roundRect(r.x,r.y+u,r.width,r.height-u,6),c.fill(),c.fillStyle="rgba(255, 255, 255, 0.07)",c.beginPath(),c.roundRect(r.x+2,r.y+u+2,r.width-4,(r.height-u)*.3,4),c.fill(),s){c.save(),c.shadowColor=J,c.shadowBlur=15,c.fillStyle="rgba(255, 136, 0, 0.8)";let e=.6*i;c.beginPath(),c.roundRect(r.x-e,r.y-e+u,r.width+2*e,r.height+2*e-u,6+e),c.fill(),c.restore();let t=1.5*Math.sin(Date.now()/500)+2.5;c.strokeStyle="rgba(255, 136, 0, 0.5)",c.lineWidth=1.5,c.beginPath(),c.roundRect(r.x-t,r.y-t+u,r.width+2*t,r.height+2*t-u,6+t),c.stroke();let a=c.createLinearGradient(r.x,r.y,r.x,r.y+r.height);a.addColorStop(0,"rgba(255, 136, 0, 0.4)"),a.addColorStop(1,"rgba(255, 80, 0, 0.25)"),c.fillStyle=a,c.beginPath(),c.roundRect(r.x,r.y+u,r.width,r.height-u,6),c.fill()}else if(o&&u>0){let e=c.createLinearGradient(r.x,r.y+u,r.x,r.y+r.height);e.addColorStop(0,"rgba(70, 75, 90, 0.6)"),e.addColorStop(1,"rgba(50, 55, 65, 0.4)"),c.fillStyle=e,c.beginPath(),c.roundRect(r.x,r.y+u,r.width,r.height-u,6),c.fill(),c.strokeStyle="rgba(0, 150, 255, 0.15)",c.lineWidth=1,c.beginPath(),c.roundRect(r.x+1,r.y+u+1,r.width-2,r.height-u-2,5),c.stroke()}c.save(),s?(c.shadowColor=J,c.shadowBlur=8,c.fillStyle="#FFCC00"):c.fillStyle="#DDD",c.font='bold 18px "SF Mono", "Courier New", monospace',c.textAlign="center",c.textBaseline="middle";let m=r.y+r.height/2+u,_=" "===n?"SPACE":n.toUpperCase();if(" "===n){if(s){let e=r.y+.7*r.height+u,t=c.createLinearGradient(r.x+20,e,r.x+r.width-40,e);t.addColorStop(0,"rgba(255, 136, 0, 0.3)"),t.addColorStop(.5,"rgba(255, 136, 0, 0.7)"),t.addColorStop(1,"rgba(255, 136, 0, 0.3)"),c.fillStyle=t,c.fillRect(r.x+30,e,r.width-60,1.5)}c.fillText("SPACE",r.x+r.width/2,m)}else c.fillText(_,r.x+r.width/2,m),s&&(c.font='bold 7px "SF Mono", "Courier New", monospace',c.fillText("●●●",r.x+r.width/2,r.y+r.height-8+u));if(c.restore(),s){c.save();let e=c.createLinearGradient(r.x,r.y+r.height-1+u,r.x+r.width,r.y+r.height-1+u);e.addColorStop(0,"rgba(255, 136, 0, 0.3)"),e.addColorStop(.5,"rgba(255, 136, 0, 0.8)"),e.addColorStop(1,"rgba(255, 136, 0, 0.3)"),c.fillStyle=e,c.fillRect(r.x+2,r.y+r.height-1.5+u,r.width-4,1.5),c.restore()}if(u>0){let e=Math.min(4,u);if(c.fillStyle="rgba(0, 0, 0, 0.7)",c.beginPath(),c.moveTo(r.x,r.y+r.height),c.lineTo(r.x+r.width,r.y+r.height),c.lineTo(r.x+r.width,r.y+r.height-e),c.lineTo(r.x,r.y+r.height-e),c.fill(),c.fillStyle="rgba(0, 0, 0, 0.5)",c.beginPath(),c.moveTo(r.x+r.width,r.y+e),c.lineTo(r.x+r.width,r.y+r.height),c.lineTo(r.x+r.width-3,r.y+r.height-3),c.lineTo(r.x+r.width-3,r.y+e+3),c.fill(),l.press>.7){let e=Math.max(.1,(1-(l.press-.7)/.3)*12);c.save(),c.strokeStyle="rgba(255, 255, 255, ".concat((1-l.press)*.4,")"),c.lineWidth=1.5,c.beginPath(),c.arc(r.x+r.width/2,r.y+r.height/2+u,e,0,2*Math.PI),c.stroke(),c.strokeStyle="rgba(255, 160, 70, ".concat((1-l.press)*.3,")"),c.lineWidth=1,c.beginPath(),c.arc(r.x+r.width/2,r.y+r.height/2+u,.7*e,0,2*Math.PI),c.stroke(),c.restore()}}}),c.strokeStyle="rgba(0, 180, 255, 0.15)",c.lineWidth=1,[["q","w"],["w","e"],["e","r"],["a","s"],["s","d"],["f","g"],["z","x"],["x","c"],["c","v"],["v","b"],["g","h"],["h","j"],["j","k"],["k","l"],["y","u"],["u","i"],["i","o"],["o","p"]].forEach(e=>{let[t,a]=e,n=b[t],r=b[a];n&&r&&(c.beginPath(),c.moveTo(n.x+n.width/2,n.y+n.height/2),c.lineTo(r.x+r.width/2,r.y+r.height/2),c.stroke())}),y.length>0&&y.forEach(e=>{c.fillStyle="rgba(".concat(e.color.r,", ").concat(e.color.g,", ").concat(e.color.b,", ").concat(e.alpha,")"),c.strokeStyle="rgba(".concat(e.color.r,", ").concat(e.color.g,", ").concat(e.color.b,", ").concat(e.alpha,")"),"square"===e.type?(c.save(),c.translate(e.x,e.y),c.rotate(e.life*Math.PI),c.fillRect(-e.size/2,-e.size/2,e.size,e.size),c.restore()):"line"===e.type?(c.save(),c.lineWidth=1+Math.random(),c.beginPath(),c.moveTo(e.x,e.y),c.lineTo(e.x-Math.cos(e.angle)*e.size,e.y-Math.sin(e.angle)*e.size),c.stroke(),c.restore()):(c.beginPath(),c.arc(e.x,e.y,e.size/2,0,2*Math.PI),c.fill(),Math.random()>.8&&(c.save(),c.globalAlpha=.5*e.alpha,c.beginPath(),c.arc(e.x,e.y,e.size,0,2*Math.PI),c.stroke(),c.restore()))})},[c,b,t,a,g,d]);(0,r.useCallback)(e=>{queueMicrotask(()=>{})},[]);let k=(0,r.useCallback)(()=>{if(c){if(_(e=>{let n={...e},r=new Set;return t&&r.add(t.toLowerCase()),a&&r.add(a.toLowerCase()),Object.keys(n).forEach(e=>{let s=n[e],o=e.toLowerCase();void 0!==s.glow&&(o===t.toLowerCase()?n[e]={...s,glow:Math.min(1,s.glow+.05)}:s.glow>0&&(n[e]={...s,glow:Math.max(0,s.glow-.1)})),void 0!==s.press&&(o===a.toLowerCase()&&s.press<1?n[e]={...s,press:Math.min(1,s.press+.3)}:s.press>0?n[e]={...s,press:Math.max(0,s.press-.15)}:0!==s.press||r.has(o)||delete n[e]);let l=n[e];l&&!r.has(o)&&(0===l.glow||void 0===l.glow)&&(0===l.press||void 0===l.press)&&delete n[e]}),t&&!n[t]&&(n[t]={glow:0,press:0}),a&&!n[a]&&(n[a]={glow:0,press:1}),n}),a&&a!==d){m(a);let e=b[a];if(e){let t=e.x+e.width/2,a=e.y+e.height/2,n=[],r=25+Math.floor(10*Math.random());for(let e=0;e<r;e++){let e=Math.random()*Math.PI*2,r=2+5*Math.random(),s=Math.random()>.3?{r:220+Math.floor(35*Math.random()),g:100+Math.floor(60*Math.random()),b:Math.floor(50*Math.random())}:{r:240+Math.floor(15*Math.random()),g:200+Math.floor(55*Math.random()),b:Math.floor(80*Math.random())},o=Math.random(),l=o>.7?"square":o>.3?"circle":"line",i="line"===l?2+6*Math.random():1+3*Math.random();n.push({x:t+(Math.random()-.5)*10,y:a+(Math.random()-.5)*10,vx:Math.cos(e)*r,vy:Math.sin(e)*r,size:i,alpha:.8+.2*Math.random(),color:s,life:1,decay:.008+.02*Math.random(),type:l,angle:e})}p(e=>[...e,...n])}}v(),p(e=>0===e.length?e:e.map(e=>"line"===e.type?{...e,x:e.x+1.2*e.vx,y:e.y+1.2*e.vy,vy:e.vy+.03,size:.97*e.size,alpha:.94*e.alpha,life:e.life-e.decay}:{...e,x:e.x+e.vx,y:e.y+e.vy,vx:.98*e.vx,vy:.98*e.vy+.07,size:"square"===e.type?e.size*(1-2*e.decay):e.size*(e.life>.5?1.01:.98),alpha:.95*e.alpha,life:e.life-e.decay}).filter(e=>e.life>0&&e.x>-50&&e.x<c.canvas.width+50&&e.y>-50&&e.y<c.canvas.height+50)),Date.now()%5e3<16&&_(e=>{let n={...e};return Object.keys(n).forEach(e=>{let r=e.toLowerCase();if(r!==t.toLowerCase()&&r!==a.toLowerCase()){let t=n[e];(0===t.press||void 0===t.press)&&(0===t.glow||void 0===t.glow)&&delete n[e]}}),n}),i.current=requestAnimationFrame(k)}},[c,v,t,a,d]);return(0,r.useEffect)(()=>{if(!l.current)return;let e=l.current.getContext("2d");return e&&u(e),()=>{i.current&&cancelAnimationFrame(i.current)}},[]),(0,r.useEffect)(()=>{if(!h.current)return;let e=()=>{if(!h.current)return;let e=h.current.getBoundingClientRect();f({width:e.width,height:e.height})},t=setTimeout(e,10),a=new ResizeObserver(e);return a.observe(h.current),()=>{clearTimeout(t),h.current&&a.unobserve(h.current)}},[]),(0,r.useEffect)(()=>{if(!l.current||!c)return;let e=window.devicePixelRatio||1;l.current.width=x.width*e,l.current.height=x.height*e,c.scale(e,e),l.current.style.width="".concat(x.width,"px"),l.current.style.height="".concat(x.height,"px")},[c,x]),(0,r.useEffect)(()=>{},[a]),(0,r.useEffect)(()=>{if(c)return i.current=requestAnimationFrame(k),()=>{i.current&&cancelAnimationFrame(i.current)}},[c,k]),(0,n.jsx)("div",{ref:h,className:z().keyboard_container,style:{width:"100%",height:"".concat(o,"px")},children:(0,n.jsx)("canvas",{ref:l,className:z().keyboard_canvas,style:{width:"100%",height:"100%"}})})};var X=a(2494),Q=a.n(X);let $=e=>{var t,a,s,o,l,i,c,u,d,m;let{typing:g,currentProblem:_,lastPressedKey:y="",className:p=""}=e,h=function(e){for(var t=arguments.length,a=Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n]},[x,f]=(0,r.useState)({romaji:"",typedLength:0,currentCharIndex:0,hasError:!1,lastUpdated:Date.now()}),S=(0,r.useMemo)(()=>{if(!g||"function"!=typeof g.getNextKey)return"";try{let e=g.getNextKey()||"";return h("次のキー:",e),e}catch(e){return console.error("[TypingArea] 次のキー取得エラー:",e),""}},[g,!1,null==g||null==(t=g.displayInfo)?void 0:t.currentCharIndex,null==g||null==(a=g.displayInfo)?void 0:a.typedLength]);if((0,r.useEffect)(()=>{if(!g)return void h("typingオブジェクトがありません");if(!g.displayInfo)return void h("表示情報が見つかりません");try{let{romaji:e="",typedLength:t=0,currentCharIndex:a=0,currentInput:n="",currentCharRomaji:r="",expectedNextChar:s=""}=g.displayInfo,o="string"==typeof e;h("表示データ更新:",{romaji:o?e.substring(0,20)+(e.length>20?"...":""):"<無効>",typedLength:t,currentCharIndex:a,currentInput:n,expectedNextChar:s,valid:o}),f({romaji:e||"",typedLength:t||0,currentCharIndex:a||0,currentInput:n||"",currentCharRomaji:r||"",expectedNextChar:s||"",hasError:!1,lastUpdated:Date.now()})}catch(e){console.error("[TypingArea] 表示データ更新エラー:",e),f(t=>({...t,hasError:!0,errorMessage:e.message,lastUpdated:Date.now()}))}},[null==g||null==(s=g.displayInfo)?void 0:s.romaji,null==g||null==(o=g.displayInfo)?void 0:o.typedLength,null==g||null==(l=g.displayInfo)?void 0:l.currentCharIndex,null==g||null==(i=g.displayInfo)?void 0:i.currentInput,null==g||null==(c=g.displayInfo)?void 0:c.currentCharRomaji,null==g||null==(u=g.displayInfo)?void 0:u.expectedNextChar]),!g)return h("typingオブジェクトがありません"),(0,n.jsx)("div",{className:"".concat(Q().typing_area," ").concat(p||""),children:(0,n.jsx)("div",{className:Q().typing_loading,children:"読み込み中..."})});if(!_)return h("問題データがありません"),(0,n.jsx)("div",{className:"".concat(Q().typing_area," ").concat(p||""),children:(0,n.jsx)("div",{className:Q().typing_loading,children:"問題を読み込み中..."})});let b=(null==g?void 0:g.errorAnimation)?Q().typing_area__problem_error:"",v={romaji:x.romaji||"",typedLength:x.typedLength||0,currentCharIndex:x.currentCharIndex||0,expectedNextChar:x.expectedNextChar||"",currentInput:x.currentInput||(null==g||null==(d=g.displayInfo)?void 0:d.currentInput)||"",currentCharRomaji:x.currentCharRomaji||(null==g||null==(m=g.displayInfo)?void 0:m.currentCharRomaji)||""},k=x.hasError||(null==g?void 0:g.errorAnimation);return(0,n.jsxs)("div",{className:"".concat(Q().typing_area," ").concat(p||""),children:[(0,n.jsxs)("div",{className:Q().typing_area__problem,"data-error":k?"true":"false",children:[(0,n.jsx)(K,{text:(null==_?void 0:_.displayText)||"表示するお題がありません",animate:!1,className:b},"problem-".concat((null==_?void 0:_.displayText)||"default")),(0,n.jsx)(U,{displayInfo:v,errorAnimation:k})]}),(0,n.jsx)("div",{className:Q().typing_area__keyboard_container,children:(0,n.jsx)(Z,{nextKey:v.expectedNextChar||S,lastPressedKey:y})})]})};var ee=a(7785),et=a.n(ee);let ea=r.memo(e=>{let{solvedCount:t=0,requiredCount:a=5,typingStats:s={},className:o="",scoreInfo:l={}}=e,{score:i=0,combo:c=0,maxCombo:u=0,rank:d="F"}=(0,r.useMemo)(()=>l||{},[l]),m=c>=2;return(0,r.useMemo)(()=>m?1+Math.min(c/20,.5):1,[c,m]),(0,r.useMemo)(()=>{var e;switch((null==d||null==(e=d.toUpperCase)?void 0:e.call(d))||"F"){case"SSS":return et().rank_sss;case"SS":return et().rank_ss;case"S+":case"S":return et().rank_s;case"A+":case"A":return et().rank_a;case"B+":case"B":return et().rank_b;case"C+":case"C":return et().rank_c;case"D+":case"D":return et().rank_d;default:return""}},[d]),(0,n.jsx)("header",{className:"".concat(et().status_bar," ").concat(o," ").concat(et().empty_bar," ").concat(et().fade_in),children:(0,n.jsx)("div",{className:et().logo_container,children:(0,n.jsx)("img",{src:(0,j.aF)("/images/manaby01_.png"),alt:"manaby ロゴ",className:"".concat(et().manaby_logo," ").concat(et().logo_animation),title:"manaby - 就労支援",loading:"eager",width:35,height:35})})})});ea.displayName="GameStatusBar",a(1427);var en=a(6786),er=a(528);let es=new Set;function eo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{difficulty:t=er.Ke.ALL,category:a=null,excludeRecent:n=[],useMemory:r=!0}=e;console.log("[ProblemSelector] 問題選択:",{指定された難易度:t,カテゴリ:a||"指定なし",除外数:n.length,難易度設定値チェック:{ALL:er.Ke.ALL,EASY:er.Ke.EASY,NORMAL:er.Ke.NORMAL,HARD:er.Ke.HARD,入力値との一致:{ALL:t===er.Ke.ALL,EASY:t===er.Ke.EASY,NORMAL:t===er.Ke.NORMAL,HARD:t===er.Ke.HARD}}});let s=[];(t===er.Ke.EASY||t===er.Ke.ALL)&&(s=s.concat(er.To),console.log("[ProblemSelector] EASY問題を追加:",er.To.length)),(t===er.Ke.NORMAL||t===er.Ke.ALL)&&(s=s.concat(er._v),console.log("[ProblemSelector] NORMAL問題を追加:",er._v.length)),(t===er.Ke.HARD||t===er.Ke.ALL)&&(s=s.concat(er.aK),console.log("[ProblemSelector] HARD問題を追加:",er.aK.length)),console.log("[ProblemSelector] 難易度「".concat(t,"」の選択可能な問題数:"),s.length),a&&"all"!==a&&(s=s.filter(e=>e.category===a));let o=new Set(n);r&&es.forEach(e=>o.add(e));let l=s.filter(e=>!o.has(e.displayText));if(0===l.length)return console.warn("候補問題がないため、全問題から選択します"),el(s)||ei();let i=el(l)||ei();if(r&&i){if(es.size>=15){let e=Array.from(es)[0];es.delete(e)}es.add(i.displayText)}return i}function el(e){if(!e||0===e.length)return null;let t=Math.floor(Math.random()*e.length);return e[t]}function ei(){return{displayText:"問題を読み込めません",kanaText:"もんだいをよみこめません",category:er.R6.GENERAL}}var ec=a(9980);let eu=()=>{var e;let{gameState:t}=(0,l.xg)(),{goToScreen:a}=eN(),[s,o]=(0,r.useState)({}),[i,u]=(0,r.useState)(""),{typing:d,typingRef:m,performanceMetrics:g,getNextKey:_,gameState:y,scoreInfo:p}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{onDebugInfoUpdate:t=null,onLastPressedKeyChange:a=null,goToScreen:n}=e||{},s=(0,r.useCallback)(function(e){for(var t=arguments.length,a=Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n]},[!1]),{gameState:o}=(0,l.xg)(),[i,u]=(0,r.useState)({score:0,combo:0,maxCombo:0,rank:"F"}),[d,m]=(0,r.useState)(null);(0,r.useRef)({solvedCount:0,requiredProblemCount:0,lastUpdated:Date.now()});let g=(0,r.useRef)({lastKeyPressTime:0,inputLatency:0,frameDrops:0,totalKeyPresses:0}),_=(0,r.useRef)(null);(0,r.useRef)(!1);let[y,p]=(0,r.useState)(""),{setGameState:h}=(0,l.xg)(),x=(0,r.useCallback)(e=>{var t,a,r,i,c,u,g,_,y,p,x,S,b,v,k,T,C,E,I,M,N,j;let P=o.solvedCount+1;if(s("問題完了",{typingStats:e,newSolvedCount:P}),P>=o.requiredProblemCount){let e=Date.now(),s=o.startTime||(null==(r=f.typingStats)||null==(a=r.statsRef)||null==(t=a.current)?void 0:t.startTime)||e,d=e-s,m=0,k=[...o.problemKPMs||[],(null==f||null==(c=f.typingStats)||null==(i=c.displayStats)?void 0:i.kpm)||0].filter(e=>e>0);m=k&&k.length>0?k.reduce((e,t)=>e+t,0)/k.length:Math.floor(((null==f||null==(v=f.typingStats)||null==(b=v.statsRef)||null==(S=b.current)?void 0:S.correctKeyCount)||0)/(d/6e4));let T=(null==f||null==(_=f.typingStats)||null==(g=_.statsRef)||null==(u=g.current)?void 0:u.correctKeyCount)||0,C=(null==f||null==(x=f.typingStats)||null==(p=x.statsRef)||null==(y=p.current)?void 0:y.mistakeCount)||0,E=(o.totalCorrectKeys||0)+T,I=(o.totalMissKeys||0)+C,M=E+I,N=M>0?Math.round(E/M*100):100;h(t=>({...t,solvedCount:P,isGameClear:!0,problemKPMs:k,startTime:s,endTime:e,totalCorrectKeys:E,totalMissKeys:I,stats:{kpm:Math.round(10*m)/10,correctCount:E,missCount:I,accuracy:N,rank:ec.A.getRank(m)||"F",problemKPMs:k,elapsedTimeMs:d,totalTime:d/1e3,solvedProblems:P}})),window.lastResultTransition=Date.now(),setTimeout(()=>{n(l.cq.RESULT,{playSound:!0,soundType:"result",gameState:{}})},300)}else{let e=(null==f||null==(T=f.typingStats)||null==(k=T.displayStats)?void 0:k.kpm)||0,t=(null==f||null==(I=f.typingStats)||null==(E=I.statsRef)||null==(C=E.current)?void 0:C.correctKeyCount)||0,a=(null==f||null==(j=f.typingStats)||null==(N=j.statsRef)||null==(M=N.current)?void 0:M.mistakeCount)||0,n=[...o.problemKPMs||[],e].filter(e=>e>0);h(e=>({...e,solvedCount:P,problemKPMs:n,totalCorrectKeys:(e.totalCorrectKeys||0)+t,totalMissKeys:(e.totalMissKeys||0)+a})),queueMicrotask(()=>{try{let e=eo({difficulty:o.difficulty,category:o.category,excludeRecent:[null==d?void 0:d.displayText]});m(e),(null==f?void 0:f.setProblem)&&f.setProblem(e)}catch(e){console.error("[GameController] 問題設定エラー:",e)}})}},[o,d,h,n]),f=(0,en.j)({initialProblem:d,playSound:!0,soundSystem:c.A,onProblemComplete:x,onDebugInfoUpdate:t});_.current=f,(0,r.useEffect)(()=>{if(!f||!f.typingSession)return;let e=setInterval(()=>{try{var e,t,a,n,r;let s=null==f?void 0:f.typingSession,o=(null==s||null==(e=s.getCombo)?void 0:e.call(s))||0,l=(null==s||null==(t=s.getMaxCombo)?void 0:t.call(s))||0,i=(null==f?void 0:f.scoreData)||{},c=(null==i?void 0:i.score)||0,d=(null==f||null==(a=f.displayStats)?void 0:a.rank)||(null==f||null==(r=f.typingStats)||null==(n=r.displayStats)?void 0:n.rank)||"F";u({score:c,combo:o,maxCombo:l,rank:d})}catch(e){console.error("[GameController] スコア情報更新エラー:",e)}},50);return()=>{clearInterval(e)}},[f,!1,s]);let S=(0,r.useCallback)(e=>{if(null==e?void 0:e.key){if("Escape"===e.key)return void n(l.cq.MAIN_MENU,{playSound:!0,soundType:"button"});if(a&&(p(e.key),queueMicrotask(()=>{a(e.key)})),!f||!f.typingSession)return void s("タイピングセッションがありません - 入力を無視します");try{let t=f.handleInput(e.key);queueMicrotask(()=>{g.current.totalKeyPresses++,g.current.lastKeyPressTime=Date.now()}),(null==t?void 0:t.success)&&e.preventDefault()}catch(e){}}},[f,n,a]),b=(0,r.useCallback)(()=>{var e;return(null==f||null==(e=f.typingSession)?void 0:e.getCurrentExpectedKey())||""},[f]);return(0,r.useEffect)(()=>(window.addEventListener("keydown",S),()=>{window.removeEventListener("keydown",S),N.A&&"function"==typeof N.A.reset&&(console.log("[GameController] コンポーネントのアンマウント時にWorkerをリセットします"),N.A.reset().catch(e=>{console.warn("[GameController] Worker終了中にエラーが発生しました:",e)}))}),[S]),(0,r.useEffect)(()=>{if(!d){let e=eo({difficulty:o.difficulty,category:o.category});m(e),e&&(null==f?void 0:f.setProblem)&&setTimeout(()=>{f.setProblem(e)},20)}},[o.difficulty,o.category,d,f]),{typing:f,typingRef:_,currentProblem:d,gameState:o,gameState:{currentProblem:d},scoreInfo:i,getNextKey:b,performanceMetrics:{get inputLatency(){return g.current.inputLatency},get lastKeyPressTime(){return g.current.lastKeyPressTime}}}}({onDebugInfoUpdate:null,onLastPressedKeyChange:u,goToScreen:a});!function(e,t,a){(0,r.useEffect)(()=>{if(!0===e.isGameClear){let e=window.lastResultTransition||0,a=Date.now();a-e>500&&(window.lastResultTransition=a,setTimeout(()=>{t(l.cq.RESULT,{playSound:!0,gameState:{}})},250))}},[e,t,a])}(t,a,m);let h=(0,r.useCallback)(()=>{a(l.cq.MAIN_MENU,{playSound:!0,soundType:"button"})},[a]);return((0,r.useEffect)(()=>{let e=e=>{"Escape"===e.key&&h()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[h]),!0===t.isGameClear)?null:(0,n.jsx)(D,{children:(0,n.jsx)("div",{className:A().typing_game__wrapper,children:(0,n.jsxs)("div",{className:A().typing_game,children:[" ",(0,n.jsx)(ea,{solvedCount:t.solvedCount,requiredCount:t.requiredProblemCount||5,typingStats:(null==d?void 0:d.stats)||{},scoreInfo:p})," ",(0,n.jsxs)("main",{className:A().typing_game__main,children:[" "," ",(0,n.jsx)($,{typing:d,currentProblem:(null==d||null==(e=d.typingSession)?void 0:e.problem)||(null==y?void 0:y.currentProblem)||t.currentProblem,lastPressedKey:i,className:A().typing_game__typing_area}),!1," "]}),(0,n.jsxs)("button",{onClick:h,className:A().typing_game__menu_button,children:[(0,n.jsx)("span",{children:"Esc:"})," メニュー"]})]})})})};var ed=a(2937),em=a.n(ed);let eg=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=e_(),a=e.kpm||0,n=ec.A.getRank?ec.A.getRank(a):"F",r={username:e.username||"Anonymous",kpm:parseFloat(a)||0,rank:n,accuracy:parseFloat(e.accuracy)||0,correctCount:e.correctCount||0,missCount:e.missCount||0,difficulty:e.difficulty||"normal",date:e.timestamp?new Date(e.timestamp).toISOString():new Date().toISOString()};t.unshift(r);let s=t.slice(0,10);return localStorage.setItem("typingGameRecords",JSON.stringify(s)),console.log("ゲーム記録を保存しました。残り記録数: ".concat(s.length,"/10")),ey(r),!0}catch(e){return console.error("記録の保存中にエラーが発生しました:",e),!1}},e_=()=>{try{let e=localStorage.getItem("typingGameRecords");return e?JSON.parse(e):[]}catch(e){return console.error("記録の取得中にエラーが発生しました:",e),[]}},ey=e=>{try{var t,a;let n=ep(),r=e.difficulty,s=!1;e.kpm>((null==(t=n[r])?void 0:t.kpm)||0)&&(n[r]={...n[r],kpm:e.kpm,date:e.date},s=!0),e.accuracy>((null==(a=n[r])?void 0:a.accuracy)||0)&&(n[r]={...n[r],accuracy:e.accuracy,date:e.date},s=!0),s&&localStorage.setItem("typingGameHighScores",JSON.stringify(n))}catch(e){console.error("ハイスコア更新中にエラーが発生しました:",e)}},ep=()=>{try{let e=localStorage.getItem("typingGameHighScores");return e?JSON.parse(e):{}}catch(e){return console.error("ハイスコアの取得中にエラーが発生しました:",e),{}}},eh=e=>{var t;let{stats:a,onClickRetry:o,onClickMenu:i,onClickRanking:u,playSound:d=!0}=e,{goToScreen:m}=eN(),{gameState:g}=(0,l.xg)();(0,r.useEffect)(()=>{console.log("ResultScreen: 受け取ったstats",a),console.log("ResultScreen: gameStateからのstats",null==g?void 0:g.stats);let e=a||(null==g?void 0:g.stats);if(console.log("ResultScreen: 使用する統計情報",e),e&&void 0!==e.kpm&&0!==e.kpm||console.warn("ResultScreen: statsデータが不足しているか、KPMが0です",e),e&&e.kpm>0)try{eg({username:"Player",kpm:e.kpm,correctCount:e.correctCount||0,missCount:e.missCount||0,accuracy:e.accuracy||0,timestamp:Date.now()}),console.log("ResultScreen: ローカルランキングにスコアを保存しました")}catch(e){console.error("ResultScreen: ランキング保存でエラーが発生しました:",e)}else console.log("ResultScreen: スコアデータが無いためランキング保存をスキップします")},[a,g]);let _=(0,r.useCallback)(()=>{console.log("メニューに戻ります"),"function"==typeof i?i():m(l.cq.MAIN_MENU,{playSound:!0})},[i,m]);(0,r.useEffect)(()=>{let e=e=>{"Escape"===e.key&&(console.log("ResultScreen: Escキーが押されました: メニューに戻ります"),e.preventDefault(),e.stopPropagation(),_())};return window.addEventListener("keydown",e,{capture:!0}),()=>{window.removeEventListener("keydown",e,{capture:!0})}},[_]),(0,r.useEffect)(()=>{if(d)try{console.log("ResultScreen: 結果画面の効果音を再生します"),c.A.sfxBuffers.complete?c.A.play("complete"):c.A.loadSound("complete",(0,j.aF)("/sounds/resultsound.mp3")).then(()=>c.A.play("complete")).catch(e=>console.error("効果音のロードに失敗しました:",e))}catch(e){console.error("効果音の再生に失敗しました:",e)}else console.log("ResultScreen: playSoundがfalseのため効果音をスキップします")},[d]);let y=e=>null==e?(console.warn("formatDecimal: 値が未定義です"),"0.0"):Number(e).toFixed(1),p={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}},h=(0,r.useMemo)(()=>{let e=a||(null==g?void 0:g.stats);return(console.log("ResultScreen: 統計データ処理:",e),e&&"object"==typeof e)?(console.log("ResultScreen: 詳細なステータスデータ",{入力されたcorrectCount:e.correctCount,入力されたmissCount:e.missCount,入力されたaccuracy:e.accuracy,解答した問題数:e.solvedProblems,残りのデータ:e}),{kpm:e.kpm||0,correctCount:"number"==typeof e.correctCount?e.correctCount:0,missCount:"number"==typeof e.missCount?e.missCount:0,accuracy:e.accuracy||0,totalTime:e.totalTime||0,elapsedTimeMs:e.elapsedTimeMs||0,rank:e.rank||"F",problemKPMs:e.problemKPMs||[],solvedProblems:e.solvedProblems}):{kpm:0,correctCount:0,missCount:0,accuracy:0,totalTime:0,elapsedTimeMs:0,rank:"F",problemKPMs:[]}},[a,null==g?void 0:g.stats]);console.log("ResultScreen: 詳細なKPM分析",{safeStatsのKPM値:h.kpm,元のstatsのKPM値:null==a?void 0:a.kpm,gameStateのKPM値:null==g||null==(t=g.stats)?void 0:t.kpm,safeStats全体:h}),h.kpm>500&&(console.warn("ResultScreen: KPM値が異常に高い値です:",h.kpm),console.warn("元の計算データ:",{correctCount:h.correctCount,elapsedTimeMs:h.elapsedTimeMs,elapsedMinutes:h.elapsedTimeMs/6e4}));let x=(0,r.useMemo)(()=>{console.log("ResultScreen: 統計情報を表示用に整形"),h.kpm>500&&console.warn("ResultScreen: KPM値が異常に高い値です:",h.kpm);let e=ec.A.getRankColor(h.rank||"F"),t=h.kpm?y(h.kpm):"0.0",a=h.accuracy?y(h.accuracy):"0.0";return{totalTime:h.totalTime?y(h.totalTime):"0.0",accuracy:a,kpm:t,correctCount:h.correctCount||0,missCount:h.missCount||0,rank:h.rank||"-",rankColor:e,problemKPMs:h.problemKPMs||[]}},[h]);return(0,n.jsxs)(s.P.div,{className:em().resultContainer,initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{delayChildren:.3,staggerChildren:.2}}},children:[(0,n.jsx)(s.P.div,{className:em().resultHeader,variants:p,children:(0,n.jsx)("h1",{className:"screen-title ".concat(em().resultTitle),children:"RESULT"})}),(0,n.jsxs)(s.P.div,{className:em().resultContent,variants:p,children:[(0,n.jsxs)(s.P.div,{className:em().rankDisplay,variants:{hidden:{scale:0,opacity:0},visible:{scale:1,opacity:1,transition:{type:"spring",stiffness:300,damping:10,delay:.5}}},children:[(0,n.jsx)("h2",{className:em().rankValue,style:{color:x.rankColor},children:x.rank}),(0,n.jsx)("p",{className:em().rankLabel,children:"YOUR RANK"}),(0,n.jsx)("div",{className:em().rankBackdrop})]}),(0,n.jsxs)(s.P.div,{className:em().statsContainer,variants:p,children:[(0,n.jsxs)(s.P.div,{className:"".concat(em().statCard," ").concat(em().keyStatCard),whileHover:{scale:1.05},transition:{type:"spring",stiffness:300,damping:15},children:[(0,n.jsx)("div",{className:em().statLabel,children:"KPM"}),(0,n.jsx)("div",{className:em().statValue,children:x.kpm})]}),(0,n.jsxs)(s.P.div,{className:"".concat(em().statCard," ").concat(em().keyStatCard),whileHover:{scale:1.05},transition:{type:"spring",stiffness:300,damping:15},children:[(0,n.jsx)("div",{className:em().statLabel,children:"Accuracy"}),(0,n.jsxs)("div",{className:em().statValue,children:[x.accuracy,"%"]})]}),"          ",(0,n.jsxs)(s.P.div,{className:em().statCard,whileHover:{scale:1.03},children:[(0,n.jsx)("div",{className:em().statLabel,children:"Correct"}),(0,n.jsx)("div",{className:em().statValue,children:x.correctCount})]}),(0,n.jsxs)(s.P.div,{className:em().statCard,whileHover:{scale:1.03},children:[(0,n.jsx)("div",{className:em().statLabel,children:"Miss"}),(0,n.jsx)("div",{className:em().statValue,children:x.missCount})]}),void 0!==x.solvedProblems&&(0,n.jsxs)(s.P.div,{className:em().statCard,whileHover:{scale:1.03},children:[(0,n.jsx)("div",{className:em().statLabel,children:"Problems"}),(0,n.jsx)("div",{className:em().statValue,children:x.solvedProblems})]})]})]}),(0,n.jsxs)(s.P.div,{className:em().buttonContainer,variants:p,children:[(0,n.jsx)(s.P.button,{className:em().resultButton,onClick:e=>{e.preventDefault(),console.log("ランキングボタンがクリックされました"),"function"==typeof u?u():m(l.cq.RANKING,{playSound:!0,gameState:a})},whileHover:{scale:1.05},whileTap:{scale:.95},children:"ランキング"}),(0,n.jsx)(s.P.button,{className:em().resultButton,onClick:e=>{e.preventDefault(),console.log("リトライボタンがクリックされました"),"function"==typeof o?o():console.error("onClickRetry関数が提供されていません")},whileHover:{scale:1.05},whileTap:{scale:.95},children:"リトライ"}),(0,n.jsx)(s.P.button,{className:em().resultButton,onClick:e=>{e.preventDefault(),console.log("メニューボタンがクリックされました"),_()},whileHover:{scale:1.05},whileTap:{scale:.95},children:"メニューへ"})]})]})};var ex=a(8618),ef=a.n(ex),eS=a(4665),eb=a(5695);let ev={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}},exit:{opacity:0,transition:{duration:.3}}},ek={hidden:{y:20,opacity:0},show:{y:0,opacity:1,transition:{type:"spring",stiffness:300,damping:20}},exit:{opacity:0,y:20,transition:{duration:.2}}},eT=()=>{(0,eb.useRouter)();let{goToScreen:e}=eN(),{gameState:t}=(0,l.xg)(),[a,o]=(0,r.useState)(!1),[i,u]=(0,r.useState)(!1),[d,m]=(0,r.useState)(!1),[g,_]=(0,r.useState)({difficulty:"normal"}),[y,p]=(0,r.useState)("normal");(0,r.useEffect)(()=>{console.log("RankingScreen: 受け取ったゲーム状態データ:",t)},[t]);let[h,x]=(0,r.useState)([]),[f,b]=(0,r.useState)({}),[v,k]=(0,r.useState)([]),[T,C]=(0,r.useState)(!0),[E,I]=(0,r.useState)(!1),[M,N]=(0,r.useState)(!1),[j,P]=(0,r.useState)(""),[w,R]=(0,r.useState)({success:!1,message:""}),[A,B]=(0,r.useState)([]),[G,O]=(0,r.useState)(!1),[D,L]=(0,r.useState)(l.cq.MAIN_MENU);(0,r.useEffect)(()=>{window.history.state&&window.history.state.options&&window.history.state.options.from?L(window.history.state.options.from):L(l.cq.MAIN_MENU),c.A.resume(),(0,eS.AU)(),K(),p(g.difficulty);let e=localStorage.getItem("playerName");e&&P(e),V()},[]);let V=()=>{if(t)try{var e,a,n;let r=JSON.parse(sessionStorage.getItem("registeredGames")||"[]"),s=0;if(t.stats&&void 0!==t.stats.kpm)s=Math.floor(t.stats.kpm);else if(t.stats&&t.stats.problemStats&&t.stats.problemStats.length>0)s=Math.floor(ec.A.calculateAverageKPM(t.stats.problemStats));else if(t.problemKPMs&&t.problemKPMs.length>0){let e=t.problemKPMs.filter(e=>e>0);e.length>0&&(s=Math.floor(e.reduce((e,t)=>e+t,0)/e.length))}let o=(null==(e=t.stats)?void 0:e.accuracy)||t.accuracy||(t.correctKeyCount&&(t.mistakes||0===t.mistakes)?t.correctKeyCount/(t.correctKeyCount+t.mistakes)*100:0),l=(null==(a=t.stats)?void 0:a.missCount)||t.mistakes||0,i=(null==(n=t.stats)?void 0:n.elapsedTimeMs)||t.playTime||0,c="".concat(s,"-").concat(o.toFixed(1),"-").concat(l,"-").concat(i);r.includes(c)&&(m(!0),console.log("このスコアは既に登録済みです"))}catch(e){console.error("登録済みゲーム確認エラー:",e)}};(0,r.useEffect)(()=>{T?F():K()},[T,y]);let K=()=>{x([...e_()].sort((e,t)=>t.kpm!==e.kpm?t.kpm-e.kpm:t.accuracy!==e.accuracy?t.accuracy-e.accuracy:e.mistakes-t.mistakes)),b(ep())},F=async()=>{I(!0);try{let e=await (0,eS.R8)(y,20);console.log("Loaded ".concat(e.length," online rankings for difficulty: ").concat(y)),k(e)}catch(e){console.error("オンラインランキングの取得に失敗しました:",e)}finally{I(!1)}},q=()=>{c.A.playSound("Button");let e=!T;C(e),e?console.log("オンラインモードに切り替えました"):console.log("ローカルモードに切り替えました")},U=e=>{c.A.playSound("Button"),p(e)},H=()=>[...h].filter(e=>e.difficulty===y).sort((e,t)=>t.kpm-e.kpm).slice(0,20),z=e=>{let t=new Date(e);return"".concat(t.getMonth()+1,"/").concat(t.getDate()," ").concat(String(t.getHours()).padStart(2,"0"),":").concat(String(t.getMinutes()).padStart(2,"0"))},Y=()=>{c.A.playSound("Button"),N(!1)},J=async()=>{if(!d&&!E){if(!t)return void R({success:!1,message:"登録するスコアがありません。プレイ後に再度お試しください。"});if(!j.trim())return void R({success:!1,message:"名前を入力してください。"});I(!0);try{localStorage.setItem("playerName",j);let e=0;if(t.stats&&void 0!==t.stats.kpm)e=Math.floor(t.stats.kpm);else if(t.stats&&t.stats.problemStats&&t.stats.problemStats.length>0)e=Math.floor(ec.A.calculateAverageKPM(t.stats.problemStats));else if(t.problemKPMs&&t.problemKPMs.length>0){let a=t.problemKPMs.filter(e=>e>0);a.length>0&&(e=Math.floor(a.reduce((e,t)=>e+t,0)/a.length))}else if(t.startTime&&t.endTime&&t.correctKeyCount){let a=t.endTime-t.startTime;e=Math.floor(t.correctKeyCount/(a/6e4))}let a=t.correctKeyCount||t.stats&&t.stats.correctCount||0;e<=0&&a>0&&(e=1);let n=ec.A.getRank(e),r=0;if(t.stats&&"number"==typeof t.stats.accuracy)r=t.stats.accuracy;else if("number"!=typeof t.accuracy||isNaN(t.accuracy)){if((t.correctKeyCount>=0||t.stats&&t.stats.correctCount>=0)&&(t.mistakes>=0||0===t.mistakes||t.stats&&(t.stats.missCount>=0||0===t.stats.missCount))){let e=t.correctKeyCount||t.stats&&t.stats.correctCount||0,a=t.mistakes||t.stats&&t.stats.missCount||0,n=e+a;n>0&&(r=e/n*100)}}else r=t.accuracy;console.log("送信する統計データ:",{kpm:e,accuracy:r,rank:n}),t.correctKeyCount||t.stats&&t.stats.correctCount;let s=t.mistakes||t.stats&&t.stats.missCount||0,o=t.playTime||t.stats&&t.stats.elapsedTimeMs||0;if(await (0,eS.HI)(j,e,r,o,s,g.difficulty||"normal",n)){m(!0),R({success:!0,message:"ランキングに登録しました！"});try{let t="".concat(e,"-").concat(r.toFixed(1),"-").concat(s,"-").concat(o),a=JSON.parse(sessionStorage.getItem("registeredGames")||"[]");a.push(t),sessionStorage.setItem("registeredGames",JSON.stringify(a))}catch(e){console.error("登録済みゲームの保存に失敗:",e)}C(!0),await F()}else throw Error("登録に失敗しました")}catch(e){console.error("スコア登録エラー:",e),R({success:!1,message:"ランキング登録中にエラーが発生しました。ネットワーク接続を確認してください。"})}finally{I(!1)}}},W=async()=>{console.log("Testing Firebase connection..."),I(!0);try{let e=await (0,eS.Yl)();B(e),O(!0),console.log("Debug data loaded:",e)}catch(e){console.error("Debug error:",e)}finally{I(!1)}},Z=()=>{O(!1)};return(0,r.useEffect)(()=>{let t=t=>{"Escape"===t.key&&(t.preventDefault(),G?(c.A.playSound("Button"),Z()):M?(c.A.playSound("Button"),Y()):i||a||(c.A.playSound("Button"),o(!0),setTimeout(()=>{e(D,{playSound:!1})},300)))};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[M,G,i,a]),(0,r.useEffect)(()=>(o(!1),u(!1),()=>{o(!1),u(!1)}),[]),(0,n.jsxs)("div",{className:ef().rankingContainer,children:[(0,n.jsx)("div",{className:ef().cornerDecoration,style:{top:10,left:10},children:(0,n.jsx)("div",{className:ef().cornerTech})}),(0,n.jsx)("div",{className:ef().cornerDecoration,style:{top:10,right:10,transform:"scaleX(-1)"},children:(0,n.jsx)("div",{className:ef().cornerTech})}),(0,n.jsx)("div",{className:ef().cornerDecoration,style:{bottom:10,left:10,transform:"scaleY(-1)"},children:(0,n.jsx)("div",{className:ef().cornerTech})}),(0,n.jsx)("div",{className:ef().cornerDecoration,style:{bottom:10,right:10,transform:"scale(-1)"},children:(0,n.jsx)("div",{className:ef().cornerTech})}),(0,n.jsx)("div",{className:ef().scanlines}),(0,n.jsx)("div",{className:ef().dotPattern}),(0,n.jsx)(s.P.div,{className:ef().rankingHeader,initial:{y:-50,opacity:0},animate:{y:0,opacity:1},exit:{y:-50,opacity:0},transition:{type:"spring",damping:20,duration:.8},children:(0,n.jsx)("h1",{className:"screen-title ".concat(ef().rankingTitle),children:"RANKING"})}),(0,n.jsxs)("div",{className:ef().onlineModeToggle,style:{display:"flex",justifyContent:"center",gap:"10px",marginBottom:"15px",zIndex:10,position:"relative"},children:[(0,n.jsx)(S,{variant:T?"default":"primary",active:!T,onClick:()=>{T&&q()},size:"small",children:"ローカル"}),(0,n.jsx)(S,{variant:T?"primary":"default",active:T,onClick:()=>{T||q()},size:"small",children:"オンライン"})]}),(0,n.jsxs)("div",{className:ef().difficultyNav,children:[(0,n.jsx)(S,{className:"button--difficulty",active:"easy"===y,variant:"easy"===y?"primary":"default",onClick:()=>U("easy"),children:"やさしい"}),(0,n.jsx)(S,{className:"button--difficulty",active:"normal"===y,variant:"normal"===y?"primary":"default",onClick:()=>U("normal"),children:"普通"}),(0,n.jsx)(S,{className:"button--difficulty",active:"hard"===y,variant:"hard"===y?"primary":"default",onClick:()=>U("hard"),children:"むずかしい"})]}),(0,n.jsx)("div",{className:ef().rankingContent,children:E?(0,n.jsx)("div",{className:ef().loadingSpinner,children:"読み込み中..."}):T?(0,n.jsxs)(s.P.div,{className:ef().tableContainer,variants:ev,initial:"hidden",animate:a?"exit":"show",exit:"exit",children:[(0,n.jsxs)("table",{className:ef().rankingTable,children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"順位"}),(0,n.jsx)("th",{children:"プレイヤー"}),(0,n.jsx)("th",{children:"KPM"}),(0,n.jsx)("th",{children:"ランク"}),(0,n.jsx)("th",{children:"正解率"}),(0,n.jsx)("th",{children:"ミス"}),(0,n.jsx)("th",{children:"日付"})]})}),(0,n.jsx)("tbody",{children:v.map((e,t)=>{var a,r;return(0,n.jsxs)(s.P.tr,{variants:ek,children:[(0,n.jsx)("td",{children:t+1}),(0,n.jsx)("td",{children:e.playerName||e.username||"Anonymous"}),(0,n.jsx)("td",{children:Math.floor(e.kpm)===e.kpm?Math.floor(e.kpm):e.kpm.toFixed(1)}),(0,n.jsx)("td",{style:{color:ec.A.getRankColor(e.rank||ec.A.getRank(e.kpm))},children:e.rank||ec.A.getRank(e.kpm)}),(0,n.jsxs)("td",{children:[(void 0!==e.accuracy?e.accuracy:(null==(a=e.stats)?void 0:a.accuracy)!==void 0?e.stats.accuracy:0).toFixed(1),"%"]}),(0,n.jsx)("td",{children:e.mistakes||(null==(r=e.stats)?void 0:r.mistakes)||0}),(0,n.jsx)("td",{children:z(e.date||e.timestamp||new Date().toISOString())})]},e.id||t)})})]}),0===v.length&&(0,n.jsx)("div",{className:ef().noRecords,children:"オンラインの記録がありません"})]}):(0,n.jsxs)(s.P.div,{className:ef().tableContainer,variants:ev,initial:"hidden",animate:a?"exit":"show",exit:"exit",children:[(0,n.jsxs)("table",{className:ef().rankingTable,children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"順位"}),(0,n.jsx)("th",{children:"KPM"}),(0,n.jsx)("th",{children:"ランク"}),(0,n.jsx)("th",{children:"正解率"}),(0,n.jsx)("th",{children:"ミス"}),(0,n.jsx)("th",{children:"日付"})]})}),(0,n.jsx)("tbody",{children:H().map((e,t)=>(0,n.jsxs)(s.P.tr,{variants:ek,children:[(0,n.jsx)("td",{children:t+1}),(0,n.jsx)("td",{children:Math.floor(e.kpm)===e.kpm?Math.floor(e.kpm):e.kpm.toFixed(1)}),(0,n.jsx)("td",{style:{color:ec.A.getRankColor(e.rank||ec.A.getRank(e.kpm))},children:e.rank||ec.A.getRank(e.kpm)}),(0,n.jsxs)("td",{children:[e.accuracy.toFixed(1),"%"]}),(0,n.jsx)("td",{children:e.mistakes}),(0,n.jsx)("td",{children:z(e.date)})]},t))})]}),0===H().length&&(0,n.jsx)("div",{className:ef().noRecords,children:"記録がありません"})]})}),(0,n.jsxs)(s.P.div,{className:ef().buttonContainer,initial:{opacity:0,y:30},animate:{opacity:+!a,y:50*!!a},exit:{opacity:0,y:50},transition:{delay:.6*!a,duration:.5},children:[(0,n.jsx)(s.P.div,{whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},children:(0,n.jsx)(S,{variant:"primary",size:"medium",onClick:()=>{c.A.playSound("Button"),N(!0),R({success:!1,message:""})},disabled:!t||!t.correctKeyCount&&!t.stats||d,children:d?"すでに登録済み":"ランキング登録"})}),(0,n.jsx)(s.P.div,{whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},children:(0,n.jsx)(S,{variant:"default",size:"medium",onClick:()=>{console.log("戻るボタンがクリックされました"),a||i||(c.A.playSound("Button"),o(!0),u(!0),setTimeout(()=>{o(!1),u(!1),e(D||l.cq.MAIN_MENU,{playSound:!1})},300))},children:"戻る"})}),(0,n.jsx)(s.P.div,{whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},children:(0,n.jsx)(S,{variant:"default",size:"medium",onClick:()=>{console.log("メインメニューボタンがクリックされました"),a||i||(c.A.playSound("Button"),o(!0),u(!0),setTimeout(()=>{o(!1),u(!1),e(l.cq.MAIN_MENU,{playSound:!1})},300))},children:"メインメニュー"})}),(0,n.jsx)(s.P.div,{whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},children:(0,n.jsx)(S,{variant:"default",size:"medium",onClick:W,disabled:E,children:"接続確認"})})]}),M&&(0,n.jsx)("div",{className:ef().modalOverlay,children:(0,n.jsxs)(s.P.div,{className:ef().modalContent,initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:400,damping:30},children:[(0,n.jsx)("div",{className:ef().cornerDecoration,style:{top:10,left:10},children:(0,n.jsx)("div",{className:ef().cornerTech})}),(0,n.jsx)("div",{className:ef().cornerDecoration,style:{top:10,right:10,transform:"scaleX(-1)"},children:(0,n.jsx)("div",{className:ef().cornerTech})}),(0,n.jsx)("div",{className:ef().cornerDecoration,style:{bottom:10,left:10,transform:"scaleY(-1)"},children:(0,n.jsx)("div",{className:ef().cornerTech})}),(0,n.jsx)("div",{className:ef().cornerDecoration,style:{bottom:10,right:10,transform:"scale(-1)"},children:(0,n.jsx)("div",{className:ef().cornerTech})}),(0,n.jsx)("div",{className:ef().scanlines}),(0,n.jsx)("div",{className:ef().dotPattern}),(0,n.jsxs)("div",{className:ef().modalHeader,children:[(0,n.jsx)("h2",{className:ef().modalTitle,children:"オンラインランキング登録"}),(0,n.jsx)(S,{variant:"default",size:"small",onClick:Y,className:ef().closeButton,children:"✕"})]}),(0,n.jsxs)("div",{className:ef().modalBody,children:[(0,n.jsx)("p",{children:"名前を入力してオンラインランキングに登録しましょう！"}),w.message&&(0,n.jsx)("div",{className:"".concat(ef().statusMessage," ").concat(w.success?ef().successMessage:ef().errorMessage),children:w.message}),(0,n.jsxs)("div",{className:ef().inputGroup,children:[(0,n.jsx)("label",{htmlFor:"playerName",children:"プレイヤー名："}),(0,n.jsx)("input",{id:"playerName",type:"text",value:j,onChange:e=>{P(e.target.value)},maxLength:20,placeholder:"名前を入力（最大20文字）",disabled:E,className:ef().nameInput})]}),t&&(0,n.jsxs)("div",{className:ef().scorePreview,children:[(0,n.jsxs)("div",{className:ef().previewItem,children:[(0,n.jsx)("span",{children:"難易度:"}),(0,n.jsx)("span",{children:"easy"===g.difficulty?"やさしい":"normal"===g.difficulty?"普通":"むずかしい"})]}),(0,n.jsxs)("div",{className:ef().previewItem,children:[(0,n.jsx)("span",{children:"KPM:"}),(0,n.jsx)("span",{children:t.stats&&"number"==typeof t.stats.kpm?Math.floor(t.stats.kpm):t.problemKPMs&&t.problemKPMs.length>0?Math.floor(t.problemKPMs.filter(e=>e>0).reduce((e,t)=>e+t,0)/t.problemKPMs.filter(e=>e>0).length):0})]}),(0,n.jsxs)("div",{className:ef().previewItem,children:[(0,n.jsx)("span",{children:"ランク:"}),(0,n.jsx)("span",{style:{color:ec.A.getRankColor(ec.A.getRank(t.stats&&"number"==typeof t.stats.kpm?Math.floor(t.stats.kpm):t.problemKPMs&&t.problemKPMs.length>0?Math.floor(t.problemKPMs.filter(e=>e>0).reduce((e,t)=>e+t,0)/t.problemKPMs.filter(e=>e>0).length):0))},children:ec.A.getRank(t.stats&&"number"==typeof t.stats.kpm?Math.floor(t.stats.kpm):t.problemKPMs&&t.problemKPMs.length>0?Math.floor(t.problemKPMs.filter(e=>e>0).reduce((e,t)=>e+t,0)/t.problemKPMs.filter(e=>e>0).length):0)})]}),(0,n.jsxs)("div",{className:ef().previewItem,children:[(0,n.jsx)("span",{children:"正解率:"}),(0,n.jsx)("span",{children:t.stats&&"number"==typeof t.stats.accuracy?t.stats.accuracy.toFixed(1):t.accuracy?t.accuracy.toFixed(1):t.correctKeyCount&&(t.mistakes||0===t.mistakes)?(t.correctKeyCount/(t.correctKeyCount+t.mistakes)*100).toFixed(1):0})]})]})]}),(0,n.jsx)("div",{className:ef().modalFooter,children:(0,n.jsx)(S,{variant:"primary",size:"medium",onClick:J,loading:E,disabled:E||d||w.success,className:"".concat(ef().registerButton," ").concat(d||w.success?ef().disabledButton:""),children:w.success?"登録完了":d?"すでに登録済み":"登録"})})]})}),G&&(0,n.jsx)("div",{className:ef().modalOverlay,children:(0,n.jsxs)(s.P.div,{className:ef().modalContent,initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:400,damping:30},children:[(0,n.jsx)("div",{className:ef().cornerDecoration,style:{top:10,left:10},children:(0,n.jsx)("div",{className:ef().cornerTech})}),(0,n.jsx)("div",{className:ef().cornerDecoration,style:{top:10,right:10,transform:"scaleX(-1)"},children:(0,n.jsx)("div",{className:ef().cornerTech})}),(0,n.jsx)("div",{className:ef().cornerDecoration,style:{bottom:10,left:10,transform:"scaleY(-1)"},children:(0,n.jsx)("div",{className:ef().cornerTech})}),(0,n.jsx)("div",{className:ef().cornerDecoration,style:{bottom:10,right:10,transform:"scale(-1)"},children:(0,n.jsx)("div",{className:ef().cornerTech})}),(0,n.jsx)("div",{className:ef().scanlines}),(0,n.jsx)("div",{className:ef().dotPattern}),(0,n.jsxs)("div",{className:ef().modalHeader,children:[(0,n.jsx)("h2",{className:ef().modalTitle,children:"デバッグ情報"}),(0,n.jsx)(S,{variant:"default",size:"small",onClick:Z,className:ef().closeButton,children:"✕"})]}),(0,n.jsx)("div",{className:ef().modalBody,children:(0,n.jsx)("pre",{className:ef().debugInfo,children:JSON.stringify(A,null,2)})}),(0,n.jsx)("div",{className:ef().modalFooter,children:(0,n.jsx)(S,{variant:"primary",size:"medium",onClick:Z,className:ef().closeButton,children:"閉じる"})})]})})]})},eC={fade:{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:1.05},transition:{type:"spring",stiffness:350,damping:25,duration:.4}},gameComplete:{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1,transition:{type:"spring",stiffness:450,damping:25,duration:.4}},exit:{opacity:0,scale:1.05,transition:{duration:.2}}},menuReveal:{initial:{y:-100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{type:"spring",stiffness:500,damping:30,duration:.6}}},eE=(e,t)=>t===l.cq.RESULT?eC.gameComplete:t===l.cq.MAIN_MENU?eC.menuReveal:eC.fade,eI=e=>{let{isActive:t}=e;return(0,n.jsx)(s.P.div,{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.12)",zIndex:10,pointerEvents:"none"},initial:{opacity:0},animate:{opacity:.3*!!t},exit:{opacity:0},transition:{duration:.1}})},eM=null,eN=()=>{let{navigateTo:e}=(0,l.xg)(),[t,a]=(0,r.useState)(!1);return{goToScreen:function(n){var r;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{playSound:!0,soundType:"button",immediate:!1,gameState:null};if(t&&!s.immediate)return;let o=(null==(r=window.history.state)?void 0:r.screen)||l.cq.MAIN_MENU;if(n===l.cq.SETTINGS){try{c.A.context&&"suspended"===c.A.context.state&&c.A.context.resume(),!1!==s.playSound&&c.A.play(s.soundType||"button")}catch(e){console.error("音声再生でエラーが発生しました:",e)}e(l.cq.MAIN_MENU),setTimeout(()=>{eM&&eM.openSettingsModal()},100);return}try{c.A.context&&"suspended"===c.A.context.state&&c.A.context.resume(),!1!==s.playSound&&n!==l.cq.RESULT&&(s.from!==l.cq.GAME||n!==l.cq.MAIN_MENU)&&c.A.play(s.soundType||"button"),console.log("画面遷移を実行します:",n,"サウンド:",!1!==s.playSound?"有効 (".concat(s.soundType||"button",")"):"無効","遷移元:",s.from||o)}catch(e){console.error("音声再生でエラーが発生しました:",e)}a(!0);let i={screen:n,options:{...s,from:s.from||o}};window.history.replaceState(i,"",window.location.pathname);let u=20;(n===l.cq.RESULT||s.immediate)&&(u=0),n===l.cq.MAIN_MENU&&s.from===l.cq.RESULT&&(console.log("ResultScreenからメインメニューへの遷移を優先処理します"),u=0,a(!1)),setTimeout(()=>{s.gameState&&n===l.cq.RANKING?(console.log("ランキング画面に遷移するためのゲーム状態データ:",s.gameState),e(n,s.gameState)):e(n),setTimeout(()=>{a(!1)},200)},u)},isTransitioning:t}},ej=()=>{let{currentScreen:e,navigateTo:t,gameState:a}=(0,l.xg)(),[c,u]=(0,r.useState)(null),[d,m]=(0,r.useState)(!1),{goToScreen:g}=eN(),[_,y]=(0,r.useState)(!1),p=(0,i.yL)(),{soundEnabled:h,bgmEnabled:x,sfxEnabled:f}=p||{};null==p||p.soundSystem,eM=P(),(0,r.useEffect)(()=>{if(e===l.cq.SETTINGS&&c!==l.cq.SETTINGS&&(t(l.cq.MAIN_MENU),setTimeout(()=>{eM?(eM.openSettingsModal(),console.log("設定モーダルを開きました")):console.warn("設定モーダルコントローラが見つかりません")},100)),c!==e){m(!0);let t=setTimeout(()=>{m(!1)},200);return u(e),()=>clearTimeout(t)}},[e,c,t]),(0,r.useEffect)(()=>{null===c&&m(!1)},[c]);let S=eE(c,e);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eI,{isActive:d}),(0,n.jsx)(o.N,{mode:"wait",children:(0,n.jsx)(s.P.div,{initial:"initial",animate:"animate",exit:"exit",variants:S,style:{width:"100%",height:"100%"},children:(()=>{let{settings:t}=(0,l.xg)();switch(e){case l.cq.GAME:return(0,n.jsx)(eu,{});case l.cq.SETTINGS:return(0,n.jsx)(w,{});case l.cq.RESULT:let r=a.stats||{};return console.log("TransitionManager: ResultScreenに渡す統計データ",r),(0,n.jsx)(eh,{stats:r,onClickRetry:()=>g(l.cq.GAME,{playSound:!0}),onClickMenu:()=>g(l.cq.MAIN_MENU,{playSound:!0}),onClickRanking:()=>g(l.cq.RANKING,{playSound:!0,gameState:{stats:r}}),playSound:!0});case l.cq.RANKING:return(0,n.jsx)(eT,{});case l.cq.MAIN_MENU:default:return(0,n.jsx)(w,{})}})()},e)})]})}},1774:e=>{e.exports={performance_monitor:"PerformanceMonitor_performance_monitor__7EyTc",monitor_header:"PerformanceMonitor_monitor_header___bPVQ",title:"PerformanceMonitor_title__ushy1",indicator_light:"PerformanceMonitor_indicator_light__KP4M2",pulse:"PerformanceMonitor_pulse__jMFgr",metrics_table:"PerformanceMonitor_metrics_table__7k8Wq",normal_value:"PerformanceMonitor_normal_value__HYoiu",warning_value:"PerformanceMonitor_warning_value__8ay3m",error_value:"PerformanceMonitor_error_value__4bgVI",details_section:"PerformanceMonitor_details_section__2CiYd",details_content:"PerformanceMonitor_details_content__yMDK8",hidden:"PerformanceMonitor_hidden__nkYSc",compact:"PerformanceMonitor_compact__xlGIq",fullscreen:"PerformanceMonitor_fullscreen__OFJ80"}},1943:e=>{e.exports={typingDisplayContainer:"HighPerformanceTypingDisplay_typingDisplayContainer__QAfhB",typingText:"HighPerformanceTypingDisplay_typingText__bMWSI",typed:"HighPerformanceTypingDisplay_typed__taQiq",current:"HighPerformanceTypingDisplay_current__pI3GT",errorAnimation:"HighPerformanceTypingDisplay_errorAnimation__MbPOZ",shake:"HighPerformanceTypingDisplay_shake__QG1Ei",remaining:"HighPerformanceTypingDisplay_remaining__tea3R",expectedKey:"HighPerformanceTypingDisplay_expectedKey__QU0gB",error:"HighPerformanceTypingDisplay_error__4evz8",progressContainer:"HighPerformanceTypingDisplay_progressContainer__ZXGLh",progressBar:"HighPerformanceTypingDisplay_progressBar__sZvuT",character:"HighPerformanceTypingDisplay_character__jXWm6",correct:"HighPerformanceTypingDisplay_correct___e2uF",future:"HighPerformanceTypingDisplay_future__86EzA"}},2219:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>m});let n={SETTINGS:"typingGameSettings",IS_ADMIN:"isAdmin",BACKGROUND_IMAGE:"savedBackgroundImage",BACKGROUND_STYLE:"savedBackgroundStyle",HIGH_SCORES:"highScores",SCREEN_BACKGROUNDS:"screenBackgrounds",USER_PREFERENCES:"userPreferences",USERNAME:"username",LAST_PLAYED_DATE:"lastPlayedDate",SCREEN_SIZE:"screenSize"},r=(e,t)=>{try{let a="object"==typeof t?JSON.stringify(t):t;return localStorage.setItem(e,a),!0}catch(t){return console.error("Storage save error for key [".concat(e,"]:"),t),!1}},s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{let a=localStorage.getItem(e);if(null===a)return t;try{return JSON.parse(a)}catch(e){return a}}catch(a){return console.error("Storage get error for key [".concat(e,"]:"),a),t}},o=()=>!0===s(n.IS_ADMIN,!1),l=()=>s(n.BACKGROUND_IMAGE,null),i=()=>s(n.BACKGROUND_STYLE,null),c=e=>s(n.SCREEN_BACKGROUNDS,{})[e]||null,u=async function(){let{targetSelector:e="#__next > div",delay:t=100}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!o())return!1;try{let a=l(),n=i();if(!a&&!n)return!1;await new Promise(e=>setTimeout(e,t));let r=document.querySelector(e);if(!r)return console.warn("背景を適用する要素が見つかりませんでした: ".concat(e)),!1;return n&&Object.entries(n).forEach(e=>{let[t,a]=e;"backgroundImage"!==t&&a&&(r.style[t]=a)}),a&&(r.style.backgroundImage="url(".concat(a,")"),r.style.backgroundSize="cover",r.style.backgroundPosition="center"),!0}catch(e){return console.error("背景適用中にエラーが発生しました:",e),!1}},d=async e=>{if(!o())return!1;let t=c(e);if(!t)return u();try{let a=document.querySelector("#__next > div");if(!a)return!1;return t.imageUrl&&(a.style.backgroundImage="url(".concat(t.imageUrl,")"),a.style.backgroundSize="cover",a.style.backgroundPosition="center"),t.styleObject&&Object.entries(t.styleObject).forEach(e=>{let[t,n]=e;"backgroundImage"!==t&&n&&(a.style[t]=n)}),console.log("".concat(e,"画面用の背景を適用しました")),!0}catch(e){return console.error("画面背景適用中にエラーが発生しました:",e),!1}},m={STORAGE_KEYS:n,saveToStorage:r,getFromStorage:s,removeFromStorage:e=>{try{return localStorage.removeItem(e),!0}catch(t){return console.error("Storage remove error for key [".concat(e,"]:"),t),!1}},saveGameSettings:e=>r(n.SETTINGS,e),getGameSettings:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(n.SETTINGS,e)},isAdminMode:o,setAdminMode:e=>r(n.IS_ADMIN,e),saveBackgroundImage:e=>r(n.BACKGROUND_IMAGE,e),saveBackgroundStyle:e=>r(n.BACKGROUND_STYLE,e),getBackgroundImage:l,getBackgroundStyle:i,saveScreenBackground:(e,t)=>{let a=s(n.SCREEN_BACKGROUNDS,{});return a[e]=t,r(n.SCREEN_BACKGROUNDS,a)},getScreenBackground:c,saveUsername:e=>r(n.USERNAME,e),getUsername:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"プレイヤー";return s(n.USERNAME,e)},saveHighScore:(e,t)=>{let a=s(n.HIGH_SCORES,{});return(!a[e]||t.kpm>a[e].kpm)&&(a[e]={...t,date:new Date().toISOString()}),r(n.HIGH_SCORES,a)},getHighScore:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=s(n.HIGH_SCORES,{});return e?t[e]||null:t},saveLastPlayedDate:()=>r(n.LAST_PLAYED_DATE,new Date().toISOString()),getLastPlayedDate:()=>s(n.LAST_PLAYED_DATE,null),saveScreenSize:e=>r(n.SCREEN_SIZE,e),getScreenSize:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{width:800,height:600};return s(n.SCREEN_SIZE,e)},applyBackgroundFromStorage:u,applyScreenBackground:d}},2494:e=>{e.exports={typing_area:"TypingArea_typing_area__24oZY",typing_area__problem:"TypingArea_typing_area__problem__yfpXs",typing_area__keyboard_container:"TypingArea_typing_area__keyboard_container__DSa2u",typing_loading:"TypingArea_typing_loading__nAda1",pulse:"TypingArea_pulse__kwFfg",problem_container:"TypingArea_problem_container__DrDCR",problem_text:"TypingArea_problem_text__5ePtR",input_area:"TypingArea_input_area__GDCyp"}},2574:e=>{e.exports={button:"Button_button__qCupi","button--disabled":"Button_button--disabled__LPoAO","button--primary":"Button_button--primary__uZOtY","button--secondary":"Button_button--secondary__O_Gm8","button--danger":"Button_button--danger__5vqLf","button--success":"Button_button--success__ZB9VJ","button--small":"Button_button--small__EwPRw","button--large":"Button_button--large__Xq3St","button--round":"Button_button--round___Izcj","button--active":"Button_button--active__NcvUE",button__icon:"Button_button__icon__u_LOV",toggle:"Button_toggle__lMu2e","toggle--on":"Button_toggle--on__idOhz","toggle--off":"Button_toggle--off__i_YR2","button--menu":"Button_button--menu__AXmIR","button--difficulty":"Button_button--difficulty__6mgjA","button--control":"Button_button--control__yI0zZ","button--back":"Button_button--back__VjTxq","button--loading":"Button_button--loading__2a2Vs",button__spinner:"Button_button__spinner__K8gfm",spinner:"Button_spinner__51Com",spin:"Button_spin__ezNAC"}},2610:e=>{e.exports={typing_game__wrapper:"GameScreen_typing_game__wrapper__t9Z_q",typing_game:"GameScreen_typing_game__KJGki",typing_game__header:"GameScreen_typing_game__header__Ga3yt",typing_game__level_display:"GameScreen_typing_game__level_display__Jfh1q",typing_game__status:"GameScreen_typing_game__status__1gf4s",typing_game__status_item:"GameScreen_typing_game__status_item___24z5",typing_game__display_toggle:"GameScreen_typing_game__display_toggle__7xDSb",typing_game__back_button:"GameScreen_typing_game__back_button__EaVM_",typing_game__main:"GameScreen_typing_game__main__4y7Pv",typing_game__content:"GameScreen_typing_game__content___sSj6",typing_game__problem:"GameScreen_typing_game__problem__5a191",typing_game__keyboard:"GameScreen_typing_game__keyboard__8Cyuw",typing_game__problem_text:"GameScreen_typing_game__problem_text__mobG0",typing_game__input:"GameScreen_typing_game__input__i3j2Q",typing_game__next_char:"GameScreen_typing_game__next_char__CJep4",typing_game__completed:"GameScreen_typing_game__completed__GsVwc",errorShake:"GameScreen_errorShake__mpCyv",typing_game__menu_button:"GameScreen_typing_game__menu_button__BeIuc",typing_game__corner:"GameScreen_typing_game__corner__ZNH9_",typing_game__corner_tech:"GameScreen_typing_game__corner_tech__D_p3y",typing_game__scanlines:"GameScreen_typing_game__scanlines__JHzVF",typing_game__dot_pattern:"GameScreen_typing_game__dot_pattern__T7ekH",typing_game__performance:"GameScreen_typing_game__performance__Gbm_q",gameContainer:"GameScreen_gameContainer__nTReN GameScreen_typing_game__KJGki",gameHeader:"GameScreen_gameHeader__ZGkP6 GameScreen_typing_game__header__Ga3yt",gameArea:"GameScreen_gameArea__eDsqs GameScreen_typing_game__main__4y7Pv",typingProblem:"GameScreen_typingProblem__sx0Q3 GameScreen_typing_game__problem_text__mobG0",simpleTypingText:"GameScreen_simpleTypingText__hNzyI GameScreen_typing_game__input__i3j2Q"}},2737:(e,t,a)=>{"use strict";a.d(t,{Sj:()=>g,cq:()=>u,xg:()=>c});var n=a(5155),r=a(2115),s=a(528),o=a(9529),l=a(2219);let i=(0,r.createContext)(),c=()=>{let e=(0,r.useContext)(i);if(!e)throw Error("useGameContext must be used within a GameProvider");return e},u={MAIN_MENU:"MAIN_MENU",GAME:"GAME",SETTINGS:"SETTINGS",CREDITS:"CREDITS",RESULT:"RESULT",RANKING:"RANKING"},d={difficulty:s.Ke.NORMAL,soundEnabled:!0,bgmEnabled:!0,bgmVolume:.5,sfxEnabled:!0,sfxVolume:1,requiredProblemCount:8,highPerformanceMode:!0,useRefactoredGameScreen:!1},m={level:1,solvedCount:0,currentProblemIndex:0,typingProgress:"",mistakes:0,isGameOver:!1,isGameClear:!1,playerName:"プレイヤー",correctKeyCount:0,startTime:null,endTime:null,hasStartedTyping:!1,problemKPMs:[],currentProblemStartTime:null,currentProblemKeyCount:0},g=e=>{let{children:t}=e,[a,c]=(0,r.useState)(u.MAIN_MENU),[g,_]=(0,r.useState)(d),[y,p]=(0,r.useState)([]),[h,x]=(0,r.useState)({...m});(0,r.useEffect)(()=>{try{let e=l.Ay.getGameSettings(d);_(e);let t=l.Ay.getUsername();t&&x(e=>({...e,playerName:t}));let a=(0,s.hb)(e.difficulty);p(a),l.Ay.applyBackgroundFromStorage(),l.Ay.saveLastPlayedDate(),console.log("[GameContext] サウンドシステムの初期化を実行..."),o.A.initializeAllSounds().then(e=>{e&&console.log("[GameContext] 効果音の先行ロード完了")}),console.log("[GameContext] 初期化完了")}catch(e){console.error("[GameContext] 初期化エラー:",e)}},[]),(0,r.useEffect)(()=>{try{l.Ay.saveGameSettings(g);let e=(0,s.hb)(g.difficulty);p(e),console.log("[GameContext] 難易度「".concat(g.difficulty,"」に更新"))}catch(e){console.error("[GameContext] 難易度更新エラー:",e)}},[g.difficulty]),(0,r.useEffect)(()=>{try{let e=g.soundEnabled;o.A.setSfxEnabled(e&&g.sfxEnabled),o.A.setSfxVolume(g.sfxVolume),o.A.setBgmEnabled(e&&g.bgmEnabled),o.A.setBgmVolume(g.bgmVolume),console.log("[GameContext] サウンド設定更新: SFX=".concat(e&&g.sfxEnabled,", BGM=").concat(e&&g.bgmEnabled))}catch(e){console.error("[GameContext] サウンド設定更新エラー:",e)}},[g.soundEnabled,g.sfxEnabled,g.sfxVolume,g.bgmEnabled,g.bgmVolume]),(0,r.useEffect)(()=>{try{l.Ay.isAdminMode()&&(l.Ay.applyScreenBackground(a),console.log("[GameContext] 画面背景更新: ".concat(a)))}catch(e){console.error("[GameContext] 背景更新エラー:",e)}},[a]);let f=(0,r.useCallback)(()=>{try{let e=g.requiredProblemCount||d.requiredProblemCount;console.log("[GameContext] ゲームリセット - 難易度設定:",{設定難易度:g.difficulty,問題数:e});let t=(0,s.hb)(g.difficulty,e);p(t);let a=t&&t.length>0?t[0]:null;if(!a)return void console.error("[ERROR] 初期問題を設定できません。問題データが不足しています。");let n={...m,currentProblem:a,problems:t,requiredProblemCount:e,playerName:l.Ay.getUsername()||m.playerName,difficulty:g.difficulty,category:"all"};x(n),console.log("[GameContext] ゲームリセット完了",n)}catch(e){console.error("[GameContext] ゲームリセットエラー:",e)}},[g.difficulty,g.requiredProblemCount]),S=(0,r.useCallback)(e=>{Object.values(u).includes(e)?(e===u.GAME&&f(),c(e),console.log("[GameContext] 画面遷移: ".concat(e))):console.error("[ERROR] 無効な画面: ".concat(e))},[f]),b=(0,r.useCallback)(()=>y[h.currentProblemIndex]||null,[y,h.currentProblemIndex]),v=(0,r.useCallback)(e=>{e&&"string"==typeof e&&(x(t=>({...t,playerName:e})),l.Ay.saveUsername(e),console.log("[GameContext] ユーザー名を設定: ".concat(e)))},[]),k=(0,r.useCallback)(e=>{try{let t={...g,...e};_(t),l.Ay.saveGameSettings(t),console.log("[GameContext] 設定を更新しました")}catch(e){console.error("[GameContext] 設定更新エラー:",e)}},[g]),T=(0,r.useCallback)(e=>{try{if(e&&e.kpm)return l.Ay.saveHighScore(g.difficulty,e),console.log("[GameContext] ゲーム結果保存: KPM=".concat(e.kpm)),!0;return!1}catch(e){return console.error("[GameContext] ゲーム結果保存エラー:",e),!1}},[g.difficulty]),C=(0,r.useCallback)(e=>{Object.values(s.Ke).includes(e)?(k({difficulty:e}),console.log("[GameContext] 難易度変更: ".concat(e))):console.error("[ERROR] 無効な難易度: ".concat(e))},[k]),E={currentScreen:a,navigateTo:S,settings:g,setSettings:k,gameState:h,setGameState:x,resetGame:f,problems:y,getCurrentProblem:b,setUsername:v,saveGameResult:T,changeDifficulty:C,isAdminMode:l.Ay.isAdminMode};return(0,n.jsx)(i.Provider,{value:E,children:t})}},2937:e=>{e.exports={resultContainer:"ResultScreen_resultContainer__v7Rr_",resultHeader:"ResultScreen_resultHeader__79lqO",resultTitle:"ResultScreen_resultTitle__8lPNA",escHint:"ResultScreen_escHint__E1hWu",pulse:"ResultScreen_pulse__GNsrL",resultSubtitle:"ResultScreen_resultSubtitle__Rc3FZ",resultContent:"ResultScreen_resultContent__CZiXS",rankDisplay:"ResultScreen_rankDisplay__qK1SC",rankValue:"ResultScreen_rankValue__5m3F7",rankLabel:"ResultScreen_rankLabel__V1cz3",rankBackdrop:"ResultScreen_rankBackdrop__A4PAd",statsContainer:"ResultScreen_statsContainer__sNIeF",statCard:"ResultScreen_statCard__MNuue",statValue:"ResultScreen_statValue__4_0Bz",statLabel:"ResultScreen_statLabel__9eivu",keyStatCard:"ResultScreen_keyStatCard__yJWh2",rankCard:"ResultScreen_rankCard__mBR9f",rankGlow:"ResultScreen_rankGlow__BEN_P",buttonContainer:"ResultScreen_buttonContainer__ncbc3",resultButton:"ResultScreen_resultButton__3bC6W",scanlines:"ResultScreen_scanlines__GxIwx",dotPattern:"ResultScreen_dotPattern__FQ_Xu",cornerDecoration:"ResultScreen_cornerDecoration__zhSBD",cornerTech:"ResultScreen_cornerTech__tD_Wc"}},2942:e=>{e.exports={error_boundary:"ErrorBoundary_error_boundary__OeuY9",error_container:"ErrorBoundary_error_container__wBl5s",pulse:"ErrorBoundary_pulse__4MFhF",error_title:"ErrorBoundary_error_title__316mE",error_message:"ErrorBoundary_error_message__evYyd",error_actions:"ErrorBoundary_error_actions__E128T",error_details:"ErrorBoundary_error_details__ZEgUX"}},4665:(e,t,a)=>{"use strict";a.d(t,{AU:()=>u,Ay:()=>k,HI:()=>d,R8:()=>m,Yl:()=>_});var n=a(3915),r=a(1115),s=a(6864),o=a(9980);let l={apiKey:"AIzaSyBB6UAYtMbTbf2pMlIAmz79MXPzLYx6ohg",authDomain:"manaby-typing.firebaseapp.com",databaseURL:"https://manaby-typing-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"manaby-typing",storageBucket:"manaby-typing.firebasestorage.app",messagingSenderId:"58110409261",appId:"1:58110409261:web:1f23739378545fab9196a4",measurementId:"G-FSD7ECC1B0"},i=null,c=null,u=()=>{if(!i)try{return i=(0,n.Wp)(l),c=(0,r.C3)(i),(0,s.P5)(i),console.log("Firebase initialized successfully"),!0}catch(e){return console.error("Firebase initialization failed:",e),!1}return!!i},d=async(e,t,a,n,s,l,i)=>{if(!u()||!c)return console.error("Firebase not initialized"),null;try{let u,d=Math.floor(t),m=parseFloat(a.toFixed(1)),g=new Date().toISOString(),_=i||(void 0!==o.A?o.A.getKPMRank(d):""),y=(0,r.KR)(c,"scores"),p=await (0,r.Jt)(y),h=null,x=null;if(p.exists()&&p.forEach(t=>{let a=t.val();a.playerName===e&&a.difficulty===l&&(h=t.key,x=a)}),h&&d>0){if(u=(0,r.jf)(y,h),!x||!(d>x.kpm)&&(d!==x.kpm||!(m>x.accuracy)))return console.log("既存のエントリーの方が良いスコアなので更新しません"),h;console.log("既存のエントリーを更新します:",h)}else u=(0,r.VC)(y);let f={score:d,stats:{kpm:d,accuracy:m,mistakes:s||0},timestamp:g,username:e||"Anonymous",playerName:e||"Anonymous",kpm:d,accuracy:m,time:n||0,mistakes:s||0,difficulty:l||"normal",date:g,timestamp_num:Date.now(),rank:_};return await (0,r.hZ)(u,f),console.log("オンラインランキングを保存しました - KPM: ".concat(d,", ランク: ").concat(_,", 正解率: ").concat(m,"%")),u.key}catch(e){return console.error("Error saving online ranking:",e),null}},m=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!u()||!c)return console.error("Firebase not initialized"),[];try{let a=(0,r.KR)(c,"scores"),n=await (0,r.Jt)(a);if(console.log("Firebase data retrieved for difficulty ".concat(e,":"),n.exists()),!n.exists())return console.log("No data available in Firebase"),[];let s=[];n.forEach(e=>{let t=e.val();s.push({id:e.key,...t})});let o=s.filter(t=>t.difficulty&&t.difficulty===e||t.gameMode===e||!t.difficulty&&!t.gameMode&&"normal"===e);console.log("Retrieved ".concat(s.length," total records, filtered to ").concat(o.length," records for difficulty: ").concat(e));let l={};return o.forEach(e=>{var t;let a=e.playerName||e.username||"Anonymous",n=void 0!==e.kpm?e.kpm:e.score||0,r=void 0!==e.accuracy?e.accuracy:(null==(t=e.stats)?void 0:t.accuracy)!==void 0?e.stats.accuracy:0;(!l[a]||n>l[a].kpm||n===l[a].kpm&&r>l[a].accuracy)&&(l[a]=e)}),Object.values(l).sort((e,t)=>{let a=void 0!==e.kpm?e.kpm:e.score||0,n=void 0!==t.kpm?t.kpm:t.score||0;if(n!==a)return n-a;{var r,s;let a=void 0!==e.accuracy?e.accuracy:(null==(r=e.stats)?void 0:r.accuracy)!==void 0?e.stats.accuracy:0;return(void 0!==t.accuracy?t.accuracy:(null==(s=t.stats)?void 0:s.accuracy)!==void 0?t.stats.accuracy:0)-a}}).slice(0,t)}catch(e){return console.error("Error fetching rankings:",e),[]}},g=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!u()||!c)return console.error("Firebase not initialized"),[];try{let a=(0,r.KR)(c,"scores"),n=await (0,r.Jt)(a);if(console.log("Recent Firebase data retrieved:",n.exists()),!n.exists())return console.log("No recent data available in Firebase"),[];let s=[];n.forEach(e=>{s.push({id:e.key,...e.val()})}),console.log("Retrieved ".concat(s.length," recent records"));let o=t?s.filter(e=>e.difficulty&&e.difficulty===t||e.gameMode===t||!e.difficulty&&!e.gameMode&&"normal"===t):s;console.log("Filtered to ".concat(o.length," records for difficulty: ").concat(t||"all"));let l={};return o.forEach(e=>{let t=e.playerName||e.username||"Anonymous",a=e.timestamp_num||(e.timestamp?new Date(e.timestamp).getTime():e.date?new Date(e.date).getTime():0);(!l[t]||a>l[t].timestamp)&&(l[t]={...e,timestamp:a})}),Object.values(l).sort((e,t)=>t.timestamp-e.timestamp).slice(0,e)}catch(e){return console.error("Error fetching recent rankings:",e),[]}},_=async()=>{if(!u()||!c)return console.error("Firebase not initialized"),[];try{let e=(0,r.KR)(c,"scores"),t=await (0,r.Jt)(e);if(console.log("DEBUG: Firebase connection test result:",t.exists()),!t.exists())return console.log("DEBUG: No data available in scores node"),[];let a=[];return t.forEach(e=>{a.push({id:e.key,...e.val()})}),console.log("DEBUG: Found ".concat(a.length," total records in database")),console.log("DEBUG: Sample record:",a.length>0?a[0]:"No records"),a}catch(e){return console.error("DEBUG: Error checking database:",e),[]}},y=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(!u()||!c)return console.error("Firebase not initialized"),null;try{let o=(0,r.KR)(c,"backgrounds"),l=(0,r.VC)(o),i=new Date().toISOString(),u=Date.now(),d=s;if(!d)try{let e=document.querySelector("#__next > div");if(e){let t=window.getComputedStyle(e);d={backgroundColor:t.backgroundColor,borderColor:t.borderColor,borderWidth:t.borderWidth,borderStyle:t.borderStyle,boxShadow:t.boxShadow,backgroundImage:""}}}catch(e){console.error("背景スタイル情報の取得に失敗しました:",e)}let m={playerName:e||"Anonymous",title:a||"".concat(e||"Anonymous","が保存した背景"),imageData:t,cssStyleInfo:d,metadata:{...n,createdAt:i},timestamp:i,timestamp_num:u};return await (0,r.hZ)(l,m),console.log("背景画像とスタイル情報を保存しました - 保存者: ".concat(e,", タイトル: ").concat(a)),l.key}catch(e){return console.error("Error saving background to Firebase:",e),null}},p=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;if(!u()||!c)return console.error("Firebase not initialized"),[];try{let t=(0,r.KR)(c,"backgrounds"),a=await (0,r.Jt)(t);if(!a.exists())return console.log("保存された背景画像データがありません"),[];let n=[];return a.forEach(e=>{n.push({id:e.key,...e.val()})}),n.sort((e,t)=>t.timestamp_num-e.timestamp_num).slice(0,e)}catch(e){return console.error("Error fetching backgrounds from Firebase:",e),[]}},h=async e=>{if(!u()||!c)return console.error("Firebase not initialized"),!1;try{let t=(0,r.KR)(c,"backgrounds/".concat(e));return await (0,r.hZ)(t,null),console.log("背景画像を削除しました - ID: ".concat(e)),!0}catch(e){return console.error("Error deleting background from Firebase:",e),!1}},x=async function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(!u()||!c)return console.error("Firebase not initialized"),null;try{let o=(0,r.KR)(c,"backgrounds"),l=(0,r.VC)(o),i=new Date().toISOString(),u=Date.now(),d=e||"ALL",m=s;if(!m)try{let e=document.querySelector("#__next > div");if(e){let t=window.getComputedStyle(e);m={backgroundColor:t.backgroundColor,borderColor:t.borderColor,borderWidth:t.borderWidth,borderStyle:t.borderStyle,boxShadow:t.boxShadow,backgroundImage:""}}}catch(e){console.error("背景スタイル情報の取得に失敗しました:",e)}let g=n||"".concat(t||"Anonymous","の").concat(f(d),"用背景"),_={playerName:t||"Anonymous",title:g,imageData:a,cssStyleInfo:m,screenId:d,metadata:{createdAt:i,type:"screen-specific-background",targetScreen:d},timestamp:i,timestamp_num:u};return await (0,r.hZ)(l,_),console.log("画面「".concat(f(d),"」用の背景を保存しました - 保存者: ").concat(t,", タイトル: ").concat(g)),l.key}catch(e){return console.error("Error saving screen background to Firebase:",e),null}},f=e=>({MAIN_MENU:"メインメニュー",GAME:"ゲーム画面",RESULT:"リザルト画面",RANKING:"ランキング画面",SETTINGS:"設定画面",CREDITS:"クレジット画面",ALL:"全画面"})[e]||e,S=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;if(!u()||!c)return console.error("Firebase not initialized"),[];try{let a=(0,r.KR)(c,"backgrounds"),n=await (0,r.Jt)(a);if(!n.exists())return console.log("保存された背景画像データがありません"),[];let s=[];return n.forEach(t=>{var a;let n=t.val();e&&n.screenId!==e&&"ALL"!==n.screenId&&(null==(a=n.metadata)?void 0:a.targetScreen)!==e&&n.screenId||s.push({id:t.key,...n})}),s.sort((e,t)=>t.timestamp_num-e.timestamp_num).slice(0,t)}catch(e){return console.error("Error fetching screen backgrounds from Firebase:",e),[]}},b=async e=>{if(!u()||!c)return console.error("Firebase not initialized"),!1;try{let t=(0,r.KR)(c,"scores"),a=await (0,r.Jt)(t);if(!a.exists())return console.log("削除対象のランキングデータがありません"),!0;let n=[];return a.forEach(t=>{let a=t.val();if((a.difficulty||a.gameMode||"normal")===e){let e=(0,r.KR)(c,"scores/".concat(t.key));n.push((0,r.hZ)(e,null))}}),n.length>0&&await Promise.all(n),console.log("難易度「".concat(e,"」のランキングデータを").concat(n.length,"件削除しました")),!0}catch(t){return console.error("難易度「".concat(e,"」のランキング削除中にエラーが発生しました:"),t),!1}},v=async()=>{if(!u()||!c)return console.error("Firebase not initialized"),!1;try{let e=(0,r.KR)(c,"scores");return await (0,r.hZ)(e,null),console.log("すべてのランキングデータを削除しました"),!0}catch(e){return console.error("ランキングデータの削除中にエラーが発生しました:",e),!1}},k={initializeFirebase:u,saveOnlineRanking:d,getTopRankings:m,getRecentRankings:g,debugCheckAllRankings:_,saveBackgroundToFirebase:y,getBackgroundsFromFirebase:p,deleteBackgroundFromFirebase:h,saveScreenBackgroundToFirebase:x,getScreenBackgroundsFromFirebase:S,deleteRankingsByDifficulty:b,deleteAllRankings:v}},6144:e=>{e.exports={sound_settings:"SoundSettings_sound_settings__242MH","sound_settings--compact":"SoundSettings_sound_settings--compact__SztGN",sound_settings__section:"SoundSettings_sound_settings__section__pMinV",sound_settings__title:"SoundSettings_sound_settings__title__vgHfM",sound_settings__toggle:"SoundSettings_sound_settings__toggle__92jaU",sound_settings__volume_control:"SoundSettings_sound_settings__volume_control__IY_hg",sound_settings__volume_label:"SoundSettings_sound_settings__volume_label__8ha20",sound_settings__slider:"SoundSettings_sound_settings__slider__hESee",sound_settings__volume_value:"SoundSettings_sound_settings__volume_value__K2RFQ"}},6527:e=>{e.exports={modal:"Modal_modal__EMSm6",modal__overlay:"Modal_modal__overlay__uHy3L",modal__content:"Modal_modal__content__amxE3",modal__header:"Modal_modal__header__pc_vI",modal__body:"Modal_modal__body__t3NVI",modal__title:"Modal_modal__title__ze_zJ",modal__close_button:"Modal_modal__close_button__z82qy","modal--small":"Modal_modal--small__ShPD5","modal--large":"Modal_modal--large__wydrS"}},6646:(e,t,a)=>{"use strict";a.d(t,{dW:()=>u,yL:()=>c});var n=a(5155),r=a(2115),s=a(9529);let o={SOUND_ENABLED:"sound_soundEnabled",BGM_ENABLED:"sound_bgmEnabled",BGM_VOLUME:"sound_bgmVolume",SFX_ENABLED:"sound_sfxEnabled",SFX_VOLUME:"sound_sfxVolume"},l={soundEnabled:!0,bgmEnabled:!0,bgmVolume:.5,sfxEnabled:!0,sfxVolume:1},i=(0,r.createContext)(null),c=()=>{let e=(0,r.useContext)(i);if(!e)throw Error("useSoundContext must be used within a SoundProvider");return e},u=e=>{let{children:t}=e,[a,c]=(0,r.useState)(l),u=(0,r.useCallback)(()=>{if(!window.localStorage)return l;try{let e={soundEnabled:"true"===localStorage.getItem(o.SOUND_ENABLED),bgmEnabled:"true"===localStorage.getItem(o.BGM_ENABLED),bgmVolume:parseFloat(localStorage.getItem(o.BGM_VOLUME)||"0.5"),sfxEnabled:"true"===localStorage.getItem(o.SFX_ENABLED),sfxVolume:parseFloat(localStorage.getItem(o.SFX_VOLUME)||"1.0")},t={soundEnabled:null!==localStorage.getItem(o.SOUND_ENABLED)?e.soundEnabled:l.soundEnabled,bgmEnabled:null!==localStorage.getItem(o.BGM_ENABLED)?e.bgmEnabled:l.bgmEnabled,bgmVolume:isNaN(e.bgmVolume)?l.bgmVolume:Math.max(0,Math.min(1,e.bgmVolume)),sfxEnabled:null!==localStorage.getItem(o.SFX_ENABLED)?e.sfxEnabled:l.sfxEnabled,sfxVolume:isNaN(e.sfxVolume)?l.sfxVolume:Math.max(0,Math.min(1,e.sfxVolume))};return console.log("[SoundContext] 設定を読み込みました:",t),t}catch(e){return console.error("[SoundContext] 設定の読み込みに失敗しました:",e),l}},[]),d=(0,r.useCallback)(e=>{if(!window.localStorage)return!1;try{return localStorage.setItem(o.SOUND_ENABLED,e.soundEnabled),localStorage.setItem(o.BGM_ENABLED,e.bgmEnabled),localStorage.setItem(o.BGM_VOLUME,e.bgmVolume),localStorage.setItem(o.SFX_ENABLED,e.sfxEnabled),localStorage.setItem(o.SFX_VOLUME,e.sfxVolume),console.log("[SoundContext] 設定を保存しました:",e),!0}catch(e){return console.error("[SoundContext] 設定の保存に失敗しました:",e),!1}},[]);(0,r.useEffect)(()=>{let e=u();c(e),s.A.setSfxEnabled(e.soundEnabled&&e.sfxEnabled),s.A.setSfxVolume(e.sfxVolume),s.A.setBgmEnabled(e.soundEnabled&&e.bgmEnabled),s.A.setBgmVolume(e.bgmVolume),console.log("[SoundContext] SoundUtilsに設定を適用しました"),s.A.initializeAllSounds().then(e=>{e?console.log("[SoundContext] 基本効果音のプリロードに成功しました"):(console.warn("[SoundContext] 一部の効果音のロードに失敗しました"),setTimeout(()=>{Promise.all([s.A.loadSound("success",s.A.soundPresets.success),s.A.loadSound("error",s.A.soundPresets.error)]).catch(e=>console.warn("[SoundContext] タイピング音声の再ロードも失敗:",e))},2e3))}).catch(e=>{console.error("[SoundContext] 効果音の初期化中にエラーが発生しました:",e)})},[u]);let m=(0,r.useCallback)(e=>{c(t=>{let a={...t,...e};return("soundEnabled"in e||"sfxEnabled"in e)&&s.A.setSfxEnabled(a.soundEnabled&&a.sfxEnabled),"sfxVolume"in e&&s.A.setSfxVolume(a.sfxVolume),("soundEnabled"in e||"bgmEnabled"in e)&&s.A.setBgmEnabled(a.soundEnabled&&a.bgmEnabled),"bgmVolume"in e&&s.A.setBgmVolume(a.bgmVolume),d(a),a})},[d]),g=(0,r.useCallback)(()=>{m({soundEnabled:!a.soundEnabled})},[a.soundEnabled,m]),_=(0,r.useCallback)(()=>{m({bgmEnabled:!a.bgmEnabled})},[a.bgmEnabled,m]),y=(0,r.useCallback)(()=>{m({sfxEnabled:!a.sfxEnabled})},[a.sfxEnabled,m]),p=(0,r.useCallback)(e=>{m({bgmVolume:Math.max(0,Math.min(1,e))})},[m]),h=(0,r.useCallback)(e=>{m({sfxVolume:Math.max(0,Math.min(1,e))})},[m]),x=(0,r.useCallback)(()=>{a.soundEnabled&&a.sfxEnabled&&s.A.playSound("button")},[a.soundEnabled,a.sfxEnabled]),f={soundEnabled:a.soundEnabled,bgmEnabled:a.bgmEnabled,bgmVolume:a.bgmVolume,sfxEnabled:a.sfxEnabled,sfxVolume:a.sfxVolume,toggleSound:g,toggleBGM:_,toggleSFX:y,setBGMVolume:p,setSFXVolume:h,updateSoundSettings:m,playButtonSound:x,soundSystem:s.A};return(0,n.jsx)(i.Provider,{value:f,children:t})}},6786:(e,t,a)=>{"use strict";a.d(t,{j:()=>o});var n=a(2115),r=a(9980);let s={playSound:()=>{}};function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{initialProblem:t=null,playSound:a=!0,soundSystem:o=s,onProblemComplete:l=()=>{},onDebugInfoUpdate:i=null}=e,c=(0,n.useRef)(null),u=(0,n.useRef)(!1),[d,m]=(0,n.useState)(!1),[g,_]=(0,n.useState)(!1),[y,p]=(0,n.useState)(!1),h=(0,n.useRef)([]),x=(0,n.useRef)(!1),f=(0,n.useRef)(0),S=(0,n.useRef)(null),b=(0,n.useRef)(null),v=(0,n.useRef)(0),k=(0,n.useRef)({romaji:"",typedLength:0,currentInputLength:0,currentCharIndex:0,currentInput:"",expectedNextChar:"",currentCharRomaji:"",updated:Date.now()}),[T,C]=(0,n.useState)({romaji:"",typedLength:0,currentInputLength:0,currentCharIndex:0,currentInput:"",expectedNextChar:"",currentCharRomaji:""}),E=(0,n.useRef)(0),[I,M]=(0,n.useState)(0),N=(0,n.useRef)({correctKeyCount:0,mistakeCount:0,startTime:null,kpm:0}),[j,P]=(0,n.useState)({correctKeyCount:0,mistakeCount:0,kpm:0}),w=(0,n.useRef)(null),R=(0,n.useRef)(null),A=(0,n.useCallback)(()=>{p(!0),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{p(!1),w.current=null},150)},[]),B=(0,n.useCallback)(()=>{S.current&&cancelAnimationFrame(S.current),S.current=requestAnimationFrame(()=>{let e=performance.now();if(e-f.current>=16){f.current=e,C(e=>{let t={...k.current};return JSON.stringify(e)===JSON.stringify(t)?e:t});let t=E.current;Math.abs(t-I)>=5&&M(t),P(e=>{let t={...N.current};return JSON.stringify(e)===JSON.stringify(t)?e:t})}S.current=null})},[I]),G=(0,n.useCallback)(()=>{R.current&&clearInterval(R.current),R.current=setInterval(()=>{B()},50)},[B]),O=(0,n.useCallback)(e=>{if(!e)return!1;try{c.current;let t=r.A.createTypingSession(e);if(!t)return!1;c.current=t,u.current=!1;let a=t.getColoringInfo();return k.current={romaji:(null==a?void 0:a.romaji)||"",typedLength:0,currentInputLength:(null==a?void 0:a.currentInputLength)||0,currentCharIndex:(null==a?void 0:a.currentCharIndex)||0,currentInput:(null==a?void 0:a.currentInput)||"",expectedNextChar:(null==a?void 0:a.expectedNextChar)||"",currentCharRomaji:(null==a?void 0:a.currentCharRomaji)||"",updated:Date.now()},E.current=0,N.current={correctKeyCount:0,mistakeCount:0,startTime:Date.now(),kpm:0},m(!0),_(!1),C({...k.current}),M(0),P({...N.current}),!0}catch(e){return console.error("[useHighPerformanceTyping] セッション初期化エラー:",e),!1}},[]),D=(0,n.useCallback)(()=>{if(u.current)return;u.current=!0,_(!0);let e=Date.now()-N.current.startTime,t=N.current.correctKeyCount,a=Math.round(t/e*6e4);N.current.kpm=a,l({problemKeyCount:t,problemElapsedMs:e,problemKPM:a}),B()},[l,B]),L=(0,n.useCallback)(e=>{if(!c.current||u.current)return{success:!1};try{var t,n,r,s,l,i,d,m;let u;if("function"==typeof c.current.accept){let a=c.current.accept(e);1===a?(u={success:!0,status:"input_accepted"},(null==(t=(n=c.current).isCompleted)?void 0:t.call(n))&&(u.status="all_completed")):u=-1===a?{success:!1,status:"wrong_input"}:{success:!1,status:"invalid_input"}}else{if("function"!=typeof c.current.processInput)return{success:!1,reason:"invalid_session"};u=c.current.processInput(e)}if(!u.success)return N.current.mistakeCount++,a&&o&&("function"==typeof o.ultraFastPlayTypingSound?o.ultraFastPlayTypingSound("error"):"function"==typeof o.playSound&&o.playSound("error")),p(!0),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{p(!1),w.current=null},150),{success:!1,reason:"incorrect_input"};{N.current.correctKeyCount++;let e=Date.now()-N.current.startTime;N.current.kpm=Math.round(N.current.correctKeyCount/e*6e4),a&&o&&("function"==typeof o.ultraFastPlayTypingSound?o.ultraFastPlayTypingSound("success"):"function"==typeof o.playSound&&o.playSound("success"));let t=(null==(r=(s=c.current).getColoringInfo)?void 0:r.call(s))||{};return k.current={romaji:t.romaji||"",typedLength:t.typedLength||0,currentInputLength:t.currentInputLength||0,currentCharIndex:t.currentCharIndex||0,currentInput:t.currentInput||"",expectedNextChar:t.expectedNextChar||"",currentCharRomaji:t.currentCharRomaji||"",updated:Date.now()},C({...k.current}),E.current=(null==(l=(i=c.current).getCompletionPercentage)?void 0:l.call(i))||0,("all_completed"===u.status||(null==(d=(m=c.current).isCompleted)?void 0:d.call(m))===!0)&&D(),{success:!0}}}catch(e){return console.error("[useHighPerformanceTyping] キー処理エラー:",e),{success:!1,reason:"processing_error"}}},[c,u,a,o,A,D]),V=(0,n.useCallback)(()=>{if(!x.current&&0!==h.current.length){x.current=!0;try{let e=Math.min(3,h.current.length),t=0;for(let a=0;a<e;a++){let e=h.current.shift();if(e&&(L(e),t++,u.current))break}}finally{x.current=!1,B(),h.current.length>0&&K()}}},[L,B,u]),K=(0,n.useCallback)(()=>{b.current||(b.current=requestAnimationFrame(e=>{b.current=null,e-v.current>=16?(v.current=e,V()):K()}))},[V]),F=(0,n.useCallback)(e=>{e&&"string"==typeof e&&0!==e.length&&(u.current||g||(h.current.push(e),K()))},[g,K]),q=(0,n.useCallback)(e=>{e.ctrlKey||e.altKey||e.metaKey||"Control"===e.key||"Alt"===e.key||"Meta"===e.key||"CapsLock"===e.key||"Shift"===e.key||"Tab"===e.key||"Escape"===e.key||F(e.key)},[F]),U=(0,n.useCallback)(()=>(window.addEventListener("keydown",q),()=>{window.removeEventListener("keydown",q)}),[q]);(0,n.useEffect)(()=>{t&&O(t)},[t,O]),(0,n.useEffect)(()=>{G();let e=setInterval(()=>{h.current.length>0&&!x.current&&K()},10),t=U();return()=>{t(),R.current&&(clearInterval(R.current),R.current=null),clearInterval(e),w.current&&(clearTimeout(w.current),w.current=null),S.current&&(cancelAnimationFrame(S.current),S.current=null),b.current&&(cancelAnimationFrame(b.current),b.current=null)}},[G,U,K]),(0,n.useEffect)(()=>{i&&i({bufferLength:h.current.length,sessionActive:!!c.current,correctKeyCount:N.current.correctKeyCount,mistakeCount:N.current.mistakeCount,kpm:N.current.kpm,progress:E.current,isCompleted:u.current})},[i,T,I,j]);let H=(0,n.useMemo)(()=>({length:h.current.length,processing:x.current,lastProcessTime:v.current}),[]);return(0,n.useMemo)(()=>({isInitialized:d,isCompleted:g,errorAnimation:y,displayInfo:T,progress:I,stats:j,sessionRef:c,completedRef:u,bufferState:H,handleInput:F,initializeSession:O,markAsCompleted:D,processKeyBuffer:V}),[d,g,y,T,I,j,H,F,O,D,V])}},7785:e=>{e.exports={fade_in:"GameStatusBar_fade_in__kMBeU",fadeIn:"GameStatusBar_fadeIn__shU4R",logo_animation:"GameStatusBar_logo_animation__PD64f",logoFadeIn:"GameStatusBar_logoFadeIn__fSEJL",status_bar:"GameStatusBar_status_bar__JeGwC",empty_bar:"GameStatusBar_empty_bar__MM97W",logo_container:"GameStatusBar_logo_container__IiJqk",manaby_logo:"GameStatusBar_manaby_logo__Nn9Op",status_info:"GameStatusBar_status_info__imU2E",status_item:"GameStatusBar_status_item__elgdV",status_label:"GameStatusBar_status_label__ws42F",status_value:"GameStatusBar_status_value__lpYBC",status_rank:"GameStatusBar_status_rank__WzXS3",level_display:"GameStatusBar_level_display__rEibH",level_text:"GameStatusBar_level_text__8UN3U",progress_bar:"GameStatusBar_progress_bar__nbOcs",progress_fill:"GameStatusBar_progress_fill__W953B",combo_container:"GameStatusBar_combo_container__JslVE",combo_value:"GameStatusBar_combo_value__D7U0h",combo_label:"GameStatusBar_combo_label__sRM1p",stats_container:"GameStatusBar_stats_container__ct0MW",score_display:"GameStatusBar_score_display__9oKyN",score_label:"GameStatusBar_score_label__0VaT0",score_value:"GameStatusBar_score_value__Cvdk6",rank_display:"GameStatusBar_rank_display__CcjZv",rank_label:"GameStatusBar_rank_label__TjkJW",rank_value:"GameStatusBar_rank_value__AglP3",rank_s:"GameStatusBar_rank_s__1w62L",rank_a:"GameStatusBar_rank_a__zZEWC",rank_b:"GameStatusBar_rank_b__oWKZz",rank_c:"GameStatusBar_rank_c__1o4OX",rank_d:"GameStatusBar_rank_d__cYZJ4",rank_f:"GameStatusBar_rank_f__jmhY0",typing_stats:"GameStatusBar_typing_stats__ortLF",kpm_display:"GameStatusBar_kpm_display__aELFH",kpm_label:"GameStatusBar_kpm_label__YHTOW",kpm_value:"GameStatusBar_kpm_value__XuN4D",completion:"GameStatusBar_completion__WgZTz"}},8618:e=>{e.exports={rankingContainer:"RankingScreen_rankingContainer__5fh4X",rankingHeader:"RankingScreen_rankingHeader__3SyFQ",rankingTitle:"RankingScreen_rankingTitle__igbNU",difficultyNav:"RankingScreen_difficultyNav__lipCh",difficultyButton:"RankingScreen_difficultyButton__xzqEg",difficultyButton__active:"RankingScreen_difficultyButton__active__3pcds",rankingContent:"RankingScreen_rankingContent__LPH4z",tableContainer:"RankingScreen_tableContainer__8GFWz",rankingTable:"RankingScreen_rankingTable__c0E4S",noRecords:"RankingScreen_noRecords__yHgIp",onlineModeToggle:"RankingScreen_onlineModeToggle__ZYiUe",modeButton:"RankingScreen_modeButton__iYQFa",modeButton__active:"RankingScreen_modeButton__active__a_uaP",buttonContainer:"RankingScreen_buttonContainer__mtwyV",registerButton:"RankingScreen_registerButton__QkBHe",disabledButton:"RankingScreen_disabledButton__TF9OV",backButton:"RankingScreen_backButton__yF95g",mainMenuButton:"RankingScreen_mainMenuButton__mF4Ib",debugButton:"RankingScreen_debugButton__OYmTj",modalOverlay:"RankingScreen_modalOverlay__qi5nD",modalContent:"RankingScreen_modalContent__DtQPc",cornerDecoration:"RankingScreen_cornerDecoration__7DYV7",cornerTech:"RankingScreen_cornerTech__lNB_b",modalHeader:"RankingScreen_modalHeader__J3hMS",modalTitle:"RankingScreen_modalTitle__IAvZD",closeButton:"RankingScreen_closeButton__Zrh4C",modalBody:"RankingScreen_modalBody__BPdG5",scanlines:"RankingScreen_scanlines__X2Kgb",dotPattern:"RankingScreen_dotPattern__dvlBW",modalFooter:"RankingScreen_modalFooter__4ofb9",inputGroup:"RankingScreen_inputGroup__FzEUB",nameInput:"RankingScreen_nameInput__nkcpf",scorePreview:"RankingScreen_scorePreview__BTbnj",previewItem:"RankingScreen_previewItem__pjGYc",statusMessage:"RankingScreen_statusMessage__HaIu5",successMessage:"RankingScreen_successMessage__53TLe",errorMessage:"RankingScreen_errorMessage__1iitL",modalActions:"RankingScreen_modalActions__xEYr7",registerActionButton:"RankingScreen_registerActionButton__vwSPc",cancelButton:"RankingScreen_cancelButton__7y_Ly",loadingSpinner:"RankingScreen_loadingSpinner__7gdef",spin:"RankingScreen_spin__oYweb"}},9254:e=>{e.exports={mainContainer:"MainMenu_mainContainer__12qmh",earlyAccessBadge:"MainMenu_earlyAccessBadge___OMwy",pulse:"MainMenu_pulse__GbdRa",titleContainer:"MainMenu_titleContainer__QIxi8",title:"MainMenu_title__Cei1U",subTitleContainer:"MainMenu_subTitleContainer__2ERhH",subTitle:"MainMenu_subTitle__6G1CQ",titleDecoration:"MainMenu_titleDecoration__o5UCq",menuContainer:"MainMenu_menuContainer__9ZLlc",logoContainer:"MainMenu_logoContainer__3CVXg",startButton:"MainMenu_startButton__46LI8",logoImage:"MainMenu_logoImage__Yok1d",difficultyToggleGroup:"MainMenu_difficultyToggleGroup__uqB3l",difficultyToggleButton:"MainMenu_difficultyToggleButton__iLQZ9",btnText:"MainMenu_btnText__VDOoL",active:"MainMenu_active__CsNux",instructions:"MainMenu_instructions__c2fXk",instructionText:"MainMenu_instructionText__jkD7I",pulsateText:"MainMenu_pulsateText__oNHCh",statusBar:"MainMenu_statusBar__SnyFY",statusItem:"MainMenu_statusItem__P5GVn",statusLabel:"MainMenu_statusLabel__IEJpz",statusValue:"MainMenu_statusValue__UjCkv",statusDivider:"MainMenu_statusDivider__KqyiF",shipIdBadge:"MainMenu_shipIdBadge__Ssz7q",shipIdLabel:"MainMenu_shipIdLabel__xuww2",shipIdValue:"MainMenu_shipIdValue__A2cFy",cornerButtons:"MainMenu_cornerButtons__37I9i",iconButton:"MainMenu_iconButton__YUba0",gearIcon:"MainMenu_gearIcon__fmBAW",gearInner:"MainMenu_gearInner__0YZXq",creditButton:"MainMenu_creditButton__2pr2g",mascotContainer:"MainMenu_mascotContainer__n4wU2",float:"MainMenu_float__k_B8t",mascotImage:"MainMenu_mascotImage__5cdjq",wiggle:"MainMenu_wiggle__cNoa1",cornerDecoration:"MainMenu_cornerDecoration__J17N_",cornerTech:"MainMenu_cornerTech__rbYD4",cornerLine:"MainMenu_cornerLine__T5S_k",techBorder:"MainMenu_techBorder__Dwk1l",techLights:"MainMenu_techLights___S_aj",techLightBlink:"MainMenu_techLightBlink__4woEL",scanlines:"MainMenu_scanlines__lquzv",dotPattern:"MainMenu_dotPattern__UGxSb",startButtonFrame:"MainMenu_startButtonFrame__ZR_9T",frameCorner:"MainMenu_frameCorner__BQdQw",keyboardShortcuts:"MainMenu_keyboardShortcuts__rLiaa",shortcutsHeader:"MainMenu_shortcutsHeader__fAxuY",shortcutsDecoration:"MainMenu_shortcutsDecoration__DL4Jh",shortcutsList:"MainMenu_shortcutsList__1S_y4",shortcutItem:"MainMenu_shortcutItem__hjZ3G",developerOptions:"MainMenu_developerOptions__j4_99",developerOptionTitle:"MainMenu_developerOptionTitle__vgujF",optionRow:"MainMenu_optionRow__5RV_M",optionLabel:"MainMenu_optionLabel__H8c7H",optionDescription:"MainMenu_optionDescription__G6w6a",versionInfo:"MainMenu_versionInfo__PJZTR",debugInfo:"MainMenu_debugInfo__oyp7f",devButton:"MainMenu_devButton__Fv7f4",devIcon:"MainMenu_devIcon__9R6hC",blink:"MainMenu_blink__SYv53",scanline:"MainMenu_scanline__EFGIm"}}}]);